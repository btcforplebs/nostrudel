import { debugLog } from "./debug";
// import { parseZap } from "../../system/src/zaps";
// placeholder:
const parseZap = (_zap) => {
    return { event: null };
};
const log = (msg, ...args) => debugLog("getForYouFeed", msg, ...args);
export async function getForYouFeed(relay, pubkey) {
    console.time("For You feed generation time");
    log("pubkey", pubkey);
    // Get events reacted to by me
    const myReactedEventIds = await getMyReactedEvents(relay, pubkey);
    log("my reacted events", myReactedEventIds);
    const myReactedAuthors = await getMyReactedAuthors(relay, myReactedEventIds, pubkey);
    log("my reacted authors", myReactedAuthors);
    // Get others who reacted to the same events as me
    const othersWhoReacted = await getOthersWhoReacted(relay, myReactedEventIds, pubkey);
    // this tends to be small when the user has just logged in, we should maybe subscribe for more from relays
    log("others who reacted", othersWhoReacted);
    // Get event ids reacted to by those others
    const reactedByOthers = await getEventIdsReactedByOthers(relay, othersWhoReacted, myReactedEventIds, pubkey);
    log("reacted by others", reactedByOthers);
    // Get full events in sorted order
    const feed = await getFeedEvents(relay, reactedByOthers, myReactedAuthors);
    log("feed.length", feed.length);
    console.timeEnd("For You feed generation time");
    return feed;
}
async function getMyReactedAuthors(relay, myReactedEventIds, myPubkey) {
    const myReactedAuthors = new Map();
    const myReactions = relay.req("getMyReactedAuthors", {
        "#e": Array.from(myReactedEventIds),
    });
    myReactions.forEach(reaction => {
        if (reaction.pubkey !== myPubkey) {
            myReactedAuthors.set(reaction.pubkey, (myReactedAuthors.get(reaction.pubkey) || 0) + 1);
        }
    });
    return myReactedAuthors;
}
async function getMyReactedEvents(relay, pubkey) {
    const myReactedEventIds = new Set();
    const myEvents = relay.req("getMyReactedEventIds", {
        authors: [pubkey],
        kinds: [1, 6, 7, 9735],
    });
    myEvents.forEach(ev => {
        const targetEventId = ev.kind === 9735 ? parseZap(ev).event?.id : ev.tags.find((tag) => tag[0] === "e")?.[1];
        if (targetEventId) {
            myReactedEventIds.add(targetEventId);
        }
    });
    return myReactedEventIds;
}
async function getOthersWhoReacted(relay, myReactedEventIds, myPubkey) {
    const othersWhoReacted = new Map();
    const otherReactions = relay.req("getOthersWhoReacted", {
        "#e": Array.from(myReactedEventIds),
    });
    otherReactions.forEach(reaction => {
        if (reaction.pubkey !== myPubkey) {
            othersWhoReacted.set(reaction.pubkey, (othersWhoReacted.get(reaction.pubkey) || 0) + 1);
        }
    });
    return othersWhoReacted;
}
async function getEventIdsReactedByOthers(relay, othersWhoReacted, myReactedEvents, myPub) {
    const eventIdsReactedByOthers = new Map();
    const events = relay.req("getEventIdsReactedByOthers", {
        authors: [...othersWhoReacted.keys()],
        kinds: [1, 6, 7, 9735],
    });
    events.forEach(event => {
        if (event.pubkey === myPub || myReactedEvents.has(event.id)) {
            // NIP-113 NOT filter could improve performance by not selecting these events in the first place
            return;
        }
        event.tags.forEach((tag) => {
            if (tag[0] === "e") {
                const score = Math.ceil(Math.sqrt(othersWhoReacted.get(event.pubkey) || 0));
                eventIdsReactedByOthers.set(tag[1], (eventIdsReactedByOthers.get(tag[1]) || 0) + score);
            }
        });
    });
    return eventIdsReactedByOthers;
}
async function getFeedEvents(relay, reactedToIds, reactedToAuthors) {
    const events = relay
        .sql(`select json from events where id in (${Array.from(reactedToIds.keys())
        .map(() => "?")
        .join(", ")}) and kind = 1 order by seen_at ASC, created DESC limit 1000`, Array.from(reactedToIds.keys()))
        .map(row => JSON.parse(row[0]));
    const seen = new Set(events.map(ev => ev.id));
    log("reactedToAuthors", reactedToAuthors);
    const favoriteAuthors = Array.from(reactedToAuthors.keys())
        .sort((a, b) => reactedToAuthors.get(b) - reactedToAuthors.get(a))
        .slice(20);
    const eventsByFavoriteAuthors = relay
        .sql(`select json from events where pubkey in (${favoriteAuthors
        .map(() => "?")
        .join(", ")}) and kind = 1 order by seen_at ASC, created DESC limit 100`, favoriteAuthors)
        .map(row => JSON.parse(row[0]));
    eventsByFavoriteAuthors.forEach(ev => {
        if (!seen.has(ev.id)) {
            events.push(ev);
        }
    });
    // Filter out replies
    const filteredEvents = events.filter(ev => !ev.tags.some((tag) => tag[0] === "e"));
    // Define constants for normalization
    // const recentnessWeight = -1;
    const currentTime = new Date().getTime();
    // Calculate min and max for normalization
    let minReactions = Infinity, maxReactions = -Infinity;
    let minAge = Infinity, maxAge = -Infinity;
    filteredEvents.forEach(event => {
        const reactions = reactedToIds.get(event.id) || 0;
        minReactions = Math.min(minReactions, reactions);
        maxReactions = Math.max(maxReactions, reactions);
        const age = currentTime - new Date(event.created_at).getTime();
        minAge = Math.min(minAge, age);
        maxAge = Math.max(maxAge, age);
    });
    const normalize = (value, min, max) => (value - min) / (max - min);
    const maxFavoriteness = Math.max(...Array.from(reactedToAuthors.values()));
    const favoritenessWeight = 0.5;
    // Normalize and sort events by calculated score
    filteredEvents.sort((a, b) => {
        const aReactions = normalize(reactedToIds.get(a.id) || 0, minReactions, maxReactions);
        const bReactions = normalize(reactedToIds.get(b.id) || 0, minReactions, maxReactions);
        const aAge = normalize(currentTime - new Date(a.created_at).getTime(), minAge, maxAge);
        const bAge = normalize(currentTime - new Date(b.created_at).getTime(), minAge, maxAge);
        const aFavoriteness = normalize(reactedToAuthors.get(a.pubkey) || 0, 0, maxFavoriteness);
        const bFavoriteness = normalize(reactedToAuthors.get(b.pubkey) || 0, 0, maxFavoriteness);
        // randomly big or small weight for recentness
        const recentnessWeight = Math.random() > 0.75 ? -0.1 : -10;
        const aScore = aReactions + recentnessWeight * aAge + aFavoriteness * favoritenessWeight;
        const bScore = bReactions + recentnessWeight * bAge + bFavoriteness * favoritenessWeight;
        // Sort by descending score
        return bScore - aScore;
    });
    return filteredEvents;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZm9yWW91RmVlZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uL3NyYy9mb3JZb3VGZWVkLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxRQUFRLEVBQUUsTUFBTSxTQUFTLENBQUM7QUFHbkMsb0RBQW9EO0FBQ3BELGVBQWU7QUFDZixNQUFNLFFBQVEsR0FBRyxDQUFDLElBQWdCLEVBQUUsRUFBRTtJQUNwQyxPQUFPLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBa0MsQ0FBQztBQUN6RCxDQUFDLENBQUM7QUFFRixNQUFNLEdBQUcsR0FBRyxDQUFDLEdBQVcsRUFBRSxHQUFHLElBQWdCLEVBQUUsRUFBRSxDQUFDLFFBQVEsQ0FBQyxlQUFlLEVBQUUsR0FBRyxFQUFFLEdBQUcsSUFBSSxDQUFDLENBQUM7QUFFMUYsTUFBTSxDQUFDLEtBQUssVUFBVSxhQUFhLENBQUMsS0FBbUIsRUFBRSxNQUFjO0lBQ3JFLE9BQU8sQ0FBQyxJQUFJLENBQUMsOEJBQThCLENBQUMsQ0FBQztJQUU3QyxHQUFHLENBQUMsUUFBUSxFQUFFLE1BQU0sQ0FBQyxDQUFDO0lBRXRCLDhCQUE4QjtJQUM5QixNQUFNLGlCQUFpQixHQUFHLE1BQU0sa0JBQWtCLENBQUMsS0FBSyxFQUFFLE1BQU0sQ0FBQyxDQUFDO0lBQ2xFLEdBQUcsQ0FBQyxtQkFBbUIsRUFBRSxpQkFBaUIsQ0FBQyxDQUFDO0lBRTVDLE1BQU0sZ0JBQWdCLEdBQUcsTUFBTSxtQkFBbUIsQ0FBQyxLQUFLLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxDQUFDLENBQUM7SUFDckYsR0FBRyxDQUFDLG9CQUFvQixFQUFFLGdCQUFnQixDQUFDLENBQUM7SUFFNUMsa0RBQWtEO0lBQ2xELE1BQU0sZ0JBQWdCLEdBQUcsTUFBTSxtQkFBbUIsQ0FBQyxLQUFLLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxDQUFDLENBQUM7SUFDckYsMEdBQTBHO0lBQzFHLEdBQUcsQ0FBQyxvQkFBb0IsRUFBRSxnQkFB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