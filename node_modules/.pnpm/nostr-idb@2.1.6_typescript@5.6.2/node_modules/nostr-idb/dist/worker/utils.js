import { sendMessageToRelay, } from "../relay/relay-message-bus.js";
export function connectRelayToWorkerContext(core, rx, tx) {
    rx((event) => {
        const isString = typeof event.data === "string";
        let data = event.data;
        try {
            if (typeof data === "string")
                data = JSON.parse(data);
            if (Array.isArray(data)) {
                sendMessageToRelay(core, data, (message) => {
                    if (isString)
                        tx(JSON.stringify(message));
                    else
                        tx(message);
                });
            }
        }
        catch (e) { }
    });
}
export function connectRelayToMessagePort(core, port) {
    connectRelayToWorkerContext(core, (listener) => port.addEventListener("message", listener), (message) => port.postMessage(message));
}
