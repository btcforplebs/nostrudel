export const ProfileContentSymbol = Symbol.for("profile-content");
export function getProfileContent(event, quite = false) {
    let cached = event[ProfileContentSymbol];
    if (!cached) {
        try {
            const profile = JSON.parse(event.content);
            // ensure nip05 is a string
            if (profile.nip05 && typeof profile.nip05 !== "string")
                profile.nip05 = String(profile.nip05);
            cached = event[ProfileContentSymbol] = profile;
        }
        catch (e) {
            if (e instanceof Error)
                cached = event[ProfileContentSymbol] = e;
        }
    }
    if (cached === undefined) {
        throw new Error("Failed to parse profile");
    }
    else if (cached instanceof Error) {
        if (!quite)
            throw cached;
        else
            return cached;
    }
    else
        return cached;
}
