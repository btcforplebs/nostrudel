{
  "version": 3,
  "sources": ["../../.pnpm/react-simplemde-editor@5.2.0_easymde@2.18.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/react-simplemde-editor/src/SimpleMdeReact.tsx"],
  "sourcesContent": ["import React, {\n  useCallback,\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n} from \"react\";\nimport SimpleMDE, { Options } from \"easymde\";\n\nimport type { Editor, EditorEventMap, KeyMap, Position } from \"codemirror\";\nimport { EditorChange } from \"codemirror\";\n\nlet _id = 0;\n\nconst generateId = () => `simplemde-editor-${++_id}`;\n\nexport type DOMEvent =\n  | \"mousedown\"\n  | \"dblclick\"\n  | \"touchstart\"\n  | \"contextmenu\"\n  | \"keydown\"\n  | \"keypress\"\n  | \"keyup\"\n  | \"cut\"\n  | \"copy\"\n  | \"paste\"\n  | \"dragstart\"\n  | \"dragenter\"\n  | \"dragover\"\n  | \"dragleave\"\n  | \"drop\";\n\nexport type CopyEvents = {\n  [TKey in string &\n    DOMEvent &\n    keyof DocumentAndElementEventHandlersEventMap as `${TKey}`]?: (\n    instance: Editor,\n    event: DocumentAndElementEventHandlersEventMap[TKey]\n  ) => void;\n};\n\nexport type GlobalEvents = {\n  [TKey in string &\n    DOMEvent &\n    keyof GlobalEventHandlersEventMap as `${TKey}`]?: (\n    instance: Editor,\n    event: GlobalEventHandlersEventMap[TKey]\n  ) => void;\n};\n\nexport type DefaultEvent = (instance: Editor, ...args: any[]) => void;\n\nexport type IndexEventsSignature = {\n  [key: string]: DefaultEvent | undefined;\n};\n\nexport interface SimpleMdeToCodemirrorEvents\n  extends CopyEvents,\n    GlobalEvents,\n    IndexEventsSignature,\n    Partial<EditorEventMap> {}\n\nexport type GetMdeInstance = (instance: SimpleMDE) => void;\nexport type GetCodemirrorInstance = (instance: Editor) => void;\nexport type GetLineAndCursor = (instance: Position) => void;\n\nexport interface SimpleMDEReactProps\n  extends Omit<React.HTMLAttributes<HTMLDivElement>, \"onChange\"> {\n  id?: string;\n  onChange?: (value: string, changeObject?: EditorChange) => void;\n  value?: string;\n  extraKeys?: KeyMap;\n  options?: SimpleMDE.Options;\n  events?: SimpleMdeToCodemirrorEvents;\n  getMdeInstance?: GetMdeInstance;\n  getCodemirrorInstance?: GetCodemirrorInstance;\n  getLineAndCursor?: GetLineAndCursor;\n  placeholder?: string;\n  textareaProps?: Omit<\n    React.HTMLAttributes<HTMLTextAreaElement>,\n    \"id\" | \"style\" | \"placeholder\"\n  >;\n}\n\nconst useHandleEditorInstanceLifecycle = ({\n  options,\n  id,\n  currentValueRef,\n  textRef,\n}: {\n  options?: Options;\n  id: string;\n  currentValueRef: React.MutableRefObject<string | undefined>;\n  textRef: HTMLTextAreaElement | null;\n}) => {\n  const [editor, setEditor] = useState<SimpleMDE | null>(null);\n\n  const imageUploadCallback = useCallback(\n    (\n      file: File,\n      onSuccess: (url: string) => void,\n      onError: (error: string) => void\n    ) => {\n      const imageUpload = options?.imageUploadFunction;\n      if (imageUpload) {\n        const _onSuccess = (url: string) => {\n          onSuccess(url);\n        };\n        imageUpload(file, _onSuccess, onError);\n      }\n    },\n    [options?.imageUploadFunction]\n  );\n\n  const editorRef = useRef(editor);\n  editorRef.current = editor;\n\n  useEffect(() => {\n    let editor: SimpleMDE;\n    if (textRef) {\n      const initialOptions = {\n        element: textRef,\n        initialValue: currentValueRef.current,\n      };\n      const imageUploadFunction = options?.imageUploadFunction\n        ? imageUploadCallback\n        : undefined;\n      editor = new SimpleMDE(\n        Object.assign({}, initialOptions, options, {\n          imageUploadFunction,\n        })\n      );\n      setEditor(editor);\n    }\n    return () => {\n      editor?.toTextArea();\n      editor?.cleanup();\n    };\n  }, [textRef, currentValueRef, id, imageUploadCallback, options]);\n\n  const codemirror = useMemo(() => {\n    return editor?.codemirror;\n  }, [editor?.codemirror]) as Editor | undefined;\n  return { editor, codemirror };\n};\n\nexport const SimpleMdeReact = React.forwardRef<\n  HTMLDivElement,\n  SimpleMDEReactProps\n>((props, ref) => {\n  const {\n    events,\n    value,\n    options,\n    children,\n    extraKeys,\n    getLineAndCursor,\n    getMdeInstance,\n    getCodemirrorInstance,\n    onChange,\n    id: anId,\n    placeholder,\n    textareaProps,\n    ...rest\n  } = props;\n\n  const id = useMemo(() => anId ?? generateId(), [anId]);\n\n  const elementWrapperRef = useRef<HTMLDivElement | null>(null);\n  const nonEventChangeRef = useRef<boolean>(true);\n\n  // This is to not pass value as a dependency e.g. to keep event handlers referentially\n  // stable and do not `off` and `on` on each value change\n  // plus to avoid unnecessary EasyEde editor recreation on each value change while still, if it has to be remounted\n  // due to options and other deps change, to preserve that last value and not the default one from the first render.\n  const currentValueRef = useRef(value);\n  currentValueRef.current = value;\n\n  const [textRef, setTextRef] = useState<HTMLTextAreaElement | null>(null);\n  const { editor, codemirror } = useHandleEditorInstanceLifecycle({\n    options,\n    id,\n    currentValueRef,\n    textRef,\n  });\n\n  useEffect(() => {\n    // If change comes from the event we don't need to update `SimpleMDE` value as it already has it\n    // Otherwise we shall set it as it comes from `props` set from the outside. E.g. by some reset button and whatnot\n    if (nonEventChangeRef.current) {\n      editor?.value(value ?? \"\");\n    }\n    nonEventChangeRef.current = true;\n  }, [editor, value]); //  _: Editor | Event <===== is to please TS :)\n  const onCodemirrorChangeHandler = useCallback(\n    (_: Editor | Event, changeObject?: EditorChange) => {\n      if (editor?.value() !== currentValueRef.current) {\n        nonEventChangeRef.current = false;\n        onChange?.(editor?.value() ?? \"\", changeObject);\n      }\n    },\n    [editor, onChange]\n  );\n\n  useEffect(() => {\n    // For some reason it doesn't work out of the box, this makes sure it's working correctly\n    if (options?.autofocus) {\n      codemirror?.focus();\n      codemirror?.setCursor(codemirror?.lineCount(), 0);\n    }\n  }, [codemirror, options?.autofocus]);\n\n  const getCursorCallback = useCallback(() => {\n    // https://codemirror.net/doc/manual.html#api_selection\n    codemirror && getLineAndCursor?.(codemirror.getDoc().getCursor());\n  }, [codemirror, getLineAndCursor]);\n\n  useEffect(() => {\n    getCursorCallback();\n  }, [getCursorCallback]);\n\n  useEffect(() => {\n    editor && getMdeInstance?.(editor);\n  }, [editor, getMdeInstance]);\n\n  useEffect(() => {\n    codemirror && getCodemirrorInstance?.(codemirror);\n  }, [codemirror, getCodemirrorInstance, getMdeInstance]);\n\n  useEffect(() => {\n    // https://codemirror.net/doc/manual.html#option_extraKeys\n    if (extraKeys && codemirror) {\n      codemirror.setOption(\n        \"extraKeys\",\n        Object.assign({}, codemirror.getOption(\"extraKeys\"), extraKeys)\n      );\n    }\n  }, [codemirror, extraKeys]);\n\n  useEffect(() => {\n    const toolbarNode =\n      elementWrapperRef.current?.getElementsByClassName(\n        \"editor-toolbarNode\"\n      )[0];\n    const handler = codemirror && onCodemirrorChangeHandler;\n    if (handler) {\n      toolbarNode?.addEventListener(\"click\", handler);\n      return () => {\n        toolbarNode?.removeEventListener(\"click\", handler);\n      };\n    }\n    return () => {};\n  }, [codemirror, onCodemirrorChangeHandler]);\n\n  useEffect(() => {\n    codemirror?.on(\"change\", onCodemirrorChangeHandler);\n    codemirror?.on(\"cursorActivity\", getCursorCallback);\n    return () => {\n      codemirror?.off(\"change\", onCodemirrorChangeHandler);\n      codemirror?.off(\"cursorActivity\", getCursorCallback);\n    };\n  }, [codemirror, getCursorCallback, onCodemirrorChangeHandler]);\n\n  const prevEvents = useRef(events);\n\n  useEffect(() => {\n    const isNotFirstEffectRun = events !== prevEvents.current;\n    isNotFirstEffectRun &&\n      prevEvents.current &&\n      Object.entries(prevEvents.current).forEach(([event, handler]) => {\n        handler && codemirror?.off(event as keyof EditorEventMap, handler);\n      });\n\n    events &&\n      Object.entries(events).forEach(([event, handler]) => {\n        handler && codemirror?.on(event as keyof EditorEventMap, handler);\n      });\n    prevEvents.current = events;\n    return () => {\n      events &&\n        Object.entries(events).forEach(([event, handler]) => {\n          handler && codemirror?.off(event as keyof EditorEventMap, handler);\n        });\n    };\n  }, [codemirror, events]);\n\n  return (\n    <div\n      id={`${id}-wrapper`}\n      {...rest}\n      ref={(aRef) => {\n        if (typeof ref === \"function\") {\n          ref(aRef);\n        } else if (ref) {\n          ref.current = aRef;\n        }\n        elementWrapperRef.current = aRef;\n      }}\n    >\n      <textarea\n        {...textareaProps}\n        id={id}\n        placeholder={placeholder}\n        ref={setTextRef}\n        style={{ display: \"none\" }}\n      />\n    </div>\n  );\n});\n\nSimpleMdeReact.displayName = \"SimpleMdeReact\";\n\nexport default SimpleMdeReact;\n"],
  "mappings": "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",
  "names": ["editor", "SimpleMDE", "React"]
}
