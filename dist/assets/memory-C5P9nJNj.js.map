{"version":3,"file":"memory-C5P9nJNj.js","sources":["../../src/views/relays/cache/database/memory.tsx"],"sourcesContent":["import { useEffect, useMemo, useState } from \"react\";\nimport { Button, ButtonGroup, Card, Flex, Heading, Text, useForceUpdate } from \"@chakra-ui/react\";\nimport { NostrEvent } from \"nostr-tools\";\n\nimport { localRelay } from \"../../../../services/local-relay\";\nimport EventKindsPieChart from \"../../../../components/charts/event-kinds-pie-chart\";\nimport EventKindsTable from \"../../../../components/charts/event-kinds-table\";\nimport ImportEventsButton from \"./components/import-events-button\";\nimport ExportEventsButton from \"./components/export-events-button\";\nimport MemoryRelay from \"../../../../classes/memory-relay\";\nimport { getSortedKinds } from \"../../../../helpers/nostr/event\";\n\nasync function importEvents(events: NostrEvent[]) {\n  for (const event of events) {\n    localRelay?.publish(event);\n  }\n}\nasync function exportEvents() {\n  if (localRelay instanceof MemoryRelay) {\n    return Array.from(localRelay.store.database.iterateTime(0, Infinity));\n  }\n  return [];\n}\n\nexport default function MemoryDatabasePage() {\n  const update = useForceUpdate();\n\n  useEffect(() => {\n    if (localRelay instanceof MemoryRelay) {\n      const sub = localRelay.store.database.inserted.subscribe(update);\n      return () => sub.unsubscribe();\n    }\n  }, []);\n\n  const count = useMemo(() => {\n    if (localRelay instanceof MemoryRelay) return localRelay.store.database.events.size;\n    return 0;\n  }, [update]);\n\n  const kinds = useMemo(() => {\n    if (localRelay instanceof MemoryRelay) {\n      return getSortedKinds(Array.from(localRelay.store.database.iterateTime(0, Infinity)));\n    }\n    return {};\n  }, [update]);\n\n  return (\n    <>\n      <Text>Total events: {count ?? \"Loading...\"}</Text>\n      <ButtonGroup flexWrap=\"wrap\">\n        <ImportEventsButton onLoad={importEvents} />\n        <ExportEventsButton getEvents={exportEvents} />\n      </ButtonGroup>\n      <Flex gap=\"2\" wrap=\"wrap\" alignItems=\"flex-start\" w=\"full\">\n        {kinds && (\n          <>\n            <Card p=\"2\" minW=\"sm\" maxW=\"lg\" flex={1}>\n              <Heading size=\"sm\">Events by kind</Heading>\n              <EventKindsPieChart kinds={kinds} />\n            </Card>\n            <Card p=\"2\" minW=\"sm\" maxW=\"md\" flex={1}>\n              <EventKindsTable kinds={kinds} />\n            </Card>\n          </>\n        )}\n      </Flex>\n    </>\n  );\n}\n"],"names":["importEvents","events","event","_a","localRelay","exportEvents","MemoryRelay","MemoryDatabasePage","update","useForceUpdate","useEffect","sub","count","useMemo","kinds","getSortedKinds","jsxs","Fragment","Text","ButtonGroup","jsx","ImportEventsButton","ExportEventsButton","Flex","Card","Heading","EventKindsPieChart","EventKindsTable"],"mappings":"2OAYA,eAAeA,EAAaC,EAAsB,OAChD,UAAWC,KAASD,GAClBE,EAAAC,IAAA,MAAAD,EAAY,QAAQD,EAExB,CACA,eAAeG,GAAe,CAC5B,OAAID,aAAsBE,EACjB,MAAM,KAAKF,EAAW,MAAM,SAAS,YAAY,EAAG,GAAQ,CAAC,EAE/D,EACT,CAEA,SAAwBG,GAAqB,CAC3C,MAAMC,EAASC,IAEfC,EAAAA,UAAU,IAAM,CACd,GAAIN,aAAsBE,EAAa,CACrC,MAAMK,EAAMP,EAAW,MAAM,SAAS,SAAS,UAAUI,CAAM,EACxD,MAAA,IAAMG,EAAI,aACnB,CACF,EAAG,CAAE,CAAA,EAEC,MAAAC,EAAQC,EAAAA,QAAQ,IAChBT,aAAsBE,EAAoBF,EAAW,MAAM,SAAS,OAAO,KACxE,EACN,CAACI,CAAM,CAAC,EAELM,EAAQD,EAAAA,QAAQ,IAChBT,aAAsBE,EACjBS,EAAe,MAAM,KAAKX,EAAW,MAAM,SAAS,YAAY,EAAG,GAAQ,CAAC,CAAC,EAE/E,GACN,CAACI,CAAM,CAAC,EAEX,OAEIQ,EAAA,KAAAC,WAAA,CAAA,SAAA,CAAAD,OAACE,EAAK,CAAA,SAAA,CAAA,iBAAeN,GAAS,YAAA,EAAa,EAC3CI,EAAAA,KAACG,EAAY,CAAA,SAAS,OACpB,SAAA,CAACC,EAAAA,IAAAC,EAAA,CAAmB,OAAQrB,CAAc,CAAA,EAC1CoB,EAAAA,IAACE,EAAmB,CAAA,UAAWjB,CAAc,CAAA,CAAA,EAC/C,EACAe,EAAA,IAACG,EAAK,CAAA,IAAI,IAAI,KAAK,OAAO,WAAW,aAAa,EAAE,OACjD,SAAAT,GAEGE,EAAAA,KAAAC,EAAAA,SAAA,CAAA,SAAA,CAACD,EAAAA,KAAAQ,EAAA,CAAK,EAAE,IAAI,KAAK,KAAK,KAAK,KAAK,KAAM,EACpC,SAAA,CAACJ,EAAA,IAAAK,EAAA,CAAQ,KAAK,KAAK,SAAc,iBAAA,EACjCL,MAACM,GAAmB,MAAAZ,EAAc,CAAA,EACpC,EACCM,EAAA,IAAAI,EAAA,CAAK,EAAE,IAAI,KAAK,KAAK,KAAK,KAAK,KAAM,EACpC,SAACJ,EAAA,IAAAO,EAAA,CAAgB,MAAAb,CAAc,CAAA,EACjC,CAAA,CAAA,CACF,CAEJ,CAAA,CACF,CAAA,CAAA,CAEJ"}