{"version":3,"file":"topic-B7-HoExo.js","sources":["../../src/views/wiki/topic.tsx"],"sourcesContent":["import { Button, Flex, Heading, Link } from \"@chakra-ui/react\";\nimport { Navigate, useParams, Link as RouterLink } from \"react-router-dom\";\nimport { NostrEvent } from \"nostr-tools\";\n\nimport VerticalPageLayout from \"../../components/vertical-page-layout\";\nimport useSubject from \"../../hooks/use-subject\";\nimport { useMemo } from \"react\";\nimport dictionaryService from \"../../services/dictionary\";\nimport { useReadRelays } from \"../../hooks/use-client-relays\";\nimport WikiPageHeader from \"./components/wiki-page-header\";\nimport UserAvatar from \"../../components/user/user-avatar\";\nimport UserName from \"../../components/user/user-name\";\nimport { WikiPagePage } from \"./page\";\nimport { useWebOfTrust } from \"../../providers/global/web-of-trust-provider\";\nimport useRouteSearchValue from \"../../hooks/use-route-search-value\";\nimport { getPageDefer } from \"../../helpers/nostr/wiki\";\n\nexport default function WikiTopicView() {\n  const { topic } = useParams();\n  if (!topic) return <Navigate to=\"/wiki\" />;\n\n  const webOfTrust = useWebOfTrust();\n  const readRelays = useReadRelays();\n  const subject = useMemo(() => dictionaryService.requestTopic(topic, readRelays, true), [topic, readRelays]);\n\n  const pages = useSubject(subject);\n\n  let sorted = pages ? Array.from(pages.values()) : [];\n  if (webOfTrust) sorted = webOfTrust.sortByDistanceAndConnections(sorted, (p) => p.pubkey);\n\n  // remove defer versions\n  sorted = sorted.filter((p) => !getPageDefer(p));\n\n  const { value: selected, setValue: setSelected, clearValue } = useRouteSearchValue(\"pubkey\");\n  const selectedPage: NostrEvent | undefined = sorted.find((p) => p.pubkey === selected) || sorted[0];\n\n  return (\n    <VerticalPageLayout>\n      <WikiPageHeader />\n      <Flex gap=\"2\" overflow=\"auto\">\n        {sorted.map((page, i) => (\n          <Button\n            key={page.pubkey}\n            flexShrink={0}\n            variant=\"outline\"\n            p=\"1\"\n            pr=\"4\"\n            colorScheme={(!selected && i === 0) || selected === page.pubkey ? \"primary\" : undefined}\n            onClick={() => setSelected(page.pubkey)}\n          >\n            <UserAvatar pubkey={page.pubkey} size=\"sm\" />\n            <UserName pubkey={page.pubkey} ml=\"2\" />\n          </Button>\n        ))}\n      </Flex>\n\n      {sorted.length === 0 && (\n        <Heading mx=\"auto\" size=\"md\" mt=\"8\">\n          Looks like there are no pages,{\" \"}\n          <Link as={RouterLink} to={{ pathname: \"/wiki/create\", search: \"topic=\" + topic }} color=\"blue.500\">\n            Create one?\n          </Link>\n        </Heading>\n      )}\n\n      {selectedPage && <WikiPagePage page={selectedPage} />}\n    </VerticalPageLayout>\n  );\n}\n"],"names":["WikiTopicView","topic","useParams","jsx","Navigate","webOfTrust","useWebOfTrust","readRelays","useReadRelays","subject","useMemo","dictionaryService","pages","useSubject","sorted","p","getPageDefer","selected","setSelected","clearValue","useRouteSearchValue","selectedPage","VerticalPageLayout","WikiPageHeader","Flex","page","i","jsxs","Button","UserAvatar","UserName","Heading","Link","RouterLink","WikiPagePage"],"mappings":"mYAiBA,SAAwBA,GAAgB,CAChC,KAAA,CAAE,MAAAC,GAAUC,IAClB,GAAI,CAACD,EAAO,OAAQE,EAAA,IAAAC,EAAA,CAAS,GAAG,OAAQ,CAAA,EAExC,MAAMC,EAAaC,IACbC,EAAaC,IACbC,EAAUC,EAAAA,QAAQ,IAAMC,EAAkB,aAAaV,EAAOM,EAAY,EAAI,EAAG,CAACN,EAAOM,CAAU,CAAC,EAEpGK,EAAQC,EAAWJ,CAAO,EAE5B,IAAAK,EAASF,EAAQ,MAAM,KAAKA,EAAM,OAAO,CAAC,EAAI,GAC9CP,MAAqBA,EAAW,6BAA6BS,EAASC,GAAMA,EAAE,MAAM,GAGxFD,EAASA,EAAO,OAAQC,GAAM,CAACC,EAAaD,CAAC,CAAC,EAExC,KAAA,CAAE,MAAOE,EAAU,SAAUC,EAAa,WAAAC,CAAW,EAAIC,EAAoB,QAAQ,EACrFC,EAAuCP,EAAO,KAAMC,GAAMA,EAAE,SAAWE,CAAQ,GAAKH,EAAO,CAAC,EAElG,cACGQ,EACC,CAAA,SAAA,CAAAnB,EAAA,IAACoB,EAAe,EAAA,EAChBpB,EAAAA,IAACqB,EAAK,CAAA,IAAI,IAAI,SAAS,OACpB,SAAOV,EAAA,IAAI,CAACW,EAAMC,IACjBC,EAAA,KAACC,EAAA,CAEC,WAAY,EACZ,QAAQ,UACR,EAAE,IACF,GAAG,IACH,YAAc,CAACX,GAAYS,IAAM,GAAMT,IAAaQ,EAAK,OAAS,UAAY,OAC9E,QAAS,IAAMP,EAAYO,EAAK,MAAM,EAEtC,SAAA,CAAAtB,EAAA,IAAC0B,EAAW,CAAA,OAAQJ,EAAK,OAAQ,KAAK,KAAK,QAC1CK,EAAS,CAAA,OAAQL,EAAK,OAAQ,GAAG,IAAI,CAAA,CAAA,EATjCA,EAAK,MAWb,CAAA,EACH,EAECX,EAAO,SAAW,GAChBa,EAAA,KAAAI,EAAA,CAAQ,GAAG,OAAO,KAAK,KAAK,GAAG,IAAI,SAAA,CAAA,iCACH,IAC9B5B,EAAA,IAAA6B,EAAA,CAAK,GAAIC,EAAY,GAAI,CAAE,SAAU,eAAgB,OAAQ,SAAWhC,GAAS,MAAM,WAAW,SAEnG,cAAA,CAAA,EACF,EAGDoB,GAAgBlB,EAAAA,IAAC+B,EAAa,CAAA,KAAMb,CAAc,CAAA,CACrD,CAAA,CAAA,CAEJ"}