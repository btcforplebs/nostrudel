import{a6 as y,af as F,gM as O,r as d,gN as k,t as w,gO as z,gP as N,j as e,E as m,gQ as S,e as I,bZ as Q,bP as V,ao as _,bQ as H,ar as K,aq as W,as as $,y as G,l as q,cf as J,b1 as X,H as f,T as Y,f as U,i as L,I as R,F as h,C as Z,L as ee,aB as se,a as ne,Z as te,bD as re,cQ as ae,cR as oe,cS as ie,cV as le,df as ce,gi as de,fL as ue,B as ge,dg as xe,gR as he,gS as me,gT as fe,gU as je,gk as pe,gV as Ce,gW as be,gX as Me,gY as ve,gl as ye,gm as ke,fM as we,gZ as Se,g_ as Ie,g$ as Ue,dh as Le,gc as Re,bI as Be,bK as Ee,k as B,h0 as Te,gg as Ae,h1 as Pe,bM as De,cx as Fe,cy as Oe,_ as ze,ct as Ne,h2 as C,bR as Qe,ae as Ve,s as _e,aI as He,W as Ke,cb as We,aP as $e,bB as Ge,h3 as qe,h4 as Je,h5 as Xe}from"./index-C6wlVu-O.js";import{M as Ye,a as Ze}from"./message-block-CcitCko1.js";function E({channel:s,...r}){const a=y(),t=F(),{list:n,pointers:i}=O(t==null?void 0:t.pubkey),l=i.find(c=>c.id===s.id),o=d.useCallback(async()=>{const c={kind:k,content:(n==null?void 0:n.content)??"",created_at:w().unix(),tags:(n==null?void 0:n.tags)??[]};let g;l?g=z(c,s):g=N(c,s),await a(l?"Leave Channel":"Join Channel",g)},[l,n,s,a]);return e.jsx(m,{onClick:o,variant:l?"outline":"solid",colorScheme:l?"red":"green",...r,children:l?"Leave":"Join"})}function es({pubkey:s}){return e.jsxs(Z,{as:ee,direction:"row",alignItems:"center",gap:"2",p:"2",children:[e.jsx(se,{pubkey:s,size:"sm"}),e.jsx(ne,{as:te,pubkey:s,fontWeight:"bold"}),e.jsx(re,{pubkey:s,onlyIcon:!0})]})}function ss({channel:s,relays:r}){const{loader:a,timeline:t}=U(`${s.id}-members`,r,{kinds:[k],"#e":[s.id]}),n=L(a);return e.jsx(R,{callback:n,children:e.jsx(h,{gap:"2",direction:"column",children:t==null?void 0:t.map(i=>e.jsx(es,{pubkey:i.pubkey},i.pubkey))})})}function ns({isOpen:s,onClose:r,channel:a,...t}){const n=S(a.id),i=I(Q());return e.jsxs(V,{isOpen:s,placement:"right",onClose:r,...t,children:[e.jsx(_,{}),e.jsxs(H,{children:[e.jsx(K,{}),e.jsx(W,{p:"4",children:n==null?void 0:n.name}),e.jsxs($,{px:"4",pt:"0",pb:"4",children:[e.jsxs(G,{children:[e.jsx(E,{channel:a}),e.jsx(m,{as:q,href:`https://www.nostrchat.io/channel/${a.id}`,leftIcon:e.jsx(J,{src:"https://www.nostrchat.io//favicon.ico",w:"6",h:"6"}),rightIcon:e.jsx(X,{}),isExternal:!0,children:"Open NostrChat"})]}),e.jsx(f,{size:"sm",mt:"2",children:"About"}),e.jsx(Y,{whiteSpace:"pre",children:n==null?void 0:n.about}),e.jsx(f,{size:"sm",mt:"2",children:"Members"}),e.jsx(ss,{channel:a,relays:i})]})]})]})}function ts({channel:s,...r}){return e.jsx(e.Fragment,{children:e.jsxs(ae,{...r,children:[e.jsx(oe,{event:s}),e.jsx(ie,{event:s}),e.jsx(le,{event:s})]})})}const rs=[he,me,fe,je,pe,Ce,be,Me,ve,ye,ke,we,Se,Ie,Ue,Le],as=d.memo(({message:s,children:r,...a})=>{const t=ce(s,xe,{linkRenderers:rs});return e.jsx(de,{event:s,children:e.jsx(ue,{children:e.jsxs(ge,{whiteSpace:"pre-wrap",...a,children:[t,r]})})})});function os({...s}){const r=d.useCallback((a,t)=>e.jsx(as,{message:a,display:"inline",children:t}),[]);return e.jsx(Ye,{renderContent:r,showThreadButton:!1,...s})}const is=d.memo(os);function ls({channel:s,rootId:r,...a}){const t=y(),n=Re(),[i,l]=d.useState(""),{getValues:o,setValue:c,watch:g,handleSubmit:j,formState:us,reset:T}=Be({defaultValues:{content:""},mode:"all"});g("content");const b=d.useRef(null),M=d.useRef(null),{onPaste:A}=Ee(b,o,c),P=j(async u=>{if(!u.content)return;let x={kind:B.ChannelMessage,content:u.content,tags:[["e",r||s.id,"","root"]],created_at:w().unix()};const D=Te(x.content);x=Ae(x,n),x=Pe(x,D),l("Signing..."),await t("Send DM",x,void 0,!1),T({content:""}),setTimeout(()=>{var v;return(v=M.current)==null?void 0:v.focus()},50),l("")}),p=d.useRef(null);return e.jsx(h,{as:"form",gap:"2",onSubmit:P,ref:p,...a,children:i?e.jsx(f,{size:"md",mx:"auto",my:"4",children:i}):e.jsxs(e.Fragment,{children:[e.jsx(De,{mb:"2",value:o().content,onChange:u=>c("content",u.target.value,{shouldDirty:!0}),rows:2,isRequired:!0,instanceRef:u=>b.current=u,ref:M,onPaste:A,onKeyDown:u=>{(u.ctrlKey||u.metaKey)&&u.key==="Enter"&&p.current&&p.current.requestSubmit()}}),e.jsx(m,{type:"submit",children:"Send"})]})})}const cs=d.memo(({timeline:s,channel:r})=>{const a=C(qe,[r])??[],t=C(Je,[r]),n=C(Xe,[r]),i=d.useMemo(()=>a.filter(o=>t!=null&&t.has(o.pubkey)||n!=null&&n.has(o.id)?!1:!o.tags.some(c=>c[0]==="e"&&c[1]!==r.id&&c[3]==="root")),[a.length,r.id,n==null?void 0:n.size,t==null?void 0:t.size]),l=d.useMemo(()=>Qe(i),[i]);return e.jsx(e.Fragment,{children:l.map(o=>e.jsx(is,{messages:o.events,reverse:!0},o.id))})});function ds({channel:s}){const r=Ve(),a=I(),t=_e(),n=S(s.id,a),i=He(),l=d.useCallback(j=>!i(j),[i]),{loader:o,timeline:c}=U(`${Ke(s.id)}-chat-messages`,a,{kinds:[B.ChannelMessage],"#e":[s.id]},{eventFilter:l}),g=L(o);return e.jsx(Ze,{timeline:o,children:e.jsxs(R,{callback:g,children:[e.jsxs(h,{h:"full",overflow:"hidden",direction:"column",p:"2",gap:"2",flexGrow:1,children:[e.jsxs(h,{gap:"2",alignItems:"center",children:[e.jsx(m,{leftIcon:e.jsx(We,{}),onClick:()=>r(-1),children:"Back"}),e.jsx(f,{hideBelow:"lg",size:"lg",children:n==null?void 0:n.name}),e.jsx($e,{}),e.jsx(E,{channel:s,hideBelow:"lg"}),e.jsx(m,{onClick:t.onOpen,children:"Channel Info"}),e.jsx(ts,{channel:s,"aria-label":"More Options"})]}),e.jsxs(h,{h:"0",flexGrow:1,overflowX:"hidden",overflowY:"scroll",direction:"column-reverse",gap:"2",py:"4",px:"2",children:[e.jsx(cs,{timeline:o,channel:s}),e.jsx(Ge,{timeline:o})]}),e.jsx(ls,{channel:s})]}),t.isOpen&&e.jsx(ns,{isOpen:!0,onClose:t.onClose,channel:s,size:"lg"})]})})}function hs(){const s=Fe("id"),r=Oe(s==null?void 0:s.id,s==null?void 0:s.relays);return r?e.jsx(Ne,{children:e.jsx(ds,{channel:r})}):e.jsx(ze,{})}export{hs as default};
//# sourceMappingURL=channel-BdVGu7pg.js.map
