import{eZ as E,r,j as t,R as C,ae as T,af as A,e as G,ay as B,aG as L,t as h,e_ as R,e$ as N,k as P,f0 as F,av as I,f1 as O,F as w,E as U,cb as Y,v as _,T as z,B as q}from"./index-C6wlVu-O.js";import{A as V}from"./react-virtualized-auto-sizer.esm-i_2dVWbg.js";import{u as W,F as Z}from"./use-user-network-DZOGHkof.js";import{M as H,S as J,a as K,G as Q,T as X,b as $,c as ee,d as se}from"./three.module-dQg0RiKP.js";var te=E?r.useLayoutEffect:r.useEffect;function ae(x,u){var l=r.useState(u),f=l[0],a=l[1];return te(function(){var m=x.subscribe(a);return function(){return m.unsubscribe()}},[x]),f}function ne(){const x=T(),u=A(),l=G(),f=B(u.pubkey),a=r.useMemo(()=>f?L(f).map(e=>e.pubkey):[],[f]),[m,re]=r.useState(h().unix()),[p,k]=r.useState(h().subtract(1,"week").unix()),c=r.useMemo(()=>new R,[]),[j]=N(()=>{if(!f)return;c.clear();const e={authors:a,kinds:[P.EncryptedDirectMessage],since:p,until:m},d=F(Array.from(l),[e],{onevent:i=>c.addEvent(i),oneose:()=>d.close()})},2*1e3,[l,c,a,p,m]);r.useEffect(()=>{j()},[l,c,a,p,m]);const M=I(u.pubkey),b=W(a),y=ae(c.onEvent),S=r.useMemo(()=>{var g;if(c.events.size===0)return{nodes:[],links:[]};const e={},d={},i=n=>{if(!e[n]){const o={id:n},s=b[n];s&&(o.image=s.picture,o.name=s.name),e[n]=o}return e[n]};for(const[n,o]of c.events){const s=o.pubkey,v=(g=o.tags.find(O))==null?void 0:g[1];if(v&&a.includes(v)&&(a.includes(s)||s===u.pubkey)){const D=[s,v].join("|");d[D]={source:i(s),target:i(v)}}}return{nodes:Object.values(e),links:Object.values(d)}},[a,u.pubkey,b,M,y]);return t.jsxs(w,{direction:"column",gap:"2",h:"full",pt:"2",children:[t.jsxs(w,{gap:"2",alignItems:"center",children:[t.jsx(U,{leftIcon:t.jsx(Y,{}),onClick:()=>x(-1),children:"Back"}),t.jsx(_,{type:"datetime-local",maxW:"sm",value:h.unix(p).format("YYYY-MM-DDThh:mm"),onChange:e=>k(h(e.target.value).unix())}),t.jsxs(z,{children:["Showing all direct messages between contacts in the last ",h.unix(p).fromNow(!0)]})]}),t.jsx(q,{overflow:"hidden",flex:1,children:t.jsx(V,{children:({height:e,width:d})=>t.jsx(Z,{graphData:S,enableNodeDrag:!1,width:d,height:e,linkDirectionalArrowLength:3.5,linkDirectionalArrowRelPos:1,linkCurvature:.25,nodeThreeObject:i=>{if(!i.image)return new H(new J(5,12,6),new K({color:11144975}));const g=new Q,n=new X().load(i.image);n.colorSpace=$;const o=new ee({map:n}),s=new se(o);return s.scale.set(10,10,10),g.children.push(s),s}})})})]})}function le(){return t.jsx(C,{children:t.jsx(ne,{})})}export{le as default};
//# sourceMappingURL=network-dm-graph-BL3Ad5fA.js.map
