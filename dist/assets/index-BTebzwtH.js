import{j as e,F as l,aN as p,Z as g,T as d,dx as R,r as x,aP as b,E as v,cw as I,G as C,s as P,C as _,a9 as D,aX as N,z as q,am as z,$ as L,_ as S,ft as E,fu as O,fv as w,a6 as F,af as M,e as W,fw as B,fx as T,t as U,f as V,fy as A,ah as K,aW as J,aj as $,ac as G,cx as H,cy as X,fz as Z,cK as Q,cL as Y,cM as f,cN as ee,cO as y,bD as se,fA as ae,fB as ne,fC as te}from"./index-C6wlVu-O.js";function ie({result:s}){return e.jsxs(e.Fragment,{children:[e.jsxs(l,{gap:"2",alignItems:"center",grow:1,children:[e.jsx(p,{pubkey:s.pubkey,size:"sm"}),e.jsx(g,{pubkey:s.pubkey,fontWeight:"bold"}),e.jsx(d,{children:"Finished job"})]}),e.jsx("audio",{src:s.content,controls:!0})]})}function re({status:s}){const n=R(),a=s.tags.find(t=>t[0]==="amount"&&t[1]&&t[2]),i=(a==null?void 0:a[1])&&parseInt(a[1]),r=a==null?void 0:a[2],[o,j]=x.useState(!1),[m,c]=x.useState(!1),h=async t=>{try{window.webln&&r&&(c(!0),t.stopPropagation(),await window.webln.sendPayment(r),j(!0))}catch(u){u instanceof Error&&n({status:"error",description:u.message})}c(!1)};return e.jsxs(e.Fragment,{children:[e.jsxs(l,{gap:"2",alignItems:"center",grow:1,children:[e.jsx(p,{pubkey:s.pubkey,size:"sm"}),e.jsx(g,{pubkey:s.pubkey,fontWeight:"bold"}),e.jsx(d,{children:"Offered"}),e.jsx(b,{}),r&&i&&e.jsxs(v,{colorScheme:"yellow",size:"sm",variant:"solid",leftIcon:e.jsx(I,{}),onClick:h,isLoading:m||o,isDisabled:!window.webln,children:["Pay ",C(i/1e3)," sats"]})]}),e.jsx(d,{children:s.content})]})}function oe({response:s}){return s.result?e.jsx(ie,{result:s.result}):s.status?e.jsx(re,{status:s.status}):null}function le(s){const n=O(s,"language",!1);return w.find(a=>a.iso639_1===n)}function ce({job:s}){const n=le(s.request),a=P();return e.jsxs(e.Fragment,{children:[e.jsxs(_,{variant:"outline",children:[e.jsxs(D,{px:"4",py:"4",pb:"2",display:"flex",gap:"2",alignItems:"center",flexWrap:"wrap",children:[e.jsx(p,{pubkey:s.request.pubkey,size:"sm"}),e.jsx(g,{pubkey:s.request.pubkey,fontWeight:"bold"}),e.jsxs(d,{children:["Requested reading in ",e.jsx("strong",{children:n==null?void 0:n.nativeName})]}),e.jsx(N,{timestamp:s.request.created_at}),e.jsx(b,{}),e.jsx(q,{icon:e.jsx(z,{}),"aria-label":"Show Raw",title:"Show Raw",variant:"ghost",size:"sm",onClick:a.onOpen})]}),e.jsxs(L,{px:"4",py:"4",gap:"2",display:"flex",flexDirection:"column",children:[s.responses.length===0&&e.jsxs(l,{gap:"2",alignItems:"center",children:[e.jsx(S,{}),"Waiting for response"]}),Object.values(s.responses).map(i=>e.jsx(oe,{response:i},i.pubkey))]})]}),a.isOpen&&e.jsx(E,{isOpen:!0,onClose:a.onClose,event:s.request})]})}function ue({note:s}){const n=F(),a=M(),[i,r]=x.useState(navigator.language.split("-")[0]??"en"),o=W(),j=x.useCallback(async()=>{const t=B.getRankedRelays(o).slice(0,8),u={kind:T,content:"",created_at:U().unix(),tags:[["i",s.id,"event"],["param","language",i],["relays",...t]]};await n("Request Reading",u)},[n,s,o,i]),{loader:m,timeline:c}=V(`${J(s)}-readings`,o,[{kinds:[T,A],"#i":[s.id]},a&&{kinds:[K],"#p":[a.pubkey]}].filter(Boolean)),h=$(c);return e.jsxs(e.Fragment,{children:[e.jsxs(l,{gap:"2",children:[e.jsx(G,{value:i,onChange:t=>r(t.target.value),w:"60",children:w.map(t=>e.jsxs("option",{value:t.iso639_1,children:[t.name," (",t.nativeName,")"]},t.iso639_1))}),e.jsx(v,{size:"md",variant:"solid",colorScheme:"primary",onClick:j,flexShrink:0,children:"Request new reading"})]}),Array.from(Object.values(h)).map(t=>e.jsx(ce,{job:t},t.request.id))]})}const k=["original","translation","tts"];function de({note:s}){const n=Z("tab","original"),a={px:"2",pt:"2",pb:"10",display:"flex",flexDirection:"column",gap:"2"};return e.jsxs(Q,{colorScheme:"primary",isLazy:!0,index:n?k.indexOf(n.value):0,onChange:i=>n.setValue(k[i]),children:[e.jsxs(Y,{children:[e.jsx(f,{children:"Original"}),e.jsx(f,{children:"Translation"}),e.jsx(f,{children:"Text to speech"})]}),e.jsxs(ee,{children:[e.jsxs(y,{...a,children:[e.jsxs(l,{gap:"2",alignItems:"center",children:[e.jsx(p,{pubkey:s.pubkey,size:["xs","sm"]}),e.jsx(g,{pubkey:s.pubkey,isTruncated:!0,fontWeight:"bold",fontSize:"lg"}),e.jsx(se,{pubkey:s.pubkey,onlyIcon:!0}),e.jsx(b,{}),e.jsx(ae,{event:s,"aria-label":"Note Options"})]}),e.jsx(ne,{event:s})]}),e.jsx(y,{...a,children:e.jsx(te,{note:s})}),e.jsx(y,{...a,children:e.jsx(ue,{note:s})})]})]})}function pe(){const s=H("id"),n=X(s.id,s.relays);return n?e.jsx(de,{note:n}):e.jsx(S,{})}export{pe as default};
//# sourceMappingURL=index-BTebzwtH.js.map
