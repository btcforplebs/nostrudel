{"version":3,"file":"browse-XIDpl7g3.js","sources":["../../src/views/goals/browse.tsx"],"sourcesContent":["import { useCallback } from \"react\";\nimport { Flex, SimpleGrid, Switch, useDisclosure } from \"@chakra-ui/react\";\nimport { getEventUID } from \"applesauce-core/helpers\";\nimport dayjs from \"dayjs\";\n\nimport PeopleListProvider, { usePeopleListContext } from \"../../providers/local/people-list-provider\";\nimport PeopleListSelection from \"../../components/people-list-selection/people-list-selection\";\nimport useTimelineLoader from \"../../hooks/use-timeline-loader\";\nimport { useReadRelays } from \"../../hooks/use-client-relays\";\nimport IntersectionObserverProvider from \"../../providers/local/intersection-observer\";\nimport { useTimelineCurserIntersectionCallback } from \"../../hooks/use-timeline-cursor-intersection-callback\";\nimport GoalCard from \"./components/goal-card\";\nimport { getGoalClosedDate } from \"../../helpers/nostr/goal\";\nimport { NostrEvent } from \"../../types/nostr-event\";\nimport VerticalPageLayout from \"../../components/vertical-page-layout\";\nimport { ErrorBoundary } from \"../../components/error-boundary\";\nimport { kinds } from \"nostr-tools\";\n\nfunction GoalsBrowsePage() {\n  const { filter, listId } = usePeopleListContext();\n  const showClosed = useDisclosure();\n\n  const readRelays = useReadRelays();\n  const eventFilter = useCallback(\n    (event: NostrEvent) => {\n      const closed = getGoalClosedDate(event);\n      if (!showClosed.isOpen && closed && dayjs().isAfter(dayjs.unix(closed))) return false;\n      return true;\n    },\n    [showClosed.isOpen],\n  );\n  const { loader, timeline: goals } = useTimelineLoader(\n    `${listId}-browse-goals`,\n    readRelays,\n    filter ? { ...filter, kinds: [kinds.ZapGoal] } : undefined,\n    { eventFilter },\n  );\n  const callback = useTimelineCurserIntersectionCallback(loader);\n\n  return (\n    <IntersectionObserverProvider callback={callback}>\n      <VerticalPageLayout>\n        <Flex gap=\"2\" alignItems=\"center\" wrap=\"wrap\">\n          <PeopleListSelection />\n          <Switch isChecked={showClosed.isOpen} onChange={showClosed.onToggle}>\n            Show ended\n          </Switch>\n        </Flex>\n\n        <SimpleGrid columns={{ base: 1, lg: 2 }} spacing=\"2\">\n          {goals?.map((event) => (\n            <ErrorBoundary key={getEventUID(event)} event={event}>\n              <GoalCard goal={event} />\n            </ErrorBoundary>\n          ))}\n        </SimpleGrid>\n      </VerticalPageLayout>\n    </IntersectionObserverProvider>\n  );\n}\n\nexport default function GoalsBrowseView() {\n  return (\n    <PeopleListProvider>\n      <GoalsBrowsePage />\n    </PeopleListProvider>\n  );\n}\n"],"names":["GoalsBrowsePage","filter","listId","usePeopleListContext","showClosed","useDisclosure","readRelays","useReadRelays","eventFilter","useCallback","event","closed","getGoalClosedDate","dayjs","loader","goals","useTimelineLoader","kinds","callback","useTimelineCurserIntersectionCallback","jsx","IntersectionObserverProvider","jsxs","VerticalPageLayout","Flex","PeopleListSelection","Switch","SimpleGrid","ErrorBoundary","GoalCard","getEventUID","GoalsBrowseView","PeopleListProvider"],"mappings":"qLAkBA,SAASA,GAAkB,CACzB,KAAM,CAAE,OAAAC,EAAQ,OAAAC,CAAO,EAAIC,EAAqB,EAC1CC,EAAaC,IAEbC,EAAaC,IACbC,EAAcC,EAAA,YACjBC,GAAsB,CACf,MAAAC,EAASC,EAAkBF,CAAK,EACtC,MAAI,GAACN,EAAW,QAAUO,GAAUE,EAAM,EAAE,QAAQA,EAAM,KAAKF,CAAM,CAAC,EAExE,EACA,CAACP,EAAW,MAAM,CAAA,EAEd,CAAE,OAAAU,EAAQ,SAAUC,CAAU,EAAAC,EAClC,GAAGd,CAAM,gBACTI,EACAL,EAAS,CAAE,GAAGA,EAAQ,MAAO,CAACgB,EAAM,OAAO,CAAM,EAAA,OACjD,CAAE,YAAAT,CAAY,CAAA,EAEVU,EAAWC,EAAsCL,CAAM,EAE7D,OACGM,EAAA,IAAAC,EAAA,CAA6B,SAAAH,EAC5B,SAAAI,OAACC,EACC,CAAA,SAAA,CAAAD,OAACE,GAAK,IAAI,IAAI,WAAW,SAAS,KAAK,OACrC,SAAA,CAAAJ,EAAA,IAACK,EAAoB,EAAA,EACrBL,EAAAA,IAACM,GAAO,UAAWtB,EAAW,OAAQ,SAAUA,EAAW,SAAU,SAErE,YAAA,CAAA,CAAA,EACF,EAEAgB,EAAAA,IAACO,EAAW,CAAA,QAAS,CAAE,KAAM,EAAG,GAAI,CAAE,EAAG,QAAQ,IAC9C,SAAOZ,GAAA,YAAAA,EAAA,IAAKL,GACVU,EAAA,IAAAQ,EAAA,CAAuC,MAAAlB,EACtC,SAAAU,EAAAA,IAACS,EAAS,CAAA,KAAMnB,CAAO,CAAA,CAAA,EADLoB,EAAYpB,CAAK,CAErC,EAEJ,CAAA,CAAA,CACF,CAAA,CACF,CAAA,CAEJ,CAEA,SAAwBqB,GAAkB,CACxC,OACGX,EAAA,IAAAY,EAAA,CACC,SAACZ,EAAA,IAAApB,EAAA,CAAA,CAAgB,CACnB,CAAA,CAEJ"}