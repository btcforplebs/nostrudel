import{j as e,R as b,b2 as m,bp as h,bs as f,af as j,bx as g,by as y,r as k,bz as v,bA as C,i as w,F as r,bt as I,I as L,bB as P,bC as T,bo as A,u as p,L as B,C as D,$ as E,aB as M,aC as R,bD as O,aX as S,bE as _,bu as z,bF as F,b as U,aw as X,bG as $,T as q}from"./index-C6wlVu-O.js";function G({message:s,pubkey:a}){const n=p(s),{plaintext:t}=$(s);return e.jsx(q,{isTruncated:!0,ref:n,children:t||"<Encrypted>"})}function K({conversation:s}){const a=A(),n=s.messages.find(c=>c.pubkey===s.correspondent),t=s.messages[0],i=p(t);return e.jsxs(B,{as:D,size:"sm",ref:i,children:[e.jsxs(E,{display:"flex",gap:"2",overflow:"hidden",children:[e.jsx(M,{pubkey:s.correspondent}),e.jsxs(r,{direction:"column",gap:"1",overflow:"hidden",flex:1,children:[e.jsxs(r,{gap:"2",alignItems:"center",overflow:"hidden",children:[e.jsx(R,{pubkey:s.correspondent,isTruncated:!0}),e.jsx(O,{onlyIcon:!0,pubkey:s.correspondent}),e.jsx(S,{flexShrink:0,timestamp:t.created_at,ml:"auto"}),_(s)&&e.jsx(z,{boxSize:4,color:"green.500"})]}),n&&e.jsx(G,{message:n,pubkey:n.pubkey})]})]}),e.jsx(F,{as:U,to:`/dm/${X.npubEncode(s.correspondent)}`+a.search})]})}function N(){const s=h(),{people:a}=f(),n=j(),t=g(),i=y(t.timeline)??[],c=k.useMemo(()=>v(i).map(o=>C(o,n.pubkey)).filter(o=>a?a.some(u=>u.pubkey===o.correspondent):!0).sort((o,u)=>u.messages[0].created_at-o.messages[0].created_at),[i,a,n.pubkey]),l=!!s.pubkey,x=w(t);return e.jsxs(r,{gap:"4",h:{base:"calc(100vh - 3.5rem)",md:"100vh"},overflow:"hidden",children:[e.jsxs(r,{gap:"2",direction:"column",w:l?"sm":{base:"full",lg:"sm"},overflowX:"hidden",overflowY:"auto",py:"2",px:{base:"2",lg:0},hideBelow:l?"xl":void 0,children:[e.jsx(r,{gap:"2",children:e.jsx(I,{flexShrink:0})}),e.jsx(L,{callback:x,children:c.map(d=>e.jsx(K,{conversation:d},d.pubkeys.join("-")))}),e.jsx(P,{timeline:t})]}),e.jsx(r,{gap:"2",direction:"column",flex:1,hideBelow:l?void 0:"xl",overflow:"hidden",children:e.jsx(T,{})})]})}function H(){return e.jsx(b,{children:e.jsx(m,{initList:"global",children:e.jsx(N,{})})})}export{H as default};
//# sourceMappingURL=index-CprHEKMZ.js.map
