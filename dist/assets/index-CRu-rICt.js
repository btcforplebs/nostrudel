import{r as u,fK as Q,k as R,j as e,F as x,aN as m,T as L,Z as S,cw as X,G as J,i as K,I as ee,fL as se,C as y,a9 as v,H as f,$ as C,df as ne,dg as ae,B as k,fM as te,dh as re,bZ as M,e as P,d5 as z,dX as B,fN as oe,at as ie,fO as le,L as ce,cf as de,fB as xe,bF as pe,fP as ue,q as he,fb as je,fQ as fe,fR as ge,E as j,_ as T,fS as me,fT as we,fU as be,fV as Se,fW as ye,fX as ve,fY as Ce,fZ as ke,f_ as Pe,f$ as Ee,g0 as Ie,g1 as Re,cm as Le,l as Me,b as ze,cz as Be,cE as Te,g2 as Ae,cB as De,ds as Ge,g3 as Ne,cq as Ue,bp as qe,fc as He,g4 as Fe,aE as Oe,aw as Ve,eS as Ze,fI as _e,dt as We,g5 as $e,b4 as Ye,g6 as Qe,g7 as Xe,bq as A,ae as D,V as G,cb as N,fJ as Je,aP as b,D as Ke,s as es,Y as ss,bP as ns,ao as as,bQ as ts,ar as rs,aq as os,as as is,y as ls,w as cs,b1 as ds}from"./index-C6wlVu-O.js";import U from"./live-video-player-CaE8qRC3.js";import{u as q,S as H,C as F,a as xs,b as ps}from"./chat-log-CLBRTBIF.js";import{S as O}from"./stream-hashtags-DvltmNAH.js";import"./hls-Bon9X3-D.js";import"./chat-message-content-DH1ZcJIv.js";function V({stream:s,...r}){const{timeline:n}=q(s),o=u.useMemo(()=>Q(n.filter(t=>t.kind===R.Zap)),[n]),c={};for(const t of o){const a=t.request.pubkey;t.payment.amount&&(c[a]=(c[a]||0)+t.payment.amount)}const i=Array.from(Object.entries(c)).sort((t,a)=>a[1]-t[1]);return e.jsx(x,{overflowX:"auto",overflowY:"hidden",gap:"4",...r,children:i.map(([t,a])=>e.jsxs(x,{gap:"2",alignItems:"center",maxW:"2xs",children:[e.jsx(m,{pubkey:t,size:"sm",noProxy:!0}),e.jsxs(L,{whiteSpace:"nowrap",isTruncated:!0,children:[e.jsx(S,{pubkey:t,fontWeight:"bold"}),e.jsx("br",{}),e.jsx(X,{}),J(a/1e3)]})]},t))})}function Z({stream:s,actions:r,displayMode:n,...o}){const{loader:c}=q(s),i=u.useRef(null),t=K(c),a=!!n,l=n==="log";return e.jsx(ee,{callback:t,root:i,children:e.jsx(se,{children:e.jsxs(y,{...o,overflow:"hidden",background:l?"transparent":void 0,children:[!a&&e.jsxs(v,{py:"3",display:"flex",justifyContent:"space-between",alignItems:"center",children:[e.jsx(f,{size:"md",children:"Stream Chat"}),r]}),e.jsxs(C,{display:"flex",flexDirection:"column",overflow:"hidden",p:0,children:[e.jsx(V,{stream:s,py:"2",px:"4",pt:a?void 0:0}),e.jsx(H,{ref:i,stream:s,flex:1,px:"4",py:"2",mb:"2"}),!l&&e.jsx(F,{stream:s})]})]})})})}const us=[te,re];function _({stream:s,...r}){const n=ne(s.event,ae,{linkRenderers:us});return n&&e.jsx(k,{whiteSpace:"pre-wrap",...r,children:n})}const hs=17777,js=37777;function fs(s,r){const n=u.useMemo(()=>z.requestEvent(r,hs,s),[s,r]),o=B(n);return(o==null?void 0:o.tags.filter(oe))??[]}function gs({cord:s,relay:r,...n}){var d,h,g;const o=M(),c=P(r?[...o,r]:o),i=ie(s,c);if(!i||i.kind!==js)return null;const t=(d=i.tags.find(p=>p[0]==="title"))==null?void 0:d[1],a=(h=i.tags.find(p=>p[0]==="image"))==null?void 0:h[1],l=(g=i.tags.find(p=>p[0]==="r"))==null?void 0:g[1];return!i.content&&!a&&l?e.jsx(le,{url:new URL(l)}):e.jsxs(y,{as:ce,variant:"outline",...n,children:[a&&e.jsx(de,{src:a}),t&&e.jsx(v,{p:"2",children:e.jsx(f,{size:"md",children:t})}),i.content&&e.jsx(C,{p:"2",children:e.jsx(xe,{event:i})}),l&&e.jsx(pe,{isExternal:!0,href:l,color:"blue.500",children:!a&&l})]})}function W({pubkey:s,...r}){const n=M(),o=P(n),c=fs(s,o);return e.jsx(e.Fragment,{children:c.map(([i,t,a])=>e.jsx(gs,{cord:t,relay:a,...r},t))})}function ms({pubkey:s,...r}){const[n,o]=u.useState(!1),[c,i]=u.useState(!1),[t,a]=u.useState("4"),{metadata:l}=ue(s),d=!!window.webln,h=d&&n&&!!(l!=null&&l.callback),g=u.useCallback(async()=>{if(h&&window.webln){try{i(!0),window.webln.enabled||await window.webln.enable();const p=parseInt(t)*1e3;if(!Number.isFinite(p))throw new Error("invalid amount");const E=new URL(l.callback);E.searchParams.append("amount",String(p));const{pr:w}=await fetch(E).then(I=>I.json());if(w){if(he(w).amount!==p)throw new Error("incorrect amount")}else throw new Error("Failed to get invoice");await window.webln.sendPayment(w)}catch{o(!1)}i(!1)}},[i,l==null?void 0:l.callback,n,h]);return je(g,1e3*60),e.jsx(x,{gap:"2",children:e.jsxs(fe,{children:[e.jsx(ge,{children:e.jsx(j,{rightIcon:h?e.jsx(T,{size:"sm"}):void 0,children:"Stream sats"})}),e.jsxs(me,{children:[e.jsx(we,{}),e.jsx(be,{}),e.jsxs(Se,{children:["Stream ",t," sats per minute"]}),e.jsx(ye,{children:d?e.jsxs(x,{gap:"2",children:[e.jsxs(ve,{step:1,min:1,value:t,onChange:p=>a(p),isDisabled:!d,children:[e.jsx(Ce,{}),e.jsxs(ke,{children:[e.jsx(Pe,{}),e.jsx(Ee,{})]})]}),e.jsx(j,{leftIcon:h?e.jsx(Ie,{}):e.jsx(Re,{}),onClick:()=>o(p=>!p),isDisabled:!d,children:h?"Stop":"Start"})]}):e.jsx(L,{colorScheme:"orange",children:"Missing WebLN"})})]})]})})}function $({stream:s,...r}){const n=xs(s);if(!n)return null;const o=Le.getSharableEventAddress(n);return e.jsxs(y,{direction:"column",gap:"1",...r,children:[e.jsx(v,{px:"2",pt:"2",pb:"0",children:e.jsx(f,{size:"md",children:e.jsx(Me,{as:ze,to:`/goals/${o}`,children:Be(n)})})}),e.jsxs(C,{p:"2",display:"flex",gap:"2",flexDirection:"column",children:[e.jsx(Te,{goal:n}),e.jsxs(x,{gap:"2",alignItems:"flex-end",children:[e.jsx(Ae,{goal:n,overflow:"hidden",flex:1}),e.jsx(De,{goal:n,flexShrink:0})]})]})]})}function Y({stream:s,"aria-label":r,title:n="Quote repost",...o}){const{openModal:c}=u.useContext(Ge),i=()=>{const t=Ue(s.event);c({initContent:`
nostr:`+t})};return e.jsx(j,{leftIcon:e.jsx(Ne,{}),onClick:i,"aria-label":r||n,title:n,...o,children:"Share"})}function ws({stream:s}){A(s.title);const r=D(),[n,o]=u.useState(!0),c=()=>e.jsxs(ls,{children:[e.jsx(cs,{value:location.href+"?displayMode=log&colorMode=dark","aria-label":"Copy chat log URL",title:"Copy chat log URL",size:"sm"}),e.jsx(j,{rightIcon:e.jsx(ds,{}),size:"sm",onClick:()=>{const a=window.screenTop+window.innerHeight-910,l=window.screenLeft+window.innerWidth-512;window.open(location.href+"?displayMode=popup","_blank",`width=512,height=910,left=${l},top=${a}`)},children:"Open"})]});return e.jsxs(G,{children:[e.jsxs(x,{gap:"2",alignItems:"center",children:[e.jsx(j,{onClick:()=>r(-1),leftIcon:e.jsx(N,{boxSize:6}),children:"Back"}),e.jsx(m,{pubkey:s.host,size:"sm",display:{base:"none",md:"block"}}),e.jsx(f,{size:"md",isTruncated:!0,display:{base:"none",md:"initial"},children:s.title}),e.jsx(Je,{stream:s,fontSize:"lg"}),e.jsx(b,{}),e.jsx(Y,{stream:s,title:"Share stream"}),e.jsx(Ke,{event:s.event,variant:"ghost"}),e.jsxs(j,{onClick:()=>o(i=>!i),children:[n?"Hide":"Show"," Chat"]})]}),e.jsxs(x,{gap:"2",maxH:"calc(100vh - 4rem)",overflow:"hidden",children:[e.jsx(U,{stream:s.streaming||s.recording,autoPlay:!!s.streaming,poster:s.image,w:0,flexGrow:1,mx:"auto"}),n&&e.jsxs(x,{direction:"column",gap:"2",flexGrow:1,maxW:"lg",flexShrink:0,children:[e.jsx($,{stream:s}),e.jsx(Z,{stream:s,actions:c(),flex:1})]})]}),e.jsxs(x,{gap:"2",alignItems:"center",children:[e.jsx(m,{pubkey:s.host,noProxy:!0}),e.jsxs(k,{children:[e.jsx(f,{size:"md",children:s.title}),e.jsx(S,{pubkey:s.host})]}),e.jsx(b,{}),!!window.webln&&e.jsx(ms,{pubkey:s.host})]}),e.jsx(_,{stream:s}),s.tags.length>0&&e.jsx(x,{gap:"2",wrap:"wrap",children:e.jsx(O,{stream:s})}),e.jsx(x,{gap:"2",wrap:"wrap",children:e.jsx(W,{pubkey:s.host,maxW:"lg",minW:"md"})})]})}function bs({stream:s}){A(s.title);const r=D(),n=es();return e.jsxs(G,{px:0,children:[e.jsxs(x,{gap:"2",alignItems:"center",px:"2",flexShrink:0,children:[e.jsx(j,{onClick:()=>r(-1),leftIcon:e.jsx(N,{}),size:"sm",children:"Back"}),e.jsx(b,{}),e.jsx(Y,{stream:s,size:"sm"}),e.jsx(j,{onClick:n.onOpen,size:"sm",children:"Show Chat"})]}),e.jsx(U,{stream:s.streaming||s.recording,autoPlay:!!s.streaming,poster:s.image}),e.jsxs(x,{direction:"column",gap:"2",overflow:"hidden",px:"2",children:[e.jsxs(x,{gap:"2",children:[e.jsx(m,{pubkey:s.host,noProxy:!0}),e.jsxs(k,{children:[e.jsx(f,{size:"md",children:s.title}),e.jsx(S,{pubkey:s.host})]})]}),e.jsx(_,{stream:s}),s.tags.length>0&&e.jsx(x,{gap:"2",wrap:"wrap",children:e.jsx(O,{stream:s})}),e.jsx(ps,{stream:s,label:"Zap Stream"}),e.jsx(f,{size:"sm",children:"Stream goal"}),e.jsx(ss,{}),e.jsx($,{stream:s}),e.jsx(W,{pubkey:s.host})]}),e.jsxs(ns,{onClose:n.onClose,isOpen:n.isOpen,size:"full",isFullHeight:!0,children:[e.jsx(as,{}),e.jsxs(ts,{children:[e.jsx(rs,{}),e.jsx(os,{px:"4",pb:"0",children:"Stream Chat"}),e.jsxs(is,{p:0,overflow:"hidden",display:"flex",gap:"2",flexDirection:"column",children:[e.jsx(V,{stream:s,px:"2"}),e.jsx(H,{stream:s,flex:1,px:"2"}),e.jsx(F,{stream:s})]})]})]})]})}function Ss({stream:s}){const n=Ye({base:!0,lg:!1})?bs:ws;return e.jsx(n,{stream:s})}function ys({stream:s,displayMode:r}){return e.jsxs(e.Fragment,{children:[e.jsx(Qe,{styles:Xe`
          body {
            background: transparent;
          }
        `}),e.jsx(Z,{stream:s,flexGrow:1,h:"100vh",w:"100vw",displayMode:r})]})}function Rs(){const{naddr:s}=qe(),[r]=He();if(Fe(),!s)return e.jsx(Oe,{replace:!0,to:"/streams"});const n=P(),[o,c]=u.useState([]),i=u.useMemo(()=>{try{const d=Ve.decode(s);if(d.type!=="naddr")throw new Error("Invalid stream address");if(d.data.kind!==R.LiveEvent)throw new Error("Invalid stream kind");const h=d.data.relays??[];return z.requestEvent(Ze([...n,...o,...h]),d.data.kind,d.data.pubkey,d.data.identifier,{alwaysRequest:!0})}catch(d){console.log(d)}},[s,o.join("|")]),t=B(i),a=u.useMemo(()=>t&&_e(t),[t]);u.useEffect(()=>{a!=null&&a.relays&&c(a.relays)},[a==null?void 0:a.relays]);const l=r.get("displayMode")??void 0;return a?e.jsx(We,{relays:o,children:e.jsx($e,{pubkey:a.host,children:l?e.jsx(ys,{stream:a,displayMode:l}):e.jsx(Ss,{stream:a})})}):e.jsx(T,{})}export{Rs as default};
//# sourceMappingURL=index-CRu-rICt.js.map
