import{av as O,df as I,dg as U,j as e,B,gu as P,dh as M,r as l,az as _,F as d,T as L,y as C,E as j,d5 as D,p as N,gv as W,L as q,aB as V,a as H,b as F,aw as G,aC as X,bD as Y,G as Q,s as E,H as S,gw as J,k as f,ep as K,_ as Z,a2 as $,a3 as ee,a4 as se,a5 as te,gx as ne,b6 as z,af as re,gy as ae,gz as oe,gA as ce,b2 as ie,ae as le,b4 as ue,fc as de,bI as he,V as xe,dY as ge,z as v,dL as me,v as pe,ac as fe,gB as je,gC as ye,dc as be,gD as Se}from"./index-C6wlVu-O.js";import ke from"./embedded-article-G0MTVFS1.js";const ve=[P],we=[M];function Re({pubkey:s,...t}){const n=O(s),r=I(n==null?void 0:n.about,U,{transformers:ve,linkRenderers:we});return e.jsx(B,{whiteSpace:"pre-line",...t,children:r})}function Ae({profile:s}){l.useEffect(()=>D.handleEvent(s),[s.id]);const{value:t}=N(()=>W.getUserStats(s.pubkey),[s.pubkey]);return e.jsxs(d,{as:q,overflow:"hidden",direction:"column",borderWidth:1,rounded:"md",p:"2",flexShrink:0,maxW:"xs",minW:"48",children:[e.jsxs(d,{gap:"2",overflow:"hidden",children:[e.jsx(V,{pubkey:s.pubkey,float:"left"}),e.jsxs(d,{direction:"column",overflow:"hidden",children:[e.jsx(H,{as:F,to:"/u/"+G.npubEncode(s.pubkey),children:e.jsx(X,{pubkey:s.pubkey,fontSize:"xl",isTruncated:!0})}),e.jsx(Y,{pubkey:s.pubkey,isTruncated:!0})]})]}),e.jsx(Re,{pubkey:s.pubkey,noOfLines:3,isTruncated:!0}),t&&e.jsx(e.Fragment,{children:t.followers_pubkey_count&&e.jsxs(L,{children:["Followers: ",Q(t.followers_pubkey_count)]})})]})}function Ce({profiles:s}){const[t,n]=l.useState("relay"),r=_(),m=l.useMemo(()=>{switch(t){case"trust":return(r==null?void 0:r.sortByDistanceAndConnections(s,c=>c.pubkey))||s;default:case"relay":return s}},[t,s,r]);return e.jsxs(e.Fragment,{children:[e.jsxs(d,{gap:"2",children:[e.jsx(L,{children:"Order By:"}),e.jsxs(C,{size:"xs",children:[e.jsx(j,{variant:t==="relay"?"solid":"outline",onClick:()=>n("relay"),children:"Relay order"}),r&&e.jsx(j,{variant:t==="trust"?"solid":"outline",onClick:()=>n("trust"),children:"Trust"})]})]}),e.jsx(d,{gap:"2",overflowY:"hidden",overflowX:"auto",w:"full",px:"2",pb:"2",children:m.map(c=>e.jsx(Ae,{profile:c},c.pubkey))})]})}const w=4;function Le({notes:s}){const t=E(),n=l.useMemo(()=>t.isOpen?s:Array.from(s).slice(0,w),[s,t.isOpen]);return e.jsxs(e.Fragment,{children:[e.jsxs(d,{justifyContent:"space-between",gap:"2",alignItems:"flex-end",children:[e.jsxs(S,{size:"md",children:["Notes (",s.length,")"]}),s.length>w&&e.jsxs(j,{size:"sm",variant:"ghost",onClick:t.onToggle,children:["Show ",t.isOpen?"less":"all"]})]}),n.map(r=>e.jsx(J,{event:r},r.id)),!t.isOpen&&s.length>w&&e.jsx(j,{mx:"auto",size:"lg",variant:"ghost",onClick:t.onOpen,px:"10",children:"Show all"})]})}const R=4;function Te({articles:s}){const t=E(),n=l.useMemo(()=>t.isOpen?s:Array.from(s).slice(0,R),[s,t.isOpen]);return e.jsxs(e.Fragment,{children:[e.jsxs(d,{justifyContent:"space-between",gap:"2",alignItems:"flex-end",children:[e.jsxs(S,{size:"md",children:["Articles (",s.length,")"]}),s.length>R&&e.jsxs(j,{size:"sm",variant:"ghost",onClick:t.onToggle,children:["Show ",t.isOpen?"less":"all"]})]}),n.map(r=>e.jsx(ke,{article:r},r.id)),!t.isOpen&&s.length>R&&e.jsx(j,{mx:"auto",size:"lg",variant:"ghost",onClick:t.onOpen,px:"10",children:"Show all"})]})}function ze(s){let t,n=!0;return{search:async(c,a)=>{n=!0;const h=typeof s=="string"?await z.requestRelay(s,!1):s;await z.requestConnect(h),t=h.subscribe(c,{onevent:i=>{var x;return n&&((x=a.onevent)==null?void 0:x.call(a,i))},oneose:()=>{var i;t==null||t.close(),(i=a.oneose)==null||i.call(a)},onclose:a.onclose})},cancel:()=>{n=!1,t&&t.close()},relay:s}}const A=new ne(10);function Fe({query:s,relay:t}){const[n,r]=l.useState([]),[m,c]=l.useState(!1),[a,h]=l.useState(),i=l.useMemo(()=>ze(t),[t]);l.useEffect(()=>{if(!(s.length<3))if(h(void 0),A.has(s+t)){const o=A.get(s+t);r(o),c(!1)}else return r([]),c(!0),i.search([{search:s,kinds:[f.Metadata,f.ShortTextNote,f.LongFormArticle],limit:200}],{onevent:o=>{o=K.add(o,typeof i.relay=="string"?i.relay:i.relay.url),r(k=>{const y=[...k,o];return A.set(s+t,y),y})},oneose:()=>c(!1)}).catch(o=>h(o)),()=>i.cancel()},[s,i]);const x=n.filter(o=>o.kind===f.Metadata),p=n.filter(o=>o.kind===f.ShortTextNote),b=n.filter(o=>o.kind===f.LongFormArticle);return m&&n.length===0?e.jsxs(S,{size:"md",mx:"auto",my:"10",children:[e.jsx(Z,{})," Searching relay..."]}):a?e.jsxs($,{status:"error",variant:"subtle",flexDirection:"column",alignItems:"center",justifyContent:"center",textAlign:"center",height:"200px",children:[e.jsx(ee,{boxSize:"40px",mr:0}),e.jsx(se,{mt:4,mb:1,fontSize:"lg",children:a.name}),e.jsx(te,{maxWidth:"sm",whiteSpace:"pre",children:a.message})]}):n.length===0?e.jsx(S,{size:"md",mx:"auto",my:"10",children:"Found nothing... :("}):e.jsxs(e.Fragment,{children:[n.length>0&&e.jsxs(L,{children:["Found ",n.length," results"]}),x.length>0&&e.jsx(Ce,{profiles:x}),p.length>0&&e.jsx(Le,{notes:p}),b.length>0&&e.jsx(Te,{articles:b})]})}function Ee(){const s=re(),t=ae(s==null?void 0:s.pubkey);return t?oe(t):ce}function Oe(){var y;const s=le(),t=Ee(),n=ue({base:!1,lg:!0}),[r,m]=de(),c=r.get("q")||"",a=r.get("relay")||t[0],{register:h,handleSubmit:i,setValue:x}=he({defaultValues:{query:c,relay:a},mode:"all"});l.useEffect(()=>x("relay",a),[a]);const p=u=>{const g=u.trim();if(g.startsWith("nostr:")||g.startsWith("web+nostr:")||be(u))return s({pathname:"/l/"+encodeURIComponent(u)},{replace:!0}),!0;const T=Se().exec(g);return T?(s({pathname:"/t/"+T[2].toLocaleLowerCase()},{replace:!0}),!0):!1},b=l.useCallback(async()=>{p(await navigator.clipboard.readText())},[]),o=i(u=>{if(!p(u.query)){const g=new URLSearchParams(r);g.set("q",u.query),g.set("relay",u.relay),m(g)}}),k=c&&a;return e.jsxs(xe,{children:[e.jsxs(d,{as:"form",gap:"2",wrap:"wrap",onSubmit:o,children:[e.jsxs(C,{children:[e.jsx(ge,{onData:p}),!!((y=navigator.clipboard)!=null&&y.readText)&&e.jsx(v,{onClick:b,icon:e.jsx(me,{boxSize:5}),"aria-label":"Read clipboard"})]}),e.jsx(pe,{type:"search",isRequired:!0,autoFocus:n,w:"auto",flexGrow:1,...h("query",{required:!0,minLength:3}),autoComplete:"off"}),e.jsx(fe,{w:"auto",...h("relay"),children:t.map(u=>e.jsx("option",{value:u,children:u},u))}),e.jsxs(C,{children:[e.jsx(v,{type:"submit","aria-label":"Search",icon:e.jsx(je,{boxSize:5}),colorScheme:"primary"}),e.jsx(v,{as:F,type:"button","aria-label":"Advanced",icon:e.jsx(ye,{boxSize:5}),to:"/relays/search"})]})]}),e.jsx(d,{direction:"column",gap:"2",children:k?e.jsx(Fe,{relay:a,query:c}):null})]})}function Be(){return e.jsx(ie,{initList:"global",children:e.jsx(Oe,{})})}export{Oe as SearchPage,Be as default};
//# sourceMappingURL=index-D7WSYw97.js.map
