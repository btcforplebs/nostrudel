import{n as U,j as e,de as I,r as v,df as ie,B as u,E as C,dg as ae,dh as oe,a6 as H,af as W,cW as le,d4 as g,d6 as _,t as $,di as de,dj as ce,m as M,dk as pe,cQ as xe,cR as ue,cS as he,cT as je,dl as Ce,cV as be,e as G,dm as k,f as K,i as me,I as ge,an as fe,ao as ke,ap as Me,aq as ye,ar as we,as as Ie,S as q,bB as ve,cp as Se,F as h,aN as S,Z as L,bD as Le,s as y,c$ as R,dn as A,dp as N,dq as Y,C as Z,H as j,y as B,T as f,G as J,aV as Q,l as w,b as m,$ as Re,dr as D,d2 as E,d3 as ze,aI as Oe,bo as Pe,ds as Te,b4 as De,k as P,cY as F,aW as Ee,by as Ue,d0 as Ae,dt as Ne,V as Be,du as Fe,Y as Ve,bC as He,aw as We,at as _e,_ as $e,bp as Ge,dc as V,dv as Ke,dw as qe}from"./index-C6wlVu-O.js";import{C as Ye}from"./community-create-modal-B8kIIGiT.js";const Ze=U({displayName:"TrendUp01",viewBox:"0 0 24 24",path:[e.jsx("path",{d:"M22 7L14.1314 14.8686C13.7354 15.2646 13.5373 15.4627 13.309 15.5368C13.1082 15.6021 12.8918 15.6021 12.691 15.5368C12.4627 15.4627 12.2646 15.2646 11.8686 14.8686L9.13137 12.1314C8.73535 11.7354 8.53735 11.5373 8.30902 11.4632C8.10817 11.3979 7.89183 11.3979 7.69098 11.4632C7.46265 11.5373 7.26465 11.7354 6.86863 12.1314L2 17M22 7H15M22 7V14",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",fill:"none"})],defaultProps:{boxSize:4}}),Je=U({displayName:"Clock",viewBox:"0 0 24 24",path:[e.jsx("path",{d:"M12 6V12L16 14M22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12Z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",fill:"none"})],defaultProps:{boxSize:4}}),Qe=U({displayName:"Hourglass03",viewBox:"0 0 24 24",path:[e.jsx("path",{d:"M9 18.5H15M6.6 2H17.4C17.9601 2 18.2401 2 18.454 2.10899C18.6422 2.20487 18.7951 2.35785 18.891 2.54601C19 2.75992 19 3.03995 19 3.6V5.67452C19 6.1637 19 6.40829 18.9447 6.63846C18.8957 6.84254 18.8149 7.03763 18.7053 7.21657C18.5816 7.4184 18.4086 7.59135 18.0627 7.93726L15.1314 10.8686C14.7354 11.2646 14.5373 11.4627 14.4632 11.691C14.3979 11.8918 14.3979 12.1082 14.4632 12.309C14.5373 12.5373 14.7354 12.7354 15.1314 13.1314L18.0627 16.0627C18.4086 16.4086 18.5816 16.5816 18.7053 16.7834C18.8149 16.9624 18.8957 17.1575 18.9447 17.3615C19 17.5917 19 17.8363 19 18.3255V20.4C19 20.9601 19 21.2401 18.891 21.454C18.7951 21.6422 18.6422 21.7951 18.454 21.891C18.2401 22 17.9601 22 17.4 22H6.6C6.03995 22 5.75992 22 5.54601 21.891C5.35785 21.7951 5.20487 21.6422 5.10899 21.454C5 21.2401 5 20.9601 5 20.4V18.3255C5 17.8363 5 17.5917 5.05526 17.3615C5.10425 17.1575 5.18506 16.9624 5.29472 16.7834C5.4184 16.5816 5.59135 16.4086 5.93726 16.0627L8.86863 13.1314C9.26465 12.7354 9.46265 12.5373 9.53684 12.309C9.6021 12.1082 9.6021 11.8918 9.53684 11.691C9.46266 11.4627 9.26464 11.2646 8.86863 10.8686L5.93726 7.93726C5.59136 7.59136 5.4184 7.4184 5.29472 7.21657C5.18506 7.03763 5.10425 6.84254 5.05526 6.63846C5 6.40829 5 6.1637 5 5.67452V3.6C5 3.03995 5 2.75992 5.10899 2.54601C5.20487 2.35785 5.35785 2.20487 5.54601 2.10899C5.75992 2 6.03995 2 6.6 2Z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",fill:"none"})],defaultProps:{boxSize:4}}),Xe=[oe];function X({community:s,maxLength:i,showExpand:t,...n}){const l=I(s),[p,d]=v.useState(!1),o=ie(l,ae,{maxLength:p?void 0:i,linkRenderers:Xe});return e.jsxs(e.Fragment,{children:[e.jsx(u,{whiteSpace:"pre-wrap",...n,children:o}),i!==void 0&&t&&!p&&((l==null?void 0:l.length)??0)>i&&e.jsx(C,{variant:"link",onClick:()=>d(!0),children:"Show More"})]})}function ee({community:s,...i}){const t=H(),n=W(),{list:l,pointers:p}=le(n==null?void 0:n.pubkey),d=p.find(a=>a.identifier===g(s)&&a.pubkey===s.pubkey),o=v.useCallback(async()=>{const a={kind:_,content:(l==null?void 0:l.content)??"",created_at:$().unix(),tags:(l==null?void 0:l.tags.filter(r=>!de(r)))??[]};let c;d?c=ce(a,M(s)):c=pe(a,M(s)),await t(d?"Unsubscribe":"Subscribe",c)},[d,l,s,t]);return e.jsx(C,{onClick:o,variant:d?"outline":"solid",colorScheme:d?"red":"green",...i,children:d?"Leave":"Join"})}function se({community:s,onEditClick:i,...t}){const n=W();return e.jsx(e.Fragment,{children:e.jsxs(xe,{...t,children:[e.jsx(ue,{event:s}),e.jsx(he,{event:s}),(n==null?void 0:n.pubkey)===s.pubkey&&i&&e.jsx(je,{onClick:i,icon:e.jsx(Ce,{}),children:"Edit Community"}),e.jsx(be,{event:s})]})})}function es({pubkey:s}){return e.jsxs(h,{overflow:"hidden",gap:"4",alignItems:"center",children:[e.jsx(S,{pubkey:s}),e.jsxs(h,{direction:"column",flex:1,overflow:"hidden",children:[e.jsx(L,{pubkey:s,fontWeight:"bold"}),e.jsx(Le,{pubkey:s})]})]})}function ne({community:s,onClose:i,...t}){const n=M(s),l=G(k(s)),{loader:p,timeline:d}=K(`${n}-members`,l,[{"#a":[n],kinds:[_]}]),o=me(p),a={};if(d)for(const c of d)(!a[c.pubkey]||a[c.pubkey].created_at<c.created_at)&&(a[c.pubkey]=c);return e.jsx(ge,{callback:o,children:e.jsxs(fe,{onClose:i,size:"4xl",...t,children:[e.jsx(ke,{}),e.jsxs(Me,{children:[e.jsx(ye,{px:"4",pt:"4",pb:"0",children:"Community Members"}),e.jsx(we,{}),e.jsxs(Ie,{p:"4",children:[e.jsx(q,{columns:{base:1,lg:2},spacing:"4",children:d==null?void 0:d.map(c=>e.jsx(es,{pubkey:c.pubkey},c.id))}),e.jsx(ve,{timeline:p})]}),e.jsx(Se,{px:"4",pt:"0",pb:"4",children:e.jsx(C,{onClick:i,children:"Close"})})]})]})})}function ss({community:s,onEditClick:i,...t}){const n=y(),l=k(s),p=R(s),d=I(s),o=A(s),a=N(s),c=Y(s);return e.jsxs(e.Fragment,{children:[e.jsxs(Z,{p:"4",gap:"4",...t,children:[d&&e.jsxs(u,{children:[e.jsx(j,{size:"sm",mb:"1",children:"About"}),e.jsx(X,{community:s,maxLength:256,showExpand:!0})]}),e.jsxs(B,{w:"full",children:[e.jsx(ee,{community:s,flex:1}),e.jsx(se,{community:s,"aria-label":"More",onEditClick:i})]}),e.jsxs(u,{children:[e.jsx(j,{size:"sm",mb:"1",children:"Mods"}),e.jsx(h,{direction:"column",gap:"2",children:p.map(r=>e.jsxs(h,{gap:"2",children:[e.jsx(S,{pubkey:r,size:"xs"}),e.jsx(L,{pubkey:r})]}))})]}),e.jsxs(u,{as:"button",textAlign:"start",cursor:"pointer",onClick:n.onOpen,children:[e.jsx(j,{size:"sm",mb:"1",children:"Members"}),e.jsx(f,{children:c?J(c):"unknown"})]}),o&&e.jsxs(u,{children:[e.jsx(j,{size:"sm",mb:"1",children:"Rules"}),e.jsx(f,{whiteSpace:"pre-wrap",children:o})]}),l.length>0&&e.jsxs(u,{children:[e.jsx(j,{size:"sm",mb:"1",children:"Relays"}),e.jsx(h,{direction:"column",gap:"2",children:l.map(r=>e.jsxs(h,{alignItems:"center",gap:"2",children:[e.jsx(Q,{relay:r,size:"xs"}),e.jsx(w,{as:m,to:`/r/${encodeURIComponent(r)}`,fontWeight:"bold",isTruncated:!0,children:r})]},r))})]}),a.length>0&&e.jsxs(u,{children:[e.jsx(j,{size:"sm",mb:"1",children:"Links"}),e.jsx(u,{children:a.map(([r,x])=>e.jsx(w,{href:r,isTruncated:!0,isExternal:!0,display:"block",children:x||r}))})]})]}),n.isOpen&&e.jsx(ne,{isOpen:n.isOpen,onClose:n.onClose,community:s})]})}function ns({community:s,onEditClick:i,...t}){const n=y(),l=k(s),p=R(s),d=I(s),o=A(s),a=N(s),c=y(),r=Y(s);return e.jsxs(e.Fragment,{children:[e.jsx(Z,{...t,children:e.jsxs(Re,{children:[e.jsxs(B,{float:"right",children:[e.jsx(ee,{community:s}),e.jsx(se,{community:s,"aria-label":"More",onEditClick:i})]}),d&&e.jsxs(e.Fragment,{children:[e.jsx(j,{size:"sm",mb:"1",children:"Description"}),e.jsx(X,{community:s,mb:"1"})]}),c.isOpen?e.jsxs(q,{spacing:"4",columns:2,children:[e.jsxs(u,{children:[e.jsx(j,{size:"sm",mb:"1",children:"Mods"}),e.jsx(h,{direction:"column",gap:"2",children:p.map(x=>e.jsxs(h,{gap:"2",children:[e.jsx(S,{pubkey:x,size:"xs"}),e.jsx(L,{pubkey:x})]}))})]}),e.jsxs(u,{as:"button",textAlign:"start",cursor:"pointer",onClick:n.onOpen,children:[e.jsx(j,{size:"sm",mb:"1",children:"Members"}),e.jsx(f,{children:r?J(r):"unknown"})]}),o&&e.jsxs(u,{children:[e.jsx(j,{size:"sm",mb:"1",children:"Rules"}),e.jsx(f,{whiteSpace:"pre-wrap",children:o})]}),l.length>0&&e.jsxs(u,{children:[e.jsx(j,{size:"sm",mb:"1",children:"Relays"}),e.jsx(h,{direction:"column",gap:"2",children:l.map(x=>e.jsxs(h,{alignItems:"center",gap:"2",children:[e.jsx(Q,{relay:x,size:"xs"}),e.jsx(w,{as:m,to:`/r/${encodeURIComponent(x)}`,fontWeight:"bold",isTruncated:!0,children:x})]},x))})]}),a.length>0&&e.jsxs(u,{children:[e.jsx(j,{size:"sm",mb:"1",children:"Links"}),e.jsx(u,{children:a.map(([x,z])=>e.jsx(w,{href:x,isTruncated:!0,isExternal:!0,display:"block",children:z||x}))})]})]}):e.jsx(C,{variant:"link",onClick:c.onOpen,w:"full",children:"Show more"})]})}),n.isOpen&&e.jsx(ne,{isOpen:n.isOpen,onClose:n.onClose,community:s})]})}function ts({isOpen:s,onClose:i,community:t,...n}){const l=H(),p=v.useMemo(()=>({name:g(t),description:I(t)||"",banner:D(t)||"",rules:A(t)||"",mods:R(t)||[],relays:k(t)||[],links:N(t)||[]}),[t]),d=async o=>{const a={kind:E,created_at:$().unix(),content:"",tags:[["d",g(t)]]};if(o.description&&a.tags.push(["description",o.description]),o.banner)try{const r=await ze(o.banner);a.tags.push(["image",o.banner,`${r.width}x${r.height}`])}catch{a.tags.push(["image",o.banner])}for(const r of o.mods)a.tags.push(["p",r,"","moderator"]);for(const r of o.relays)a.tags.push(["relay",r]);for(const[r,x]of o.links)a.tags.push(x?["r",r,x]:["r",r]);await l("Update Community",a,o.relays)&&i()};return e.jsx(Ye,{isOpen:s,onClose:i,onSubmit:d,defaultValues:p,isUpdate:!0,...n})}function T(s){return`/c/${encodeURIComponent(g(s))}/${We.npubEncode(s.pubkey)}`}function rs({community:s}){const i=Oe(),t=D(s),n=Pe(),{openModal:l}=v.useContext(Te),p=y(),d=M(s),o=De({base:!0,xl:!1}),a=k(s),c=G(a),{loader:r}=K(`${Ee(s)}-timeline`,c,{kinds:[P.ShortTextNote,P.Repost,P.GenericRepost,F],"#a":[d]}),x=Ue(r.timeline)??[],z=R(s),te=Ae(x,z),re=x.filter(O=>O.kind!==F&&!te.has(O.id)&&!i(O));let b="newest";return n.pathname.endsWith("/newest")&&(b="newest"),n.pathname.endsWith("/pending")&&(b="pending"),n.pathname.endsWith("/trending")&&(b="trending"),e.jsxs(e.Fragment,{children:[e.jsx(Ne,{relays:a,children:e.jsxs(Be,{pt:t&&"0",children:[e.jsxs(h,{backgroundImage:D(s),backgroundRepeat:"no-repeat",backgroundSize:"cover",backgroundPosition:"center",aspectRatio:3/1,backgroundColor:"rgba(0,0,0,0.2)",p:"4",gap:"4",direction:"column",justifyContent:"flex-end",textShadow:"2px 2px var(--chakra-blur-sm) var(--chakra-colors-blackAlpha-800)",children:[e.jsx(j,{children:g(s)}),e.jsxs(h,{gap:"2",alignItems:"center",children:[e.jsx(S,{pubkey:s.pubkey,size:"sm"}),e.jsx(f,{children:"by"}),e.jsx(L,{pubkey:s.pubkey})]})]}),o&&e.jsx(ns,{community:s,w:"full",flexShrink:0,onEditClick:p.onOpen}),e.jsxs(h,{gap:"4",alignItems:"flex-start",overflow:"hidden",children:[e.jsxs(h,{direction:"column",gap:"4",flex:1,overflow:"hidden",minH:"full",children:[e.jsxs(B,{size:"sm",children:[e.jsx(C,{colorScheme:"primary",leftIcon:e.jsx(Fe,{}),onClick:()=>l({cacheFormKey:d+"-new-post",initCommunity:d,requireSubject:!0}),children:"New Post"}),e.jsx(Ve,{orientation:"vertical",h:"2rem"}),e.jsx(C,{leftIcon:e.jsx(Ze,{}),as:m,to:T(s)+"/trending",colorScheme:b==="trending"?"primary":"gray",replace:!0,children:"Trending"}),e.jsx(C,{leftIcon:e.jsx(Je,{}),as:m,to:T(s)+"/newest",colorScheme:b==="newest"?"primary":"gray",replace:!0,children:"New"}),e.jsxs(C,{leftIcon:e.jsx(Qe,{}),as:m,to:T(s)+"/pending",colorScheme:b=="pending"?"primary":"gray",replace:!0,children:["Pending (",re.length,")"]})]}),e.jsx(He,{context:{community:s,timeline:r}})]}),!o&&e.jsx(ss,{community:s,w:"full",maxW:"xs",flexShrink:0,onEditClick:p.onOpen})]})]})}),p.isOpen&&e.jsx(ts,{isOpen:p.isOpen,onClose:p.onClose,community:s})]})}function is(){const{community:s,pubkey:i}=Ge(),t=s?V(s):void 0;if(t){if(t.type==="naddr"&&t.data.kind===E)return t.data}else if(s&&i){const n=Ke(i)?i:qe(V(i));return n?{kind:E,pubkey:n,identifier:s}:void 0}}function ls(){const s=is(),i=_e(s,void 0,{alwaysRequest:!0});return i?e.jsx(rs,{community:i}):e.jsx($e,{})}export{ls as default};
//# sourceMappingURL=index-D6oneq3Q.js.map
