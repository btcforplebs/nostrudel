var cl=Object.create;var an=Object.defineProperty;var ul=Object.getOwnPropertyDescriptor;var _l=Object.getOwnPropertyNames;var fl=Object.getPrototypeOf,dl=Object.prototype.hasOwnProperty;var pl=(M,m)=>()=>(m||M((m={exports:{}}).exports,m),m.exports);var ml=(M,m,q,e)=>{if(m&&typeof m=="object"||typeof m=="function")for(let B of _l(m))!dl.call(M,B)&&B!==q&&an(M,B,{get:()=>m[B],enumerable:!(e=ul(m,B))||e.enumerable});return M};var hl=(M,m,q)=>(q=M!=null?cl(fl(M)):{},ml(m||!M||!M.__esModule?an(q,"default",{value:M,enumerable:!0}):q,M));var _n=pl((sc,Rt)=>{"use strict";var yl=Object.prototype.hasOwnProperty,Ce="~";function ct(){}Object.create&&(ct.prototype=Object.create(null),new ct().__proto__||(Ce=!1));function ql(M,m,q){this.fn=M,this.context=m,this.once=q||!1}function un(M,m,q,e,B){if(typeof q!="function")throw new TypeError("The listener must be a function");var K=new ql(q,e||M,B),ne=Ce?Ce+m:m;return M._events[ne]?M._events[ne].fn?M._events[ne]=[M._events[ne],K]:M._events[ne].push(K):(M._events[ne]=K,M._eventsCount++),M}function qt(M,m){--M._eventsCount===0?M._events=new ct:delete M._events[m]}function Le(){this._events=new ct,this._eventsCount=0}Le.prototype.eventNames=function(){var m=[],q,e;if(this._eventsCount===0)return m;for(e in q=this._events)yl.call(q,e)&&m.push(Ce?e.slice(1):e);return Object.getOwnPropertySymbols?m.concat(Object.getOwnPropertySymbols(q)):m};Le.prototype.listeners=function(m){var q=Ce?Ce+m:m,e=this._events[q];if(!e)return[];if(e.fn)return[e.fn];for(var B=0,K=e.length,ne=new Array(K);B<K;B++)ne[B]=e[B].fn;return ne};Le.prototype.listenerCount=function(m){var q=Ce?Ce+m:m,e=this._events[q];return e?e.fn?1:e.length:0};Le.prototype.emit=function(m,q,e,B,K,ne){var le=Ce?Ce+m:m;if(!this._events[le])return!1;var se=this._events[le],ye=arguments.length,be,te;if(se.fn){switch(se.once&&this.removeListener(m,se.fn,void 0,!0),ye){case 1:return se.fn.call(se.context),!0;case 2:return se.fn.call(se.context,q),!0;case 3:return se.fn.call(se.context,q,e),!0;case 4:return se.fn.call(se.context,q,e,B),!0;case 5:return se.fn.call(se.context,q,e,B,K),!0;case 6:return se.fn.call(se.context,q,e,B,K,ne),!0}for(te=1,be=new Array(ye-1);te<ye;te++)be[te-1]=arguments[te];se.fn.apply(se.context,be)}else{var xe=se.length,we;for(te=0;te<xe;te++)switch(se[te].once&&this.removeListener(m,se[te].fn,void 0,!0),ye){case 1:se[te].fn.call(se[te].context);break;case 2:se[te].fn.call(se[te].context,q);break;case 3:se[te].fn.call(se[te].context,q,e);break;case 4:se[te].fn.call(se[te].context,q,e,B);break;default:if(!be)for(we=1,be=new Array(ye-1);we<ye;we++)be[we-1]=arguments[we];se[te].fn.apply(se[te].context,be)}}return!0};Le.prototype.on=function(m,q,e){return un(this,m,q,e,!1)};Le.prototype.once=function(m,q,e){return un(this,m,q,e,!0)};Le.prototype.removeListener=function(m,q,e,B){var K=Ce?Ce+m:m;if(!this._events[K])return this;if(!q)return qt(this,K),this;var ne=this._events[K];if(ne.fn)ne.fn===q&&(!B||ne.once)&&(!e||ne.context===e)&&qt(this,K);else{for(var le=0,se=[],ye=ne.length;le<ye;le++)(ne[le].fn!==q||B&&!ne[le].once||e&&ne[le].context!==e)&&se.push(ne[le]);se.length?this._events[K]=se.length===1?se[0]:se:qt(this,K)}return this};Le.prototype.removeAllListeners=function(m){var q;return m?(q=Ce?Ce+m:m,this._events[q]&&qt(this,q)):(this._events=new ct,this._eventsCount=0),this};Le.prototype.off=Le.prototype.removeListener;Le.prototype.addListener=Le.prototype.on;Le.prefixed=Ce;Le.EventEmitter=Le;typeof Rt<"u"&&(Rt.exports=Le)});var Lt=(()=>{var M=import.meta.url;return function(m){var q=m||{},e=typeof q<"u"?q:{},B,K;e.ready=new Promise(function(n,t){B=n,K=t});let ne=globalThis.sqlite3InitModuleState||Object.assign(Object.create(null),{debugModule:()=>{}});delete globalThis.sqlite3InitModuleState,ne.debugModule("globalThis.location =",globalThis.location);let le="emscripten-bug-17951";e[le]=function n(t,i){t.env.foo=function(){};let o=e.locateFile(n.uri,typeof qe>"u"?"":qe);ne.debugModule("instantiateWasm() uri =",o);let r=()=>fetch(o,{credentials:"same-origin"});return(WebAssembly.instantiateStreaming?async()=>WebAssembly.instantiateStreaming(r(),t).then(p=>i(p.instance,p.module)):async()=>r().then(p=>p.arrayBuffer()).then(p=>WebAssembly.instantiate(p,t)).then(p=>i(p.instance,p.module)))(),{}},e[le].uri="sqlite3.wasm";var se=Object.assign({},e),ye=[],be="./this.program",te=(n,t)=>{throw t},xe=typeof window=="object",we=typeof importScripts=="function",He=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string",rt=!xe&&!He&&!we,qe="";function De(n){return e.locateFile?e.locateFile(n,qe):qe+n}var Be,ft,st,vt;(xe||we)&&(we?qe=self.location.href:typeof document<"u"&&document.currentScript&&(qe=document.currentScript.src),M&&(qe=M),qe.indexOf("blob:")!==0?qe=qe.substr(0,qe.replace(/[?#].*/,"").lastIndexOf("/")+1):qe="",Be=n=>{var t=new XMLHttpRequest;return t.open("GET",n,!1),t.send(null),t.responseText},we&&(st=n=>{var t=new XMLHttpRequest;return t.open("GET",n,!1),t.responseType="arraybuffer",t.send(null),new Uint8Array(t.response)}),ft=(n,t,i)=>{var o=new XMLHttpRequest;o.open("GET",n,!0),o.responseType="arraybuffer",o.onload=()=>{if(o.status==200||o.status==0&&o.response){t(o.response);return}i()},o.onerror=i,o.send(null)},vt=n=>document.title=n);var Ye=e.print||console.log.bind(console),ze=e.printErr||console.warn.bind(console);Object.assign(e,se),se=null,e.arguments&&(ye=e.arguments),e.thisProgram&&(be=e.thisProgram),e.quit&&(te=e.quit);var wt=16,Et=4;function qn(n){switch(n){case"i1":case"i8":case"u8":return 1;case"i16":case"u16":return 2;case"i32":case"u32":return 4;case"i64":case"u64":return 8;case"float":return 4;case"double":return 8;default:{if(n[n.length-1]==="*")return Et;if(n[0]==="i"){let t=Number(n.substr(1));return Mt(t%8===0,"getNativeTypeSize invalid bits "+t+", type "+n),t/8}return 0}}}var it;e.wasmBinary&&(it=e.wasmBinary);var bn=e.noExitRuntime||!0;typeof WebAssembly!="object"&&Ge("no native wasm support detected");var Ve,Ct=!1,vn;function Mt(n,t){n||Ge(t)}var jt=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0;function Ze(n,t,i){for(var o=t+i,r=t;n[r]&&!(r>=o);)++r;if(r-t>16&&n.buffer&&jt)return jt.decode(n.subarray(t,r));for(var s="";t<r;){var p=n[t++];if(!(p&128)){s+=String.fromCharCode(p);continue}var h=n[t++]&63;if((p&224)==192){s+=String.fromCharCode((p&31)<<6|h);continue}var R=n[t++]&63;if((p&240)==224?p=(p&15)<<12|h<<6|R:p=(p&7)<<18|h<<12|R<<6|n[t++]&63,p<65536)s+=String.fromCharCode(p);else{var C=p-65536;s+=String.fromCharCode(55296|C>>10,56320|C&1023)}}return s}function wn(n,t){return n?Ze(et,n,t):""}function dt(n,t,i,o){if(!(o>0))return 0;for(var r=i,s=i+o-1,p=0;p<n.length;++p){var h=n.charCodeAt(p);if(h>=55296&&h<=57343){var R=n.charCodeAt(++p);h=65536+((h&1023)<<10)|R&1023}if(h<=127){if(i>=s)break;t[i++]=h}else if(h<=2047){if(i+1>=s)break;t[i++]=192|h>>6,t[i++]=128|h&63}else if(h<=65535){if(i+2>=s)break;t[i++]=224|h>>12,t[i++]=128|h>>6&63,t[i++]=128|h&63}else{if(i+3>=s)break;t[i++]=240|h>>18,t[i++]=128|h>>12&63,t[i++]=128|h>>6&63,t[i++]=128|h&63}}return t[i]=0,i-r}function Bt(n,t,i){return dt(n,et,t,i)}function ot(n){for(var t=0,i=0;i<n.length;++i){var o=n.charCodeAt(i);o<=127?t++:o<=2047?t+=2:o>=55296&&o<=57343?(t+=4,++i):t+=3}return t}var Nl,Pe,et,pt,En,fe,ke,xt,zt,xn,St;function Wt(){var n=Ve.buffer;e.HEAP8=Pe=new Int8Array(n),e.HEAP16=pt=new Int16Array(n),e.HEAP32=fe=new Int32Array(n),e.HEAPU8=et=new Uint8Array(n),e.HEAPU16=En=new Uint16Array(n),e.HEAPU32=ke=new Uint32Array(n),e.HEAPF32=xt=new Float32Array(n),e.HEAPF64=St=new Float64Array(n),e.HEAP64=zt=new BigInt64Array(n),e.HEAPU64=xn=new BigUint64Array(n)}var Cl=524288,Ut=e.INITIAL_MEMORY||16777216;e.wasmMemory?Ve=e.wasmMemory:Ve=new WebAssembly.Memory({initial:Ut/65536,maximum:32768}),Wt(),Ut=Ve.buffer.byteLength;var Sn,Qt=[],Ht=[],Ml=[],Vt=[],An=!1;function jl(){return bn}function kn(){if(e.preRun)for(typeof e.preRun=="function"&&(e.preRun=[e.preRun]);e.preRun.length;)Fn(e.preRun.shift());It(Qt)}function In(){An=!0,!e.noFSInit&&!a.init.initialized&&a.init(),a.ignorePermissions=!1,$e.init(),It(Ht)}function Tn(){if(e.postRun)for(typeof e.postRun=="function"&&(e.postRun=[e.postRun]);e.postRun.length;)Pn(e.postRun.shift());It(Vt)}function Fn(n){Qt.unshift(n)}function On(n){Ht.unshift(n)}function Bl(n){}function Pn(n){Vt.unshift(n)}var Je=0,At=null,at=null;function zl(n){return n}function kt(n){Je++,e.monitorRunDependencies&&e.monitorRunDependencies(Je)}function mt(n){if(Je--,e.monitorRunDependencies&&e.monitorRunDependencies(Je),Je==0&&(At!==null&&(clearInterval(At),At=null),at)){var t=at;at=null,t()}}function Ge(n){e.onAbort&&e.onAbort(n),n="Aborted("+n+")",ze(n),Ct=!0,vn=1,n+=". Build with -sASSERTIONS for more info.";var t=new WebAssembly.RuntimeError(n);throw K(t),t}var Ln="data:application/octet-stream;base64,";function Gt(n){return n.startsWith(Ln)}function Wl(n){return n.startsWith("file://")}var Me;e.locateFile?(Me="sqlite3.wasm",Gt(Me)||(Me=De(Me))):Me=new URL("sqlite3.wasm",import.meta.url).href;function $t(n){try{if(n==Me&&it)return new Uint8Array(it);if(st)return st(n);throw"both async and sync fetching of the wasm failed"}catch(t){Ge(t)}}function Rn(){return!it&&(xe||we)&&typeof fetch=="function"?fetch(Me,{credentials:"same-origin"}).then(function(n){if(!n.ok)throw"failed to load wasm binary file at '"+Me+"'";return n.arrayBuffer()}).catch(function(){return $t(Me)}):Promise.resolve().then(function(){return $t(Me)})}function Dn(){var n={env:en,wasi_snapshot_preview1:en};function t(p,h){var R=p.exports;e.asm=R,Sn=e.asm.__indirect_function_table,On(e.asm.__wasm_call_ctors),mt("wasm-instantiate")}kt("wasm-instantiate");function i(p){t(p.instance)}function o(p){return Rn().then(function(h){return WebAssembly.instantiate(h,n)}).then(function(h){return h}).then(p,function(h){ze("failed to asynchronously prepare wasm: "+h),Ge(h)})}function r(){return!it&&typeof WebAssembly.instantiateStreaming=="function"&&!Gt(Me)&&typeof fetch=="function"?fetch(Me,{credentials:"same-origin"}).then(function(p){var h=WebAssembly.instantiateStreaming(p,n);return h.then(i,function(R){return ze("wasm streaming compile failed: "+R),ze("falling back to ArrayBuffer instantiation"),o(i)})}):o(i)}if(e.instantiateWasm)try{var s=e.instantiateWasm(n,t);return s}catch(p){ze("Module.instantiateWasm callback failed with error: "+p),K(p)}return r().catch(K),{}}var pe,Te,Ul={};function Ql(n){this.name="ExitStatus",this.message="Program terminated with exit("+n+")",this.status=n}function It(n){for(;n.length>0;)n.shift()(e)}function Hl(n,t="i8"){switch(t.endsWith("*")&&(t="*"),t){case"i1":return Pe[n>>0];case"i8":return Pe[n>>0];case"i16":return pt[n>>1];case"i32":return fe[n>>2];case"i64":return zt[n>>3];case"float":return xt[n>>2];case"double":return St[n>>3];case"*":return ke[n>>2];default:Ge("invalid type for getValue: "+t)}return null}function Vl(n,t,i="i8"){switch(i.endsWith("*")&&(i="*"),i){case"i1":Pe[n>>0]=t;break;case"i8":Pe[n>>0]=t;break;case"i16":pt[n>>1]=t;break;case"i32":fe[n>>2]=t;break;case"i64":Te=[t>>>0,(pe=t,+Math.abs(pe)>=1?pe>0?(Math.min(+Math.floor(pe/4294967296),4294967295)|0)>>>0:~~+Math.ceil((pe-+(~~pe>>>0))/4294967296)>>>0:0)],fe[n>>2]=Te[0],fe[n+4>>2]=Te[1];break;case"float":xt[n>>2]=t;break;case"double":St[n>>3]=t;break;case"*":ke[n>>2]=t;break;default:Ge("invalid type for setValue: "+i)}}var ve={isAbs:n=>n.charAt(0)==="/",splitPath:n=>{var t=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/;return t.exec(n).slice(1)},normalizeArray:(n,t)=>{for(var i=0,o=n.length-1;o>=0;o--){var r=n[o];r==="."?n.splice(o,1):r===".."?(n.splice(o,1),i++):i&&(n.splice(o,1),i--)}if(t)for(;i;i--)n.unshift("..");return n},normalize:n=>{var t=ve.isAbs(n),i=n.substr(-1)==="/";return n=ve.normalizeArray(n.split("/").filter(o=>!!o),!t).join("/"),!n&&!t&&(n="."),n&&i&&(n+="/"),(t?"/":"")+n},dirname:n=>{var t=ve.splitPath(n),i=t[0],o=t[1];return!i&&!o?".":(o&&(o=o.substr(0,o.length-1)),i+o)},basename:n=>{if(n==="/")return"/";n=ve.normalize(n),n=n.replace(/\/$/,"");var t=n.lastIndexOf("/");return t===-1?n:n.substr(t+1)},join:function(){var n=Array.prototype.slice.call(arguments);return ve.normalize(n.join("/"))},join2:(n,t)=>ve.normalize(n+"/"+t)};function Nn(){if(typeof crypto=="object"&&typeof crypto.getRandomValues=="function"){var n=new Uint8Array(1);return()=>(crypto.getRandomValues(n),n[0])}else return()=>Ge("randomDevice")}var Ue={resolve:function(){for(var n="",t=!1,i=arguments.length-1;i>=-1&&!t;i--){var o=i>=0?arguments[i]:a.cwd();if(typeof o!="string")throw new TypeError("Arguments to path.resolve must be strings");if(!o)return"";n=o+"/"+n,t=ve.isAbs(o)}return n=ve.normalizeArray(n.split("/").filter(r=>!!r),!t).join("/"),(t?"/":"")+n||"."},relative:(n,t)=>{n=Ue.resolve(n).substr(1),t=Ue.resolve(t).substr(1);function i(C){for(var Q=0;Q<C.length&&C[Q]==="";Q++);for(var U=C.length-1;U>=0&&C[U]==="";U--);return Q>U?[]:C.slice(Q,U-Q+1)}for(var o=i(n.split("/")),r=i(t.split("/")),s=Math.min(o.length,r.length),p=s,h=0;h<s;h++)if(o[h]!==r[h]){p=h;break}for(var R=[],h=p;h<o.length;h++)R.push("..");return R=R.concat(r.slice(p)),R.join("/")}};function Tt(n,t,i){var o=i>0?i:ot(n)+1,r=new Array(o),s=dt(n,r,0,r.length);return t&&(r.length=s),r}var $e={ttys:[],init:function(){},shutdown:function(){},register:function(n,t){$e.ttys[n]={input:[],output:[],ops:t},a.registerDevice(n,$e.stream_ops)},stream_ops:{open:function(n){var t=$e.ttys[n.node.rdev];if(!t)throw new a.ErrnoError(43);n.tty=t,n.seekable=!1},close:function(n){n.tty.ops.fsync(n.tty)},fsync:function(n){n.tty.ops.fsync(n.tty)},read:function(n,t,i,o,r){if(!n.tty||!n.tty.ops.get_char)throw new a.ErrnoError(60);for(var s=0,p=0;p<o;p++){var h;try{h=n.tty.ops.get_char(n.tty)}catch{throw new a.ErrnoError(29)}if(h===void 0&&s===0)throw new a.ErrnoError(6);if(h==null)break;s++,t[i+p]=h}return s&&(n.node.timestamp=Date.now()),s},write:function(n,t,i,o,r){if(!n.tty||!n.tty.ops.put_char)throw new a.ErrnoError(60);try{for(var s=0;s<o;s++)n.tty.ops.put_char(n.tty,t[i+s])}catch{throw new a.ErrnoError(29)}return o&&(n.node.timestamp=Date.now()),s}},default_tty_ops:{get_char:function(n){if(!n.input.length){var t=null;if(typeof window<"u"&&typeof window.prompt=="function"?(t=window.prompt("Input: "),t!==null&&(t+=`
`)):typeof readline=="function"&&(t=readline(),t!==null&&(t+=`
`)),!t)return null;n.input=Tt(t,!0)}return n.input.shift()},put_char:function(n,t){t===null||t===10?(Ye(Ze(n.output,0)),n.output=[]):t!=0&&n.output.push(t)},fsync:function(n){n.output&&n.output.length>0&&(Ye(Ze(n.output,0)),n.output=[])}},default_tty1_ops:{put_char:function(n,t){t===null||t===10?(ze(Ze(n.output,0)),n.output=[]):t!=0&&n.output.push(t)},fsync:function(n){n.output&&n.output.length>0&&(ze(Ze(n.output,0)),n.output=[])}}};function Cn(n,t){return et.fill(0,n,n+t),n}function Mn(n,t){return Math.ceil(n/t)*t}function Kt(n){n=Mn(n,65536);var t=rn(65536,n);return t?Cn(t,n):0}var me={ops_table:null,mount:function(n){return me.createNode(null,"/",16895,0)},createNode:function(n,t,i,o){if(a.isBlkdev(i)||a.isFIFO(i))throw new a.ErrnoError(63);me.ops_table||(me.ops_table={dir:{node:{getattr:me.node_ops.getattr,setattr:me.node_ops.setattr,lookup:me.node_ops.lookup,mknod:me.node_ops.mknod,rename:me.node_ops.rename,unlink:me.node_ops.unlink,rmdir:me.node_ops.rmdir,readdir:me.node_ops.readdir,symlink:me.node_ops.symlink},stream:{llseek:me.stream_ops.llseek}},file:{node:{getattr:me.node_ops.getattr,setattr:me.node_ops.setattr},stream:{llseek:me.stream_ops.llseek,read:me.stream_ops.read,write:me.stream_ops.write,allocate:me.stream_ops.allocate,mmap:me.stream_ops.mmap,msync:me.stream_ops.msync}},link:{node:{getattr:me.node_ops.getattr,setattr:me.node_ops.setattr,readlink:me.node_ops.readlink},stream:{}},chrdev:{node:{getattr:me.node_ops.getattr,setattr:me.node_ops.setattr},stream:a.chrdev_stream_ops}});var r=a.createNode(n,t,i,o);return a.isDir(r.mode)?(r.node_ops=me.ops_table.dir.node,r.stream_ops=me.ops_table.dir.stream,r.contents={}):a.isFile(r.mode)?(r.node_ops=me.ops_table.file.node,r.stream_ops=me.ops_table.file.stream,r.usedBytes=0,r.contents=null):a.isLink(r.mode)?(r.node_ops=me.ops_table.link.node,r.stream_ops=me.ops_table.link.stream):a.isChrdev(r.mode)&&(r.node_ops=me.ops_table.chrdev.node,r.stream_ops=me.ops_table.chrdev.stream),r.timestamp=Date.now(),n&&(n.contents[t]=r,n.timestamp=r.timestamp),r},getFileDataAsTypedArray:function(n){return n.contents?n.contents.subarray?n.contents.subarray(0,n.usedBytes):new Uint8Array(n.contents):new Uint8Array(0)},expandFileStorage:function(n,t){var i=n.contents?n.contents.length:0;if(!(i>=t)){var o=1024*1024;t=Math.max(t,i*(i<o?2:1.125)>>>0),i!=0&&(t=Math.max(t,256));var r=n.contents;n.contents=new Uint8Array(t),n.usedBytes>0&&n.contents.set(r.subarray(0,n.usedBytes),0)}},resizeFileStorage:function(n,t){if(n.usedBytes!=t)if(t==0)n.contents=null,n.usedBytes=0;else{var i=n.contents;n.contents=new Uint8Array(t),i&&n.contents.set(i.subarray(0,Math.min(t,n.usedBytes))),n.usedBytes=t}},node_ops:{getattr:function(n){var t={};return t.dev=a.isChrdev(n.mode)?n.id:1,t.ino=n.id,t.mode=n.mode,t.nlink=1,t.uid=0,t.gid=0,t.rdev=n.rdev,a.isDir(n.mode)?t.size=4096:a.isFile(n.mode)?t.size=n.usedBytes:a.isLink(n.mode)?t.size=n.link.length:t.size=0,t.atime=new Date(n.timestamp),t.mtime=new Date(n.timestamp),t.ctime=new Date(n.timestamp),t.blksize=4096,t.blocks=Math.ceil(t.size/t.blksize),t},setattr:function(n,t){t.mode!==void 0&&(n.mode=t.mode),t.timestamp!==void 0&&(n.timestamp=t.timestamp),t.size!==void 0&&me.resizeFileStorage(n,t.size)},lookup:function(n,t){throw a.genericErrors[44]},mknod:function(n,t,i,o){return me.createNode(n,t,i,o)},rename:function(n,t,i){if(a.isDir(n.mode)){var o;try{o=a.lookupNode(t,i)}catch{}if(o)for(var r in o.contents)throw new a.ErrnoError(55)}delete n.parent.contents[n.name],n.parent.timestamp=Date.now(),n.name=i,t.contents[i]=n,t.timestamp=n.parent.timestamp,n.parent=t},unlink:function(n,t){delete n.contents[t],n.timestamp=Date.now()},rmdir:function(n,t){var i=a.lookupNode(n,t);for(var o in i.contents)throw new a.ErrnoError(55);delete n.contents[t],n.timestamp=Date.now()},readdir:function(n){var t=[".",".."];for(var i in n.contents)n.contents.hasOwnProperty(i)&&t.push(i);return t},symlink:function(n,t,i){var o=me.createNode(n,t,41471,0);return o.link=i,o},readlink:function(n){if(!a.isLink(n.mode))throw new a.ErrnoError(28);return n.link}},stream_ops:{read:function(n,t,i,o,r){var s=n.node.contents;if(r>=n.node.usedBytes)return 0;var p=Math.min(n.node.usedBytes-r,o);if(p>8&&s.subarray)t.set(s.subarray(r,r+p),i);else for(var h=0;h<p;h++)t[i+h]=s[r+h];return p},write:function(n,t,i,o,r,s){if(t.buffer===Pe.buffer&&(s=!1),!o)return 0;var p=n.node;if(p.timestamp=Date.now(),t.subarray&&(!p.contents||p.contents.subarray)){if(s)return p.contents=t.subarray(i,i+o),p.usedBytes=o,o;if(p.usedBytes===0&&r===0)return p.contents=t.slice(i,i+o),p.usedBytes=o,o;if(r+o<=p.usedBytes)return p.contents.set(t.subarray(i,i+o),r),o}if(me.expandFileStorage(p,r+o),p.contents.subarray&&t.subarray)p.contents.set(t.subarray(i,i+o),r);else for(var h=0;h<o;h++)p.contents[r+h]=t[i+h];return p.usedBytes=Math.max(p.usedBytes,r+o),o},llseek:function(n,t,i){var o=t;if(i===1?o+=n.position:i===2&&a.isFile(n.node.mode)&&(o+=n.node.usedBytes),o<0)throw new a.ErrnoError(28);return o},allocate:function(n,t,i){me.expandFileStorage(n.node,t+i),n.node.usedBytes=Math.max(n.node.usedBytes,t+i)},mmap:function(n,t,i,o,r){if(!a.isFile(n.node.mode))throw new a.ErrnoError(43);var s,p,h=n.node.contents;if(!(r&2)&&h.buffer===Pe.buffer)p=!1,s=h.byteOffset;else{if((i>0||i+t<h.length)&&(h.subarray?h=h.subarray(i,i+t):h=Array.prototype.slice.call(h,i,i+t)),p=!0,s=Kt(t),!s)throw new a.ErrnoError(48);Pe.set(h,s)}return{ptr:s,allocated:p}},msync:function(n,t,i,o,r){return me.stream_ops.write(n,t,0,o,i,!1),0}}};function jn(n,t,i,o){var r=o?"":"al "+n;ft(n,s=>{Mt(s,'Loading data file "'+n+'" failed (no arrayBuffer).'),t(new Uint8Array(s)),r&&mt(r)},s=>{if(i)i();else throw'Loading data file "'+n+'" failed.'}),r&&kt(r)}var a={root:null,mounts:[],devices:{},streams:[],nextInode:1,nameTable:null,currentPath:"/",initialized:!1,ignorePermissions:!0,ErrnoError:null,genericErrors:{},filesystems:null,syncFSRequests:0,lookupPath:(n,t={})=>{if(n=Ue.resolve(n),!n)return{path:"",node:null};var i={follow_mount:!0,recurse_count:0};if(t=Object.assign(i,t),t.recurse_count>8)throw new a.ErrnoError(32);for(var o=n.split("/").filter(U=>!!U),r=a.root,s="/",p=0;p<o.length;p++){var h=p===o.length-1;if(h&&t.parent)break;if(r=a.lookupNode(r,o[p]),s=ve.join2(s,o[p]),a.isMountpoint(r)&&(!h||h&&t.follow_mount)&&(r=r.mounted.root),!h||t.follow)for(var R=0;a.isLink(r.mode);){var C=a.readlink(s);s=Ue.resolve(ve.dirname(s),C);var Q=a.lookupPath(s,{recurse_count:t.recurse_count+1});if(r=Q.node,R++>40)throw new a.ErrnoError(32)}}return{path:s,node:r}},getPath:n=>{for(var t;;){if(a.isRoot(n)){var i=n.mount.mountpoint;return t?i[i.length-1]!=="/"?i+"/"+t:i+t:i}t=t?n.name+"/"+t:n.name,n=n.parent}},hashName:(n,t)=>{for(var i=0,o=0;o<t.length;o++)i=(i<<5)-i+t.charCodeAt(o)|0;return(n+i>>>0)%a.nameTable.length},hashAddNode:n=>{var t=a.hashName(n.parent.id,n.name);n.name_next=a.nameTable[t],a.nameTable[t]=n},hashRemoveNode:n=>{var t=a.hashName(n.parent.id,n.name);if(a.nameTable[t]===n)a.nameTable[t]=n.name_next;else for(var i=a.nameTable[t];i;){if(i.name_next===n){i.name_next=n.name_next;break}i=i.name_next}},lookupNode:(n,t)=>{var i=a.mayLookup(n);if(i)throw new a.ErrnoError(i,n);for(var o=a.hashName(n.id,t),r=a.nameTable[o];r;r=r.name_next){var s=r.name;if(r.parent.id===n.id&&s===t)return r}return a.lookup(n,t)},createNode:(n,t,i,o)=>{var r=new a.FSNode(n,t,i,o);return a.hashAddNode(r),r},destroyNode:n=>{a.hashRemoveNode(n)},isRoot:n=>n===n.parent,isMountpoint:n=>!!n.mounted,isFile:n=>(n&61440)===32768,isDir:n=>(n&61440)===16384,isLink:n=>(n&61440)===40960,isChrdev:n=>(n&61440)===8192,isBlkdev:n=>(n&61440)===24576,isFIFO:n=>(n&61440)===4096,isSocket:n=>(n&49152)===49152,flagModes:{r:0,"r+":2,w:577,"w+":578,a:1089,"a+":1090},modeStringToFlags:n=>{var t=a.flagModes[n];if(typeof t>"u")throw new Error("Unknown file open mode: "+n);return t},flagsToPermissionString:n=>{var t=["r","w","rw"][n&3];return n&512&&(t+="w"),t},nodePermissions:(n,t)=>a.ignorePermissions?0:t.includes("r")&&!(n.mode&292)||t.includes("w")&&!(n.mode&146)||t.includes("x")&&!(n.mode&73)?2:0,mayLookup:n=>{var t=a.nodePermissions(n,"x");return t||(n.node_ops.lookup?0:2)},mayCreate:(n,t)=>{try{var i=a.lookupNode(n,t);return 20}catch{}return a.nodePermissions(n,"wx")},mayDelete:(n,t,i)=>{var o;try{o=a.lookupNode(n,t)}catch(s){return s.errno}var r=a.nodePermissions(n,"wx");if(r)return r;if(i){if(!a.isDir(o.mode))return 54;if(a.isRoot(o)||a.getPath(o)===a.cwd())return 10}else if(a.isDir(o.mode))return 31;return 0},mayOpen:(n,t)=>n?a.isLink(n.mode)?32:a.isDir(n.mode)&&(a.flagsToPermissionString(t)!=="r"||t&512)?31:a.nodePermissions(n,a.flagsToPermissionString(t)):44,MAX_OPEN_FDS:4096,nextfd:(n=0,t=a.MAX_OPEN_FDS)=>{for(var i=n;i<=t;i++)if(!a.streams[i])return i;throw new a.ErrnoError(33)},getStream:n=>a.streams[n],createStream:(n,t,i)=>{a.FSStream||(a.FSStream=function(){this.shared={}},a.FSStream.prototype={},Object.defineProperties(a.FSStream.prototype,{object:{get:function(){return this.node},set:function(r){this.node=r}},isRead:{get:function(){return(this.flags&2097155)!==1}},isWrite:{get:function(){return(this.flags&2097155)!==0}},isAppend:{get:function(){return this.flags&1024}},flags:{get:function(){return this.shared.flags},set:function(r){this.shared.flags=r}},position:{get:function(){return this.shared.position},set:function(r){this.shared.position=r}}})),n=Object.assign(new a.FSStream,n);var o=a.nextfd(t,i);return n.fd=o,a.streams[o]=n,n},closeStream:n=>{a.streams[n]=null},chrdev_stream_ops:{open:n=>{var t=a.getDevice(n.node.rdev);n.stream_ops=t.stream_ops,n.stream_ops.open&&n.stream_ops.open(n)},llseek:()=>{throw new a.ErrnoError(70)}},major:n=>n>>8,minor:n=>n&255,makedev:(n,t)=>n<<8|t,registerDevice:(n,t)=>{a.devices[n]={stream_ops:t}},getDevice:n=>a.devices[n],getMounts:n=>{for(var t=[],i=[n];i.length;){var o=i.pop();t.push(o),i.push.apply(i,o.mounts)}return t},syncfs:(n,t)=>{typeof n=="function"&&(t=n,n=!1),a.syncFSRequests++,a.syncFSRequests>1&&ze("warning: "+a.syncFSRequests+" FS.syncfs operations in flight at once, probably just doing extra work");var i=a.getMounts(a.root.mount),o=0;function r(p){return a.syncFSRequests--,t(p)}function s(p){if(p)return s.errored?void 0:(s.errored=!0,r(p));++o>=i.length&&r(null)}i.forEach(p=>{if(!p.type.syncfs)return s(null);p.type.syncfs(p,n,s)})},mount:(n,t,i)=>{var o=i==="/",r=!i,s;if(o&&a.root)throw new a.ErrnoError(10);if(!o&&!r){var p=a.lookupPath(i,{follow_mount:!1});if(i=p.path,s=p.node,a.isMountpoint(s))throw new a.ErrnoError(10);if(!a.isDir(s.mode))throw new a.ErrnoError(54)}var h={type:n,opts:t,mountpoint:i,mounts:[]},R=n.mount(h);return R.mount=h,h.root=R,o?a.root=R:s&&(s.mounted=h,s.mount&&s.mount.mounts.push(h)),R},unmount:n=>{var t=a.lookupPath(n,{follow_mount:!1});if(!a.isMountpoint(t.node))throw new a.ErrnoError(28);var i=t.node,o=i.mounted,r=a.getMounts(o);Object.keys(a.nameTable).forEach(p=>{for(var h=a.nameTable[p];h;){var R=h.name_next;r.includes(h.mount)&&a.destroyNode(h),h=R}}),i.mounted=null;var s=i.mount.mounts.indexOf(o);i.mount.mounts.splice(s,1)},lookup:(n,t)=>n.node_ops.lookup(n,t),mknod:(n,t,i)=>{var o=a.lookupPath(n,{parent:!0}),r=o.node,s=ve.basename(n);if(!s||s==="."||s==="..")throw new a.ErrnoError(28);var p=a.mayCreate(r,s);if(p)throw new a.ErrnoError(p);if(!r.node_ops.mknod)throw new a.ErrnoError(63);return r.node_ops.mknod(r,s,t,i)},create:(n,t)=>(t=t!==void 0?t:438,t&=4095,t|=32768,a.mknod(n,t,0)),mkdir:(n,t)=>(t=t!==void 0?t:511,t&=1023,t|=16384,a.mknod(n,t,0)),mkdirTree:(n,t)=>{for(var i=n.split("/"),o="",r=0;r<i.length;++r)if(i[r]){o+="/"+i[r];try{a.mkdir(o,t)}catch(s){if(s.errno!=20)throw s}}},mkdev:(n,t,i)=>(typeof i>"u"&&(i=t,t=438),t|=8192,a.mknod(n,t,i)),symlink:(n,t)=>{if(!Ue.resolve(n))throw new a.ErrnoError(44);var i=a.lookupPath(t,{parent:!0}),o=i.node;if(!o)throw new a.ErrnoError(44);var r=ve.basename(t),s=a.mayCreate(o,r);if(s)throw new a.ErrnoError(s);if(!o.node_ops.symlink)throw new a.ErrnoError(63);return o.node_ops.symlink(o,r,n)},rename:(n,t)=>{var i=ve.dirname(n),o=ve.dirname(t),r=ve.basename(n),s=ve.basename(t),p,h,R;if(p=a.lookupPath(n,{parent:!0}),h=p.node,p=a.lookupPath(t,{parent:!0}),R=p.node,!h||!R)throw new a.ErrnoError(44);if(h.mount!==R.mount)throw new a.ErrnoError(75);var C=a.lookupNode(h,r),Q=Ue.relative(n,o);if(Q.charAt(0)!==".")throw new a.ErrnoError(28);if(Q=Ue.relative(t,i),Q.charAt(0)!==".")throw new a.ErrnoError(55);var U;try{U=a.lookupNode(R,s)}catch{}if(C!==U){var G=a.isDir(C.mode),A=a.mayDelete(h,r,G);if(A)throw new a.ErrnoError(A);if(A=U?a.mayDelete(R,s,G):a.mayCreate(R,s),A)throw new a.ErrnoError(A);if(!h.node_ops.rename)throw new a.ErrnoError(63);if(a.isMountpoint(C)||U&&a.isMountpoint(U))throw new a.ErrnoError(10);if(R!==h&&(A=a.nodePermissions(h,"w"),A))throw new a.ErrnoError(A);a.hashRemoveNode(C);try{h.node_ops.rename(C,R,s)}catch(I){throw I}finally{a.hashAddNode(C)}}},rmdir:n=>{var t=a.lookupPath(n,{parent:!0}),i=t.node,o=ve.basename(n),r=a.lookupNode(i,o),s=a.mayDelete(i,o,!0);if(s)throw new a.ErrnoError(s);if(!i.node_ops.rmdir)throw new a.ErrnoError(63);if(a.isMountpoint(r))throw new a.ErrnoError(10);i.node_ops.rmdir(i,o),a.destroyNode(r)},readdir:n=>{var t=a.lookupPath(n,{follow:!0}),i=t.node;if(!i.node_ops.readdir)throw new a.ErrnoError(54);return i.node_ops.readdir(i)},unlink:n=>{var t=a.lookupPath(n,{parent:!0}),i=t.node;if(!i)throw new a.ErrnoError(44);var o=ve.basename(n),r=a.lookupNode(i,o),s=a.mayDelete(i,o,!1);if(s)throw new a.ErrnoError(s);if(!i.node_ops.unlink)throw new a.ErrnoError(63);if(a.isMountpoint(r))throw new a.ErrnoError(10);i.node_ops.unlink(i,o),a.destroyNode(r)},readlink:n=>{var t=a.lookupPath(n),i=t.node;if(!i)throw new a.ErrnoError(44);if(!i.node_ops.readlink)throw new a.ErrnoError(28);return Ue.resolve(a.getPath(i.parent),i.node_ops.readlink(i))},stat:(n,t)=>{var i=a.lookupPath(n,{follow:!t}),o=i.node;if(!o)throw new a.ErrnoError(44);if(!o.node_ops.getattr)throw new a.ErrnoError(63);return o.node_ops.getattr(o)},lstat:n=>a.stat(n,!0),chmod:(n,t,i)=>{var o;if(typeof n=="string"){var r=a.lookupPath(n,{follow:!i});o=r.node}else o=n;if(!o.node_ops.setattr)throw new a.ErrnoError(63);o.node_ops.setattr(o,{mode:t&4095|o.mode&-4096,timestamp:Date.now()})},lchmod:(n,t)=>{a.chmod(n,t,!0)},fchmod:(n,t)=>{var i=a.getStream(n);if(!i)throw new a.ErrnoError(8);a.chmod(i.node,t)},chown:(n,t,i,o)=>{var r;if(typeof n=="string"){var s=a.lookupPath(n,{follow:!o});r=s.node}else r=n;if(!r.node_ops.setattr)throw new a.ErrnoError(63);r.node_ops.setattr(r,{timestamp:Date.now()})},lchown:(n,t,i)=>{a.chown(n,t,i,!0)},fchown:(n,t,i)=>{var o=a.getStream(n);if(!o)throw new a.ErrnoError(8);a.chown(o.node,t,i)},truncate:(n,t)=>{if(t<0)throw new a.ErrnoError(28);var i;if(typeof n=="string"){var o=a.lookupPath(n,{follow:!0});i=o.node}else i=n;if(!i.node_ops.setattr)throw new a.ErrnoError(63);if(a.isDir(i.mode))throw new a.ErrnoError(31);if(!a.isFile(i.mode))throw new a.ErrnoError(28);var r=a.nodePermissions(i,"w");if(r)throw new a.ErrnoError(r);i.node_ops.setattr(i,{size:t,timestamp:Date.now()})},ftruncate:(n,t)=>{var i=a.getStream(n);if(!i)throw new a.ErrnoError(8);if(!(i.flags&2097155))throw new a.ErrnoError(28);a.truncate(i.node,t)},utime:(n,t,i)=>{var o=a.lookupPath(n,{follow:!0}),r=o.node;r.node_ops.setattr(r,{timestamp:Math.max(t,i)})},open:(n,t,i)=>{if(n==="")throw new a.ErrnoError(44);t=typeof t=="string"?a.modeStringToFlags(t):t,i=typeof i>"u"?438:i,t&64?i=i&4095|32768:i=0;var o;if(typeof n=="object")o=n;else{n=ve.normalize(n);try{var r=a.lookupPath(n,{follow:!(t&131072)});o=r.node}catch{}}var s=!1;if(t&64)if(o){if(t&128)throw new a.ErrnoError(20)}else o=a.mknod(n,i,0),s=!0;if(!o)throw new a.ErrnoError(44);if(a.isChrdev(o.mode)&&(t&=-513),t&65536&&!a.isDir(o.mode))throw new a.ErrnoError(54);if(!s){var p=a.mayOpen(o,t);if(p)throw new a.ErrnoError(p)}t&512&&!s&&a.truncate(o,0),t&=-131713;var h=a.createStream({node:o,path:a.getPath(o),flags:t,seekable:!0,position:0,stream_ops:o.stream_ops,ungotten:[],error:!1});return h.stream_ops.open&&h.stream_ops.open(h),e.logReadFiles&&!(t&1)&&(a.readFiles||(a.readFiles={}),n in a.readFiles||(a.readFiles[n]=1)),h},close:n=>{if(a.isClosed(n))throw new a.ErrnoError(8);n.getdents&&(n.getdents=null);try{n.stream_ops.close&&n.stream_ops.close(n)}catch(t){throw t}finally{a.closeStream(n.fd)}n.fd=null},isClosed:n=>n.fd===null,llseek:(n,t,i)=>{if(a.isClosed(n))throw new a.ErrnoError(8);if(!n.seekable||!n.stream_ops.llseek)throw new a.ErrnoError(70);if(i!=0&&i!=1&&i!=2)throw new a.ErrnoError(28);return n.position=n.stream_ops.llseek(n,t,i),n.ungotten=[],n.position},read:(n,t,i,o,r)=>{if(o<0||r<0)throw new a.ErrnoError(28);if(a.isClosed(n))throw new a.ErrnoError(8);if((n.flags&2097155)===1)throw new a.ErrnoError(8);if(a.isDir(n.node.mode))throw new a.ErrnoError(31);if(!n.stream_ops.read)throw new a.ErrnoError(28);var s=typeof r<"u";if(!s)r=n.position;else if(!n.seekable)throw new a.ErrnoError(70);var p=n.stream_ops.read(n,t,i,o,r);return s||(n.position+=p),p},write:(n,t,i,o,r,s)=>{if(o<0||r<0)throw new a.ErrnoError(28);if(a.isClosed(n))throw new a.ErrnoError(8);if(!(n.flags&2097155))throw new a.ErrnoError(8);if(a.isDir(n.node.mode))throw new a.ErrnoError(31);if(!n.stream_ops.write)throw new a.ErrnoError(28);n.seekable&&n.flags&1024&&a.llseek(n,0,2);var p=typeof r<"u";if(!p)r=n.position;else if(!n.seekable)throw new a.ErrnoError(70);var h=n.stream_ops.write(n,t,i,o,r,s);return p||(n.position+=h),h},allocate:(n,t,i)=>{if(a.isClosed(n))throw new a.ErrnoError(8);if(t<0||i<=0)throw new a.ErrnoError(28);if(!(n.flags&2097155))throw new a.ErrnoError(8);if(!a.isFile(n.node.mode)&&!a.isDir(n.node.mode))throw new a.ErrnoError(43);if(!n.stream_ops.allocate)throw new a.ErrnoError(138);n.stream_ops.allocate(n,t,i)},mmap:(n,t,i,o,r)=>{if(o&2&&!(r&2)&&(n.flags&2097155)!==2)throw new a.ErrnoError(2);if((n.flags&2097155)===1)throw new a.ErrnoError(2);if(!n.stream_ops.mmap)throw new a.ErrnoError(43);return n.stream_ops.mmap(n,t,i,o,r)},msync:(n,t,i,o,r)=>n.stream_ops.msync?n.stream_ops.msync(n,t,i,o,r):0,munmap:n=>0,ioctl:(n,t,i)=>{if(!n.stream_ops.ioctl)throw new a.ErrnoError(59);return n.stream_ops.ioctl(n,t,i)},readFile:(n,t={})=>{if(t.flags=t.flags||0,t.encoding=t.encoding||"binary",t.encoding!=="utf8"&&t.encoding!=="binary")throw new Error('Invalid encoding type "'+t.encoding+'"');var i,o=a.open(n,t.flags),r=a.stat(n),s=r.size,p=new Uint8Array(s);return a.read(o,p,0,s,0),t.encoding==="utf8"?i=Ze(p,0):t.encoding==="binary"&&(i=p),a.close(o),i},writeFile:(n,t,i={})=>{i.flags=i.flags||577;var o=a.open(n,i.flags,i.mode);if(typeof t=="string"){var r=new Uint8Array(ot(t)+1),s=dt(t,r,0,r.length);a.write(o,r,0,s,void 0,i.canOwn)}else if(ArrayBuffer.isView(t))a.write(o,t,0,t.byteLength,void 0,i.canOwn);else throw new Error("Unsupported data type");a.close(o)},cwd:()=>a.currentPath,chdir:n=>{var t=a.lookupPath(n,{follow:!0});if(t.node===null)throw new a.ErrnoError(44);if(!a.isDir(t.node.mode))throw new a.ErrnoError(54);var i=a.nodePermissions(t.node,"x");if(i)throw new a.ErrnoError(i);a.currentPath=t.path},createDefaultDirectories:()=>{a.mkdir("/tmp"),a.mkdir("/home"),a.mkdir("/home/web_user")},createDefaultDevices:()=>{a.mkdir("/dev"),a.registerDevice(a.makedev(1,3),{read:()=>0,write:(t,i,o,r,s)=>r}),a.mkdev("/dev/null",a.makedev(1,3)),$e.register(a.makedev(5,0),$e.default_tty_ops),$e.register(a.makedev(6,0),$e.default_tty1_ops),a.mkdev("/dev/tty",a.makedev(5,0)),a.mkdev("/dev/tty1",a.makedev(6,0));var n=Nn();a.createDevice("/dev","random",n),a.createDevice("/dev","urandom",n),a.mkdir("/dev/shm"),a.mkdir("/dev/shm/tmp")},createSpecialDirectories:()=>{a.mkdir("/proc");var n=a.mkdir("/proc/self");a.mkdir("/proc/self/fd"),a.mount({mount:()=>{var t=a.createNode(n,"fd",16895,73);return t.node_ops={lookup:(i,o)=>{var r=+o,s=a.getStream(r);if(!s)throw new a.ErrnoError(8);var p={parent:null,mount:{mountpoint:"fake"},node_ops:{readlink:()=>s.path}};return p.parent=p,p}},t}},{},"/proc/self/fd")},createStandardStreams:()=>{e.stdin?a.createDevice("/dev","stdin",e.stdin):a.symlink("/dev/tty","/dev/stdin"),e.stdout?a.createDevice("/dev","stdout",null,e.stdout):a.symlink("/dev/tty","/dev/stdout"),e.stderr?a.createDevice("/dev","stderr",null,e.stderr):a.symlink("/dev/tty1","/dev/stderr");var n=a.open("/dev/stdin",0),t=a.open("/dev/stdout",1),i=a.open("/dev/stderr",1)},ensureErrnoError:()=>{a.ErrnoError||(a.ErrnoError=function(t,i){this.node=i,this.setErrno=function(o){this.errno=o},this.setErrno(t),this.message="FS error"},a.ErrnoError.prototype=new Error,a.ErrnoError.prototype.constructor=a.ErrnoError,[44].forEach(n=>{a.genericErrors[n]=new a.ErrnoError(n),a.genericErrors[n].stack="<generic error, no stack>"}))},staticInit:()=>{a.ensureErrnoError(),a.nameTable=new Array(4096),a.mount(me,{},"/"),a.createDefaultDirectories(),a.createDefaultDevices(),a.createSpecialDirectories(),a.filesystems={MEMFS:me}},init:(n,t,i)=>{a.init.initialized=!0,a.ensureErrnoError(),e.stdin=n||e.stdin,e.stdout=t||e.stdout,e.stderr=i||e.stderr,a.createStandardStreams()},quit:()=>{a.init.initialized=!1;for(var n=0;n<a.streams.length;n++){var t=a.streams[n];t&&a.close(t)}},getMode:(n,t)=>{var i=0;return n&&(i|=365),t&&(i|=146),i},findObject:(n,t)=>{var i=a.analyzePath(n,t);return i.exists?i.object:null},analyzePath:(n,t)=>{try{var i=a.lookupPath(n,{follow:!t});n=i.path}catch{}var o={isRoot:!1,exists:!1,error:0,name:null,path:null,object:null,parentExists:!1,parentPath:null,parentObject:null};try{var i=a.lookupPath(n,{parent:!0});o.parentExists=!0,o.parentPath=i.path,o.parentObject=i.node,o.name=ve.basename(n),i=a.lookupPath(n,{follow:!t}),o.exists=!0,o.path=i.path,o.object=i.node,o.name=i.node.name,o.isRoot=i.path==="/"}catch(r){o.error=r.errno}return o},createPath:(n,t,i,o)=>{n=typeof n=="string"?n:a.getPath(n);for(var r=t.split("/").reverse();r.length;){var s=r.pop();if(s){var p=ve.join2(n,s);try{a.mkdir(p)}catch{}n=p}}return p},createFile:(n,t,i,o,r)=>{var s=ve.join2(typeof n=="string"?n:a.getPath(n),t),p=a.getMode(o,r);return a.create(s,p)},createDataFile:(n,t,i,o,r,s)=>{var p=t;n&&(n=typeof n=="string"?n:a.getPath(n),p=t?ve.join2(n,t):n);var h=a.getMode(o,r),R=a.create(p,h);if(i){if(typeof i=="string"){for(var C=new Array(i.length),Q=0,U=i.length;Q<U;++Q)C[Q]=i.charCodeAt(Q);i=C}a.chmod(R,h|146);var G=a.open(R,577);a.write(G,i,0,i.length,0,s),a.close(G),a.chmod(R,h)}return R},createDevice:(n,t,i,o)=>{var r=ve.join2(typeof n=="string"?n:a.getPath(n),t),s=a.getMode(!!i,!!o);a.createDevice.major||(a.createDevice.major=64);var p=a.makedev(a.createDevice.major++,0);return a.registerDevice(p,{open:h=>{h.seekable=!1},close:h=>{o&&o.buffer&&o.buffer.length&&o(10)},read:(h,R,C,Q,U)=>{for(var G=0,A=0;A<Q;A++){var I;try{I=i()}catch{throw new a.ErrnoError(29)}if(I===void 0&&G===0)throw new a.ErrnoError(6);if(I==null)break;G++,R[C+A]=I}return G&&(h.node.timestamp=Date.now()),G},write:(h,R,C,Q,U)=>{for(var G=0;G<Q;G++)try{o(R[C+G])}catch{throw new a.ErrnoError(29)}return Q&&(h.node.timestamp=Date.now()),G}}),a.mkdev(r,s,p)},forceLoadFile:n=>{if(n.isDevice||n.isFolder||n.link||n.contents)return!0;if(typeof XMLHttpRequest<"u")throw new Error("Lazy loading should have been performed (contents set) in createLazyFile, but it was not. Lazy loading only works in web workers. Use --embed-file or --preload-file in emcc on the main thread.");if(Be)try{n.contents=Tt(Be(n.url),!0),n.usedBytes=n.contents.length}catch{throw new a.ErrnoError(29)}else throw new Error("Cannot load without read() or XMLHttpRequest.")},createLazyFile:(n,t,i,o,r)=>{function s(){this.lengthKnown=!1,this.chunks=[]}if(s.prototype.get=function(A){if(!(A>this.length-1||A<0)){var I=A%this.chunkSize,O=A/this.chunkSize|0;return this.getter(O)[I]}},s.prototype.setDataGetter=function(A){this.getter=A},s.prototype.cacheLength=function(){var A=new XMLHttpRequest;if(A.open("HEAD",i,!1),A.send(null),!(A.status>=200&&A.status<300||A.status===304))throw new Error("Couldn't load "+i+". Status: "+A.status);var I=Number(A.getResponseHeader("Content-length")),O,x=(O=A.getResponseHeader("Accept-Ranges"))&&O==="bytes",b=(O=A.getResponseHeader("Content-Encoding"))&&O==="gzip",F=1024*1024;x||(F=I);var j=(w,H)=>{if(w>H)throw new Error("invalid range ("+w+", "+H+") or no bytes requested!");if(H>I-1)throw new Error("only "+I+" bytes available! programmer error!");var _=new XMLHttpRequest;if(_.open("GET",i,!1),I!==F&&_.setRequestHeader("Range","bytes="+w+"-"+H),_.responseType="arraybuffer",_.overrideMimeType&&_.overrideMimeType("text/plain; charset=x-user-defined"),_.send(null),!(_.status>=200&&_.status<300||_.status===304))throw new Error("Couldn't load "+i+". Status: "+_.status);return _.response!==void 0?new Uint8Array(_.response||[]):Tt(_.responseText||"",!0)},z=this;z.setDataGetter(w=>{var H=w*F,_=(w+1)*F-1;if(_=Math.min(_,I-1),typeof z.chunks[w]>"u"&&(z.chunks[w]=j(H,_)),typeof z.chunks[w]>"u")throw new Error("doXHR failed!");return z.chunks[w]}),(b||!I)&&(F=I=1,I=this.getter(0).length,F=I,Ye("LazyFiles on gzip forces download of the whole file when length is accessed")),this._length=I,this._chunkSize=F,this.lengthKnown=!0},typeof XMLHttpRequest<"u"){if(!we)throw"Cannot do synchronous binary XHRs outside webworkers in modern browsers. Use --embed-file or --preload-file in emcc";var p=new s;Object.defineProperties(p,{length:{get:function(){return this.lengthKnown||this.cacheLength(),this._length}},chunkSize:{get:function(){return this.lengthKnown||this.cacheLength(),this._chunkSize}}});var h={isDevice:!1,contents:p}}else var h={isDevice:!1,url:i};var R=a.createFile(n,t,h,o,r);h.contents?R.contents=h.contents:h.url&&(R.contents=null,R.url=h.url),Object.defineProperties(R,{usedBytes:{get:function(){return this.contents.length}}});var C={},Q=Object.keys(R.stream_ops);Q.forEach(G=>{var A=R.stream_ops[G];C[G]=function(){return a.forceLoadFile(R),A.apply(null,arguments)}});function U(G,A,I,O,x){var b=G.node.contents;if(x>=b.length)return 0;var F=Math.min(b.length-x,O);if(b.slice)for(var j=0;j<F;j++)A[I+j]=b[x+j];else for(var j=0;j<F;j++)A[I+j]=b.get(x+j);return F}return C.read=(G,A,I,O,x)=>(a.forceLoadFile(R),U(G,A,I,O,x)),C.mmap=(G,A,I,O,x)=>{a.forceLoadFile(R);var b=Kt(A);if(!b)throw new a.ErrnoError(48);return U(G,Pe,b,A,I),{ptr:b,allocated:!0}},R.stream_ops=C,R},createPreloadedFile:(n,t,i,o,r,s,p,h,R,C)=>{var Q=t?Ue.resolve(ve.join2(n,t)):n,U="cp "+Q;function G(A){function I(O){C&&C(),h||a.createDataFile(n,t,O,o,r,R),s&&s(),mt(U)}Browser.handledByPreloadPlugin(A,Q,I,()=>{p&&p(),mt(U)})||I(A)}kt(U),typeof i=="string"?jn(i,A=>G(A),p):G(i)},indexedDB:()=>window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB,DB_NAME:()=>"EM_FS_"+window.location.pathname,DB_VERSION:20,DB_STORE_NAME:"FILE_DATA",saveFilesToDB:(n,t,i)=>{t=t||(()=>{}),i=i||(()=>{});var o=a.indexedDB();try{var r=o.open(a.DB_NAME(),a.DB_VERSION)}catch(s){return i(s)}r.onupgradeneeded=()=>{Ye("creating db");var s=r.result;s.createObjectStore(a.DB_STORE_NAME)},r.onsuccess=()=>{var s=r.result,p=s.transaction([a.DB_STORE_NAME],"readwrite"),h=p.objectStore(a.DB_STORE_NAME),R=0,C=0,Q=n.length;function U(){C==0?t():i()}n.forEach(G=>{var A=h.put(a.analyzePath(G).object.contents,G);A.onsuccess=()=>{R++,R+C==Q&&U()},A.onerror=()=>{C++,R+C==Q&&U()}}),p.onerror=i},r.onerror=i},loadFilesFromDB:(n,t,i)=>{t=t||(()=>{}),i=i||(()=>{});var o=a.indexedDB();try{var r=o.open(a.DB_NAME(),a.DB_VERSION)}catch(s){return i(s)}r.onupgradeneeded=i,r.onsuccess=()=>{var s=r.result;try{var p=s.transaction([a.DB_STORE_NAME],"readonly")}catch(G){i(G);return}var h=p.objectStore(a.DB_STORE_NAME),R=0,C=0,Q=n.length;function U(){C==0?t():i()}n.forEach(G=>{var A=h.get(G);A.onsuccess=()=>{a.analyzePath(G).exists&&a.unlink(G),a.createDataFile(ve.dirname(G),ve.basename(G),A.result,!0,!0,!0),R++,R+C==Q&&U()},A.onerror=()=>{C++,R+C==Q&&U()}}),p.onerror=i},r.onerror=i}},ue={DEFAULT_POLLMASK:5,calculateAt:function(n,t,i){if(ve.isAbs(t))return t;var o;if(n===-100)o=a.cwd();else{var r=ue.getStreamFromFD(n);o=r.path}if(t.length==0){if(!i)throw new a.ErrnoError(44);return o}return ve.join2(o,t)},doStat:function(n,t,i){try{var o=n(t)}catch(h){if(h&&h.node&&ve.normalize(t)!==ve.normalize(a.getPath(h.node)))return-54;throw h}fe[i>>2]=o.dev,fe[i+8>>2]=o.ino,fe[i+12>>2]=o.mode,ke[i+16>>2]=o.nlink,fe[i+20>>2]=o.uid,fe[i+24>>2]=o.gid,fe[i+28>>2]=o.rdev,Te=[o.size>>>0,(pe=o.size,+Math.abs(pe)>=1?pe>0?(Math.min(+Math.floor(pe/4294967296),4294967295)|0)>>>0:~~+Math.ceil((pe-+(~~pe>>>0))/4294967296)>>>0:0)],fe[i+40>>2]=Te[0],fe[i+44>>2]=Te[1],fe[i+48>>2]=4096,fe[i+52>>2]=o.blocks;var r=o.atime.getTime(),s=o.mtime.getTime(),p=o.ctime.getTime();return Te=[Math.floor(r/1e3)>>>0,(pe=Math.floor(r/1e3),+Math.abs(pe)>=1?pe>0?(Math.min(+Math.floor(pe/4294967296),4294967295)|0)>>>0:~~+Math.ceil((pe-+(~~pe>>>0))/4294967296)>>>0:0)],fe[i+56>>2]=Te[0],fe[i+60>>2]=Te[1],ke[i+64>>2]=r%1e3*1e3,Te=[Math.floor(s/1e3)>>>0,(pe=Math.floor(s/1e3),+Math.abs(pe)>=1?pe>0?(Math.min(+Math.floor(pe/4294967296),4294967295)|0)>>>0:~~+Math.ceil((pe-+(~~pe>>>0))/4294967296)>>>0:0)],fe[i+72>>2]=Te[0],fe[i+76>>2]=Te[1],ke[i+80>>2]=s%1e3*1e3,Te=[Math.floor(p/1e3)>>>0,(pe=Math.floor(p/1e3),+Math.abs(pe)>=1?pe>0?(Math.min(+Math.floor(pe/4294967296),4294967295)|0)>>>0:~~+Math.ceil((pe-+(~~pe>>>0))/4294967296)>>>0:0)],fe[i+88>>2]=Te[0],fe[i+92>>2]=Te[1],ke[i+96>>2]=p%1e3*1e3,Te=[o.ino>>>0,(pe=o.ino,+Math.abs(pe)>=1?pe>0?(Math.min(+Math.floor(pe/4294967296),4294967295)|0)>>>0:~~+Math.ceil((pe-+(~~pe>>>0))/4294967296)>>>0:0)],fe[i+104>>2]=Te[0],fe[i+108>>2]=Te[1],0},doMsync:function(n,t,i,o,r){if(!a.isFile(t.node.mode))throw new a.ErrnoError(43);if(o&2)return 0;var s=et.slice(n,n+i);a.msync(t,s,r,i,o)},varargs:void 0,get:function(){ue.varargs+=4;var n=fe[ue.varargs-4>>2];return n},getStr:function(n){var t=wn(n);return t},getStreamFromFD:function(n){var t=a.getStream(n);if(!t)throw new a.ErrnoError(8);return t}};function Bn(n,t){try{return n=ue.getStr(n),a.chmod(n,t),0}catch(i){if(typeof a>"u"||!(i instanceof a.ErrnoError))throw i;return-i.errno}}function zn(n,t,i,o){try{if(t=ue.getStr(t),t=ue.calculateAt(n,t),i&-8)return-28;var r=a.lookupPath(t,{follow:!0}),s=r.node;if(!s)return-44;var p="";return i&4&&(p+="r"),i&2&&(p+="w"),i&1&&(p+="x"),p&&a.nodePermissions(s,p)?-2:0}catch(h){if(typeof a>"u"||!(h instanceof a.ErrnoError))throw h;return-h.errno}}function Wn(n,t){try{return a.fchmod(n,t),0}catch(i){if(typeof a>"u"||!(i instanceof a.ErrnoError))throw i;return-i.errno}}function Un(n,t,i){try{return a.fchown(n,t,i),0}catch(o){if(typeof a>"u"||!(o instanceof a.ErrnoError))throw o;return-o.errno}}function Qn(n){return fe[tn()>>2]=n,n}function Hn(n,t,i){ue.varargs=i;try{var o=ue.getStreamFromFD(n);switch(t){case 0:{var r=ue.get();if(r<0)return-28;var s;return s=a.createStream(o,r),s.fd}case 1:case 2:return 0;case 3:return o.flags;case 4:{var r=ue.get();return o.flags|=r,0}case 5:{var r=ue.get(),p=0;return pt[r+p>>1]=2,0}case 6:case 7:return 0;case 16:case 8:return-28;case 9:return Qn(28),-1;default:return-28}}catch(h){if(typeof a>"u"||!(h instanceof a.ErrnoError))throw h;return-h.errno}}function Vn(n,t){try{var i=ue.getStreamFromFD(n);return ue.doStat(a.stat,i.path,t)}catch(o){if(typeof a>"u"||!(o instanceof a.ErrnoError))throw o;return-o.errno}}var Gn=9007199254740992,$n=-9007199254740992;function Jt(n){return n<$n||n>Gn?NaN:Number(n)}function Kn(n,t){try{return t=Jt(t),isNaN(t)?-61:(a.ftruncate(n,t),0)}catch(i){if(typeof a>"u"||!(i instanceof a.ErrnoError))throw i;return-i.errno}}function Jn(n,t){try{if(t===0)return-28;var i=a.cwd(),o=ot(i)+1;return t<o?-68:(Bt(i,n,t),o)}catch(r){if(typeof a>"u"||!(r instanceof a.ErrnoError))throw r;return-r.errno}}function Xn(n,t,i){ue.varargs=i;try{var o=ue.getStreamFromFD(n);switch(t){case 21509:case 21505:return o.tty?0:-59;case 21510:case 21511:case 21512:case 21506:case 21507:case 21508:return o.tty?0:-59;case 21519:{if(!o.tty)return-59;var r=ue.get();return fe[r>>2]=0,0}case 21520:return o.tty?-28:-59;case 21531:{var r=ue.get();return a.ioctl(o,t,r)}case 21523:return o.tty?0:-59;case 21524:return o.tty?0:-59;default:return-28}}catch(s){if(typeof a>"u"||!(s instanceof a.ErrnoError))throw s;return-s.errno}}function Yn(n,t){try{return n=ue.getStr(n),ue.doStat(a.lstat,n,t)}catch(i){if(typeof a>"u"||!(i instanceof a.ErrnoError))throw i;return-i.errno}}function Zn(n,t,i){try{return t=ue.getStr(t),t=ue.calculateAt(n,t),t=ve.normalize(t),t[t.length-1]==="/"&&(t=t.substr(0,t.length-1)),a.mkdir(t,i,0),0}catch(o){if(typeof a>"u"||!(o instanceof a.ErrnoError))throw o;return-o.errno}}function er(n,t,i,o){try{t=ue.getStr(t);var r=o&256,s=o&4096;return o=o&-6401,t=ue.calculateAt(n,t,s),ue.doStat(r?a.lstat:a.stat,t,i)}catch(p){if(typeof a>"u"||!(p instanceof a.ErrnoError))throw p;return-p.errno}}function tr(n,t,i,o){ue.varargs=o;try{t=ue.getStr(t),t=ue.calculateAt(n,t);var r=o?ue.get():0;return a.open(t,i,r).fd}catch(s){if(typeof a>"u"||!(s instanceof a.ErrnoError))throw s;return-s.errno}}function nr(n,t,i,o){try{if(t=ue.getStr(t),t=ue.calculateAt(n,t),o<=0)return-28;var r=a.readlink(t),s=Math.min(o,ot(r)),p=Pe[i+s];return Bt(r,i,o+1),Pe[i+s]=p,s}catch(h){if(typeof a>"u"||!(h instanceof a.ErrnoError))throw h;return-h.errno}}function rr(n){try{return n=ue.getStr(n),a.rmdir(n),0}catch(t){if(typeof a>"u"||!(t instanceof a.ErrnoError))throw t;return-t.errno}}function sr(n,t){try{return n=ue.getStr(n),ue.doStat(a.stat,n,t)}catch(i){if(typeof a>"u"||!(i instanceof a.ErrnoError))throw i;return-i.errno}}function ir(n,t,i){try{return t=ue.getStr(t),t=ue.calculateAt(n,t),i===0?a.unlink(t):i===512?a.rmdir(t):Ge("Invalid flags passed to unlinkat"),0}catch(o){if(typeof a>"u"||!(o instanceof a.ErrnoError))throw o;return-o.errno}}function Ft(n){return ke[n>>2]+fe[n+4>>2]*4294967296}function or(n,t,i,o){try{if(t=ue.getStr(t),t=ue.calculateAt(n,t,!0),i){var p=Ft(i),h=fe[i+8>>2];r=p*1e3+h/1e6,i+=16,p=Ft(i),h=fe[i+8>>2],s=p*1e3+h/1e6}else var r=Date.now(),s=r;return a.utime(t,r,s),0}catch(R){if(typeof a>"u"||!(R instanceof a.ErrnoError))throw R;return-R.errno}}var ar=!0;function lr(){return ar}function cr(n){return n%4===0&&(n%100!==0||n%400===0)}var ur=[0,31,60,91,121,152,182,213,244,274,305,335],_r=[0,31,59,90,120,151,181,212,243,273,304,334];function fr(n){var t=cr(n.getFullYear()),i=t?ur:_r,o=i[n.getMonth()]+n.getDate()-1;return o}function dr(n,t){var i=new Date(Ft(n)*1e3);fe[t>>2]=i.getSeconds(),fe[t+4>>2]=i.getMinutes(),fe[t+8>>2]=i.getHours(),fe[t+12>>2]=i.getDate(),fe[t+16>>2]=i.getMonth(),fe[t+20>>2]=i.getFullYear()-1900,fe[t+24>>2]=i.getDay();var o=fr(i)|0;fe[t+28>>2]=o,fe[t+36>>2]=-(i.getTimezoneOffset()*60);var r=new Date(i.getFullYear(),0,1),s=new Date(i.getFullYear(),6,1).getTimezoneOffset(),p=r.getTimezoneOffset(),h=(s!=p&&i.getTimezoneOffset()==Math.min(p,s))|0;fe[t+32>>2]=h}function pr(n,t,i,o,r,s,p){try{var h=ue.getStreamFromFD(o),R=a.mmap(h,n,r,t,i),C=R.ptr;return fe[s>>2]=R.allocated,ke[p>>2]=C,0}catch(Q){if(typeof a>"u"||!(Q instanceof a.ErrnoError))throw Q;return-Q.errno}}function mr(n,t,i,o,r,s){try{var p=ue.getStreamFromFD(r);i&2&&ue.doMsync(n,p,t,o,s),a.munmap(p)}catch(h){if(typeof a>"u"||!(h instanceof a.ErrnoError))throw h;return-h.errno}}function Xt(n){var t=ot(n)+1,i=nn(t);return i&&dt(n,Pe,i,t),i}function hr(n,t,i){var o=new Date().getFullYear(),r=new Date(o,0,1),s=new Date(o,6,1),p=r.getTimezoneOffset(),h=s.getTimezoneOffset(),R=Math.max(p,h);ke[n>>2]=R*60,fe[t>>2]=+(p!=h);function C(I){var O=I.toTimeString().match(/\(([A-Za-z ]+)\)$/);return O?O[1]:"GMT"}var Q=C(r),U=C(s),G=Xt(Q),A=Xt(U);h<p?(ke[i>>2]=G,ke[i+4>>2]=A):(ke[i>>2]=A,ke[i+4>>2]=G)}function gr(){return Date.now()}var Yt;Yt=()=>performance.now();function yr(){return 2147483648}function qr(n){var t=Ve.buffer;try{return Ve.grow(n-t.byteLength+65535>>>16),Wt(),1}catch{}}function br(n){var t=et.length;n=n>>>0;var i=yr();if(n>i)return!1;let o=(R,C)=>R+(C-R%C)%C;for(var r=1;r<=4;r*=2){var s=t*(1+.2/r);s=Math.min(s,n+100663296);var p=Math.min(i,o(Math.max(n,s),65536)),h=qr(p);if(h)return!0}return!1}var Ot={};function vr(){return be||"./this.program"}function lt(){if(!lt.strings){var n=(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",t={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:n,_:vr()};for(var i in Ot)Ot[i]===void 0?delete t[i]:t[i]=Ot[i];var o=[];for(var i in t)o.push(i+"="+t[i]);lt.strings=o}return lt.strings}function wr(n,t,i){for(var o=0;o<n.length;++o)Pe[t++>>0]=n.charCodeAt(o);i||(Pe[t>>0]=0)}function Er(n,t){var i=0;return lt().forEach(function(o,r){var s=t+i;ke[n+r*4>>2]=s,wr(o,s),i+=o.length+1}),0}function xr(n,t){var i=lt();ke[n>>2]=i.length;var o=0;return i.forEach(function(r){o+=r.length+1}),ke[t>>2]=o,0}function Sr(n){try{var t=ue.getStreamFromFD(n);return a.close(t),0}catch(i){if(typeof a>"u"||!(i instanceof a.ErrnoError))throw i;return i.errno}}function Ar(n,t){try{var i=ue.getStreamFromFD(n),o=i.tty?2:a.isDir(i.mode)?3:a.isLink(i.mode)?7:4;return Pe[t>>0]=o,0}catch(r){if(typeof a>"u"||!(r instanceof a.ErrnoError))throw r;return r.errno}}function kr(n,t,i,o){for(var r=0,s=0;s<i;s++){var p=ke[t>>2],h=ke[t+4>>2];t+=8;var R=a.read(n,Pe,p,h,o);if(R<0)return-1;if(r+=R,R<h)break;typeof o<"u"&&(o+=R)}return r}function Ir(n,t,i,o){try{var r=ue.getStreamFromFD(n),s=kr(r,t,i);return ke[o>>2]=s,0}catch(p){if(typeof a>"u"||!(p instanceof a.ErrnoError))throw p;return p.errno}}function Tr(n,t,i,o){try{if(t=Jt(t),isNaN(t))return 61;var r=ue.getStreamFromFD(n);return a.llseek(r,t,i),Te=[r.position>>>0,(pe=r.position,+Math.abs(pe)>=1?pe>0?(Math.min(+Math.floor(pe/4294967296),4294967295)|0)>>>0:~~+Math.ceil((pe-+(~~pe>>>0))/4294967296)>>>0:0)],fe[o>>2]=Te[0],fe[o+4>>2]=Te[1],r.getdents&&t===0&&i===0&&(r.getdents=null),0}catch(s){if(typeof a>"u"||!(s instanceof a.ErrnoError))throw s;return s.errno}}function Fr(n){try{var t=ue.getStreamFromFD(n);return t.stream_ops&&t.stream_ops.fsync?t.stream_ops.fsync(t):0}catch(i){if(typeof a>"u"||!(i instanceof a.ErrnoError))throw i;return i.errno}}function Or(n,t,i,o){for(var r=0,s=0;s<i;s++){var p=ke[t>>2],h=ke[t+4>>2];t+=8;var R=a.write(n,Pe,p,h,o);if(R<0)return-1;r+=R,typeof o<"u"&&(o+=R)}return r}function Pr(n,t,i,o){try{var r=ue.getStreamFromFD(n),s=Or(r,t,i);return ke[o>>2]=s,0}catch(p){if(typeof a>"u"||!(p instanceof a.ErrnoError))throw p;return p.errno}}var Zt=function(n,t,i,o){n||(n=this),this.parent=n,this.mount=n.mount,this.mounted=null,this.id=a.nextInode++,this.name=t,this.mode=i,this.node_ops={},this.stream_ops={},this.rdev=o},ht=365,gt=146;Object.defineProperties(Zt.prototype,{read:{get:function(){return(this.mode&ht)===ht},set:function(n){n?this.mode|=ht:this.mode&=~ht}},write:{get:function(){return(this.mode&gt)===gt},set:function(n){n?this.mode|=gt:this.mode&=~gt}},isFolder:{get:function(){return a.isDir(this.mode)}},isDevice:{get:function(){return a.isChrdev(this.mode)}}}),a.FSNode=Zt,a.staticInit();var Gl=!1,en={__syscall_chmod:Bn,__syscall_faccessat:zn,__syscall_fchmod:Wn,__syscall_fchown32:Un,__syscall_fcntl64:Hn,__syscall_fstat64:Vn,__syscall_ftruncate64:Kn,__syscall_getcwd:Jn,__syscall_ioctl:Xn,__syscall_lstat64:Yn,__syscall_mkdirat:Zn,__syscall_newfstatat:er,__syscall_openat:tr,__syscall_readlinkat:nr,__syscall_rmdir:rr,__syscall_stat64:sr,__syscall_unlinkat:ir,__syscall_utimensat:or,_emscripten_get_now_is_monotonic:lr,_localtime_js:dr,_mmap_js:pr,_munmap_js:mr,_tzset_js:hr,emscripten_date_now:gr,emscripten_get_now:Yt,emscripten_resize_heap:br,environ_get:Er,environ_sizes_get:xr,fd_close:Sr,fd_fdstat_get:Ar,fd_read:Ir,fd_seek:Tr,fd_sync:Fr,fd_write:Pr,memory:Ve},$l=Dn(),Lr=e.___wasm_call_ctors=function(){return(Lr=e.___wasm_call_ctors=e.asm.__wasm_call_ctors).apply(null,arguments)},Rr=e._sqlite3_status64=function(){return(Rr=e._sqlite3_status64=e.asm.sqlite3_status64).apply(null,arguments)},Dr=e._sqlite3_status=function(){return(Dr=e._sqlite3_status=e.asm.sqlite3_status).apply(null,arguments)},Nr=e._sqlite3_db_status=function(){return(Nr=e._sqlite3_db_status=e.asm.sqlite3_db_status).apply(null,arguments)},Cr=e._sqlite3_msize=function(){return(Cr=e._sqlite3_msize=e.asm.sqlite3_msize).apply(null,arguments)},Mr=e._sqlite3_vfs_find=function(){return(Mr=e._sqlite3_vfs_find=e.asm.sqlite3_vfs_find).apply(null,arguments)},jr=e._sqlite3_initialize=function(){return(jr=e._sqlite3_initialize=e.asm.sqlite3_initialize).apply(null,arguments)},Br=e._sqlite3_malloc=function(){return(Br=e._sqlite3_malloc=e.asm.sqlite3_malloc).apply(null,arguments)},zr=e._sqlite3_free=function(){return(zr=e._sqlite3_free=e.asm.sqlite3_free).apply(null,arguments)},Wr=e._sqlite3_vfs_register=function(){return(Wr=e._sqlite3_vfs_register=e.asm.sqlite3_vfs_register).apply(null,arguments)},Ur=e._sqlite3_vfs_unregister=function(){return(Ur=e._sqlite3_vfs_unregister=e.asm.sqlite3_vfs_unregister).apply(null,arguments)},Qr=e._sqlite3_malloc64=function(){return(Qr=e._sqlite3_malloc64=e.asm.sqlite3_malloc64).apply(null,arguments)},Hr=e._sqlite3_realloc=function(){return(Hr=e._sqlite3_realloc=e.asm.sqlite3_realloc).apply(null,arguments)},Vr=e._sqlite3_realloc64=function(){return(Vr=e._sqlite3_realloc64=e.asm.sqlite3_realloc64).apply(null,arguments)},Gr=e._sqlite3_value_text=function(){return(Gr=e._sqlite3_value_text=e.asm.sqlite3_value_text).apply(null,arguments)},$r=e._sqlite3_randomness=function(){return($r=e._sqlite3_randomness=e.asm.sqlite3_randomness).apply(null,arguments)},Kr=e._sqlite3_stricmp=function(){return(Kr=e._sqlite3_stricmp=e.asm.sqlite3_stricmp).apply(null,arguments)},Jr=e._sqlite3_strnicmp=function(){return(Jr=e._sqlite3_strnicmp=e.asm.sqlite3_strnicmp).apply(null,arguments)},Xr=e._sqlite3_uri_parameter=function(){return(Xr=e._sqlite3_uri_parameter=e.asm.sqlite3_uri_parameter).apply(null,arguments)},tn=e.___errno_location=function(){return(tn=e.___errno_location=e.asm.__errno_location).apply(null,arguments)},Yr=e._sqlite3_uri_boolean=function(){return(Yr=e._sqlite3_uri_boolean=e.asm.sqlite3_uri_boolean).apply(null,arguments)},Zr=e._sqlite3_serialize=function(){return(Zr=e._sqlite3_serialize=e.asm.sqlite3_serialize).apply(null,arguments)},es=e._sqlite3_prepare_v2=function(){return(es=e._sqlite3_prepare_v2=e.asm.sqlite3_prepare_v2).apply(null,arguments)},ts=e._sqlite3_step=function(){return(ts=e._sqlite3_step=e.asm.sqlite3_step).apply(null,arguments)},ns=e._sqlite3_column_int64=function(){return(ns=e._sqlite3_column_int64=e.asm.sqlite3_column_int64).apply(null,arguments)},rs=e._sqlite3_reset=function(){return(rs=e._sqlite3_reset=e.asm.sqlite3_reset).apply(null,arguments)},ss=e._sqlite3_exec=function(){return(ss=e._sqlite3_exec=e.asm.sqlite3_exec).apply(null,arguments)},is=e._sqlite3_column_int=function(){return(is=e._sqlite3_column_int=e.asm.sqlite3_column_int).apply(null,arguments)},os=e._sqlite3_finalize=function(){return(os=e._sqlite3_finalize=e.asm.sqlite3_finalize).apply(null,arguments)},as=e._sqlite3_file_control=function(){return(as=e._sqlite3_file_control=e.asm.sqlite3_file_control).apply(null,arguments)},ls=e._sqlite3_column_name=function(){return(ls=e._sqlite3_column_name=e.asm.sqlite3_column_name).apply(null,arguments)},cs=e._sqlite3_column_text=function(){return(cs=e._sqlite3_column_text=e.asm.sqlite3_column_text).apply(null,arguments)},us=e._sqlite3_column_type=function(){return(us=e._sqlite3_column_type=e.asm.sqlite3_column_type).apply(null,arguments)},_s=e._sqlite3_errmsg=function(){return(_s=e._sqlite3_errmsg=e.asm.sqlite3_errmsg).apply(null,arguments)},fs=e._sqlite3_deserialize=function(){return(fs=e._sqlite3_deserialize=e.asm.sqlite3_deserialize).apply(null,arguments)},ds=e._sqlite3_clear_bindings=function(){return(ds=e._sqlite3_clear_bindings=e.asm.sqlite3_clear_bindings).apply(null,arguments)},ps=e._sqlite3_value_blob=function(){return(ps=e._sqlite3_value_blob=e.asm.sqlite3_value_blob).apply(null,arguments)},ms=e._sqlite3_value_bytes=function(){return(ms=e._sqlite3_value_bytes=e.asm.sqlite3_value_bytes).apply(null,arguments)},hs=e._sqlite3_value_double=function(){return(hs=e._sqlite3_value_double=e.asm.sqlite3_value_double).apply(null,arguments)},gs=e._sqlite3_value_int=function(){return(gs=e._sqlite3_value_int=e.asm.sqlite3_value_int).apply(null,arguments)},ys=e._sqlite3_value_int64=function(){return(ys=e._sqlite3_value_int64=e.asm.sqlite3_value_int64).apply(null,arguments)},qs=e._sqlite3_value_subtype=function(){return(qs=e._sqlite3_value_subtype=e.asm.sqlite3_value_subtype).apply(null,arguments)},bs=e._sqlite3_value_pointer=function(){return(bs=e._sqlite3_value_pointer=e.asm.sqlite3_value_pointer).apply(null,arguments)},vs=e._sqlite3_value_type=function(){return(vs=e._sqlite3_value_type=e.asm.sqlite3_value_type).apply(null,arguments)},ws=e._sqlite3_value_nochange=function(){return(ws=e._sqlite3_value_nochange=e.asm.sqlite3_value_nochange).apply(null,arguments)},Es=e._sqlite3_value_frombind=function(){return(Es=e._sqlite3_value_frombind=e.asm.sqlite3_value_frombind).apply(null,arguments)},xs=e._sqlite3_value_dup=function(){return(xs=e._sqlite3_value_dup=e.asm.sqlite3_value_dup).apply(null,arguments)},Ss=e._sqlite3_value_free=function(){return(Ss=e._sqlite3_value_free=e.asm.sqlite3_value_free).apply(null,arguments)},As=e._sqlite3_result_blob=function(){return(As=e._sqlite3_result_blob=e.asm.sqlite3_result_blob).apply(null,arguments)},ks=e._sqlite3_result_error_toobig=function(){return(ks=e._sqlite3_result_error_toobig=e.asm.sqlite3_result_error_toobig).apply(null,arguments)},Is=e._sqlite3_result_error_nomem=function(){return(Is=e._sqlite3_result_error_nomem=e.asm.sqlite3_result_error_nomem).apply(null,arguments)},Ts=e._sqlite3_result_double=function(){return(Ts=e._sqlite3_result_double=e.asm.sqlite3_result_double).apply(null,arguments)},Fs=e._sqlite3_result_error=function(){return(Fs=e._sqlite3_result_error=e.asm.sqlite3_result_error).apply(null,arguments)},Os=e._sqlite3_result_int=function(){return(Os=e._sqlite3_result_int=e.asm.sqlite3_result_int).apply(null,arguments)},Ps=e._sqlite3_result_int64=function(){return(Ps=e._sqlite3_result_int64=e.asm.sqlite3_result_int64).apply(null,arguments)},Ls=e._sqlite3_result_null=function(){return(Ls=e._sqlite3_result_null=e.asm.sqlite3_result_null).apply(null,arguments)},Rs=e._sqlite3_result_pointer=function(){return(Rs=e._sqlite3_result_pointer=e.asm.sqlite3_result_pointer).apply(null,arguments)},Ds=e._sqlite3_result_subtype=function(){return(Ds=e._sqlite3_result_subtype=e.asm.sqlite3_result_subtype).apply(null,arguments)},Ns=e._sqlite3_result_text=function(){return(Ns=e._sqlite3_result_text=e.asm.sqlite3_result_text).apply(null,arguments)},Cs=e._sqlite3_result_zeroblob=function(){return(Cs=e._sqlite3_result_zeroblob=e.asm.sqlite3_result_zeroblob).apply(null,arguments)},Ms=e._sqlite3_result_zeroblob64=function(){return(Ms=e._sqlite3_result_zeroblob64=e.asm.sqlite3_result_zeroblob64).apply(null,arguments)},js=e._sqlite3_result_error_code=function(){return(js=e._sqlite3_result_error_code=e.asm.sqlite3_result_error_code).apply(null,arguments)},Bs=e._sqlite3_user_data=function(){return(Bs=e._sqlite3_user_data=e.asm.sqlite3_user_data).apply(null,arguments)},zs=e._sqlite3_context_db_handle=function(){return(zs=e._sqlite3_context_db_handle=e.asm.sqlite3_context_db_handle).apply(null,arguments)},Ws=e._sqlite3_vtab_nochange=function(){return(Ws=e._sqlite3_vtab_nochange=e.asm.sqlite3_vtab_nochange).apply(null,arguments)},Us=e._sqlite3_vtab_in_first=function(){return(Us=e._sqlite3_vtab_in_first=e.asm.sqlite3_vtab_in_first).apply(null,arguments)},Qs=e._sqlite3_vtab_in_next=function(){return(Qs=e._sqlite3_vtab_in_next=e.asm.sqlite3_vtab_in_next).apply(null,arguments)},Hs=e._sqlite3_aggregate_context=function(){return(Hs=e._sqlite3_aggregate_context=e.asm.sqlite3_aggregate_context).apply(null,arguments)},Vs=e._sqlite3_get_auxdata=function(){return(Vs=e._sqlite3_get_auxdata=e.asm.sqlite3_get_auxdata).apply(null,arguments)},Gs=e._sqlite3_set_auxdata=function(){return(Gs=e._sqlite3_set_auxdata=e.asm.sqlite3_set_auxdata).apply(null,arguments)},$s=e._sqlite3_column_count=function(){return($s=e._sqlite3_column_count=e.asm.sqlite3_column_count).apply(null,arguments)},Ks=e._sqlite3_data_count=function(){return(Ks=e._sqlite3_data_count=e.asm.sqlite3_data_count).apply(null,arguments)},Js=e._sqlite3_column_blob=function(){return(Js=e._sqlite3_column_blob=e.asm.sqlite3_column_blob).apply(null,arguments)},Xs=e._sqlite3_column_bytes=function(){return(Xs=e._sqlite3_column_bytes=e.asm.sqlite3_column_bytes).apply(null,arguments)},Ys=e._sqlite3_column_double=function(){return(Ys=e._sqlite3_column_double=e.asm.sqlite3_column_double).apply(null,arguments)},Zs=e._sqlite3_column_value=function(){return(Zs=e._sqlite3_column_value=e.asm.sqlite3_column_value).apply(null,arguments)},ei=e._sqlite3_bind_blob=function(){return(ei=e._sqlite3_bind_blob=e.asm.sqlite3_bind_blob).apply(null,arguments)},ti=e._sqlite3_bind_double=function(){return(ti=e._sqlite3_bind_double=e.asm.sqlite3_bind_double).apply(null,arguments)},ni=e._sqlite3_bind_int=function(){return(ni=e._sqlite3_bind_int=e.asm.sqlite3_bind_int).apply(null,arguments)},ri=e._sqlite3_bind_int64=function(){return(ri=e._sqlite3_bind_int64=e.asm.sqlite3_bind_int64).apply(null,arguments)},si=e._sqlite3_bind_null=function(){return(si=e._sqlite3_bind_null=e.asm.sqlite3_bind_null).apply(null,arguments)},ii=e._sqlite3_bind_pointer=function(){return(ii=e._sqlite3_bind_pointer=e.asm.sqlite3_bind_pointer).apply(null,arguments)},oi=e._sqlite3_bind_text=function(){return(oi=e._sqlite3_bind_text=e.asm.sqlite3_bind_text).apply(null,arguments)},ai=e._sqlite3_bind_parameter_count=function(){return(ai=e._sqlite3_bind_parameter_count=e.asm.sqlite3_bind_parameter_count).apply(null,arguments)},li=e._sqlite3_bind_parameter_index=function(){return(li=e._sqlite3_bind_parameter_index=e.asm.sqlite3_bind_parameter_index).apply(null,arguments)},ci=e._sqlite3_db_handle=function(){return(ci=e._sqlite3_db_handle=e.asm.sqlite3_db_handle).apply(null,arguments)},ui=e._sqlite3_stmt_readonly=function(){return(ui=e._sqlite3_stmt_readonly=e.asm.sqlite3_stmt_readonly).apply(null,arguments)},_i=e._sqlite3_stmt_isexplain=function(){return(_i=e._sqlite3_stmt_isexplain=e.asm.sqlite3_stmt_isexplain).apply(null,arguments)},fi=e._sqlite3_stmt_status=function(){return(fi=e._sqlite3_stmt_status=e.asm.sqlite3_stmt_status).apply(null,arguments)},di=e._sqlite3_sql=function(){return(di=e._sqlite3_sql=e.asm.sqlite3_sql).apply(null,arguments)},pi=e._sqlite3_expanded_sql=function(){return(pi=e._sqlite3_expanded_sql=e.asm.sqlite3_expanded_sql).apply(null,arguments)},mi=e._sqlite3_preupdate_old=function(){return(mi=e._sqlite3_preupdate_old=e.asm.sqlite3_preupdate_old).apply(null,arguments)},hi=e._sqlite3_preupdate_count=function(){return(hi=e._sqlite3_preupdate_count=e.asm.sqlite3_preupdate_count).apply(null,arguments)},gi=e._sqlite3_preupdate_depth=function(){return(gi=e._sqlite3_preupdate_depth=e.asm.sqlite3_preupdate_depth).apply(null,arguments)},yi=e._sqlite3_preupdate_blobwrite=function(){return(yi=e._sqlite3_preupdate_blobwrite=e.asm.sqlite3_preupdate_blobwrite).apply(null,arguments)},qi=e._sqlite3_preupdate_new=function(){return(qi=e._sqlite3_preupdate_new=e.asm.sqlite3_preupdate_new).apply(null,arguments)},bi=e._sqlite3_value_numeric_type=function(){return(bi=e._sqlite3_value_numeric_type=e.asm.sqlite3_value_numeric_type).apply(null,arguments)},vi=e._sqlite3_set_authorizer=function(){return(vi=e._sqlite3_set_authorizer=e.asm.sqlite3_set_authorizer).apply(null,arguments)},wi=e._sqlite3_strglob=function(){return(wi=e._sqlite3_strglob=e.asm.sqlite3_strglob).apply(null,arguments)},Ei=e._sqlite3_strlike=function(){return(Ei=e._sqlite3_strlike=e.asm.sqlite3_strlike).apply(null,arguments)},xi=e._sqlite3_auto_extension=function(){return(xi=e._sqlite3_auto_extension=e.asm.sqlite3_auto_extension).apply(null,arguments)},Si=e._sqlite3_cancel_auto_extension=function(){return(Si=e._sqlite3_cancel_auto_extension=e.asm.sqlite3_cancel_auto_extension).apply(null,arguments)},Ai=e._sqlite3_reset_auto_extension=function(){return(Ai=e._sqlite3_reset_auto_extension=e.asm.sqlite3_reset_auto_extension).apply(null,arguments)},ki=e._sqlite3_prepare_v3=function(){return(ki=e._sqlite3_prepare_v3=e.asm.sqlite3_prepare_v3).apply(null,arguments)},Ii=e._sqlite3_create_module=function(){return(Ii=e._sqlite3_create_module=e.asm.sqlite3_create_module).apply(null,arguments)},Ti=e._sqlite3_create_module_v2=function(){return(Ti=e._sqlite3_create_module_v2=e.asm.sqlite3_create_module_v2).apply(null,arguments)},Fi=e._sqlite3_drop_modules=function(){return(Fi=e._sqlite3_drop_modules=e.asm.sqlite3_drop_modules).apply(null,arguments)},Oi=e._sqlite3_declare_vtab=function(){return(Oi=e._sqlite3_declare_vtab=e.asm.sqlite3_declare_vtab).apply(null,arguments)},Pi=e._sqlite3_vtab_on_conflict=function(){return(Pi=e._sqlite3_vtab_on_conflict=e.asm.sqlite3_vtab_on_conflict).apply(null,arguments)},Li=e._sqlite3_vtab_collation=function(){return(Li=e._sqlite3_vtab_collation=e.asm.sqlite3_vtab_collation).apply(null,arguments)},Ri=e._sqlite3_vtab_in=function(){return(Ri=e._sqlite3_vtab_in=e.asm.sqlite3_vtab_in).apply(null,arguments)},Di=e._sqlite3_vtab_rhs_value=function(){return(Di=e._sqlite3_vtab_rhs_value=e.asm.sqlite3_vtab_rhs_value).apply(null,arguments)},Ni=e._sqlite3_vtab_distinct=function(){return(Ni=e._sqlite3_vtab_distinct=e.asm.sqlite3_vtab_distinct).apply(null,arguments)},Ci=e._sqlite3_keyword_name=function(){return(Ci=e._sqlite3_keyword_name=e.asm.sqlite3_keyword_name).apply(null,arguments)},Mi=e._sqlite3_keyword_count=function(){return(Mi=e._sqlite3_keyword_count=e.asm.sqlite3_keyword_count).apply(null,arguments)},ji=e._sqlite3_keyword_check=function(){return(ji=e._sqlite3_keyword_check=e.asm.sqlite3_keyword_check).apply(null,arguments)},Bi=e._sqlite3_complete=function(){return(Bi=e._sqlite3_complete=e.asm.sqlite3_complete).apply(null,arguments)},zi=e._sqlite3_libversion=function(){return(zi=e._sqlite3_libversion=e.asm.sqlite3_libversion).apply(null,arguments)},Wi=e._sqlite3_libversion_number=function(){return(Wi=e._sqlite3_libversion_number=e.asm.sqlite3_libversion_number).apply(null,arguments)},Ui=e._sqlite3_shutdown=function(){return(Ui=e._sqlite3_shutdown=e.asm.sqlite3_shutdown).apply(null,arguments)},Qi=e._sqlite3_last_insert_rowid=function(){return(Qi=e._sqlite3_last_insert_rowid=e.asm.sqlite3_last_insert_rowid).apply(null,arguments)},Hi=e._sqlite3_set_last_insert_rowid=function(){return(Hi=e._sqlite3_set_last_insert_rowid=e.asm.sqlite3_set_last_insert_rowid).apply(null,arguments)},Vi=e._sqlite3_changes64=function(){return(Vi=e._sqlite3_changes64=e.asm.sqlite3_changes64).apply(null,arguments)},Gi=e._sqlite3_changes=function(){return(Gi=e._sqlite3_changes=e.asm.sqlite3_changes).apply(null,arguments)},$i=e._sqlite3_total_changes64=function(){return($i=e._sqlite3_total_changes64=e.asm.sqlite3_total_changes64).apply(null,arguments)},Ki=e._sqlite3_total_changes=function(){return(Ki=e._sqlite3_total_changes=e.asm.sqlite3_total_changes).apply(null,arguments)},Ji=e._sqlite3_txn_state=function(){return(Ji=e._sqlite3_txn_state=e.asm.sqlite3_txn_state).apply(null,arguments)},Xi=e._sqlite3_close_v2=function(){return(Xi=e._sqlite3_close_v2=e.asm.sqlite3_close_v2).apply(null,arguments)},Yi=e._sqlite3_busy_handler=function(){return(Yi=e._sqlite3_busy_handler=e.asm.sqlite3_busy_handler).apply(null,arguments)},Zi=e._sqlite3_progress_handler=function(){return(Zi=e._sqlite3_progress_handler=e.asm.sqlite3_progress_handler).apply(null,arguments)},eo=e._sqlite3_busy_timeout=function(){return(eo=e._sqlite3_busy_timeout=e.asm.sqlite3_busy_timeout).apply(null,arguments)},to=e._sqlite3_create_function=function(){return(to=e._sqlite3_create_function=e.asm.sqlite3_create_function).apply(null,arguments)},no=e._sqlite3_create_function_v2=function(){return(no=e._sqlite3_create_function_v2=e.asm.sqlite3_create_function_v2).apply(null,arguments)},ro=e._sqlite3_create_window_function=function(){return(ro=e._sqlite3_create_window_function=e.asm.sqlite3_create_window_function).apply(null,arguments)},so=e._sqlite3_overload_function=function(){return(so=e._sqlite3_overload_function=e.asm.sqlite3_overload_function).apply(null,arguments)},io=e._sqlite3_trace_v2=function(){return(io=e._sqlite3_trace_v2=e.asm.sqlite3_trace_v2).apply(null,arguments)},oo=e._sqlite3_commit_hook=function(){return(oo=e._sqlite3_commit_hook=e.asm.sqlite3_commit_hook).apply(null,arguments)},ao=e._sqlite3_update_hook=function(){return(ao=e._sqlite3_update_hook=e.asm.sqlite3_update_hook).apply(null,arguments)},lo=e._sqlite3_rollback_hook=function(){return(lo=e._sqlite3_rollback_hook=e.asm.sqlite3_rollback_hook).apply(null,arguments)},co=e._sqlite3_preupdate_hook=function(){return(co=e._sqlite3_preupdate_hook=e.asm.sqlite3_preupdate_hook).apply(null,arguments)},uo=e._sqlite3_error_offset=function(){return(uo=e._sqlite3_error_offset=e.asm.sqlite3_error_offset).apply(null,arguments)},_o=e._sqlite3_errcode=function(){return(_o=e._sqlite3_errcode=e.asm.sqlite3_errcode).apply(null,arguments)},fo=e._sqlite3_extended_errcode=function(){return(fo=e._sqlite3_extended_errcode=e.asm.sqlite3_extended_errcode).apply(null,arguments)},po=e._sqlite3_errstr=function(){return(po=e._sqlite3_errstr=e.asm.sqlite3_errstr).apply(null,arguments)},mo=e._sqlite3_limit=function(){return(mo=e._sqlite3_limit=e.asm.sqlite3_limit).apply(null,arguments)},ho=e._sqlite3_open=function(){return(ho=e._sqlite3_open=e.asm.sqlite3_open).apply(null,arguments)},go=e._sqlite3_open_v2=function(){return(go=e._sqlite3_open_v2=e.asm.sqlite3_open_v2).apply(null,arguments)},yo=e._sqlite3_create_collation=function(){return(yo=e._sqlite3_create_collation=e.asm.sqlite3_create_collation).apply(null,arguments)},qo=e._sqlite3_create_collation_v2=function(){return(qo=e._sqlite3_create_collation_v2=e.asm.sqlite3_create_collation_v2).apply(null,arguments)},bo=e._sqlite3_collation_needed=function(){return(bo=e._sqlite3_collation_needed=e.asm.sqlite3_collation_needed).apply(null,arguments)},vo=e._sqlite3_get_autocommit=function(){return(vo=e._sqlite3_get_autocommit=e.asm.sqlite3_get_autocommit).apply(null,arguments)},wo=e._sqlite3_table_column_metadata=function(){return(wo=e._sqlite3_table_column_metadata=e.asm.sqlite3_table_column_metadata).apply(null,arguments)},Eo=e._sqlite3_extended_result_codes=function(){return(Eo=e._sqlite3_extended_result_codes=e.asm.sqlite3_extended_result_codes).apply(null,arguments)},xo=e._sqlite3_uri_key=function(){return(xo=e._sqlite3_uri_key=e.asm.sqlite3_uri_key).apply(null,arguments)},So=e._sqlite3_uri_int64=function(){return(So=e._sqlite3_uri_int64=e.asm.sqlite3_uri_int64).apply(null,arguments)},Ao=e._sqlite3_db_name=function(){return(Ao=e._sqlite3_db_name=e.asm.sqlite3_db_name).apply(null,arguments)},ko=e._sqlite3_db_filename=function(){return(ko=e._sqlite3_db_filename=e.asm.sqlite3_db_filename).apply(null,arguments)},Io=e._sqlite3_compileoption_used=function(){return(Io=e._sqlite3_compileoption_used=e.asm.sqlite3_compileoption_used).apply(null,arguments)},To=e._sqlite3_compileoption_get=function(){return(To=e._sqlite3_compileoption_get=e.asm.sqlite3_compileoption_get).apply(null,arguments)},Fo=e._sqlite3session_diff=function(){return(Fo=e._sqlite3session_diff=e.asm.sqlite3session_diff).apply(null,arguments)},Oo=e._sqlite3session_attach=function(){return(Oo=e._sqlite3session_attach=e.asm.sqlite3session_attach).apply(null,arguments)},Po=e._sqlite3session_create=function(){return(Po=e._sqlite3session_create=e.asm.sqlite3session_create).apply(null,arguments)},Lo=e._sqlite3session_delete=function(){return(Lo=e._sqlite3session_delete=e.asm.sqlite3session_delete).apply(null,arguments)},Ro=e._sqlite3session_table_filter=function(){return(Ro=e._sqlite3session_table_filter=e.asm.sqlite3session_table_filter).apply(null,arguments)},Do=e._sqlite3session_changeset=function(){return(Do=e._sqlite3session_changeset=e.asm.sqlite3session_changeset).apply(null,arguments)},No=e._sqlite3session_changeset_strm=function(){return(No=e._sqlite3session_changeset_strm=e.asm.sqlite3session_changeset_strm).apply(null,arguments)},Co=e._sqlite3session_patchset_strm=function(){return(Co=e._sqlite3session_patchset_strm=e.asm.sqlite3session_patchset_strm).apply(null,arguments)},Mo=e._sqlite3session_patchset=function(){return(Mo=e._sqlite3session_patchset=e.asm.sqlite3session_patchset).apply(null,arguments)},jo=e._sqlite3session_enable=function(){return(jo=e._sqlite3session_enable=e.asm.sqlite3session_enable).apply(null,arguments)},Bo=e._sqlite3session_indirect=function(){return(Bo=e._sqlite3session_indirect=e.asm.sqlite3session_indirect).apply(null,arguments)},zo=e._sqlite3session_isempty=function(){return(zo=e._sqlite3session_isempty=e.asm.sqlite3session_isempty).apply(null,arguments)},Wo=e._sqlite3session_memory_used=function(){return(Wo=e._sqlite3session_memory_used=e.asm.sqlite3session_memory_used).apply(null,arguments)},Uo=e._sqlite3session_object_config=function(){return(Uo=e._sqlite3session_object_config=e.asm.sqlite3session_object_config).apply(null,arguments)},Qo=e._sqlite3session_changeset_size=function(){return(Qo=e._sqlite3session_changeset_size=e.asm.sqlite3session_changeset_size).apply(null,arguments)},Ho=e._sqlite3changeset_start=function(){return(Ho=e._sqlite3changeset_start=e.asm.sqlite3changeset_start).apply(null,arguments)},Vo=e._sqlite3changeset_start_v2=function(){return(Vo=e._sqlite3changeset_start_v2=e.asm.sqlite3changeset_start_v2).apply(null,arguments)},Go=e._sqlite3changeset_start_strm=function(){return(Go=e._sqlite3changeset_start_strm=e.asm.sqlite3changeset_start_strm).apply(null,arguments)},$o=e._sqlite3changeset_start_v2_strm=function(){return($o=e._sqlite3changeset_start_v2_strm=e.asm.sqlite3changeset_start_v2_strm).apply(null,arguments)},Ko=e._sqlite3changeset_next=function(){return(Ko=e._sqlite3changeset_next=e.asm.sqlite3changeset_next).apply(null,arguments)},Jo=e._sqlite3changeset_op=function(){return(Jo=e._sqlite3changeset_op=e.asm.sqlite3changeset_op).apply(null,arguments)},Xo=e._sqlite3changeset_pk=function(){return(Xo=e._sqlite3changeset_pk=e.asm.sqlite3changeset_pk).apply(null,arguments)},Yo=e._sqlite3changeset_old=function(){return(Yo=e._sqlite3changeset_old=e.asm.sqlite3changeset_old).apply(null,arguments)},Zo=e._sqlite3changeset_new=function(){return(Zo=e._sqlite3changeset_new=e.asm.sqlite3changeset_new).apply(null,arguments)},ea=e._sqlite3changeset_conflict=function(){return(ea=e._sqlite3changeset_conflict=e.asm.sqlite3changeset_conflict).apply(null,arguments)},ta=e._sqlite3changeset_fk_conflicts=function(){return(ta=e._sqlite3changeset_fk_conflicts=e.asm.sqlite3changeset_fk_conflicts).apply(null,arguments)},na=e._sqlite3changeset_finalize=function(){return(na=e._sqlite3changeset_finalize=e.asm.sqlite3changeset_finalize).apply(null,arguments)},ra=e._sqlite3changeset_invert=function(){return(ra=e._sqlite3changeset_invert=e.asm.sqlite3changeset_invert).apply(null,arguments)},sa=e._sqlite3changeset_invert_strm=function(){return(sa=e._sqlite3changeset_invert_strm=e.asm.sqlite3changeset_invert_strm).apply(null,arguments)},ia=e._sqlite3changeset_apply_v2=function(){return(ia=e._sqlite3changeset_apply_v2=e.asm.sqlite3changeset_apply_v2).apply(null,arguments)},oa=e._sqlite3changeset_apply=function(){return(oa=e._sqlite3changeset_apply=e.asm.sqlite3changeset_apply).apply(null,arguments)},aa=e._sqlite3changeset_apply_v2_strm=function(){return(aa=e._sqlite3changeset_apply_v2_strm=e.asm.sqlite3changeset_apply_v2_strm).apply(null,arguments)},la=e._sqlite3changeset_apply_strm=function(){return(la=e._sqlite3changeset_apply_strm=e.asm.sqlite3changeset_apply_strm).apply(null,arguments)},ca=e._sqlite3changegroup_new=function(){return(ca=e._sqlite3changegroup_new=e.asm.sqlite3changegroup_new).apply(null,arguments)},ua=e._sqlite3changegroup_add=function(){return(ua=e._sqlite3changegroup_add=e.asm.sqlite3changegroup_add).apply(null,arguments)},_a=e._sqlite3changegroup_output=function(){return(_a=e._sqlite3changegroup_output=e.asm.sqlite3changegroup_output).apply(null,arguments)},fa=e._sqlite3changegroup_add_strm=function(){return(fa=e._sqlite3changegroup_add_strm=e.asm.sqlite3changegroup_add_strm).apply(null,arguments)},da=e._sqlite3changegroup_output_strm=function(){return(da=e._sqlite3changegroup_output_strm=e.asm.sqlite3changegroup_output_strm).apply(null,arguments)},pa=e._sqlite3changegroup_delete=function(){return(pa=e._sqlite3changegroup_delete=e.asm.sqlite3changegroup_delete).apply(null,arguments)},ma=e._sqlite3changeset_concat=function(){return(ma=e._sqlite3changeset_concat=e.asm.sqlite3changeset_concat).apply(null,arguments)},ha=e._sqlite3changeset_concat_strm=function(){return(ha=e._sqlite3changeset_concat_strm=e.asm.sqlite3changeset_concat_strm).apply(null,arguments)},ga=e._sqlite3session_config=function(){return(ga=e._sqlite3session_config=e.asm.sqlite3session_config).apply(null,arguments)},ya=e._sqlite3_sourceid=function(){return(ya=e._sqlite3_sourceid=e.asm.sqlite3_sourceid).apply(null,arguments)},qa=e._sqlite3__wasm_pstack_ptr=function(){return(qa=e._sqlite3__wasm_pstack_ptr=e.asm.sqlite3__wasm_pstack_ptr).apply(null,arguments)},ba=e._sqlite3__wasm_pstack_restore=function(){return(ba=e._sqlite3__wasm_pstack_restore=e.asm.sqlite3__wasm_pstack_restore).apply(null,arguments)},va=e._sqlite3__wasm_pstack_alloc=function(){return(va=e._sqlite3__wasm_pstack_alloc=e.asm.sqlite3__wasm_pstack_alloc).apply(null,arguments)},wa=e._sqlite3__wasm_pstack_remaining=function(){return(wa=e._sqlite3__wasm_pstack_remaining=e.asm.sqlite3__wasm_pstack_remaining).apply(null,arguments)},Ea=e._sqlite3__wasm_pstack_quota=function(){return(Ea=e._sqlite3__wasm_pstack_quota=e.asm.sqlite3__wasm_pstack_quota).apply(null,arguments)},xa=e._sqlite3__wasm_db_error=function(){return(xa=e._sqlite3__wasm_db_error=e.asm.sqlite3__wasm_db_error).apply(null,arguments)},Sa=e._sqlite3__wasm_test_struct=function(){return(Sa=e._sqlite3__wasm_test_struct=e.asm.sqlite3__wasm_test_struct).apply(null,arguments)},Aa=e._sqlite3__wasm_enum_json=function(){return(Aa=e._sqlite3__wasm_enum_json=e.asm.sqlite3__wasm_enum_json).apply(null,arguments)},ka=e._sqlite3__wasm_vfs_unlink=function(){return(ka=e._sqlite3__wasm_vfs_unlink=e.asm.sqlite3__wasm_vfs_unlink).apply(null,arguments)},Ia=e._sqlite3__wasm_db_vfs=function(){return(Ia=e._sqlite3__wasm_db_vfs=e.asm.sqlite3__wasm_db_vfs).apply(null,arguments)},Ta=e._sqlite3__wasm_db_reset=function(){return(Ta=e._sqlite3__wasm_db_reset=e.asm.sqlite3__wasm_db_reset).apply(null,arguments)},Fa=e._sqlite3__wasm_db_export_chunked=function(){return(Fa=e._sqlite3__wasm_db_export_chunked=e.asm.sqlite3__wasm_db_export_chunked).apply(null,arguments)},Oa=e._sqlite3__wasm_db_serialize=function(){return(Oa=e._sqlite3__wasm_db_serialize=e.asm.sqlite3__wasm_db_serialize).apply(null,arguments)},Pa=e._sqlite3__wasm_vfs_create_file=function(){return(Pa=e._sqlite3__wasm_vfs_create_file=e.asm.sqlite3__wasm_vfs_create_file).apply(null,arguments)},La=e._sqlite3__wasm_posix_create_file=function(){return(La=e._sqlite3__wasm_posix_create_file=e.asm.sqlite3__wasm_posix_create_file).apply(null,arguments)},Ra=e._sqlite3__wasm_kvvfsMakeKeyOnPstack=function(){return(Ra=e._sqlite3__wasm_kvvfsMakeKeyOnPstack=e.asm.sqlite3__wasm_kvvfsMakeKeyOnPstack).apply(null,arguments)},Da=e._sqlite3__wasm_kvvfs_methods=function(){return(Da=e._sqlite3__wasm_kvvfs_methods=e.asm.sqlite3__wasm_kvvfs_methods).apply(null,arguments)},Na=e._sqlite3__wasm_vtab_config=function(){return(Na=e._sqlite3__wasm_vtab_config=e.asm.sqlite3__wasm_vtab_config).apply(null,arguments)},Ca=e._sqlite3__wasm_db_config_ip=function(){return(Ca=e._sqlite3__wasm_db_config_ip=e.asm.sqlite3__wasm_db_config_ip).apply(null,arguments)},Ma=e._sqlite3__wasm_db_config_pii=function(){return(Ma=e._sqlite3__wasm_db_config_pii=e.asm.sqlite3__wasm_db_config_pii).apply(null,arguments)},ja=e._sqlite3__wasm_db_config_s=function(){return(ja=e._sqlite3__wasm_db_config_s=e.asm.sqlite3__wasm_db_config_s).apply(null,arguments)},Ba=e._sqlite3__wasm_config_i=function(){return(Ba=e._sqlite3__wasm_config_i=e.asm.sqlite3__wasm_config_i).apply(null,arguments)},za=e._sqlite3__wasm_config_ii=function(){return(za=e._sqlite3__wasm_config_ii=e.asm.sqlite3__wasm_config_ii).apply(null,arguments)},Wa=e._sqlite3__wasm_config_j=function(){return(Wa=e._sqlite3__wasm_config_j=e.asm.sqlite3__wasm_config_j).apply(null,arguments)},Ua=e._sqlite3__wasm_qfmt_token=function(){return(Ua=e._sqlite3__wasm_qfmt_token=e.asm.sqlite3__wasm_qfmt_token).apply(null,arguments)},Qa=e._sqlite3__wasm_init_wasmfs=function(){return(Qa=e._sqlite3__wasm_init_wasmfs=e.asm.sqlite3__wasm_init_wasmfs).apply(null,arguments)},Ha=e._sqlite3__wasm_test_intptr=function(){return(Ha=e._sqlite3__wasm_test_intptr=e.asm.sqlite3__wasm_test_intptr).apply(null,arguments)},Va=e._sqlite3__wasm_test_voidptr=function(){return(Va=e._sqlite3__wasm_test_voidptr=e.asm.sqlite3__wasm_test_voidptr).apply(null,arguments)},Ga=e._sqlite3__wasm_test_int64_max=function(){return(Ga=e._sqlite3__wasm_test_int64_max=e.asm.sqlite3__wasm_test_int64_max).apply(null,arguments)},$a=e._sqlite3__wasm_test_int64_min=function(){return($a=e._sqlite3__wasm_test_int64_min=e.asm.sqlite3__wasm_test_int64_min).apply(null,arguments)},Ka=e._sqlite3__wasm_test_int64_times2=function(){return(Ka=e._sqlite3__wasm_test_int64_times2=e.asm.sqlite3__wasm_test_int64_times2).apply(null,arguments)},Ja=e._sqlite3__wasm_test_int64_minmax=function(){return(Ja=e._sqlite3__wasm_test_int64_minmax=e.asm.sqlite3__wasm_test_int64_minmax).apply(null,arguments)},Xa=e._sqlite3__wasm_test_int64ptr=function(){return(Xa=e._sqlite3__wasm_test_int64ptr=e.asm.sqlite3__wasm_test_int64ptr).apply(null,arguments)},Ya=e._sqlite3__wasm_test_stack_overflow=function(){return(Ya=e._sqlite3__wasm_test_stack_overflow=e.asm.sqlite3__wasm_test_stack_overflow).apply(null,arguments)},Za=e._sqlite3__wasm_test_str_hello=function(){return(Za=e._sqlite3__wasm_test_str_hello=e.asm.sqlite3__wasm_test_str_hello).apply(null,arguments)},el=e._sqlite3__wasm_SQLTester_strglob=function(){return(el=e._sqlite3__wasm_SQLTester_strglob=e.asm.sqlite3__wasm_SQLTester_strglob).apply(null,arguments)},nn=e._malloc=function(){return(nn=e._malloc=e.asm.malloc).apply(null,arguments)},tl=e._free=function(){return(tl=e._free=e.asm.free).apply(null,arguments)},nl=e._realloc=function(){return(nl=e._realloc=e.asm.realloc).apply(null,arguments)},rn=e._emscripten_builtin_memalign=function(){return(rn=e._emscripten_builtin_memalign=e.asm.emscripten_builtin_memalign).apply(null,arguments)},rl=e.stackSave=function(){return(rl=e.stackSave=e.asm.stackSave).apply(null,arguments)},sl=e.stackRestore=function(){return(sl=e.stackRestore=e.asm.stackRestore).apply(null,arguments)},il=e.stackAlloc=function(){return(il=e.stackAlloc=e.asm.stackAlloc).apply(null,arguments)};e.wasmMemory=Ve;var yt;at=function n(){yt||sn(),yt||(at=n)};function sn(n){if(n=n||ye,Je>0||(kn(),Je>0))return;function t(){yt||(yt=!0,e.calledRun=!0,!Ct&&(In(),B(e),e.onRuntimeInitialized&&e.onRuntimeInitialized(),Tn()))}e.setStatus?(e.setStatus("Running..."),setTimeout(function(){setTimeout(function(){e.setStatus("")},1),t()},1)):t()}if(e.preInit)for(typeof e.preInit=="function"&&(e.preInit=[e.preInit]);e.preInit.length>0;)e.preInit.pop()();return sn(),e.postRun||(e.postRun=[]),e.postRun.push(function(n){"use strict";"use strict";if(globalThis.sqlite3ApiBootstrap=function t(i=globalThis.sqlite3ApiConfig||t.defaultConfig){if(t.sqlite3)return(t.sqlite3.config||console).warn("sqlite3ApiBootstrap() called multiple times.","Config and external initializers are ignored on calls after the first."),t.sqlite3;let o=Object.assign(Object.create(null),{exports:void 0,memory:void 0,bigIntEnabled:typeof n<"u"&&n.HEAPU64?!0:!!globalThis.BigInt64Array,debug:console.debug.bind(console),warn:console.warn.bind(console),error:console.error.bind(console),log:console.log.bind(console),wasmfsOpfsDir:"/opfs",useStdAlloc:!1},i||{});Object.assign(o,{allocExportName:o.useStdAlloc?"malloc":"sqlite3_malloc",deallocExportName:o.useStdAlloc?"free":"sqlite3_free",reallocExportName:o.useStdAlloc?"realloc":"sqlite3_realloc"},o),["exports","memory","wasmfsOpfsDir"].forEach(l=>{typeof o[l]=="function"&&(o[l]=o[l]())}),delete globalThis.sqlite3ApiConfig,delete t.defaultConfig;let r=Object.create(null),s=Object.create(null),p=l=>r.sqlite3_js_rc_str&&r.sqlite3_js_rc_str(l)||"Unknown result code #"+l,h=l=>typeof l=="number"&&l===(l|0);class R extends Error{constructor(...c){let u;if(c.length)if(h(c[0]))if(u=c[0],c.length===1)super(p(c[0]));else{let y=p(u);typeof c[1]=="object"?super(y,c[1]):(c[0]=y+":",super(c.join(" ")))}else c.length===2&&typeof c[1]=="object"?super(...c):super(c.join(" "));this.resultCode=u||r.SQLITE_ERROR,this.name="SQLite3Error"}}R.toss=(...l)=>{throw new R(...l)};let C=R.toss;o.wasmfsOpfsDir&&!/^\/[^/]+$/.test(o.wasmfsOpfsDir)&&C("config.wasmfsOpfsDir must be falsy or in the form '/dir-name'.");let Q=l=>typeof l!="bigint"&&l===(l|0)&&l<=2147483647&&l>=-2147483648,U=function l(c){return l._max||(l._max=BigInt("0x7fffffffffffffff"),l._min=~l._max),c>=l._min&&c<=l._max},G=l=>l>=-0x7fffffffn-1n&&l<=0x7fffffffn,A=function l(c){return l._min||(l._min=Number.MIN_SAFE_INTEGER,l._max=Number.MAX_SAFE_INTEGER),c>=l._min&&c<=l._max},I=l=>l&&l.constructor&&Q(l.constructor.BYTES_PER_ELEMENT)?l:!1,O=typeof SharedArrayBuffer>"u"?function(){}:SharedArrayBuffer,x=l=>l.buffer instanceof O,b=(l,c,u)=>x(l)?l.slice(c,u):l.subarray(c,u),F=l=>l&&(l instanceof Uint8Array||l instanceof Int8Array||l instanceof ArrayBuffer),j=l=>l&&(l instanceof Uint8Array||l instanceof Int8Array||l instanceof ArrayBuffer),z=l=>F(l)||C("Value is not of a supported TypedArray type."),w=new TextDecoder("utf-8"),H=function(l,c,u){return w.decode(b(l,c,u))},_=function(l){return j(l)?H(l instanceof ArrayBuffer?new Uint8Array(l):l):Array.isArray(l)?l.join(""):(s.isPtr(l)&&(l=s.cstrToJs(l)),l)};class f extends Error{constructor(...c){c.length===2&&typeof c[1]=="object"?super(...c):c.length?super(c.join(" ")):super("Allocation failed."),this.resultCode=r.SQLITE_NOMEM,this.name="WasmAllocError"}}f.toss=(...l)=>{throw new f(...l)},Object.assign(r,{sqlite3_bind_blob:void 0,sqlite3_bind_text:void 0,sqlite3_create_function_v2:(l,c,u,y,W,Z,_e,oe,de)=>{},sqlite3_create_function:(l,c,u,y,W,Z,_e,oe)=>{},sqlite3_create_window_function:(l,c,u,y,W,Z,_e,oe,de,he)=>{},sqlite3_prepare_v3:(l,c,u,y,W,Z)=>{},sqlite3_prepare_v2:(l,c,u,y,W)=>{},sqlite3_exec:(l,c,u,y,W)=>{},sqlite3_randomness:(l,c)=>{}});let S={affirmBindableTypedArray:z,flexibleString:_,bigIntFits32:G,bigIntFits64:U,bigIntFitsDouble:A,isBindableTypedArray:F,isInt32:Q,isSQLableTypedArray:j,isTypedArray:I,typedArrayToString:H,isUIThread:()=>globalThis.window===globalThis&&!!globalThis.document,isSharedTypedArray:x,toss:function(...l){throw new Error(l.join(" "))},toss3:C,typedArrayPart:b,affirmDbHeader:function(l){l instanceof ArrayBuffer&&(l=new Uint8Array(l));let c="SQLite format 3";c.length>l.byteLength&&C("Input does not contain an SQLite3 database header.");for(let u=0;u<c.length;++u)c.charCodeAt(u)!==l[u]&&C("Input does not contain an SQLite3 database header.")},affirmIsDb:function(l){l instanceof ArrayBuffer&&(l=new Uint8Array(l));let c=l.byteLength;(c<512||c%512!==0)&&C("Byte array size",c,"is invalid for an SQLite3 db."),S.affirmDbHeader(l)}};Object.assign(s,{ptrSizeof:o.wasmPtrSizeof||4,ptrIR:o.wasmPtrIR||"i32",bigIntEnabled:!!o.bigIntEnabled,exports:o.exports||C("Missing API config.exports (WASM module exports)."),memory:o.memory||o.exports.memory||C("API config object requires a WebAssembly.Memory object","in either config.exports.memory (exported)","or config.memory (imported)."),alloc:void 0,realloc:void 0,dealloc:void 0}),s.allocFromTypedArray=function(l){l instanceof ArrayBuffer&&(l=new Uint8Array(l)),z(l);let c=s.alloc(l.byteLength||1);return s.heapForSize(l.constructor).set(l.byteLength?l:[0],c),c};{let l=o.allocExportName,c=o.deallocExportName,u=o.reallocExportName;for(let y of[l,c,u])s.exports[y]instanceof Function||C("Missing required exports[",y,"] function.");s.alloc=function y(W){return y.impl(W)||f.toss("Failed to allocate",W," bytes.")},s.alloc.impl=s.exports[l],s.realloc=function y(W,Z){let _e=y.impl(W,Z);return Z?_e||f.toss("Failed to reallocate",Z," bytes."):0},s.realloc.impl=s.exports[u],s.dealloc=s.exports[c]}s.compileOptionUsed=function l(c){if(arguments.length){if(Array.isArray(c)){let u={};return c.forEach(y=>{u[y]=r.sqlite3_compileoption_used(y)}),u}else if(typeof c=="object")return Object.keys(c).forEach(u=>{c[u]=r.sqlite3_compileoption_used(u)}),c}else{if(l._result)return l._result;l._opt||(l._rx=/^([^=]+)=(.+)/,l._rxInt=/^-?\d+$/,l._opt=function(_e,oe){let de=l._rx.exec(_e);oe[0]=de?de[1]:_e,oe[1]=de?l._rxInt.test(de[2])?+de[2]:de[2]:!0});let u={},y=[0,0],W=0,Z;for(;Z=r.sqlite3_compileoption_get(W++);)l._opt(Z,y),u[y[0]]=y[1];return l._result=u}return typeof c=="string"?!!r.sqlite3_compileoption_used(c):!1},s.pstack=Object.assign(Object.create(null),{restore:s.exports.sqlite3__wasm_pstack_restore,alloc:function(l){return typeof l=="string"&&!(l=s.sizeofIR(l))&&f.toss("Invalid value for pstack.alloc(",arguments[0],")"),s.exports.sqlite3__wasm_pstack_alloc(l)||f.toss("Could not allocate",l,"bytes from the pstack.")},allocChunks:function(l,c){typeof c=="string"&&!(c=s.sizeofIR(c))&&f.toss("Invalid size value for allocChunks(",arguments[1],")");let u=s.pstack.alloc(l*c),y=[],W=0,Z=0;for(;W<l;++W,Z+=c)y.push(u+Z);return y},allocPtr:(l=1,c=!0)=>l===1?s.pstack.alloc(c?8:s.ptrSizeof):s.pstack.allocChunks(l,c?8:s.ptrSizeof),call:function(l){let c=s.pstack.pointer;try{return l(d)}finally{s.pstack.restore(c)}}}),Object.defineProperties(s.pstack,{pointer:{configurable:!1,iterable:!0,writeable:!1,get:s.exports.sqlite3__wasm_pstack_ptr},quota:{configurable:!1,iterable:!0,writeable:!1,get:s.exports.sqlite3__wasm_pstack_quota},remaining:{configurable:!1,iterable:!0,writeable:!1,get:s.exports.sqlite3__wasm_pstack_remaining}}),r.sqlite3_randomness=(...l)=>{if(l.length===1&&S.isTypedArray(l[0])&&l[0].BYTES_PER_ELEMENT===1){let c=l[0];if(c.byteLength===0)return s.exports.sqlite3_randomness(0,0),c;let u=s.pstack.pointer;try{let y=c.byteLength,W=0,Z=s.exports.sqlite3_randomness,_e=s.heap8u(),oe=y<512?y:512,de=s.pstack.alloc(oe);do{let he=y>oe?oe:y;Z(he,de),c.set(b(_e,de,de+he),W),y-=he,W+=he}while(y>0)}catch(y){console.error("Highly unexpected (and ignored!) exception in sqlite3_randomness():",y)}finally{s.pstack.restore(u)}return c}s.exports.sqlite3_randomness(...l)};let L;if(r.sqlite3_wasmfs_opfs_dir=function(){if(L!==void 0)return L;let l=o.wasmfsOpfsDir;if(!l||!globalThis.FileSystemHandle||!globalThis.FileSystemDirectoryHandle||!globalThis.FileSystemFileHandle)return L="";try{return l&&s.xCallWrapped("sqlite3__wasm_init_wasmfs","i32",["string"],l)===0?L=l:L=""}catch{return L=""}},r.sqlite3_wasmfs_filename_is_persistent=function(l){let c=r.sqlite3_wasmfs_opfs_dir();return c&&l?l.startsWith(c+"/"):!1},r.sqlite3_js_db_uses_vfs=function(l,c,u=0){try{let y=r.sqlite3_vfs_find(c);return y?l?y===r.sqlite3_js_db_vfs(l,u)?y:!1:y===r.sqlite3_vfs_find(0)?y:!1:!1}catch{return!1}},r.sqlite3_js_vfs_list=function(){let l=[],c=r.sqlite3_vfs_find(0);for(;c;){let u=new r.sqlite3_vfs(c);l.push(s.cstrToJs(u.$zName)),c=u.$pNext,u.dispose()}return l},r.sqlite3_js_db_export=function(l,c=0){l=s.xWrap.testConvertArg("sqlite3*",l),l||C("Invalid sqlite3* argument."),s.bigIntEnabled||C("BigInt64 support is not enabled.");let u=s.scopedAllocPush(),y;try{let W=s.scopedAlloc(8+s.ptrSizeof),Z=W+8,_e=c?s.isPtr(c)?c:s.scopedAllocCString(""+c):0,oe=s.exports.sqlite3__wasm_db_serialize(l,_e,Z,W,0);oe&&C("Database serialization failed with code",d.capi.sqlite3_js_rc_str(oe)),y=s.peekPtr(Z);let de=s.peek(W,"i64");return oe=de?s.heap8u().slice(y,y+Number(de)):new Uint8Array,oe}finally{y&&s.exports.sqlite3_free(y),s.scopedAllocPop(u)}},r.sqlite3_js_db_vfs=(l,c=0)=>S.sqlite3__wasm_db_vfs(l,c),r.sqlite3_js_aggregate_context=(l,c)=>r.sqlite3_aggregate_context(l,c)||(c?f.toss("Cannot allocate",c,"bytes for sqlite3_aggregate_context()"):0),r.sqlite3_js_posix_create_file=function(l,c,u){let y;c&&s.isPtr(c)?y=c:c instanceof ArrayBuffer||c instanceof Uint8Array?(y=s.allocFromTypedArray(c),(arguments.length<3||!S.isInt32(u)||u<0)&&(u=c.byteLength)):R.toss("Invalid 2nd argument for sqlite3_js_posix_create_file().");try{(!S.isInt32(u)||u<0)&&R.toss("Invalid 3rd argument for sqlite3_js_posix_create_file().");let W=S.sqlite3__wasm_posix_create_file(l,y,u);W&&R.toss("Creation of file failed with sqlite3 result code",r.sqlite3_js_rc_str(W))}finally{s.dealloc(y)}},r.sqlite3_js_vfs_create_file=function(l,c,u,y){o.warn("sqlite3_js_vfs_create_file() is deprecated and","should be avoided because it can lead to C-level crashes.","See its documentation for alternative options.");let W;u?(s.isPtr(u)?W=u:u instanceof ArrayBuffer&&(u=new Uint8Array(u)),u instanceof Uint8Array?(W=s.allocFromTypedArray(u),(arguments.length<4||!S.isInt32(y)||y<0)&&(y=u.byteLength)):R.toss("Invalid 3rd argument type for sqlite3_js_vfs_create_file().")):W=0,(!S.isInt32(y)||y<0)&&(s.dealloc(W),R.toss("Invalid 4th argument for sqlite3_js_vfs_create_file()."));try{let Z=S.sqlite3__wasm_vfs_create_file(l,c,W,y);Z&&R.toss("Creation of file failed with sqlite3 result code",r.sqlite3_js_rc_str(Z))}finally{s.dealloc(W)}},r.sqlite3_js_sql_to_string=l=>{if(typeof l=="string")return l;let c=_(v);return c===v?void 0:c},S.isUIThread()){let l=function(c){let u=Object.create(null);return u.prefix="kvvfs-"+c,u.stores=[],(c==="session"||c==="")&&u.stores.push(globalThis.sessionStorage),(c==="local"||c==="")&&u.stores.push(globalThis.localStorage),u};r.sqlite3_js_kvvfs_clear=function(c=""){let u=0,y=l(c);return y.stores.forEach(W=>{let Z=[],_e;for(_e=0;_e<W.length;++_e){let oe=W.key(_e);oe.startsWith(y.prefix)&&Z.push(oe)}Z.forEach(oe=>W.removeItem(oe)),u+=Z.length}),u},r.sqlite3_js_kvvfs_size=function(c=""){let u=0,y=l(c);return y.stores.forEach(W=>{let Z;for(Z=0;Z<W.length;++Z){let _e=W.key(Z);_e.startsWith(y.prefix)&&(u+=_e.length,u+=W.getItem(_e).length)}}),u*2}}r.sqlite3_db_config=function(l,c,...u){switch(this.s||(this.s=s.xWrap("sqlite3__wasm_db_config_s","int",["sqlite3*","int","string:static"]),this.pii=s.xWrap("sqlite3__wasm_db_config_pii","int",["sqlite3*","int","*","int","int"]),this.ip=s.xWrap("sqlite3__wasm_db_config_ip","int",["sqlite3*","int","int","*"])),c){case r.SQLITE_DBCONFIG_ENABLE_FKEY:case r.SQLITE_DBCONFIG_ENABLE_TRIGGER:case r.SQLITE_DBCONFIG_ENABLE_FTS3_TOKENIZER:case r.SQLITE_DBCONFIG_ENABLE_LOAD_EXTENSION:case r.SQLITE_DBCONFIG_NO_CKPT_ON_CLOSE:case r.SQLITE_DBCONFIG_ENABLE_QPSG:case r.SQLITE_DBCONFIG_TRIGGER_EQP:case r.SQLITE_DBCONFIG_RESET_DATABASE:case r.SQLITE_DBCONFIG_DEFENSIVE:case r.SQLITE_DBCONFIG_WRITABLE_SCHEMA:case r.SQLITE_DBCONFIG_LEGACY_ALTER_TABLE:case r.SQLITE_DBCONFIG_DQS_DML:case r.SQLITE_DBCONFIG_DQS_DDL:case r.SQLITE_DBCONFIG_ENABLE_VIEW:case r.SQLITE_DBCONFIG_LEGACY_FILE_FORMAT:case r.SQLITE_DBCONFIG_TRUSTED_SCHEMA:case r.SQLITE_DBCONFIG_STMT_SCANSTATUS:case r.SQLITE_DBCONFIG_REVERSE_SCANORDER:return this.ip(l,c,u[0],u[1]||0);case r.SQLITE_DBCONFIG_LOOKASIDE:return this.pii(l,c,u[0],u[1],u[2]);case r.SQLITE_DBCONFIG_MAINDBNAME:return this.s(l,c,u[0]);default:return r.SQLITE_MISUSE}}.bind(Object.create(null)),r.sqlite3_value_to_js=function(l,c=!0){let u,y=r.sqlite3_value_type(l);switch(y){case r.SQLITE_INTEGER:s.bigIntEnabled?(u=r.sqlite3_value_int64(l),S.bigIntFitsDouble(u)&&(u=Number(u))):u=r.sqlite3_value_double(l);break;case r.SQLITE_FLOAT:u=r.sqlite3_value_double(l);break;case r.SQLITE_TEXT:u=r.sqlite3_value_text(l);break;case r.SQLITE_BLOB:{let W=r.sqlite3_value_bytes(l),Z=r.sqlite3_value_blob(l);W&&!Z&&d.WasmAllocError.toss("Cannot allocate memory for blob argument of",W,"byte(s)"),u=W?s.heap8u().slice(Z,Z+Number(W)):null;break}case r.SQLITE_NULL:u=null;break;default:c&&C(r.SQLITE_MISMATCH,"Unhandled sqlite3_value_type():",y),u=void 0}return u},r.sqlite3_values_to_js=function(l,c,u=!0){let y,W=[];for(y=0;y<l;++y)W.push(r.sqlite3_value_to_js(s.peekPtr(c+s.ptrSizeof*y),u));return W},r.sqlite3_result_error_js=function(l,c){c instanceof f?r.sqlite3_result_error_nomem(l):r.sqlite3_result_error(l,""+c,-1)},r.sqlite3_result_js=function(l,c){if(c instanceof Error){r.sqlite3_result_error_js(l,c);return}try{switch(typeof c){case"undefined":break;case"boolean":r.sqlite3_result_int(l,c?1:0);break;case"bigint":S.bigIntFits32(c)?r.sqlite3_result_int(l,Number(c)):S.bigIntFitsDouble(c)?r.sqlite3_result_double(l,Number(c)):s.bigIntEnabled?S.bigIntFits64(c)?r.sqlite3_result_int64(l,c):C("BigInt value",c.toString(),"is too BigInt for int64."):C("BigInt value",c.toString(),"is too BigInt.");break;case"number":{let u;S.isInt32(c)?u=r.sqlite3_result_int:s.bigIntEnabled&&Number.isInteger(c)&&S.bigIntFits64(BigInt(c))?u=r.sqlite3_result_int64:u=r.sqlite3_result_double,u(l,c);break}case"string":{let[u,y]=s.allocCString(c,!0);r.sqlite3_result_text(l,u,y,r.SQLITE_WASM_DEALLOC);break}case"object":if(c===null){r.sqlite3_result_null(l);break}else if(S.isBindableTypedArray(c)){let u=s.allocFromTypedArray(c);r.sqlite3_result_blob(l,u,c.byteLength,r.SQLITE_WASM_DEALLOC);break}default:C("Don't not how to handle this UDF result value:",typeof c,c)}}catch(u){r.sqlite3_result_error_js(l,u)}},r.sqlite3_column_js=function(l,c,u=!0){let y=r.sqlite3_column_value(l,c);return y===0?void 0:r.sqlite3_value_to_js(y,u)};let D=function(l,c,u){u=r[u],this.ptr?s.pokePtr(this.ptr,0):this.ptr=s.allocPtr();let y=u(l,c,this.ptr);if(y)return R.toss(y,arguments[2]+"() failed with code "+y);let W=s.peekPtr(this.ptr);return W?r.sqlite3_value_to_js(W,!0):void 0}.bind(Object.create(null));r.sqlite3_preupdate_new_js=(l,c)=>D(l,c,"sqlite3_preupdate_new"),r.sqlite3_preupdate_old_js=(l,c)=>D(l,c,"sqlite3_preupdate_old"),r.sqlite3changeset_new_js=(l,c)=>D(l,c,"sqlite3changeset_new"),r.sqlite3changeset_old_js=(l,c)=>D(l,c,"sqlite3changeset_old");let d={WasmAllocError:f,SQLite3Error:R,capi:r,util:S,wasm:s,config:o,version:Object.create(null),client:void 0,asyncPostInit:async function l(){if(l.isReady instanceof Promise)return l.isReady;let c=t.initializersAsync;delete t.initializersAsync;let u=async()=>(d.__isUnderTest||(delete d.util,delete d.StructBinder),d),y=Z=>{throw o.error("an async sqlite3 initializer failed:",Z),Z};if(!c||!c.length)return l.isReady=u().catch(y);c=c.map(Z=>Z instanceof Function?async _e=>Z(d):Z),c.push(u);let W=Promise.resolve(d);for(;c.length;)W=W.then(c.shift());return l.isReady=W.catch(y)},scriptInfo:void 0};try{t.initializers.forEach(l=>{l(d)})}catch(l){throw console.error("sqlite3 bootstrap initializer threw:",l),l}return delete t.initializers,t.sqlite3=d,d},globalThis.sqlite3ApiBootstrap.initializers=[],globalThis.sqlite3ApiBootstrap.initializersAsync=[],globalThis.sqlite3ApiBootstrap.defaultConfig=Object.create(null),globalThis.sqlite3ApiBootstrap.sqlite3=void 0,globalThis.WhWasmUtilInstaller=function(t){"use strict";t.bigIntEnabled===void 0&&(t.bigIntEnabled=!!globalThis.BigInt64Array);let i=(..._)=>{throw new Error(_.join(" "))};t.exports||Object.defineProperty(t,"exports",{enumerable:!0,configurable:!0,get:()=>t.instance&&t.instance.exports});let o=t.pointerIR||"i32",r=t.ptrSizeof=o==="i32"?4:o==="i64"?8:i("Unhandled ptrSizeof:",o),s=Object.create(null);s.heapSize=0,s.memory=null,s.freeFuncIndexes=[],s.scopedAlloc=[],s.utf8Decoder=new TextDecoder,s.utf8Encoder=new TextEncoder("utf-8"),t.sizeofIR=_=>{switch(_){case"i8":return 1;case"i16":return 2;case"i32":case"f32":case"float":return 4;case"i64":case"f64":case"double":return 8;case"*":return r;default:return(""+_).endsWith("*")?r:void 0}};let p=function(){if(!s.memory)s.memory=t.memory instanceof WebAssembly.Memory?t.memory:t.exports.memory;else if(s.heapSize===s.memory.buffer.byteLength)return s;let _=s.memory.buffer;return s.HEAP8=new Int8Array(_),s.HEAP8U=new Uint8Array(_),s.HEAP16=new Int16Array(_),s.HEAP16U=new Uint16Array(_),s.HEAP32=new Int32Array(_),s.HEAP32U=new Uint32Array(_),t.bigIntEnabled&&(s.HEAP64=new BigInt64Array(_),s.HEAP64U=new BigUint64Array(_)),s.HEAP32F=new Float32Array(_),s.HEAP64F=new Float64Array(_),s.heapSize=_.byteLength,s};t.heap8=()=>p().HEAP8,t.heap8u=()=>p().HEAP8U,t.heap16=()=>p().HEAP16,t.heap16u=()=>p().HEAP16U,t.heap32=()=>p().HEAP32,t.heap32u=()=>p().HEAP32U,t.heapForSize=function(_,f=!0){let S,L=s.memory&&s.heapSize===s.memory.buffer.byteLength?s:p();switch(_){case Int8Array:return L.HEAP8;case Uint8Array:return L.HEAP8U;case Int16Array:return L.HEAP16;case Uint16Array:return L.HEAP16U;case Int32Array:return L.HEAP32;case Uint32Array:return L.HEAP32U;case 8:return f?L.HEAP8U:L.HEAP8;case 16:return f?L.HEAP16U:L.HEAP16;case 32:return f?L.HEAP32U:L.HEAP32;case 64:if(L.HEAP64)return f?L.HEAP64U:L.HEAP64;break;default:if(t.bigIntEnabled){if(_===globalThis.BigUint64Array)return L.HEAP64U;if(_===globalThis.BigInt64Array)return L.HEAP64;break}}i("Invalid heapForSize() size: expecting 8, 16, 32,","or (if BigInt is enabled) 64.")},t.functionTable=function(){return t.exports.__indirect_function_table},t.functionEntry=function(_){let f=t.functionTable();return _<f.length?f.get(_):void 0},t.jsFuncToWasm=function _(f,S){if(_._||(_._={sigTypes:Object.assign(Object.create(null),{i:"i32",p:"i32",P:"i32",s:"i32",j:"i64",f:"f32",d:"f64"}),typeCodes:Object.assign(Object.create(null),{f64:124,f32:125,i64:126,i32:127}),uleb128Encode:function(d,l,c){c<128?d[l](c):d[l](c%128|128,c>>7)},rxJSig:/^(\w)\((\w*)\)$/,sigParams:function(d){let l=_._.rxJSig.exec(d);return l?l[2]:d.substr(1)},letterType:d=>_._.sigTypes[d]||i("Invalid signature letter:",d),pushSigType:(d,l)=>d.push(_._.typeCodes[_._.letterType(l)])}),typeof f=="string"){let d=S;S=f,f=d}let L=_._.sigParams(S),D=[1,96];_._.uleb128Encode(D,"push",L.length);for(let d of L)_._.pushSigType(D,d);return S[0]==="v"?D.push(0):(D.push(1),_._.pushSigType(D,S[0])),_._.uleb128Encode(D,"unshift",D.length),D.unshift(0,97,115,109,1,0,0,0,1),D.push(2,7,1,1,101,1,102,0,0,7,5,1,1,102,0,0),new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array(D)),{e:{f}}).exports.f};let h=function(f,S,L){if(L&&!s.scopedAlloc.length&&i("No scopedAllocPush() scope is active."),typeof f=="string"){let c=S;S=f,f=c}(typeof S!="string"||!(f instanceof Function))&&i("Invalid arguments: expecting (function,signature) or (signature,function).");let D=t.functionTable(),d=D.length,l;for(;s.freeFuncIndexes.length&&(l=s.freeFuncIndexes.pop(),D.get(l));){l=null;continue}l||(l=d,D.grow(1));try{return D.set(l,f),L&&s.scopedAlloc[s.scopedAlloc.length-1].push(l),l}catch(c){if(!(c instanceof TypeError))throw l===d&&s.freeFuncIndexes.push(d),c}try{let c=t.jsFuncToWasm(f,S);D.set(l,c),L&&s.scopedAlloc[s.scopedAlloc.length-1].push(l)}catch(c){throw l===d&&s.freeFuncIndexes.push(d),c}return l};t.installFunction=(_,f)=>h(_,f,!1),t.scopedInstallFunction=(_,f)=>h(_,f,!0),t.uninstallFunction=function(_){if(!_&&_!==0)return;let f=s.freeFuncIndexes,S=t.functionTable();f.push(_);let L=S.get(_);return S.set(_,null),L},t.peek=function(f,S="i8"){S.endsWith("*")&&(S=o);let L=s.memory&&s.heapSize===s.memory.buffer.byteLength?s:p(),D=Array.isArray(f)?[]:void 0,d;do{switch(D&&(f=arguments[0].shift()),S){case"i1":case"i8":d=L.HEAP8[f>>0];break;case"i16":d=L.HEAP16[f>>1];break;case"i32":d=L.HEAP32[f>>2];break;case"float":case"f32":d=L.HEAP32F[f>>2];break;case"double":case"f64":d=Number(L.HEAP64F[f>>3]);break;case"i64":if(t.bigIntEnabled){d=BigInt(L.HEAP64[f>>3]);break}default:i("Invalid type for peek():",S)}D&&D.push(d)}while(D&&arguments[0].length);return D||d},t.poke=function(_,f,S="i8"){S.endsWith("*")&&(S=o);let L=s.memory&&s.heapSize===s.memory.buffer.byteLength?s:p();for(let D of Array.isArray(_)?_:[_])switch(S){case"i1":case"i8":L.HEAP8[D>>0]=f;continue;case"i16":L.HEAP16[D>>1]=f;continue;case"i32":L.HEAP32[D>>2]=f;continue;case"float":case"f32":L.HEAP32F[D>>2]=f;continue;case"double":case"f64":L.HEAP64F[D>>3]=f;continue;case"i64":if(L.HEAP64){L.HEAP64[D>>3]=BigInt(f);continue}default:i("Invalid type for poke(): "+S)}return this},t.peekPtr=(..._)=>t.peek(_.length===1?_[0]:_,o),t.pokePtr=(_,f=0)=>t.poke(_,f,o),t.peek8=(..._)=>t.peek(_.length===1?_[0]:_,"i8"),t.poke8=(_,f)=>t.poke(_,f,"i8"),t.peek16=(..._)=>t.peek(_.length===1?_[0]:_,"i16"),t.poke16=(_,f)=>t.poke(_,f,"i16"),t.peek32=(..._)=>t.peek(_.length===1?_[0]:_,"i32"),t.poke32=(_,f)=>t.poke(_,f,"i32"),t.peek64=(..._)=>t.peek(_.length===1?_[0]:_,"i64"),t.poke64=(_,f)=>t.poke(_,f,"i64"),t.peek32f=(..._)=>t.peek(_.length===1?_[0]:_,"f32"),t.poke32f=(_,f)=>t.poke(_,f,"f32"),t.peek64f=(..._)=>t.peek(_.length===1?_[0]:_,"f64"),t.poke64f=(_,f)=>t.poke(_,f,"f64"),t.getMemValue=t.peek,t.getPtrValue=t.peekPtr,t.setMemValue=t.poke,t.setPtrValue=t.pokePtr,t.isPtr32=_=>typeof _=="number"&&_===(_|0)&&_>=0,t.isPtr=t.isPtr32,t.cstrlen=function(_){if(!_||!t.isPtr(_))return null;let f=p().HEAP8U,S=_;for(;f[S]!==0;++S);return S-_};let R=typeof SharedArrayBuffer>"u"?function(){}:SharedArrayBuffer,C=function(_,f,S){return s.utf8Decoder.decode(_.buffer instanceof R?_.slice(f,S):_.subarray(f,S))};t.cstrToJs=function(_){let f=t.cstrlen(_);return f?C(p().HEAP8U,_,_+f):f===null?f:""},t.jstrlen=function(_){if(typeof _!="string")return null;let f=_.length,S=0;for(let L=0;L<f;++L){let D=_.charCodeAt(L);D>=55296&&D<=57343&&(D=65536+((D&1023)<<10)|_.charCodeAt(++L)&1023),D<=127?++S:D<=2047?S+=2:D<=65535?S+=3:S+=4}return S},t.jstrcpy=function(_,f,S=0,L=-1,D=!0){if((!f||!(f instanceof Int8Array)&&!(f instanceof Uint8Array))&&i("jstrcpy() target must be an Int8Array or Uint8Array."),L<0&&(L=f.length-S),!(L>0)||!(S>=0))return 0;let d=0,l=_.length,c=S,u=S+L-(D?1:0);for(;d<l&&S<u;++d){let y=_.charCodeAt(d);if(y>=55296&&y<=57343&&(y=65536+((y&1023)<<10)|_.charCodeAt(++d)&1023),y<=127){if(S>=u)break;f[S++]=y}else if(y<=2047){if(S+1>=u)break;f[S++]=192|y>>6,f[S++]=128|y&63}else if(y<=65535){if(S+2>=u)break;f[S++]=224|y>>12,f[S++]=128|y>>6&63,f[S++]=128|y&63}else{if(S+3>=u)break;f[S++]=240|y>>18,f[S++]=128|y>>12&63,f[S++]=128|y>>6&63,f[S++]=128|y&63}}return D&&(f[S++]=0),S-c},t.cstrncpy=function(_,f,S){if((!_||!f)&&i("cstrncpy() does not accept NULL strings."),S<0)S=t.cstrlen(strPtr)+1;else if(!(S>0))return 0;let L=t.heap8u(),D=0,d;for(;D<S&&(d=L[f+D]);++D)L[_+D]=d;return D<S&&(L[_+D++]=0),D},t.jstrToUintArray=(_,f=!1)=>s.utf8Encoder.encode(f?_+"\0":_);let Q=(_,f)=>{(!(_.alloc instanceof Function)||!(_.dealloc instanceof Function))&&i("Object is missing alloc() and/or dealloc() function(s)","required by",f+"().")},U=function(_,f,S,L){if(Q(t,L),typeof _!="string")return null;{let D=s.utf8Encoder.encode(_),d=S(D.length+1),l=p().HEAP8U;return l.set(D,d),l[d+D.length]=0,f?[d,D.length]:d}};t.allocCString=(_,f=!1)=>U(_,f,t.alloc,"allocCString()"),t.scopedAllocPush=function(){Q(t,"scopedAllocPush");let _=[];return s.scopedAlloc.push(_),_},t.scopedAllocPop=function(_){Q(t,"scopedAllocPop");let f=arguments.length?s.scopedAlloc.indexOf(_):s.scopedAlloc.length-1;f<0&&i("Invalid state object for scopedAllocPop()."),arguments.length===0&&(_=s.scopedAlloc[f]),s.scopedAlloc.splice(f,1);for(let S;S=_.pop();)t.functionEntry(S)?t.uninstallFunction(S):t.dealloc(S)},t.scopedAlloc=function(_){s.scopedAlloc.length||i("No scopedAllocPush() scope is active.");let f=t.alloc(_);return s.scopedAlloc[s.scopedAlloc.length-1].push(f),f},Object.defineProperty(t.scopedAlloc,"level",{configurable:!1,enumerable:!1,get:()=>s.scopedAlloc.length,set:()=>i("The 'active' property is read-only.")}),t.scopedAllocCString=(_,f=!1)=>U(_,f,t.scopedAlloc,"scopedAllocCString()");let G=function(_,f){let S=t[_?"scopedAlloc":"alloc"]((f.length+1)*t.ptrSizeof),L=0;return f.forEach(D=>{t.pokePtr(S+t.ptrSizeof*L++,t[_?"scopedAllocCString":"allocCString"](""+D))}),t.pokePtr(S+t.ptrSizeof*L,0),S};t.scopedAllocMainArgv=_=>G(!0,_),t.allocMainArgv=_=>G(!1,_),t.cArgvToJs=(_,f)=>{let S=[];for(let L=0;L<_;++L){let D=t.peekPtr(f+t.ptrSizeof*L);S.push(D?t.cstrToJs(D):null)}return S},t.scopedAllocCall=function(_){t.scopedAllocPush();try{return _()}finally{t.scopedAllocPop()}};let A=function(_,f,S){Q(t,S);let L=f?"i64":o,D=t[S](_*(f?8:r));if(t.poke(D,0,L),_===1)return D;let d=[D];for(let l=1;l<_;++l)D+=f?8:r,d[l]=D,t.poke(D,0,L);return d};t.allocPtr=(_=1,f=!0)=>A(_,f,"alloc"),t.scopedAllocPtr=(_=1,f=!0)=>A(_,f,"scopedAlloc"),t.xGet=function(_){return t.exports[_]||i("Cannot find exported symbol:",_)};let I=(_,f)=>i(_+"() requires",f,"argument(s).");t.xCall=function(_,...f){let S=_ instanceof Function?_:t.xGet(_);return S instanceof Function||i("Exported symbol",_,"is not a function."),S.length!==f.length&&I(S===_?S.name:_,S.length),arguments.length===2&&Array.isArray(arguments[1])?S.apply(null,arguments[1]):S.apply(null,f)},s.xWrap=Object.create(null),s.xWrap.convert=Object.create(null),s.xWrap.convert.arg=new Map,s.xWrap.convert.result=new Map;let O=s.xWrap.convert.arg,x=s.xWrap.convert.result;t.bigIntEnabled&&O.set("i64",_=>BigInt(_));let b=o==="i32"?_=>_|0:_=>BigInt(_)|BigInt(0);O.set("i32",b).set("i16",_=>(_|0)&65535).set("i8",_=>(_|0)&255).set("f32",_=>Number(_).valueOf()).set("float",O.get("f32")).set("f64",O.get("f32")).set("double",O.get("f64")).set("int",O.get("i32")).set("null",_=>_).set(null,O.get("null")).set("**",b).set("*",b),x.set("*",b).set("pointer",b).set("number",_=>Number(_)).set("void",_=>{}).set("null",_=>_).set(null,x.get("null"));{let _=["i8","i16","i32","int","f32","float","f64","double"];t.bigIntEnabled&&_.push("i64");let f=O.get(o);for(let S of _)O.set(S+"*",f),x.set(S+"*",f),x.set(S,O.get(S)||i("Missing arg converter:",S))}let F=function(_){return typeof _=="string"?t.scopedAllocCString(_):_?b(_):null};O.set("string",F).set("utf8",F).set("pointer",F),x.set("string",_=>t.cstrToJs(_)).set("utf8",x.get("string")).set("string:dealloc",_=>{try{return _?t.cstrToJs(_):null}finally{t.dealloc(_)}}).set("utf8:dealloc",x.get("string:dealloc")).set("json",_=>JSON.parse(t.cstrToJs(_))).set("json:dealloc",_=>{try{return _?JSON.parse(t.cstrToJs(_)):null}finally{t.dealloc(_)}});let j=class{constructor(_){this.name=_.name||"unnamed adapter"}convertArg(_,f,S){i("AbstractArgAdapter must be subclassed.")}};O.FuncPtrAdapter=class Qe extends j{constructor(f){super(f),O.FuncPtrAdapter.warnOnUse&&console.warn("xArg.FuncPtrAdapter is an internal-only API","and is not intended to be invoked from","client-level code. Invoked with:",f),this.name=f.name||"unnamed",this.signature=f.signature,f.contextKey instanceof Function&&(this.contextKey=f.contextKey,f.bindScope||(f.bindScope="context")),this.bindScope=f.bindScope||i("FuncPtrAdapter options requires a bindScope (explicit or implied)."),Qe.bindScopes.indexOf(f.bindScope)<0&&i("Invalid options.bindScope ("+f.bindMod+") for FuncPtrAdapter. Expecting one of: ("+Qe.bindScopes.join(", ")+")"),this.isTransient=this.bindScope==="transient",this.isContext=this.bindScope==="context",this.isPermanent=this.bindScope==="permanent",this.singleton=this.bindScope==="singleton"?[]:void 0,this.callProxy=f.callProxy instanceof Function?f.callProxy:void 0}contextKey(f,S){return this}contextMap(f){let S=this.__cmap||(this.__cmap=new Map),L=S.get(f);return L===void 0&&S.set(f,L=[]),L}convertArg(f,S,L){let D=this.singleton;if(!D&&this.isContext&&(D=this.contextMap(this.contextKey(S,L))),D&&D[0]===f)return D[1];if(f instanceof Function){this.callProxy&&(f=this.callProxy(f));let d=h(f,this.signature,this.isTransient);if(Qe.debugFuncInstall&&Qe.debugOut("FuncPtrAdapter installed",this,this.contextKey(S,L),"@"+d,f),D){if(D[1]){Qe.debugFuncInstall&&Qe.debugOut("FuncPtrAdapter uninstalling",this,this.contextKey(S,L),"@"+D[1],f);try{s.scopedAlloc[s.scopedAlloc.length-1].push(D[1])}catch{}}D[0]=f,D[1]=d}return d}else if(t.isPtr(f)||f===null||f===void 0){if(D&&D[1]&&D[1]!==f){Qe.debugFuncInstall&&Qe.debugOut("FuncPtrAdapter uninstalling",this,this.contextKey(S,L),"@"+D[1],f);try{s.scopedAlloc[s.scopedAlloc.length-1].push(D[1])}catch{}D[0]=D[1]=f|0}return f||0}else throw new TypeError("Invalid FuncPtrAdapter argument type. Expecting a function pointer or a "+(this.name?this.name+" ":"")+"function matching signature "+this.signature+".")}},O.FuncPtrAdapter.warnOnUse=!1,O.FuncPtrAdapter.debugFuncInstall=!1,O.FuncPtrAdapter.debugOut=console.debug.bind(console),O.FuncPtrAdapter.bindScopes=["transient","context","singleton","permanent"];let z=_=>O.get(_)||i("Argument adapter not found:",_),w=_=>x.get(_)||i("Result adapter not found:",_);s.xWrap.convertArg=(_,...f)=>z(_)(...f),s.xWrap.convertArgNoCheck=(_,...f)=>O.get(_)(...f),s.xWrap.convertResult=(_,f)=>_===null?f:_?w(_)(f):void 0,s.xWrap.convertResultNoCheck=(_,f)=>_===null?f:_?x.get(_)(f):void 0,t.xWrap=function(_,f,...S){arguments.length===3&&Array.isArray(arguments[2])&&(S=arguments[2]),t.isPtr(_)&&(_=t.functionEntry(_)||i("Function pointer not found in WASM function table."));let L=_ instanceof Function,D=L?_:t.xGet(_);if(L&&(_=D.name||"unnamed function"),S.length!==D.length&&I(_,D.length),f===null&&D.length===0)return D;f!=null&&w(f);for(let l of S)l instanceof j?O.set(l,(...c)=>l.convertArg(...c)):z(l);let d=s.xWrap;return D.length===0?(...l)=>l.length?I(_,D.length):d.convertResult(f,D.call(null)):function(...l){l.length!==D.length&&I(_,D.length);let c=t.scopedAllocPush();try{let u=0;for(;u<l.length;++u)l[u]=d.convertArgNoCheck(S[u],l[u],l,u);return d.convertResultNoCheck(f,D.apply(null,l))}finally{t.scopedAllocPop(c)}}};let H=function(_,f,S,L,D,d){if(typeof S=="string"){if(f===1)return d.get(S);if(f===2){if(L)L instanceof Function||i(D,"requires a function argument.");else return delete d.get(S),_;return d.set(S,L),_}}i("Invalid arguments to",D)};return t.xWrap.resultAdapter=function _(f,S){return H(_,arguments.length,f,S,"resultAdapter()",x)},t.xWrap.argAdapter=function _(f,S){return H(_,arguments.length,f,S,"argAdapter()",O)},t.xWrap.FuncPtrAdapter=O.FuncPtrAdapter,t.xCallWrapped=function(_,f,S,...L){return Array.isArray(arguments[3])&&(L=arguments[3]),t.xWrap(_,f,S||[]).apply(null,L||[])},t.xWrap.testConvertArg=s.xWrap.convertArg,t.xWrap.testConvertResult=s.xWrap.convertResult,t},globalThis.WhWasmUtilInstaller.yawl=function(t){let i=()=>fetch(t.uri,{credentials:"same-origin"}),o=this,r=function(p){if(t.wasmUtilTarget){let h=(...C)=>{throw new Error(C.join(" "))},R=t.wasmUtilTarget;if(R.module=p.module,R.instance=p.instance,R.instance.exports.memory||(R.memory=t.imports&&t.imports.env&&t.imports.env.memory||h("Missing 'memory' object!")),!R.alloc&&p.instance.exports.malloc){let C=p.instance.exports;R.alloc=function(Q){return C.malloc(Q)||h("Allocation of",Q,"bytes failed.")},R.dealloc=function(Q){C.free(Q)}}o(R)}return t.onload&&t.onload(p,t),p};return WebAssembly.instantiateStreaming?function(){return WebAssembly.instantiateStreaming(i(),t.imports||{}).then(r)}:function(){return i().then(h=>h.arrayBuffer()).then(h=>WebAssembly.instantiate(h,t.imports||{})).then(r)}}.bind(globalThis.WhWasmUtilInstaller),globalThis.Jaccwabyt=function t(i){let o=(...T)=>{throw new Error(T.join(" "))};!(i.heap instanceof WebAssembly.Memory)&&!(i.heap instanceof Function)&&o("config.heap must be WebAssembly.Memory instance or a function."),["alloc","dealloc"].forEach(function(T){i[T]instanceof Function||o("Config option '"+T+"' must be a function.")});let r=t,s=i.heap instanceof Function?i.heap:()=>new Uint8Array(i.heap.buffer),p=i.alloc,h=i.dealloc,R=i.log||console.log.bind(console),C=i.memberPrefix||"",Q=i.memberSuffix||"",U=i.bigIntEnabled===void 0?!!globalThis.BigInt64Array:!!i.bigIntEnabled,G=globalThis.BigInt,A=globalThis.BigInt64Array,I=i.ptrSizeof||4,O=i.ptrIR||"i32";r.debugFlags||(r.__makeDebugFlags=function(T=null){T&&T.__flags&&(T=T.__flags);let Y=function ee(re){return arguments.length===0?ee.__flags:(re<0?(delete ee.__flags.getter,delete ee.__flags.setter,delete ee.__flags.alloc,delete ee.__flags.dealloc):(ee.__flags.getter=(1&re)!==0,ee.__flags.setter=(2&re)!==0,ee.__flags.alloc=(4&re)!==0,ee.__flags.dealloc=(8&re)!==0),ee._flags)};return Object.defineProperty(Y,"__flags",{iterable:!1,writable:!1,value:Object.create(T)}),T||Y(0),Y},r.debugFlags=r.__makeDebugFlags());let x=function(){let T=new ArrayBuffer(2);return new DataView(T).setInt16(0,256,!0),new Int16Array(T)[0]===256}(),b=T=>T[1]==="(",F=T=>T==="p"||T==="P",j=T=>T==="P",z=T=>b(T)?"p":T[0],w=function(T){switch(z(T)){case"c":case"C":return"i8";case"i":return"i32";case"p":case"P":case"s":return O;case"j":return"i64";case"f":return"float";case"d":return"double"}o("Unhandled signature IR:",T)},H=A?()=>!0:()=>o("BigInt64Array is not available."),_=function(T){switch(z(T)){case"p":case"P":case"s":{switch(I){case 4:return"getInt32";case 8:return H()&&"getBigInt64"}break}case"i":return"getInt32";case"c":return"getInt8";case"C":return"getUint8";case"j":return H()&&"getBigInt64";case"f":return"getFloat32";case"d":return"getFloat64"}o("Unhandled DataView getter for signature:",T)},f=function(T){switch(z(T)){case"p":case"P":case"s":{switch(I){case 4:return"setInt32";case 8:return H()&&"setBigInt64"}break}case"i":return"setInt32";case"c":return"setInt8";case"C":return"setUint8";case"j":return H()&&"setBigInt64";case"f":return"setFloat32";case"d":return"setFloat64"}o("Unhandled DataView setter for signature:",T)},S=function(T){switch(z(T)){case"i":case"f":case"c":case"C":case"d":return Number;case"j":return H()&&G;case"p":case"P":case"s":switch(I){case 4:return Number;case 8:return H()&&G}break}o("Unhandled DataView set wrapper for signature:",T)},L=(T,Y)=>T+"::"+Y,D=function(T,Y){return()=>o(L(T,Y),"is read-only.")},d=new WeakMap,l="(pointer-is-external)",c=function(T,Y,ee){if(ee||(ee=d.get(Y)),ee){if(d.delete(Y),Array.isArray(Y.ondispose)){let re;for(;re=Y.ondispose.shift();)try{re instanceof Function?re.call(Y):re instanceof ce?re.dispose():typeof re=="number"&&h(re)}catch(Ee){console.warn("ondispose() for",T.structName,"@",ee,"threw. NOT propagating it.",Ee)}}else if(Y.ondispose instanceof Function)try{Y.ondispose()}catch(re){console.warn("ondispose() for",T.structName,"@",ee,"threw. NOT propagating it.",re)}delete Y.ondispose,T.debugFlags.__flags.dealloc&&R("debug.dealloc:",Y[l]?"EXTERNAL":"",T.structName,"instance:",T.structInfo.sizeof,"bytes @"+ee),Y[l]||h(ee)}},u=T=>({configurable:!1,writable:!1,iterable:!1,value:T}),y=function(T,Y,ee){let re=!ee;ee?Object.defineProperty(Y,l,u(ee)):(ee=p(T.structInfo.sizeof),ee||o("Allocation of",T.structName,"structure failed."));try{T.debugFlags.__flags.alloc&&R("debug.alloc:",re?"":"EXTERNAL",T.structName,"instance:",T.structInfo.sizeof,"bytes @"+ee),re&&s().fill(0,ee,ee+T.structInfo.sizeof),d.set(Y,ee)}catch(Ee){throw c(T,Y,ee),Ee}},W=function(){let T=this.pointer;return T?new Uint8Array(s().slice(T,T+this.structInfo.sizeof)):null},_e=u(T=>C+T+Q),oe=function(T,Y,ee=!0){let re=T.members[Y];if(!re&&(C||Q)){for(let Ee of Object.values(T.members))if(Ee.key===Y){re=Ee;break}!re&&ee&&o(L(T.name,Y),"is not a mapped struct member.")}return re},de=function T(Y,ee,re=!1){T._||(T._=Ae=>Ae.replace(/[^vipPsjrdcC]/g,"").replace(/[pPscC]/g,"i"));let Ee=oe(Y.structInfo,ee,!0);return re?T._(Ee.signature):Ee.signature},he={configurable:!1,enumerable:!1,get:function(){return d.get(this)},set:()=>o("Cannot assign the 'pointer' property of a struct.")},ge=u(function(){let T=[];for(let Y of Object.keys(this.structInfo.members))T.push(this.memberKey(Y));return T}),J=new TextDecoder("utf-8"),E=new TextEncoder,N=typeof SharedArrayBuffer>"u"?function(){}:SharedArrayBuffer,$=function(T,Y,ee){return J.decode(T.buffer instanceof N?T.slice(Y,ee):T.subarray(Y,ee))},g=function(T,Y,ee=!1){let re=oe(T.structInfo,Y,ee);return re&&re.signature.length===1&&re.signature[0]==="s"?re:!1},k=function(T){T.signature!=="s"&&o("Invalid member type signature for C-string value:",JSON.stringify(T))},P=function(Y,ee){let re=oe(Y.structInfo,ee,!0);k(re);let Ee=Y[re.key];if(!Ee)return null;let Ae=Ee,Se=s();for(;Se[Ae]!==0;++Ae);return Ee===Ae?"":$(Se,Ee,Ae)},X=function(T,...Y){T.ondispose?Array.isArray(T.ondispose)||(T.ondispose=[T.ondispose]):T.ondispose=[],T.ondispose.push(...Y)},V=function(T){let Y=E.encode(T),ee=p(Y.length+1);ee||o("Allocation error while duplicating string:",T);let re=s();return re.set(Y,ee),re[ee+Y.length]=0,ee},ae=function(T,Y,ee){let re=oe(T.structInfo,Y,!0);k(re);let Ee=V(ee);return T[re.key]=Ee,X(T,Ee),T},ce=function(Y,ee){arguments[2]!==u&&o("Do not call the StructType constructor","from client-level code."),Object.defineProperties(this,{structName:u(Y),structInfo:u(ee)})};ce.prototype=Object.create(null,{dispose:u(function(){c(this.constructor,this)}),lookupMember:u(function(T,Y=!0){return oe(this.structInfo,T,Y)}),memberToJsString:u(function(T){return P(this,T)}),memberIsString:u(function(T,Y=!0){return g(this,T,Y)}),memberKey:_e,memberKeys:ge,memberSignature:u(function(T,Y=!1){return de(this,T,Y)}),memoryDump:u(W),pointer:he,setMemberCString:u(function(T,Y){return ae(this,T,Y)})}),Object.assign(ce.prototype,{addOnDispose:function(...T){return X(this,...T),this}}),Object.defineProperties(ce,{allocCString:u(V),isA:u(T=>T instanceof ce),hasExternalPointer:u(T=>T instanceof ce&&!!T[l]),memberKey:_e});let ie=T=>Number.isFinite(T)||T instanceof(G||Number),Oe=function T(Y,ee,re){if(!T._){T._={getters:{},setters:{},sw:{}};let Ne=["i","c","C","p","P","s","f","d","v()"];U&&Ne.push("j"),Ne.forEach(function(We){T._.getters[We]=_(We),T._.setters[We]=f(We),T._.sw[We]=S(We)});let ol=/^[ipPsjfdcC]$/,al=/^[vipPsjfdcC]\([ipPsjfdcC]*\)$/;T.sigCheck=function(We,ll,on,Pt){Object.prototype.hasOwnProperty.call(We,on)&&o(We.structName,"already has a property named",on+"."),ol.test(Pt)||al.test(Pt)||o("Malformed signature for",L(We.structName,ll)+":",Pt)}}let Ee=Y.memberKey(ee);T.sigCheck(Y.prototype,ee,Ee,re.signature),re.key=Ee,re.name=ee;let Ae=z(re.signature),Se=L(Y.prototype.structName,Ee),Ie=Y.prototype.debugFlags.__flags,tt=Object.create(null);tt.configurable=!1,tt.enumerable=!1,tt.get=function(){Ie.getter&&R("debug.getter:",T._.getters[Ae],"for",w(Ae),Se,"@",this.pointer,"+",re.offset,"sz",re.sizeof);let Ne=new DataView(s().buffer,this.pointer+re.offset,re.sizeof)[T._.getters[Ae]](0,x);return Ie.getter&&R("debug.getter:",Se,"result =",Ne),Ne},re.readOnly?tt.set=D(Y.prototype.structName,Ee):tt.set=function(Ne){if(Ie.setter&&R("debug.setter:",T._.setters[Ae],"for",w(Ae),Se,"@",this.pointer,"+",re.offset,"sz",re.sizeof,Ne),this.pointer||o("Cannot set struct property on disposed instance."),Ne===null)Ne=0;else for(;!ie(Ne);){if(j(re.signature)&&Ne instanceof ce){Ne=Ne.pointer||0,Ie.setter&&R("debug.setter:",Se,"resolved to",Ne);break}o("Invalid value for pointer-type",Se+".")}new DataView(s().buffer,this.pointer+re.offset,re.sizeof)[T._.setters[Ae]](0,T._.sw[Ae](Ne),x)},Object.defineProperty(Y.prototype,Ee,tt)},Fe=function T(Y,ee){arguments.length===1?(ee=Y,Y=ee.name):ee.name||(ee.name=Y),Y||o("Struct name is required.");let re=!1;Object.keys(ee.members).forEach(Se=>{let Ie=ee.members[Se];Ie.sizeof?Ie.sizeof===1?Ie.signature==="c"||Ie.signature==="C"||o("Unexpected sizeof==1 member",L(ee.name,Se),"with signature",Ie.signature):(Ie.sizeof%4!==0&&(console.warn("Invalid struct member description =",Ie,"from",ee),o(Y,"member",Se,"sizeof is not aligned. sizeof="+Ie.sizeof)),Ie.offset%4!==0&&(console.warn("Invalid struct member description =",Ie,"from",ee),o(Y,"member",Se,"offset is not aligned. offset="+Ie.offset))):o(Y,"member",Se,"is missing sizeof."),(!re||re.offset<Ie.offset)&&(re=Ie)}),re?ee.sizeof<re.offset+re.sizeof&&o("Invalid struct config:",Y,"max member offset ("+re.offset+") ","extends past end of struct (sizeof="+ee.sizeof+")."):o("No member property descriptions found.");let Ee=u(r.__makeDebugFlags(T.debugFlags)),Ae=function Se(Ie){this instanceof Se?arguments.length?((Ie!==(Ie|0)||Ie<=0)&&o("Invalid pointer value for",Y,"constructor."),y(Se,this,Ie)):y(Se,this):o("The",Y,"constructor may only be called via 'new'.")};return Object.defineProperties(Ae,{debugFlags:Ee,isA:u(Se=>Se instanceof Ae),memberKey:_e,memberKeys:ge,methodInfoForKey:u(function(Se){}),structInfo:u(ee),structName:u(Y)}),Ae.prototype=new ce(Y,ee,u),Object.defineProperties(Ae.prototype,{debugFlags:Ee,constructor:u(Ae)}),Object.keys(ee.members).forEach(Se=>Oe(Ae,Se,ee.members[Se])),Ae};return Fe.StructType=ce,Fe.config=i,Fe.allocCString=V,Fe.debugFlags||(Fe.debugFlags=r.__makeDebugFlags(r.debugFlags)),Fe},globalThis.sqlite3ApiBootstrap.initializers.push(function(t){"use strict";let i=(...x)=>{throw new Error(x.join(" "))},o=t.SQLite3Error.toss,r=t.capi,s=t.wasm,p=t.util;if(globalThis.WhWasmUtilInstaller(s),delete globalThis.WhWasmUtilInstaller,s.bindingSignatures=[["sqlite3_aggregate_context","void*","sqlite3_context*","int"],["sqlite3_bind_double","int","sqlite3_stmt*","int","f64"],["sqlite3_bind_int","int","sqlite3_stmt*","int","int"],["sqlite3_bind_null",void 0,"sqlite3_stmt*","int"],["sqlite3_bind_parameter_count","int","sqlite3_stmt*"],["sqlite3_bind_parameter_index","int","sqlite3_stmt*","string"],["sqlite3_bind_pointer","int","sqlite3_stmt*","int","*","string:static","*"],["sqlite3_busy_handler","int",["sqlite3*",new s.xWrap.FuncPtrAdapter({signature:"i(pi)",contextKey:(x,b)=>x[0]}),"*"]],["sqlite3_busy_timeout","int","sqlite3*","int"],["sqlite3_changes","int","sqlite3*"],["sqlite3_clear_bindings","int","sqlite3_stmt*"],["sqlite3_collation_needed","int","sqlite3*","*","*"],["sqlite3_column_blob","*","sqlite3_stmt*","int"],["sqlite3_column_bytes","int","sqlite3_stmt*","int"],["sqlite3_column_count","int","sqlite3_stmt*"],["sqlite3_column_double","f64","sqlite3_stmt*","int"],["sqlite3_column_int","int","sqlite3_stmt*","int"],["sqlite3_column_name","string","sqlite3_stmt*","int"],["sqlite3_column_text","string","sqlite3_stmt*","int"],["sqlite3_column_type","int","sqlite3_stmt*","int"],["sqlite3_column_value","sqlite3_value*","sqlite3_stmt*","int"],["sqlite3_commit_hook","void*",["sqlite3*",new s.xWrap.FuncPtrAdapter({name:"sqlite3_commit_hook",signature:"i(p)",contextKey:x=>x[0]}),"*"]],["sqlite3_compileoption_get","string","int"],["sqlite3_compileoption_used","int","string"],["sqlite3_complete","int","string:flexible"],["sqlite3_context_db_handle","sqlite3*","sqlite3_context*"],["sqlite3_data_count","int","sqlite3_stmt*"],["sqlite3_db_filename","string","sqlite3*","string"],["sqlite3_db_handle","sqlite3*","sqlite3_stmt*"],["sqlite3_db_name","string","sqlite3*","int"],["sqlite3_db_status","int","sqlite3*","int","*","*","int"],["sqlite3_errcode","int","sqlite3*"],["sqlite3_errmsg","string","sqlite3*"],["sqlite3_error_offset","int","sqlite3*"],["sqlite3_errstr","string","int"],["sqlite3_exec","int",["sqlite3*","string:flexible",new s.xWrap.FuncPtrAdapter({signature:"i(pipp)",bindScope:"transient",callProxy:x=>{let b;return(F,j,z,w)=>{try{let H=s.cArgvToJs(j,z);return b||(b=s.cArgvToJs(j,w)),x(H,b)|0}catch(H){return H.resultCode||r.SQLITE_ERROR}}}}),"*","**"]],["sqlite3_expanded_sql","string","sqlite3_stmt*"],["sqlite3_extended_errcode","int","sqlite3*"],["sqlite3_extended_result_codes","int","sqlite3*","int"],["sqlite3_file_control","int","sqlite3*","string","int","*"],["sqlite3_finalize","int","sqlite3_stmt*"],["sqlite3_free",void 0,"*"],["sqlite3_get_autocommit","int","sqlite3*"],["sqlite3_get_auxdata","*","sqlite3_context*","int"],["sqlite3_initialize",void 0],["sqlite3_keyword_count","int"],["sqlite3_keyword_name","int",["int","**","*"]],["sqlite3_keyword_check","int",["string","int"]],["sqlite3_libversion","string"],["sqlite3_libversion_number","int"],["sqlite3_limit","int",["sqlite3*","int","int"]],["sqlite3_malloc","*","int"],["sqlite3_open","int","string","*"],["sqlite3_open_v2","int","string","*","int","string"],["sqlite3_progress_handler",void 0,["sqlite3*","int",new s.xWrap.FuncPtrAdapter({name:"xProgressHandler",signature:"i(p)",bindScope:"context",contextKey:(x,b)=>x[0]}),"*"]],["sqlite3_realloc","*","*","int"],["sqlite3_reset","int","sqlite3_stmt*"],["sqlite3_result_blob",void 0,"sqlite3_context*","*","int","*"],["sqlite3_result_double",void 0,"sqlite3_context*","f64"],["sqlite3_result_error",void 0,"sqlite3_context*","string","int"],["sqlite3_result_error_code",void 0,"sqlite3_context*","int"],["sqlite3_result_error_nomem",void 0,"sqlite3_context*"],["sqlite3_result_error_toobig",void 0,"sqlite3_context*"],["sqlite3_result_int",void 0,"sqlite3_context*","int"],["sqlite3_result_null",void 0,"sqlite3_context*"],["sqlite3_result_pointer",void 0,"sqlite3_context*","*","string:static","*"],["sqlite3_result_subtype",void 0,"sqlite3_value*","int"],["sqlite3_result_text",void 0,"sqlite3_context*","string","int","*"],["sqlite3_result_zeroblob",void 0,"sqlite3_context*","int"],["sqlite3_rollback_hook","void*",["sqlite3*",new s.xWrap.FuncPtrAdapter({name:"sqlite3_rollback_hook",signature:"v(p)",contextKey:x=>x[0]}),"*"]],["sqlite3_set_authorizer","int",["sqlite3*",new s.xWrap.FuncPtrAdapter({name:"sqlite3_set_authorizer::xAuth",signature:"i(pissss)",contextKey:(x,b)=>x[0],callProxy:x=>(b,F,j,z,w,H)=>{try{return j=j&&s.cstrToJs(j),z=z&&s.cstrToJs(z),w=w&&s.cstrToJs(w),H=H&&s.cstrToJs(H),x(b,F,j,z,w,H)||0}catch(_){return _.resultCode||r.SQLITE_ERROR}}}),"*"]],["sqlite3_set_auxdata",void 0,["sqlite3_context*","int","*",new s.xWrap.FuncPtrAdapter({name:"xDestroyAuxData",signature:"v(*)",contextKey:(x,b)=>x[0]})]],["sqlite3_shutdown",void 0],["sqlite3_sourceid","string"],["sqlite3_sql","string","sqlite3_stmt*"],["sqlite3_status","int","int","*","*","int"],["sqlite3_step","int","sqlite3_stmt*"],["sqlite3_stmt_isexplain","int",["sqlite3_stmt*"]],["sqlite3_stmt_readonly","int",["sqlite3_stmt*"]],["sqlite3_stmt_status","int","sqlite3_stmt*","int","int"],["sqlite3_strglob","int","string","string"],["sqlite3_stricmp","int","string","string"],["sqlite3_strlike","int","string","string","int"],["sqlite3_strnicmp","int","string","string","int"],["sqlite3_table_column_metadata","int","sqlite3*","string","string","string","**","**","*","*","*"],["sqlite3_total_changes","int","sqlite3*"],["sqlite3_trace_v2","int",["sqlite3*","int",new s.xWrap.FuncPtrAdapter({name:"sqlite3_trace_v2::callback",signature:"i(ippp)",contextKey:(x,b)=>x[0]}),"*"]],["sqlite3_txn_state","int",["sqlite3*","string"]],["sqlite3_uri_boolean","int","sqlite3_filename","string","int"],["sqlite3_uri_key","string","sqlite3_filename","int"],["sqlite3_uri_parameter","string","sqlite3_filename","string"],["sqlite3_user_data","void*","sqlite3_context*"],["sqlite3_value_blob","*","sqlite3_value*"],["sqlite3_value_bytes","int","sqlite3_value*"],["sqlite3_value_double","f64","sqlite3_value*"],["sqlite3_value_dup","sqlite3_value*","sqlite3_value*"],["sqlite3_value_free",void 0,"sqlite3_value*"],["sqlite3_value_frombind","int","sqlite3_value*"],["sqlite3_value_int","int","sqlite3_value*"],["sqlite3_value_nochange","int","sqlite3_value*"],["sqlite3_value_numeric_type","int","sqlite3_value*"],["sqlite3_value_pointer","*","sqlite3_value*","string:static"],["sqlite3_value_subtype","int","sqlite3_value*"],["sqlite3_value_text","string","sqlite3_value*"],["sqlite3_value_type","int","sqlite3_value*"],["sqlite3_vfs_find","*","string"],["sqlite3_vfs_register","int","sqlite3_vfs*","int"],["sqlite3_vfs_unregister","int","sqlite3_vfs*"]],s.bindingSignatures.int64=[["sqlite3_bind_int64","int",["sqlite3_stmt*","int","i64"]],["sqlite3_changes64","i64",["sqlite3*"]],["sqlite3_column_int64","i64",["sqlite3_stmt*","int"]],["sqlite3_create_module","int",["sqlite3*","string","sqlite3_module*","*"]],["sqlite3_create_module_v2","int",["sqlite3*","string","sqlite3_module*","*","*"]],["sqlite3_declare_vtab","int",["sqlite3*","string:flexible"]],["sqlite3_deserialize","int","sqlite3*","string","*","i64","i64","int"],["sqlite3_drop_modules","int",["sqlite3*","**"]],["sqlite3_last_insert_rowid","i64",["sqlite3*"]],["sqlite3_malloc64","*","i64"],["sqlite3_msize","i64","*"],["sqlite3_overload_function","int",["sqlite3*","string","int"]],["sqlite3_preupdate_blobwrite","int","sqlite3*"],["sqlite3_preupdate_count","int","sqlite3*"],["sqlite3_preupdate_depth","int","sqlite3*"],["sqlite3_preupdate_hook","*",["sqlite3*",new s.xWrap.FuncPtrAdapter({name:"sqlite3_preupdate_hook",signature:"v(ppippjj)",contextKey:x=>x[0],callProxy:x=>(b,F,j,z,w,H,_)=>{x(b,F,j,s.cstrToJs(z),s.cstrToJs(w),H,_)}}),"*"]],["sqlite3_preupdate_new","int",["sqlite3*","int","**"]],["sqlite3_preupdate_old","int",["sqlite3*","int","**"]],["sqlite3_realloc64","*","*","i64"],["sqlite3_result_int64",void 0,"*","i64"],["sqlite3_result_zeroblob64","int","*","i64"],["sqlite3_serialize","*","sqlite3*","string","*","int"],["sqlite3_set_last_insert_rowid",void 0,["sqlite3*","i64"]],["sqlite3_status64","int","int","*","*","int"],["sqlite3_total_changes64","i64",["sqlite3*"]],["sqlite3_update_hook","*",["sqlite3*",new s.xWrap.FuncPtrAdapter({name:"sqlite3_update_hook",signature:"v(iippj)",contextKey:x=>x[0],callProxy:x=>(b,F,j,z,w)=>{x(b,F,s.cstrToJs(j),s.cstrToJs(z),w)}}),"*"]],["sqlite3_uri_int64","i64",["sqlite3_filename","string","i64"]],["sqlite3_value_int64","i64","sqlite3_value*"],["sqlite3_vtab_collation","string","sqlite3_index_info*","int"],["sqlite3_vtab_distinct","int","sqlite3_index_info*"],["sqlite3_vtab_in","int","sqlite3_index_info*","int","int"],["sqlite3_vtab_in_first","int","sqlite3_value*","**"],["sqlite3_vtab_in_next","int","sqlite3_value*","**"],["sqlite3_vtab_nochange","int","sqlite3_context*"],["sqlite3_vtab_on_conflict","int","sqlite3*"],["sqlite3_vtab_rhs_value","int","sqlite3_index_info*","int","**"]],s.bigIntEnabled&&s.exports.sqlite3changegroup_add){let x={signature:"i(ps)",callProxy:b=>(F,j)=>{try{return b(F,s.cstrToJs(j))|0}catch(z){return z.resultCode||r.SQLITE_ERROR}}};s.bindingSignatures.int64.push(["sqlite3changegroup_add","int",["sqlite3_changegroup*","int","void*"]],["sqlite3changegroup_add_strm","int",["sqlite3_changegroup*",new s.xWrap.FuncPtrAdapter({name:"xInput",signature:"i(ppp)",bindScope:"transient"}),"void*"]],["sqlite3changegroup_delete",void 0,["sqlite3_changegroup*"]],["sqlite3changegroup_new","int",["**"]],["sqlite3changegroup_output","int",["sqlite3_changegroup*","int*","**"]],["sqlite3changegroup_output_strm","int",["sqlite3_changegroup*",new s.xWrap.FuncPtrAdapter({name:"xOutput",signature:"i(ppi)",bindScope:"transient"}),"void*"]],["sqlite3changeset_apply","int",["sqlite3*","int","void*",new s.xWrap.FuncPtrAdapter({name:"xFilter",bindScope:"transient",...x}),new s.xWrap.FuncPtrAdapter({name:"xConflict",signature:"i(pip)",bindScope:"transient"}),"void*"]],["sqlite3changeset_apply_strm","int",["sqlite3*",new s.xWrap.FuncPtrAdapter({name:"xInput",signature:"i(ppp)",bindScope:"transient"}),"void*",new s.xWrap.FuncPtrAdapter({name:"xFilter",bindScope:"transient",...x}),new s.xWrap.FuncPtrAdapter({name:"xConflict",signature:"i(pip)",bindScope:"transient"}),"void*"]],["sqlite3changeset_apply_v2","int",["sqlite3*","int","void*",new s.xWrap.FuncPtrAdapter({name:"xFilter",bindScope:"transient",...x}),new s.xWrap.FuncPtrAdapter({name:"xConflict",signature:"i(pip)",bindScope:"transient"}),"void*","**","int*","int"]],["sqlite3changeset_apply_v2_strm","int",["sqlite3*",new s.xWrap.FuncPtrAdapter({name:"xInput",signature:"i(ppp)",bindScope:"transient"}),"void*",new s.xWrap.FuncPtrAdapter({name:"xFilter",bindScope:"transient",...x}),new s.xWrap.FuncPtrAdapter({name:"xConflict",signature:"i(pip)",bindScope:"transient"}),"void*","**","int*","int"]],["sqlite3changeset_concat","int",["int","void*","int","void*","int*","**"]],["sqlite3changeset_concat_strm","int",[new s.xWrap.FuncPtrAdapter({name:"xInputA",signature:"i(ppp)",bindScope:"transient"}),"void*",new s.xWrap.FuncPtrAdapter({name:"xInputB",signature:"i(ppp)",bindScope:"transient"}),"void*",new s.xWrap.FuncPtrAdapter({name:"xOutput",signature:"i(ppi)",bindScope:"transient"}),"void*"]],["sqlite3changeset_conflict","int",["sqlite3_changeset_iter*","int","**"]],["sqlite3changeset_finalize","int",["sqlite3_changeset_iter*"]],["sqlite3changeset_fk_conflicts","int",["sqlite3_changeset_iter*","int*"]],["sqlite3changeset_invert","int",["int","void*","int*","**"]],["sqlite3changeset_invert_strm","int",[new s.xWrap.FuncPtrAdapter({name:"xInput",signature:"i(ppp)",bindScope:"transient"}),"void*",new s.xWrap.FuncPtrAdapter({name:"xOutput",signature:"i(ppi)",bindScope:"transient"}),"void*"]],["sqlite3changeset_new","int",["sqlite3_changeset_iter*","int","**"]],["sqlite3changeset_next","int",["sqlite3_changeset_iter*"]],["sqlite3changeset_old","int",["sqlite3_changeset_iter*","int","**"]],["sqlite3changeset_op","int",["sqlite3_changeset_iter*","**","int*","int*","int*"]],["sqlite3changeset_pk","int",["sqlite3_changeset_iter*","**","int*"]],["sqlite3changeset_start","int",["**","int","*"]],["sqlite3changeset_start_strm","int",["**",new s.xWrap.FuncPtrAdapter({name:"xInput",signature:"i(ppp)",bindScope:"transient"}),"void*"]],["sqlite3changeset_start_v2","int",["**","int","*","int"]],["sqlite3changeset_start_v2_strm","int",["**",new s.xWrap.FuncPtrAdapter({name:"xInput",signature:"i(ppp)",bindScope:"transient"}),"void*","int"]],["sqlite3session_attach","int",["sqlite3_session*","string"]],["sqlite3session_changeset","int",["sqlite3_session*","int*","**"]],["sqlite3session_changeset_size","i64",["sqlite3_session*"]],["sqlite3session_changeset_strm","int",["sqlite3_session*",new s.xWrap.FuncPtrAdapter({name:"xOutput",signature:"i(ppp)",bindScope:"transient"}),"void*"]],["sqlite3session_config","int",["int","void*"]],["sqlite3session_create","int",["sqlite3*","string","**"]],["sqlite3session_diff","int",["sqlite3_session*","string","string","**"]],["sqlite3session_enable","int",["sqlite3_session*","int"]],["sqlite3session_indirect","int",["sqlite3_session*","int"]],["sqlite3session_isempty","int",["sqlite3_session*"]],["sqlite3session_memory_used","i64",["sqlite3_session*"]],["sqlite3session_object_config","int",["sqlite3_session*","int","void*"]],["sqlite3session_patchset","int",["sqlite3_session*","*","**"]],["sqlite3session_patchset_strm","int",["sqlite3_session*",new s.xWrap.FuncPtrAdapter({name:"xOutput",signature:"i(ppp)",bindScope:"transient"}),"void*"]],["sqlite3session_table_filter",void 0,["sqlite3_session*",new s.xWrap.FuncPtrAdapter({name:"xFilter",...x,contextKey:(b,F)=>b[0]}),"*"]])}s.bindingSignatures.wasmInternal=[["sqlite3__wasm_db_reset","int","sqlite3*"],["sqlite3__wasm_db_vfs","sqlite3_vfs*","sqlite3*","string"],["sqlite3__wasm_vfs_create_file","int","sqlite3_vfs*","string","*","int"],["sqlite3__wasm_posix_create_file","int","string","*","int"],["sqlite3__wasm_vfs_unlink","int","sqlite3_vfs*","string"],["sqlite3__wasm_qfmt_token","string:dealloc","string","int"]],t.StructBinder=globalThis.Jaccwabyt({heap:s.heap8u,alloc:s.alloc,dealloc:s.dealloc,bigIntEnabled:s.bigIntEnabled,memberPrefix:"$"}),delete globalThis.Jaccwabyt;{let x=s.xWrap.argAdapter("string");s.xWrap.argAdapter("string:flexible",w=>x(p.flexibleString(w))),s.xWrap.argAdapter("string:static",function(w){return s.isPtr(w)?w:(w=""+w,this[w]||(this[w]=s.allocCString(w)))}.bind(Object.create(null)));let b=s.xWrap.argAdapter("*"),F=function(){};s.xWrap.argAdapter("sqlite3_filename",b)("sqlite3_context*",b)("sqlite3_value*",b)("void*",b)("sqlite3_changegroup*",b)("sqlite3_changeset_iter*",b)("sqlite3_session*",b)("sqlite3_stmt*",w=>b(w instanceof(t?.oo1?.Stmt||F)?w.pointer:w))("sqlite3*",w=>b(w instanceof(t?.oo1?.DB||F)?w.pointer:w))("sqlite3_index_info*",w=>b(w instanceof(r.sqlite3_index_info||F)?w.pointer:w))("sqlite3_module*",w=>b(w instanceof(r.sqlite3_module||F)?w.pointer:w))("sqlite3_vfs*",w=>typeof w=="string"?r.sqlite3_vfs_find(w)||t.SQLite3Error.toss(r.SQLITE_NOTFOUND,"Unknown sqlite3_vfs name:",w):b(w instanceof(r.sqlite3_vfs||F)?w.pointer:w));let j=s.xWrap.resultAdapter("*");s.xWrap.resultAdapter("sqlite3*",j)("sqlite3_context*",j)("sqlite3_stmt*",j)("sqlite3_value*",j)("sqlite3_vfs*",j)("void*",j),s.exports.sqlite3_step.length===0&&(s.xWrap.doArgcCheck=!1,t.config.warn("Disabling sqlite3.wasm.xWrap.doArgcCheck due to environmental quirks."));for(let w of s.bindingSignatures)r[w[0]]=s.xWrap.apply(null,w);for(let w of s.bindingSignatures.wasmInternal)p[w[0]]=s.xWrap.apply(null,w);let z=function(w){return()=>i(w+"() is unavailable due to lack","of BigInt support in this build.")};for(let w of s.bindingSignatures.int64)r[w[0]]=s.bigIntEnabled?s.xWrap.apply(null,w):z(w[0]);if(delete s.bindingSignatures,s.exports.sqlite3__wasm_db_error){let w=s.xWrap("sqlite3__wasm_db_error","int","sqlite3*","int","string");p.sqlite3__wasm_db_error=function(H,_,f){return _ instanceof t.WasmAllocError?(_=r.SQLITE_NOMEM,f=0):_ instanceof Error&&(f=f||""+_,_=_.resultCode||r.SQLITE_ERROR),H?w(H,_,f):_}}else p.sqlite3__wasm_db_error=function(w,H,_){return console.warn("sqlite3__wasm_db_error() is not exported.",arguments),H}}{let x=s.xCall("sqlite3__wasm_enum_json");x||i("Maintenance required: increase sqlite3__wasm_enum_json()'s","static buffer size!"),s.ctype=JSON.parse(s.cstrToJs(x));let b=["access","authorizer","blobFinalizers","changeset","config","dataTypes","dbConfig","dbStatus","encodings","fcntl","flock","ioCap","limits","openFlags","prepareFlags","resultCodes","sqlite3Status","stmtStatus","syncFlags","trace","txnState","udfFlags","version"];s.bigIntEnabled&&b.push("serialize","session","vtab");for(let z of b)for(let w of Object.entries(s.ctype[z]))r[w[0]]=w[1];s.functionEntry(r.SQLITE_WASM_DEALLOC)||i("Internal error: cannot resolve exported function","entry SQLITE_WASM_DEALLOC (=="+r.SQLITE_WASM_DEALLOC+").");let F=Object.create(null);for(let z of["resultCodes"])for(let w of Object.entries(s.ctype[z]))F[w[1]]=w[0];r.sqlite3_js_rc_str=z=>F[z];let j=Object.assign(Object.create(null),{WasmTestStruct:!0,sqlite3_kvvfs_methods:!p.isUIThread(),sqlite3_index_info:!s.bigIntEnabled,sqlite3_index_constraint:!s.bigIntEnabled,sqlite3_index_orderby:!s.bigIntEnabled,sqlite3_index_constraint_usage:!s.bigIntEnabled});for(let z of s.ctype.structs)j[z.name]||(r[z.name]=t.StructBinder(z));if(r.sqlite3_index_info){for(let z of["sqlite3_index_constraint","sqlite3_index_orderby","sqlite3_index_constraint_usage"])r.sqlite3_index_info[z]=r[z],delete r[z];r.sqlite3_vtab_config=s.xWrap("sqlite3__wasm_vtab_config","int",["sqlite3*","int","int"])}}let h=(x,b,F)=>p.sqlite3__wasm_db_error(x,r.SQLITE_MISUSE,b+"() requires "+F+" argument"+(F===1?"":"s")+"."),R=x=>p.sqlite3__wasm_db_error(x,r.SQLITE_FORMAT,"SQLITE_UTF8 is the only supported encoding."),C=x=>s.xWrap.argAdapter("sqlite3*")(x),Q=x=>s.isPtr(x)?s.cstrToJs(x):x,U=function(x,b){x=C(x);let F=this.dbMap.get(x);if(b)!F&&b>0&&this.dbMap.set(x,F=Object.create(null));else return this.dbMap.delete(x),F;return F}.bind(Object.assign(Object.create(null),{dbMap:new Map}));U.addCollation=function(x,b){let F=U(x,1);F.collation||(F.collation=new Set),F.collation.add(Q(b).toLowerCase())},U._addUDF=function(x,b,F,j){b=Q(b).toLowerCase();let z=j.get(b);z||j.set(b,z=new Set),z.add(F<0?-1:F)},U.addFunction=function(x,b,F){let j=U(x,1);j.udf||(j.udf=new Map),this._addUDF(x,b,F,j.udf)},U.addWindowFunc=function(x,b,F){let j=U(x,1);j.wudf||(j.wudf=new Map),this._addUDF(x,b,F,j.wudf)},U.cleanup=function(x){x=C(x);let b=[x];for(let z of["sqlite3_busy_handler","sqlite3_commit_hook","sqlite3_preupdate_hook","sqlite3_progress_handler","sqlite3_rollback_hook","sqlite3_set_authorizer","sqlite3_trace_v2","sqlite3_update_hook"]){let w=s.exports[z];b.length=w.length;try{r[z](...b)}catch(H){console.warn("close-time call of",z+"(",b,") threw:",H)}}let F=U(x,0);if(!F)return;if(F.collation){for(let z of F.collation)try{r.sqlite3_create_collation_v2(x,z,r.SQLITE_UTF8,0,0,0)}catch{}delete F.collation}let j;for(j=0;j<2;++j){let z=j?F.wudf:F.udf;if(!z)continue;let w=j?r.sqlite3_create_window_function:r.sqlite3_create_function_v2;for(let H of z){let _=H[0],f=H[1],S=[x,_,0,r.SQLITE_UTF8,0,0,0,0,0];j&&S.push(0);for(let L of f)try{S[2]=L,w.apply(null,S)}catch{}f.clear()}z.clear()}delete F.udf,delete F.wudf};{let x=s.xWrap("sqlite3_close_v2","int","sqlite3*");r.sqlite3_close_v2=function(b){if(arguments.length!==1)return h(b,"sqlite3_close_v2",1);if(b)try{U.cleanup(b)}catch{}return x(b)}}if(r.sqlite3session_table_filter){let x=s.xWrap("sqlite3session_delete",void 0,["sqlite3_session*"]);r.sqlite3session_delete=function(b){if(arguments.length!==1)return h(pDb,"sqlite3session_delete",1);b&&r.sqlite3session_table_filter(b,0,0),x(b)}}{let x=(F,j)=>"argv["+j+"]:"+F[0]+":"+s.cstrToJs(F[1]).toLowerCase(),b=s.xWrap("sqlite3_create_collation_v2","int",["sqlite3*","string","int","*",new s.xWrap.FuncPtrAdapter({name:"xCompare",signature:"i(pipip)",contextKey:x}),new s.xWrap.FuncPtrAdapter({name:"xDestroy",signature:"v(p)",contextKey:x})]);r.sqlite3_create_collation_v2=function(F,j,z,w,H,_){if(arguments.length!==6)return h(F,"sqlite3_create_collation_v2",6);if(!(z&15))z|=r.SQLITE_UTF8;else if(r.SQLITE_UTF8!==(z&15))return R(F);try{let f=b(F,j,z,w,H,_);return f===0&&H instanceof Function&&U.addCollation(F,j),f}catch(f){return p.sqlite3__wasm_db_error(F,f)}},r.sqlite3_create_collation=(F,j,z,w,H)=>arguments.length===5?r.sqlite3_create_collation_v2(F,j,z,w,H,0):h(F,"sqlite3_create_collation",5)}{let x=function(z,w){return z[0]+":"+(z[2]<0?-1:z[2])+":"+w+":"+s.cstrToJs(z[1]).toLowerCase()},b=Object.assign(Object.create(null),{xInverseAndStep:{signature:"v(pip)",contextKey:x,callProxy:z=>(w,H,_)=>{try{z(w,...r.sqlite3_values_to_js(H,_))}catch(f){r.sqlite3_result_error_js(w,f)}}},xFinalAndValue:{signature:"v(p)",contextKey:x,callProxy:z=>w=>{try{r.sqlite3_result_js(w,z(w))}catch(H){r.sqlite3_result_error_js(w,H)}}},xFunc:{signature:"v(pip)",contextKey:x,callProxy:z=>(w,H,_)=>{try{r.sqlite3_result_js(w,z(w,...r.sqlite3_values_to_js(H,_)))}catch(f){r.sqlite3_result_error_js(w,f)}}},xDestroy:{signature:"v(p)",contextKey:x,callProxy:z=>w=>{try{z(w)}catch(H){console.error("UDF xDestroy method threw:",H)}}}}),F=s.xWrap("sqlite3_create_function_v2","int",["sqlite3*","string","int","int","*",new s.xWrap.FuncPtrAdapter({name:"xFunc",...b.xFunc}),new s.xWrap.FuncPtrAdapter({name:"xStep",...b.xInverseAndStep}),new s.xWrap.FuncPtrAdapter({name:"xFinal",...b.xFinalAndValue}),new s.xWrap.FuncPtrAdapter({name:"xDestroy",...b.xDestroy})]),j=s.xWrap("sqlite3_create_window_function","int",["sqlite3*","string","int","int","*",new s.xWrap.FuncPtrAdapter({name:"xStep",...b.xInverseAndStep}),new s.xWrap.FuncPtrAdapter({name:"xFinal",...b.xFinalAndValue}),new s.xWrap.FuncPtrAdapter({name:"xValue",...b.xFinalAndValue}),new s.xWrap.FuncPtrAdapter({name:"xInverse",...b.xInverseAndStep}),new s.xWrap.FuncPtrAdapter({name:"xDestroy",...b.xDestroy})]);r.sqlite3_create_function_v2=function z(w,H,_,f,S,L,D,d,l){if(z.length!==arguments.length)return h(w,"sqlite3_create_function_v2",z.length);if(!(f&15))f|=r.SQLITE_UTF8;else if(r.SQLITE_UTF8!==(f&15))return R(w);try{let c=F(w,H,_,f,S,L,D,d,l);return c===0&&(L instanceof Function||D instanceof Function||d instanceof Function||l instanceof Function)&&U.addFunction(w,H,_),c}catch(c){return console.error("sqlite3_create_function_v2() setup threw:",c),p.sqlite3__wasm_db_error(w,c,"Creation of UDF threw: "+c)}},r.sqlite3_create_function=function z(w,H,_,f,S,L,D,d){return z.length===arguments.length?r.sqlite3_create_function_v2(w,H,_,f,S,L,D,d,0):h(w,"sqlite3_create_function",z.length)},r.sqlite3_create_window_function=function z(w,H,_,f,S,L,D,d,l,c){if(z.length!==arguments.length)return h(w,"sqlite3_create_window_function",z.length);if(!(f&15))f|=r.SQLITE_UTF8;else if(r.SQLITE_UTF8!==(f&15))return R(w);try{let u=j(w,H,_,f,S,L,D,d,l,c);return u===0&&(L instanceof Function||D instanceof Function||d instanceof Function||l instanceof Function||c instanceof Function)&&U.addWindowFunc(w,H,_),u}catch(u){return console.error("sqlite3_create_window_function() setup threw:",u),p.sqlite3__wasm_db_error(w,u,"Creation of UDF threw: "+u)}},r.sqlite3_create_function_v2.udfSetResult=r.sqlite3_create_function.udfSetResult=r.sqlite3_create_window_function.udfSetResult=r.sqlite3_result_js,r.sqlite3_create_function_v2.udfConvertArgs=r.sqlite3_create_function.udfConvertArgs=r.sqlite3_create_window_function.udfConvertArgs=r.sqlite3_values_to_js,r.sqlite3_create_function_v2.udfSetError=r.sqlite3_create_function.udfSetError=r.sqlite3_create_window_function.udfSetError=r.sqlite3_result_error_js}{let x=(F,j)=>(typeof F=="string"?j=-1:p.isSQLableTypedArray(F)?(j=F.byteLength,F=p.typedArrayToString(F instanceof ArrayBuffer?new Uint8Array(F):F)):Array.isArray(F)&&(F=F.join(""),j=-1),[F,j]),b={basic:s.xWrap("sqlite3_prepare_v3","int",["sqlite3*","string","int","int","**","**"]),full:s.xWrap("sqlite3_prepare_v3","int",["sqlite3*","*","int","int","**","**"])};r.sqlite3_prepare_v3=function F(j,z,w,H,_,f){if(F.length!==arguments.length)return h(j,"sqlite3_prepare_v3",F.length);let[S,L]=x(z,w);switch(typeof S){case"string":return b.basic(j,S,L,H,_,null);case"number":return b.full(j,S,L,H,_,f);default:return p.sqlite3__wasm_db_error(j,r.SQLITE_MISUSE,"Invalid SQL argument type for sqlite3_prepare_v2/v3().")}},r.sqlite3_prepare_v2=function F(j,z,w,H,_){return F.length===arguments.length?r.sqlite3_prepare_v3(j,z,w,0,H,_):h(j,"sqlite3_prepare_v2",F.length)}}{let x=s.xWrap("sqlite3_bind_text","int",["sqlite3_stmt*","int","string","int","*"]),b=s.xWrap("sqlite3_bind_blob","int",["sqlite3_stmt*","int","*","int","*"]);r.sqlite3_bind_text=function F(j,z,w,H,_){if(F.length!==arguments.length)return h(r.sqlite3_db_handle(j),"sqlite3_bind_text",F.length);if(s.isPtr(w)||w===null)return x(j,z,w,H,_);w instanceof ArrayBuffer?w=new Uint8Array(w):Array.isArray(pMem)&&(w=pMem.join(""));let f,S;try{if(p.isSQLableTypedArray(w))f=s.allocFromTypedArray(w),S=w.byteLength;else if(typeof w=="string")[f,S]=s.allocCString(w);else return p.sqlite3__wasm_db_error(r.sqlite3_db_handle(j),r.SQLITE_MISUSE,"Invalid 3rd argument type for sqlite3_bind_text().");return x(j,z,f,S,r.SQLITE_WASM_DEALLOC)}catch(L){return s.dealloc(f),p.sqlite3__wasm_db_error(r.sqlite3_db_handle(j),L)}},r.sqlite3_bind_blob=function F(j,z,w,H,_){if(F.length!==arguments.length)return h(r.sqlite3_db_handle(j),"sqlite3_bind_blob",F.length);if(s.isPtr(w)||w===null)return b(j,z,w,H,_);w instanceof ArrayBuffer?w=new Uint8Array(w):Array.isArray(w)&&(w=w.join(""));let f,S;try{if(p.isBindableTypedArray(w))f=s.allocFromTypedArray(w),S=H>=0?H:w.byteLength;else if(typeof w=="string")[f,S]=s.allocCString(w);else return p.sqlite3__wasm_db_error(r.sqlite3_db_handle(j),r.SQLITE_MISUSE,"Invalid 3rd argument type for sqlite3_bind_blob().");return b(j,z,f,S,r.SQLITE_WASM_DEALLOC)}catch(L){return s.dealloc(f),p.sqlite3__wasm_db_error(r.sqlite3_db_handle(j),L)}}}r.sqlite3_config=function(x,...b){if(arguments.length<2)return r.SQLITE_MISUSE;switch(x){case r.SQLITE_CONFIG_COVERING_INDEX_SCAN:case r.SQLITE_CONFIG_MEMSTATUS:case r.SQLITE_CONFIG_SMALL_MALLOC:case r.SQLITE_CONFIG_SORTERREF_SIZE:case r.SQLITE_CONFIG_STMTJRNL_SPILL:case r.SQLITE_CONFIG_URI:return s.exports.sqlite3__wasm_config_i(x,b[0]);case r.SQLITE_CONFIG_LOOKASIDE:return s.exports.sqlite3__wasm_config_ii(x,b[0],b[1]);case r.SQLITE_CONFIG_MEMDB_MAXSIZE:return s.exports.sqlite3__wasm_config_j(x,b[0]);case r.SQLITE_CONFIG_GETMALLOC:case r.SQLITE_CONFIG_GETMUTEX:case r.SQLITE_CONFIG_GETPCACHE2:case r.SQLITE_CONFIG_GETPCACHE:case r.SQLITE_CONFIG_HEAP:case r.SQLITE_CONFIG_LOG:case r.SQLITE_CONFIG_MALLOC:case r.SQLITE_CONFIG_MMAP_SIZE:case r.SQLITE_CONFIG_MULTITHREAD:case r.SQLITE_CONFIG_MUTEX:case r.SQLITE_CONFIG_PAGECACHE:case r.SQLITE_CONFIG_PCACHE2:case r.SQLITE_CONFIG_PCACHE:case r.SQLITE_CONFIG_PCACHE_HDRSZ:case r.SQLITE_CONFIG_PMASZ:case r.SQLITE_CONFIG_SERIALIZED:case r.SQLITE_CONFIG_SINGLETHREAD:case r.SQLITE_CONFIG_SQLLOG:case r.SQLITE_CONFIG_WIN32_HEAPSIZE:default:return r.SQLITE_NOTFOUND}};{let x=new Set;r.sqlite3_auto_extension=function(b){if(b instanceof Function)b=s.installFunction("i(ppp)",b);else if(arguments.length!==1||!s.isPtr(b))return r.SQLITE_MISUSE;let F=s.exports.sqlite3_auto_extension(b);return b!==arguments[0]&&(F===0?x.add(b):s.uninstallFunction(b)),F},r.sqlite3_cancel_auto_extension=function(b){return!b||arguments.length!==1||!s.isPtr(b)?0:s.exports.sqlite3_cancel_auto_extension(b)},r.sqlite3_reset_auto_extension=function(){s.exports.sqlite3_reset_auto_extension();for(let b of x)s.uninstallFunction(b);x.clear()}}let G=r.sqlite3_vfs_find("kvvfs");if(G)if(p.isUIThread()){let x=new r.sqlite3_kvvfs_methods(s.exports.sqlite3__wasm_kvvfs_methods());delete r.sqlite3_kvvfs_methods;let b=s.exports.sqlite3__wasm_kvvfsMakeKeyOnPstack,F=s.pstack,j=w=>s.peek(w)===115?sessionStorage:localStorage,z={xRead:(w,H,_,f)=>{let S=F.pointer,L=s.scopedAllocPush();try{let D=b(w,H);if(!D)return-3;let d=s.cstrToJs(D),l=j(w).getItem(d);if(!l)return-1;let c=l.length;if(f<=0)return c;if(f===1)return s.poke(_,0),c;let u=s.scopedAllocCString(l);return f>c+1&&(f=c+1),s.heap8u().copyWithin(_,u,u+f-1),s.poke(_+f-1,0),f-1}catch(D){return console.error("kvstorageRead()",D),-2}finally{F.restore(S),s.scopedAllocPop(L)}},xWrite:(w,H,_)=>{let f=F.pointer;try{let S=b(w,H);if(!S)return 1;let L=s.cstrToJs(S);return j(w).setItem(L,s.cstrToJs(_)),0}catch(S){return console.error("kvstorageWrite()",S),r.SQLITE_IOERR}finally{F.restore(f)}},xDelete:(w,H)=>{let _=F.pointer;try{let f=b(w,H);return f?(j(w).removeItem(s.cstrToJs(f)),0):1}catch(f){return console.error("kvstorageDelete()",f),r.SQLITE_IOERR}finally{F.restore(_)}}};for(let w of Object.keys(z))x[x.memberKey(w)]=s.installFunction(x.memberSignature(w),z[w])}else r.sqlite3_vfs_unregister(G);s.xWrap.FuncPtrAdapter.warnOnUse=!0;let A=t.StructBinder,I=function x(b,F,j,z=x.installMethodArgcCheck){if(b instanceof A.StructType?!(j instanceof Function)&&!s.isPtr(j)&&i("Usage errror: expecting a Function or WASM pointer to one."):i("Usage error: target object is-not-a StructType."),arguments.length===1)return(f,S)=>x(b,f,S,z);x.argcProxy||(x.argcProxy=function(f,S,L,D){return function(...d){return L.length!==arguments.length&&i("Argument mismatch for",f.structInfo.name+"::"+S+": Native signature is:",D),L.apply(this,d)}},x.removeFuncList=function(){this.ondispose.__removeFuncList&&(this.ondispose.__removeFuncList.forEach((f,S)=>{if(typeof f=="number")try{s.uninstallFunction(f)}catch{}}),delete this.ondispose.__removeFuncList)});let w=b.memberSignature(F);w.length<2&&i("Member",F,"does not have a function pointer signature:",w);let H=b.memberKey(F),_=z&&!s.isPtr(j)?x.argcProxy(b,H,j,w):j;if(s.isPtr(_))_&&!s.functionEntry(_)&&i("Pointer",_,"is not a WASM function table entry."),b[H]=_;else{let f=s.installFunction(_,b.memberSignature(F,!0));b[H]=f,(!b.ondispose||!b.ondispose.__removeFuncList)&&(b.addOnDispose("ondispose.__removeFuncList handler",x.removeFuncList),b.ondispose.__removeFuncList=[]),b.ondispose.__removeFuncList.push(H,f)}return(f,S)=>x(b,f,S,z)};I.installMethodArgcCheck=!1;let O=function(x,b,F=I.installMethodArgcCheck){let j=new Map;for(let z of Object.keys(b)){let w=b[z],H=j.get(w);if(H){let _=x.memberKey(z);x[_]=x[x.memberKey(H)]}else I(x,z,w,F),j.set(w,z)}return x};A.StructType.prototype.installMethod=function(b,F,j=I.installMethodArgcCheck){return arguments.length<3&&b&&typeof b=="object"?O(this,...arguments):I(this,...arguments)},A.StructType.prototype.installMethods=function(x,b=I.installMethodArgcCheck){return O(this,x,b)}}),globalThis.sqlite3ApiBootstrap.initializers.push(function(t){t.version={libVersion:"3.46.1",libVersionNumber:3046001,sourceId:"2024-08-13 09:16:08 c9c2ab54ba1f5f46360f1b4f35d849cd3f080e6fc2b6c60e91b16c63f69a1e33",downloadVersion:3460100}}),globalThis.sqlite3ApiBootstrap.initializers.push(function(t){let i=(...d)=>{throw new Error(d.join(" "))},o=(...d)=>{throw new t.SQLite3Error(...d)},r=t.capi,s=t.wasm,p=t.util,h=new WeakMap,R=new WeakMap,C=(d,l,c)=>{let u=Object.getOwnPropertyDescriptor(d,l);return u?u.value:c},Q=function(d,l){return l&&(d instanceof I&&(d=d.pointer),o(l,"sqlite3 result code",l+":",d?r.sqlite3_errmsg(d):r.sqlite3_errstr(l))),arguments[0]},U=s.installFunction("i(ippp)",function(d,l,c,u){r.SQLITE_TRACE_STMT===d&&console.log("SQL TRACE #"+ ++this.counter+" via sqlite3@"+l+":",s.cstrToJs(u))}.bind({counter:0})),G=Object.create(null),A=function d(...l){if(!d._name2vfs){d._name2vfs=Object.create(null);let ge=typeof importScripts=="function"?J=>o("The VFS for",J,"is only available in the main window thread."):!1;d._name2vfs[":localStorage:"]={vfs:"kvvfs",filename:ge||(()=>"local")},d._name2vfs[":sessionStorage:"]={vfs:"kvvfs",filename:ge||(()=>"session")}}let c=d.normalizeArgs(...l),u=c.filename,y=c.vfs,W=c.flags;(typeof u!="string"&&typeof u!="number"||typeof W!="string"||y&&typeof y!="string"&&typeof y!="number")&&(t.config.error("Invalid DB ctor args",c,arguments),o("Invalid arguments for DB constructor."));let Z=typeof u=="number"?s.cstrToJs(u):u,_e=d._name2vfs[Z];_e&&(y=_e.vfs,u=Z=_e.filename(Z));let oe,de=0;W.indexOf("c")>=0&&(de|=r.SQLITE_OPEN_CREATE|r.SQLITE_OPEN_READWRITE),W.indexOf("w")>=0&&(de|=r.SQLITE_OPEN_READWRITE),de===0&&(de|=r.SQLITE_OPEN_READONLY),de|=r.SQLITE_OPEN_EXRESCODE;let he=s.pstack.pointer;try{let ge=s.pstack.allocPtr(),J=r.sqlite3_open_v2(u,ge,de,y||0);oe=s.peekPtr(ge),Q(oe,J),r.sqlite3_extended_result_codes(oe,1),W.indexOf("t")>=0&&r.sqlite3_trace_v2(oe,r.SQLITE_TRACE_STMT,U,oe)}catch(ge){throw oe&&r.sqlite3_close_v2(oe),ge}finally{s.pstack.restore(he)}this.filename=Z,h.set(this,oe),R.set(this,Object.create(null));try{let ge=r.sqlite3_js_db_vfs(oe)||o("Internal error: cannot get VFS for new db handle."),J=G[ge];J&&(J instanceof Function?J(this,t):Q(oe,r.sqlite3_exec(oe,J,0,0,0)))}catch(ge){throw this.close(),ge}};A.setVfsPostOpenSql=function(d,l){G[d]=l},A.normalizeArgs=function(d=":memory:",l="c",c=null){let u={};return arguments.length===1&&arguments[0]&&typeof arguments[0]=="object"?(Object.assign(u,arguments[0]),u.flags===void 0&&(u.flags="c"),u.vfs===void 0&&(u.vfs=null),u.filename===void 0&&(u.filename=":memory:")):(u.filename=d,u.flags=l,u.vfs=c),u};let I=function(...d){A.apply(this,d)};I.dbCtorHelper=A;let O={null:1,number:2,string:3,boolean:4,blob:5};O.undefined==O.null,s.bigIntEnabled&&(O.bigint=O.number);let x=function(){O!==arguments[2]&&o(r.SQLITE_MISUSE,"Do not call the Stmt constructor directly. Use DB.prepare()."),this.db=arguments[0],h.set(this,arguments[1]),this.parameterCount=r.sqlite3_bind_parameter_count(this.pointer)},b=function(d){return d.pointer||o("DB has been closed."),d},F=function(d,l){return(l!==(l|0)||l<0||l>=d.columnCount)&&o("Column index",l,"is out of range."),d},j=function(d,l){let c=Object.create(null);switch(c.opt=Object.create(null),l.length){case 1:typeof l[0]=="string"||p.isSQLableTypedArray(l[0])||Array.isArray(l[0])?c.sql=l[0]:l[0]&&typeof l[0]=="object"&&(c.opt=l[0],c.sql=c.opt.sql);break;case 2:c.sql=l[0],c.opt=l[1];break;default:o("Invalid argument count for exec().")}c.sql=p.flexibleString(c.sql),typeof c.sql!="string"&&o("Missing SQL argument or unsupported SQL value type.");let u=c.opt;switch(u.returnValue){case"resultRows":u.resultRows||(u.resultRows=[]),c.returnVal=()=>u.resultRows;break;case"saveSql":u.saveSql||(u.saveSql=[]),c.returnVal=()=>u.saveSql;break;case void 0:case"this":c.returnVal=()=>d;break;default:o("Invalid returnValue value:",u.returnValue)}if(!u.callback&&!u.returnValue&&u.rowMode!==void 0&&(u.resultRows||(u.resultRows=[]),c.returnVal=()=>u.resultRows),u.callback||u.resultRows)switch(u.rowMode===void 0?"array":u.rowMode){case"object":c.cbArg=(y,W)=>{W.columnNames||(W.columnNames=y.getColumnNames([]));let Z=y.get([]),_e=Object.create(null);for(let oe in W.columnNames)_e[W.columnNames[oe]]=Z[oe];return _e};break;case"array":c.cbArg=y=>y.get([]);break;case"stmt":Array.isArray(u.resultRows)&&o("exec(): invalid rowMode for a resultRows array: must","be one of 'array', 'object',","a result column number, or column name reference."),c.cbArg=y=>y;break;default:if(p.isInt32(u.rowMode)){c.cbArg=y=>y.get(u.rowMode);break}else if(typeof u.rowMode=="string"&&u.rowMode.length>1&&u.rowMode[0]==="$"){let y=u.rowMode.substr(1);c.cbArg=W=>{let Z=W.get(Object.create(null))[y];return Z===void 0?o(r.SQLITE_NOTFOUND,"exec(): unknown result column:",y):Z};break}o("Invalid rowMode:",u.rowMode)}return c},z=(d,l,c,...u)=>{let y=d.prepare(l);try{let W=y.bind(c).step()?y.get(...u):void 0;return y.reset(),W}finally{y.finalize()}},w=(d,l,c,u)=>d.exec({sql:l,bind:c,rowMode:u,returnValue:"resultRows"});I.checkRc=(d,l)=>Q(d,l),I.prototype={isOpen:function(){return!!this.pointer},affirmOpen:function(){return b(this)},close:function(){if(this.pointer){if(this.onclose&&this.onclose.before instanceof Function)try{this.onclose.before(this)}catch{}let d=this.pointer;if(Object.keys(R.get(this)).forEach((l,c)=>{if(c&&c.pointer)try{c.finalize()}catch{}}),h.delete(this),R.delete(this),r.sqlite3_close_v2(d),this.onclose&&this.onclose.after instanceof Function)try{this.onclose.after(this)}catch{}delete this.filename}},changes:function(d=!1,l=!1){let c=b(this).pointer;return d?l?r.sqlite3_total_changes64(c):r.sqlite3_total_changes(c):l?r.sqlite3_changes64(c):r.sqlite3_changes(c)},dbFilename:function(d="main"){return r.sqlite3_db_filename(b(this).pointer,d)},dbName:function(d=0){return r.sqlite3_db_name(b(this).pointer,d)},dbVfsName:function(d=0){let l,c=r.sqlite3_js_db_vfs(b(this).pointer,d);if(c){let u=new r.sqlite3_vfs(c);try{l=s.cstrToJs(u.$zName)}finally{u.dispose()}}return l},prepare:function(d){b(this);let l=s.pstack.pointer,c,u;try{c=s.pstack.alloc(8),I.checkRc(this,r.sqlite3_prepare_v2(this.pointer,d,-1,c,null)),u=s.peekPtr(c)}finally{s.pstack.restore(l)}u||o("Cannot prepare empty SQL.");let y=new x(this,u,O);return R.get(this)[u]=y,y},exec:function(){b(this);let d=j(this,arguments);if(!d.sql)return o("exec() requires an SQL string.");let l=d.opt,c=l.callback,u=Array.isArray(l.resultRows)?l.resultRows:void 0,y,W=l.bind,Z=!!(d.cbArg||l.columnNames||u),_e=s.scopedAllocPush(),oe=Array.isArray(l.saveSql)?l.saveSql:void 0;try{let de=p.isSQLableTypedArray(d.sql),he=de?d.sql.byteLength:s.jstrlen(d.sql),ge=s.scopedAlloc(2*s.ptrSizeof+(he+1)),J=ge+s.ptrSizeof,E=J+s.ptrSizeof,N=E+he;for(de?s.heap8().set(d.sql,E):s.jstrcpy(d.sql,s.heap8(),E,he,!1),s.poke(E+he,0);E&&s.peek(E,"i8");){s.pokePtr([ge,J],0),I.checkRc(this,r.sqlite3_prepare_v3(this.pointer,E,he,0,ge,J));let $=s.peekPtr(ge);if(E=s.peekPtr(J),he=N-E,!!$){if(oe&&oe.push(r.sqlite3_sql($).trim()),y=new x(this,$,O),W&&y.parameterCount&&(y.bind(W),W=null),Z&&y.columnCount){let g=Array.isArray(l.columnNames)?0:1;if(Z=!1,d.cbArg||u){let k=Object.create(null);for(;y.step();y._lockedByExec=!1){g++===0&&y.getColumnNames(k.columnNames=l.columnNames||[]),y._lockedByExec=!0;let P=d.cbArg(y,k);if(u&&u.push(P),c&&c.call(l,P,y)===!1)break}y._lockedByExec=!1}g===0&&y.getColumnNames(l.columnNames)}else y.step();y.reset().finalize(),y=null}}}finally{s.scopedAllocPop(_e),y&&(delete y._lockedByExec,y.finalize())}return d.returnVal()},createFunction:function(l,c,u){let y=k=>k instanceof Function;switch(arguments.length){case 1:u=l,l=u.name,c=u.xFunc||0;break;case 2:y(c)||(u=c,c=u.xFunc||0);break;case 3:break;default:break}u||(u={}),typeof l!="string"&&o("Invalid arguments: missing function name.");let W=u.xStep||0,Z=u.xFinal||0,_e=u.xValue||0,oe=u.xInverse||0,de;y(c)?(de=!1,(y(W)||y(Z))&&o("Ambiguous arguments: scalar or aggregate?"),W=Z=null):y(W)?(y(Z)||o("Missing xFinal() callback for aggregate or window UDF."),c=null):y(Z)?o("Missing xStep() callback for aggregate or window UDF."):o("Missing function-type properties."),de===!1?(y(_e)||y(oe))&&o("xValue and xInverse are not permitted for non-window UDFs."):y(_e)?(y(oe)||o("xInverse must be provided if xValue is."),de=!0):y(oe)&&o("xValue must be provided if xInverse is.");let he=u.pApp;he!=null&&(typeof he!="number"||!p.isInt32(he))&&o("Invalid value for pApp property. Must be a legal WASM pointer value.");let ge=u.xDestroy||0;ge&&!y(ge)&&o("xDestroy property must be a function.");let J=0;C(u,"deterministic")&&(J|=r.SQLITE_DETERMINISTIC),C(u,"directOnly")&&(J|=r.SQLITE_DIRECTONLY),C(u,"innocuous")&&(J|=r.SQLITE_INNOCUOUS),l=l.toLowerCase();let E=c||W,N=C(u,"arity"),$=typeof N=="number"?N:E.length?E.length-1:0,g;return de?g=r.sqlite3_create_window_function(this.pointer,l,$,r.SQLITE_UTF8|J,he||0,W,Z,_e,oe,ge):g=r.sqlite3_create_function_v2(this.pointer,l,$,r.SQLITE_UTF8|J,he||0,c,W,Z,ge),I.checkRc(this,g),this},selectValue:function(d,l,c){return z(this,d,l,0,c)},selectValues:function(d,l,c){let u=this.prepare(d),y=[];try{for(u.bind(l);u.step();)y.push(u.get(0,c));u.reset()}finally{u.finalize()}return y},selectArray:function(d,l){return z(this,d,l,[])},selectObject:function(d,l){return z(this,d,l,{})},selectArrays:function(d,l){return w(this,d,l,"array")},selectObjects:function(d,l){return w(this,d,l,"object")},openStatementCount:function(){return this.pointer?Object.keys(R.get(this)).length:0},transaction:function(d){let l="BEGIN";arguments.length>1&&(/[^a-zA-Z]/.test(arguments[0])&&o(r.SQLITE_MISUSE,"Invalid argument for BEGIN qualifier."),l+=" "+arguments[0],d=arguments[1]),b(this).exec(l);try{let c=d(this);return this.exec("COMMIT"),c}catch(c){throw this.exec("ROLLBACK"),c}},savepoint:function(d){b(this).exec("SAVEPOINT oo1");try{let l=d(this);return this.exec("RELEASE oo1"),l}catch(l){throw this.exec("ROLLBACK to SAVEPOINT oo1; RELEASE SAVEPOINT oo1"),l}},checkRc:function(d){return Q(this,d)}};let H=function(d){return d.pointer||o("Stmt has been closed."),d},_=function(d){let l=O[d==null?"null":typeof d];switch(l){case O.boolean:case O.null:case O.number:case O.string:return l;case O.bigint:if(s.bigIntEnabled)return l;default:return p.isBindableTypedArray(d)?O.blob:void 0}},f=function(d){return _(d)||o("Unsupported bind() argument type:",typeof d)},S=function(d,l){let c=typeof l=="number"?l:r.sqlite3_bind_parameter_index(d.pointer,l);return c===0||!p.isInt32(c)?o("Invalid bind() parameter name: "+l):(c<1||c>d.parameterCount)&&o("Bind index",l,"is out of range."),c},L=function(d,l){return d._lockedByExec&&o("Operation is illegal when statement is locked:",l),d},D=function d(l,c,u,y){L(H(l),"bind()"),d._||(d._tooBigInt=Z=>o("BigInt value is too big to store without precision loss:",Z),d._={string:function(Z,_e,oe,de){let[he,ge]=s.allocCString(oe,!0);return(de?r.sqlite3_bind_blob:r.sqlite3_bind_text)(Z.pointer,_e,he,ge,r.SQLITE_WASM_DEALLOC)}}),f(y),c=S(l,c);let W=0;switch(y==null?O.null:u){case O.null:W=r.sqlite3_bind_null(l.pointer,c);break;case O.string:W=d._.string(l,c,y,!1);break;case O.number:{let Z;p.isInt32(y)?Z=r.sqlite3_bind_int:typeof y=="bigint"?p.bigIntFits64(y)?s.bigIntEnabled?Z=r.sqlite3_bind_int64:p.bigIntFitsDouble(y)?(y=Number(y),Z=r.sqlite3_bind_double):d._tooBigInt(y):d._tooBigInt(y):(y=Number(y),s.bigIntEnabled&&Number.isInteger(y)?Z=r.sqlite3_bind_int64:Z=r.sqlite3_bind_double),W=Z(l.pointer,c,y);break}case O.boolean:W=r.sqlite3_bind_int(l.pointer,c,y?1:0);break;case O.blob:{if(typeof y=="string"){W=d._.string(l,c,y,!0);break}else y instanceof ArrayBuffer?y=new Uint8Array(y):p.isBindableTypedArray(y)||o("Binding a value as a blob requires","that it be a string, Uint8Array, Int8Array, or ArrayBuffer.");let Z=s.alloc(y.byteLength||1);s.heap8().set(y.byteLength?y:[0],Z),W=r.sqlite3_bind_blob(l.pointer,c,Z,y.byteLength,r.SQLITE_WASM_DEALLOC);break}default:t.config.warn("Unsupported bind() argument type:",y),o("Unsupported bind() argument type: "+typeof y)}return W&&I.checkRc(l.db.pointer,W),l._mayGet=!1,l};x.prototype={finalize:function(){if(this.pointer){L(this,"finalize()");let d=r.sqlite3_finalize(this.pointer);return delete R.get(this.db)[this.pointer],h.delete(this),delete this._mayGet,delete this.parameterCount,delete this._lockedByExec,delete this.db,d}},clearBindings:function(){return L(H(this),"clearBindings()"),r.sqlite3_clear_bindings(this.pointer),this._mayGet=!1,this},reset:function(d){L(this,"reset()"),d&&this.clearBindings();let l=r.sqlite3_reset(H(this).pointer);return this._mayGet=!1,Q(this.db,l),this},bind:function(){H(this);let d,l;switch(arguments.length){case 1:d=1,l=arguments[0];break;case 2:d=arguments[0],l=arguments[1];break;default:o("Invalid bind() arguments.")}return l===void 0?this:(this.parameterCount||o("This statement has no bindable parameters."),this._mayGet=!1,l===null?D(this,d,O.null,l):Array.isArray(l)?(arguments.length!==1&&o("When binding an array, an index argument is not permitted."),l.forEach((c,u)=>D(this,u+1,f(c),c)),this):(l instanceof ArrayBuffer&&(l=new Uint8Array(l)),typeof l=="object"&&!p.isBindableTypedArray(l)?(arguments.length!==1&&o("When binding an object, an index argument is not permitted."),Object.keys(l).forEach(c=>D(this,c,f(l[c]),l[c])),this):D(this,d,f(l),l)))},bindAsBlob:function(d,l){H(this),arguments.length===1&&(l=d,d=1);let c=f(l);return O.string!==c&&O.blob!==c&&O.null!==c&&o("Invalid value type for bindAsBlob()"),D(this,d,O.blob,l)},step:function(){L(this,"step()");let d=r.sqlite3_step(H(this).pointer);switch(d){case r.SQLITE_DONE:return this._mayGet=!1;case r.SQLITE_ROW:return this._mayGet=!0;default:this._mayGet=!1,t.config.warn("sqlite3_step() rc=",d,r.sqlite3_js_rc_str(d),"SQL =",r.sqlite3_sql(this.pointer)),I.checkRc(this.db.pointer,d)}},stepReset:function(){return this.step(),this.reset()},stepFinalize:function(){try{let d=this.step();return this.reset(),d}finally{try{this.finalize()}catch{}}},get:function(d,l){if(H(this)._mayGet||o("Stmt.step() has not (recently) returned true."),Array.isArray(d)){let c=0,u=this.columnCount;for(;c<u;)d[c]=this.get(c++);return d}else if(d&&typeof d=="object"){let c=0,u=this.columnCount;for(;c<u;)d[r.sqlite3_column_name(this.pointer,c)]=this.get(c++);return d}switch(F(this,d),l===void 0?r.sqlite3_column_type(this.pointer,d):l){case r.SQLITE_NULL:return null;case r.SQLITE_INTEGER:if(s.bigIntEnabled){let c=r.sqlite3_column_int64(this.pointer,d);return c>=Number.MIN_SAFE_INTEGER&&c<=Number.MAX_SAFE_INTEGER?Number(c).valueOf():c}else{let c=r.sqlite3_column_double(this.pointer,d);return(c>Number.MAX_SAFE_INTEGER||c<Number.MIN_SAFE_INTEGER)&&o("Integer is out of range for JS integer range: "+c),p.isInt32(c)?c|0:c}case r.SQLITE_FLOAT:return r.sqlite3_column_double(this.pointer,d);case r.SQLITE_TEXT:return r.sqlite3_column_text(this.pointer,d);case r.SQLITE_BLOB:{let c=r.sqlite3_column_bytes(this.pointer,d),u=r.sqlite3_column_blob(this.pointer,d),y=new Uint8Array(c);return c&&y.set(s.heap8u().slice(u,u+c),0),c&&this.db._blobXfer instanceof Array&&this.db._blobXfer.push(y.buffer),y}default:o("Don't know how to translate","type of result column #"+d+".")}o("Not reached.")},getInt:function(d){return this.get(d,r.SQLITE_INTEGER)},getFloat:function(d){return this.get(d,r.SQLITE_FLOAT)},getString:function(d){return this.get(d,r.SQLITE_TEXT)},getBlob:function(d){return this.get(d,r.SQLITE_BLOB)},getJSON:function(d){let l=this.get(d,r.SQLITE_STRING);return l===null?l:JSON.parse(l)},getColumnName:function(d){return r.sqlite3_column_name(F(H(this),d).pointer,d)},getColumnNames:function(d=[]){F(H(this),0);let l=this.columnCount;for(let c=0;c<l;++c)d.push(r.sqlite3_column_name(this.pointer,c));return d},getParamIndex:function(d){return H(this).parameterCount?r.sqlite3_bind_parameter_index(this.pointer,d):void 0}};{let d={enumerable:!0,get:function(){return h.get(this)},set:()=>o("The pointer property is read-only.")};Object.defineProperty(x.prototype,"pointer",d),Object.defineProperty(I.prototype,"pointer",d)}if(Object.defineProperty(x.prototype,"columnCount",{enumerable:!1,get:function(){return r.sqlite3_column_count(this.pointer)},set:()=>o("The columnCount property is read-only.")}),t.oo1={DB:I,Stmt:x},p.isUIThread()){t.oo1.JsStorageDb=function(l="session"){let c=A.normalizeArgs(...arguments);l=c.filename,l!=="session"&&l!=="local"&&o("JsStorageDb db name must be one of 'session' or 'local'."),c.vfs="kvvfs",A.call(this,c)};let d=t.oo1.JsStorageDb;d.prototype=Object.create(I.prototype),d.clearStorage=r.sqlite3_js_kvvfs_clear,d.prototype.clearStorage=function(){return d.clearStorage(b(this).filename)},d.storageSize=r.sqlite3_js_kvvfs_size,d.prototype.storageSize=function(){return d.storageSize(b(this).filename)}}}),globalThis.sqlite3ApiBootstrap.initializers.push(function(t){let i=t.util;t.initWorker1API=function(){"use strict";let o=(...A)=>{throw new Error(A.join(" "))};globalThis.WorkerGlobalScope instanceof Function||o("initWorker1API() must be run from a Worker thread.");let r=this.sqlite3||o("Missing this.sqlite3 object."),s=r.oo1.DB,p=function(A){let I=h.idMap.get(A);return I||(I="db#"+ ++h.idSeq+"@"+A.pointer,h.idMap.set(A,I),I)},h={dbList:[],idSeq:0,idMap:new WeakMap,xfer:[],open:function(A){let I=new s(A);return this.dbs[p(I)]=I,this.dbList.indexOf(I)<0&&this.dbList.push(I),I},close:function(A,I){if(A){delete this.dbs[p(A)];let O=A.filename,x=i.sqlite3__wasm_db_vfs(A.pointer,0);A.close();let b=this.dbList.indexOf(A);b>=0&&this.dbList.splice(b,1),I&&O&&x&&i.sqlite3__wasm_vfs_unlink(x,O)}},post:function(A,I){I&&I.length?(globalThis.postMessage(A,Array.from(I)),I.length=0):globalThis.postMessage(A)},dbs:Object.create(null),getDb:function(A,I=!0){return this.dbs[A]||(I?o("Unknown (or closed) DB ID:",A):void 0)}},R=function(A=h.dbList[0]){return A&&A.pointer?A:o("DB is not opened.")},C=function(A,I=!0){let O=h.getDb(A.dbId,!1)||h.dbList[0];return I?R(O):O},Q=function(){return h.dbList[0]&&p(h.dbList[0])},U=A=>A===""||A[0]===":",G={open:function(A){let I=Object.create(null),O=A.args||Object.create(null);O.simulateError&&o("Throwing because of simulateError flag.");let x=Object.create(null);I.vfs=O.vfs,I.filename=O.filename||"";let b=h.open(I);return x.filename=b.filename,x.persistent=!!r.capi.sqlite3_js_db_uses_vfs(b.pointer,"opfs"),x.dbId=p(b),x.vfs=b.dbVfsName(),x},close:function(A){let I=C(A,!1),O={filename:I&&I.filename};if(I){let x=A.args&&typeof A.args=="object"?!!A.args.unlink:!1;h.close(I,x)}return O},exec:function(A){let I=typeof A.args=="string"?{sql:A.args}:A.args||Object.create(null);I.rowMode==="stmt"?o("Invalid rowMode for 'exec': stmt mode","does not work in the Worker API."):I.sql||o("'exec' requires input SQL.");let O=C(A);(I.callback||Array.isArray(I.resultRows))&&(O._blobXfer=h.xfer);let x=I.callback,b=0,F=!!I.columnNames;typeof x=="string"&&(F||(I.columnNames=[]),I.callback=function(j,z){h.post({type:x,columnNames:I.columnNames,rowNumber:++b,row:j},h.xfer)});try{let j=I.countChanges?O.changes(!0,I.countChanges===64):void 0;O.exec(I),j!==void 0&&(I.changeCount=O.changes(!0,I.countChanges===64)-j),I.callback instanceof Function&&(I.callback=x,h.post({type:x,columnNames:I.columnNames,rowNumber:null,row:void 0}))}finally{delete O._blobXfer,I.callback&&(I.callback=x)}return I},"config-get":function(){let A=Object.create(null),I=r.config;return["bigIntEnabled"].forEach(function(O){Object.getOwnPropertyDescriptor(I,O)&&(A[O]=I[O])}),A.version=r.version,A.vfsList=r.capi.sqlite3_js_vfs_list(),A.opfsEnabled=!!r.opfs,A},export:function(A){let I=C(A),O={byteArray:r.capi.sqlite3_js_db_export(I.pointer),filename:I.filename,mimetype:"application/x-sqlite3"};return h.xfer.push(O.byteArray.buffer),O},toss:function(A){o("Testing worker exception")},"opfs-tree":async function(A){return r.opfs||o("OPFS support is unavailable."),await r.opfs.treeList()}};globalThis.onmessage=async function(A){A=A.data;let I,O=A.dbId,x=A.type,b=performance.now();try{G.hasOwnProperty(x)&&G[x]instanceof Function?I=await G[x](A):o("Unknown db worker message type:",A.type)}catch(F){x="error",I={operation:A.type,message:F.message,errorClass:F.name,input:A},F.stack&&(I.stack=typeof F.stack=="string"?F.stack.split(/\n\s*/):F.stack)}O||(O=I.dbId||Q()),h.post({type:x,dbId:O,messageId:A.messageId,workerReceivedTime:b,workerRespondTime:performance.now(),departureTime:A.departureTime,result:I},h.xfer)},globalThis.postMessage({type:"sqlite3-api",result:"worker1-ready"})}.bind({sqlite3:t})}),globalThis.sqlite3ApiBootstrap.initializers.push(function(t){let i=t.wasm,o=t.capi,r=t.util.toss3,s=Object.create(null);t.vfs=s,o.sqlite3_vfs.prototype.registerVfs=function(p=!1){this instanceof t.capi.sqlite3_vfs||r("Expecting a sqlite3_vfs-type argument.");let h=o.sqlite3_vfs_register(this,p?1:0);return h&&r("sqlite3_vfs_register(",this,") failed with rc",h),this.pointer!==o.sqlite3_vfs_find(this.$zName)&&r("BUG: sqlite3_vfs_find(vfs.$zName) failed for just-installed VFS",this),this},s.installVfs=function(p){let h=0,R=["io","vfs"];for(let C of R){let Q=p[C];Q&&(++h,Q.struct.installMethods(Q.methods,!!Q.applyArgcCheck),C==="vfs"&&(!Q.struct.$zName&&typeof Q.name=="string"&&Q.struct.addOnDispose(Q.struct.$zName=i.allocCString(Q.name)),Q.struct.registerVfs(!!Q.asDefault)))}return h||r("Misuse: installVfs() options object requires at least","one of:",R),this}}),globalThis.sqlite3ApiBootstrap.initializers.push(function(t){let i=t.wasm,o=t.capi,r=t.util.toss3,s=Object.create(null);t.vtab=s;let p=o.sqlite3_index_info;p.prototype.nthConstraint=function(C,Q=!1){if(C<0||C>=this.$nConstraint)return!1;let U=this.$aConstraint+p.sqlite3_index_constraint.structInfo.sizeof*C;return Q?U:new p.sqlite3_index_constraint(U)},p.prototype.nthConstraintUsage=function(C,Q=!1){if(C<0||C>=this.$nConstraint)return!1;let U=this.$aConstraintUsage+p.sqlite3_index_constraint_usage.structInfo.sizeof*C;return Q?U:new p.sqlite3_index_constraint_usage(U)},p.prototype.nthOrderBy=function(C,Q=!1){if(C<0||C>=this.$nOrderBy)return!1;let U=this.$aOrderBy+p.sqlite3_index_orderby.structInfo.sizeof*C;return Q?U:new p.sqlite3_index_orderby(U)};let h=function(C,Q){return function(U,G=!1){if(arguments.length===0&&(U=new Q),U instanceof Q)return this.set(U.pointer,U),U;i.isPtr(U)||t.SQLite3Error.toss("Invalid argument to",C+"()");let A=this.get(U);return G&&this.delete(U),A}.bind(new Map)},R=function(C,Q){let U=h(C,Q);return Object.assign(Object.create(null),{StructType:Q,create:G=>{let A=U();return i.pokePtr(G,A.pointer),A},get:G=>U(G),unget:G=>U(G,!0),dispose:G=>{let A=U(G,!0);A&&A.dispose()}})};s.xVtab=R("xVtab",o.sqlite3_vtab),s.xCursor=R("xCursor",o.sqlite3_vtab_cursor),s.xIndexInfo=C=>new o.sqlite3_index_info(C),s.xError=function C(Q,U,G){if(C.errorReporter instanceof Function)try{C.errorReporter("sqlite3_module::"+Q+"(): "+U.message)}catch{}let A;return U instanceof t.WasmAllocError?A=o.SQLITE_NOMEM:arguments.length>2?A=G:U instanceof t.SQLite3Error&&(A=U.resultCode),A||o.SQLITE_ERROR},s.xError.errorReporter=console.error.bind(console),s.xRowid=(C,Q)=>i.poke(C,Q,"i64"),s.setupModule=function(C){let Q=!1,U=this instanceof o.sqlite3_module?this:C.struct||(Q=new o.sqlite3_module);try{let G=C.methods||r("Missing 'methods' object.");for(let A of Object.entries({xConnect:"xCreate",xDisconnect:"xDestroy"})){let I=A[0],O=A[1];G[I]===!0?G[I]=G[O]:G[O]===!0&&(G[O]=G[I])}if(C.catchExceptions){let A=function(x,b){return["xConnect","xCreate"].indexOf(x)>=0?function(F,j,z,w,H,_){try{return b(...arguments)||0}catch(f){return f instanceof t.WasmAllocError||(i.dealloc(i.peekPtr(_)),i.pokePtr(_,i.allocCString(f.message))),s.xError(x,f)}}:function(...F){try{return b(...F)||0}catch(j){return s.xError(x,j)}}},I=["xCreate","xConnect","xBestIndex","xDisconnect","xDestroy","xOpen","xClose","xFilter","xNext","xEof","xColumn","xRowid","xUpdate","xBegin","xSync","xCommit","xRollback","xFindFunction","xRename","xSavepoint","xRelease","xRollbackTo","xShadowName"],O=Object.create(null);for(let x of I){let b=G[x];if(b instanceof Function)x==="xConnect"&&G.xCreate===b?O[x]=G.xCreate:x==="xCreate"&&G.xConnect===b?O[x]=G.xConnect:O[x]=A(x,b);else continue}U.installMethods(O,!1)}else U.installMethods(G,!!C.applyArgcCheck);if(U.$iVersion===0){let A;typeof C.iVersion=="number"?A=C.iVersion:U.$xShadowName?A=3:U.$xSavePoint||U.$xRelease||U.$xRollbackTo?A=2:A=1,U.$iVersion=A}}catch(G){throw Q&&Q.dispose(),G}return U},o.sqlite3_module.prototype.setupModule=function(C){return s.setupModule.call(this,C)}}),globalThis.sqlite3ApiBootstrap.initializers.push(function(t){let i=function o(r){if(!globalThis.SharedArrayBuffer||!globalThis.Atomics)return Promise.reject(new Error("Cannot install OPFS: Missing SharedArrayBuffer and/or Atomics. The server must emit the COOP/COEP response headers to enable those. See https://sqlite.org/wasm/doc/trunk/persistence.md#coop-coep"));if(typeof WorkerGlobalScope>"u")return Promise.reject(new Error("The OPFS sqlite3_vfs cannot run in the main thread because it requires Atomics.wait()."));if(!globalThis.FileSystemHandle||!globalThis.FileSystemDirectoryHandle||!globalThis.FileSystemFileHandle||!globalThis.FileSystemFileHandle.prototype.createSyncAccessHandle||!navigator?.storage?.getDirectory)return Promise.reject(new Error("Missing required OPFS APIs."));(!r||typeof r!="object")&&(r=Object.create(null));let s=new URL(globalThis.location.href).searchParams;return s.has("opfs-disable")?Promise.resolve(t):(r.verbose===void 0&&(r.verbose=s.has("opfs-verbose")?+s.get("opfs-verbose")||2:1),r.sanityChecks===void 0&&(r.sanityChecks=s.has("opfs-sanity-check")),r.proxyUri===void 0&&(r.proxyUri=o.defaultProxyUri),typeof r.proxyUri=="function"&&(r.proxyUri=r.proxyUri()),new Promise(function(h,R){let C=[t.config.error,t.config.warn,t.config.log],Q=(g,...k)=>{r.verbose>g&&C[g]("OPFS syncer:",...k)},U=(...g)=>Q(2,...g),G=(...g)=>Q(1,...g),A=(...g)=>Q(0,...g),I=t.util.toss,O=t.capi,x=t.util,b=t.wasm,F=O.sqlite3_vfs,j=O.sqlite3_file,z=O.sqlite3_io_methods,w=Object.create(null),H=()=>globalThis.FileSystemHandle&&globalThis.FileSystemDirectoryHandle&&globalThis.FileSystemFileHandle&&globalThis.FileSystemFileHandle.prototype.createSyncAccessHandle&&navigator?.storage?.getDirectory;w.metrics={dump:function(){let g,k=0,P=0,X=0;for(g in u.opIds){let V=y[g];k+=V.count,P+=V.time,X+=V.wait,V.avgTime=V.count&&V.time?V.time/V.count:0,V.avgWait=V.count&&V.wait?V.wait/V.count:0}t.config.log(globalThis.location.href,"metrics for",globalThis.location.href,":",y,`
Total of`,k,"op(s) for",P,"ms (incl. "+X+" ms of waiting on the async side)"),t.config.log("Serialization metrics:",y.s11n),d.postMessage({type:"opfs-async-metrics"})},reset:function(){let g,k=X=>X.count=X.time=X.wait=0;for(g in u.opIds)k(y[g]=Object.create(null));let P=y.s11n=Object.create(null);P=P.serialize=Object.create(null),P.count=P.time=0,P=y.s11n.deserialize=Object.create(null),P.count=P.time=0}};let _=new z,f=new F().addOnDispose(()=>_.dispose()),S,L=g=>(S=!0,f.dispose(),R(g)),D=()=>(S=!1,h(t)),d=new Worker(new URL("sqlite3-opfs-async-proxy.js",import.meta.url));setTimeout(()=>{S===void 0&&L(new Error("Timeout while waiting for OPFS async proxy worker."))},4e3),d._originalOnError=d.onerror,d.onerror=function(g){A("Error initializing OPFS asyncer:",g),L(new Error("Loading OPFS async Worker failed for unknown reasons."))};let l=O.sqlite3_vfs_find(null),c=l?new F(l):null;_.$iVersion=1,f.$iVersion=2,f.$szOsFile=O.sqlite3_file.structInfo.sizeof,f.$mxPathname=1024,f.$zName=b.allocCString("opfs"),f.$xDlOpen=f.$xDlError=f.$xDlSym=f.$xDlClose=null,f.addOnDispose("$zName",f.$zName,"cleanup default VFS wrapper",()=>c?c.dispose():null);let u=Object.create(null);u.verbose=r.verbose,u.littleEndian=(()=>{let g=new ArrayBuffer(2);return new DataView(g).setInt16(0,256,!0),new Int16Array(g)[0]===256})(),u.asyncIdleWaitTime=150,u.asyncS11nExceptions=1,u.fileBufferSize=1024*64,u.sabS11nOffset=u.fileBufferSize,u.sabS11nSize=f.$mxPathname*2,u.sabIO=new SharedArrayBuffer(u.fileBufferSize+u.sabS11nSize),u.opIds=Object.create(null);let y=Object.create(null);{let g=0;u.opIds.whichOp=g++,u.opIds.rc=g++,u.opIds.xAccess=g++,u.opIds.xClose=g++,u.opIds.xDelete=g++,u.opIds.xDeleteNoWait=g++,u.opIds.xFileSize=g++,u.opIds.xLock=g++,u.opIds.xOpen=g++,u.opIds.xRead=g++,u.opIds.xSleep=g++,u.opIds.xSync=g++,u.opIds.xTruncate=g++,u.opIds.xUnlock=g++,u.opIds.xWrite=g++,u.opIds.mkdir=g++,u.opIds["opfs-async-metrics"]=g++,u.opIds["opfs-async-shutdown"]=g++,u.opIds.retry=g++,u.sabOP=new SharedArrayBuffer(g*4),w.metrics.reset()}u.sq3Codes=Object.create(null),["SQLITE_ACCESS_EXISTS","SQLITE_ACCESS_READWRITE","SQLITE_BUSY","SQLITE_CANTOPEN","SQLITE_ERROR","SQLITE_IOERR","SQLITE_IOERR_ACCESS","SQLITE_IOERR_CLOSE","SQLITE_IOERR_DELETE","SQLITE_IOERR_FSYNC","SQLITE_IOERR_LOCK","SQLITE_IOERR_READ","SQLITE_IOERR_SHORT_READ","SQLITE_IOERR_TRUNCATE","SQLITE_IOERR_UNLOCK","SQLITE_IOERR_WRITE","SQLITE_LOCK_EXCLUSIVE","SQLITE_LOCK_NONE","SQLITE_LOCK_PENDING","SQLITE_LOCK_RESERVED","SQLITE_LOCK_SHARED","SQLITE_LOCKED","SQLITE_MISUSE","SQLITE_NOTFOUND","SQLITE_OPEN_CREATE","SQLITE_OPEN_DELETEONCLOSE","SQLITE_OPEN_MAIN_DB","SQLITE_OPEN_READONLY"].forEach(g=>{(u.sq3Codes[g]=O[g])===void 0&&I("Maintenance required: not found:",g)}),u.opfsFlags=Object.assign(Object.create(null),{OPFS_UNLOCK_ASAP:1,OPFS_UNLINK_BEFORE_OPEN:2,defaultUnlockAsap:!1});let W=(g,...k)=>{let P=u.opIds[g]||I("Invalid op ID:",g);u.s11n.serialize(...k),Atomics.store(u.sabOPView,u.opIds.rc,-1),Atomics.store(u.sabOPView,u.opIds.whichOp,P),Atomics.notify(u.sabOPView,u.opIds.whichOp);let X=performance.now();for(;Atomics.wait(u.sabOPView,u.opIds.rc,-1)!=="not-equal";);let V=Atomics.load(u.sabOPView,u.opIds.rc);if(y[g].wait+=performance.now()-X,V&&u.asyncS11nExceptions){let ae=u.s11n.deserialize();ae&&A(g+"() async error:",...ae)}return V};w.debug={asyncShutdown:()=>{G("Shutting down OPFS async listener. The OPFS VFS will no longer work."),W("opfs-async-shutdown")},asyncRestart:()=>{G("Attempting to restart OPFS VFS async listener. Might work, might not."),d.postMessage({type:"opfs-async-restart"})}};let Z=()=>{if(u.s11n)return u.s11n;let g=new TextDecoder,k=new TextEncoder("utf-8"),P=new Uint8Array(u.sabIO,u.sabS11nOffset,u.sabS11nSize),X=new DataView(u.sabIO,u.sabS11nOffset,u.sabS11nSize);u.s11n=Object.create(null);let V=Object.create(null);V.number={id:1,size:8,getter:"getFloat64",setter:"setFloat64"},V.bigint={id:2,size:8,getter:"getBigInt64",setter:"setBigInt64"},V.boolean={id:3,size:4,getter:"getInt32",setter:"setInt32"},V.string={id:4};let ae=ie=>V[typeof ie]||I("Maintenance required: this value type cannot be serialized.",ie),ce=ie=>{switch(ie){case V.number.id:return V.number;case V.bigint.id:return V.bigint;case V.boolean.id:return V.boolean;case V.string.id:return V.string;default:I("Invalid type ID:",ie)}};return u.s11n.deserialize=function(ie=!1){++y.s11n.deserialize.count;let Oe=performance.now(),Fe=P[0],T=Fe?[]:null;if(Fe){let Y=[],ee=1,re,Ee,Ae;for(re=0;re<Fe;++re,++ee)Y.push(ce(P[ee]));for(re=0;re<Fe;++re){let Se=Y[re];Se.getter?(Ae=X[Se.getter](ee,u.littleEndian),ee+=Se.size):(Ee=X.getInt32(ee,u.littleEndian),ee+=4,Ae=g.decode(P.slice(ee,ee+Ee)),ee+=Ee),T.push(Ae)}}return ie&&(P[0]=0),y.s11n.deserialize.time+=performance.now()-Oe,T},u.s11n.serialize=function(...ie){let Oe=performance.now();if(++y.s11n.serialize.count,ie.length){let Fe=[],T=0,Y=1;for(P[0]=ie.length&255;T<ie.length;++T,++Y)Fe.push(ae(ie[T])),P[Y]=Fe[T].id;for(T=0;T<ie.length;++T){let ee=Fe[T];if(ee.setter)X[ee.setter](Y,ie[T],u.littleEndian),Y+=ee.size;else{let re=k.encode(ie[T]);X.setInt32(Y,re.byteLength,u.littleEndian),Y+=4,P.set(re,Y),Y+=re.byteLength}}}else P[0]=0;y.s11n.serialize.time+=performance.now()-Oe},u.s11n},_e=function g(k=16){g._chars||(g._chars="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ012346789",g._n=g._chars.length);let P=[],X=0;for(;X<k;++X){let V=Math.random()*(g._n*64)%g._n|0;P[X]=g._chars[V]}return P.join("")},oe=Object.create(null),de=Object.create(null);de.op=void 0,de.start=void 0;let he=g=>{de.start=performance.now(),de.op=g,++y[g].count},ge=()=>y[de.op].time+=performance.now()-de.start,J={xCheckReservedLock:function(g,k){return b.poke(k,0,"i32"),0},xClose:function(g){he("xClose");let k=0,P=oe[g];return P&&(delete oe[g],k=W("xClose",g),P.sq3File&&P.sq3File.dispose()),ge(),k},xDeviceCharacteristics:function(g){return O.SQLITE_IOCAP_UNDELETABLE_WHEN_OPEN},xFileControl:function(g,k,P){return O.SQLITE_NOTFOUND},xFileSize:function(g,k){he("xFileSize");let P=W("xFileSize",g);if(P==0)try{let X=u.s11n.deserialize()[0];b.poke(k,X,"i64")}catch(X){A("Unexpected error reading xFileSize() result:",X),P=u.sq3Codes.SQLITE_IOERR}return ge(),P},xLock:function(g,k){he("xLock");let P=oe[g],X=0;return P.lockType?P.lockType=k:(X=W("xLock",g,k),X===0&&(P.lockType=k)),ge(),X},xRead:function(g,k,P,X){he("xRead");let V=oe[g],ae;try{ae=W("xRead",g,P,Number(X)),(ae===0||O.SQLITE_IOERR_SHORT_READ===ae)&&b.heap8u().set(V.sabView.subarray(0,P),k)}catch(ce){A("xRead(",arguments,") failed:",ce,V),ae=O.SQLITE_IOERR_READ}return ge(),ae},xSync:function(g,k){he("xSync"),++y.xSync.count;let P=W("xSync",g,k);return ge(),P},xTruncate:function(g,k){he("xTruncate");let P=W("xTruncate",g,Number(k));return ge(),P},xUnlock:function(g,k){he("xUnlock");let P=oe[g],X=0;return O.SQLITE_LOCK_NONE===k&&P.lockType&&(X=W("xUnlock",g,k)),X===0&&(P.lockType=k),ge(),X},xWrite:function(g,k,P,X){he("xWrite");let V=oe[g],ae;try{V.sabView.set(b.heap8u().subarray(k,k+P)),ae=W("xWrite",g,P,Number(X))}catch(ce){A("xWrite(",arguments,") failed:",ce,V),ae=O.SQLITE_IOERR_WRITE}return ge(),ae}},E={xAccess:function(g,k,P,X){he("xAccess");let V=W("xAccess",b.cstrToJs(k));return b.poke(X,V?0:1,"i32"),ge(),0},xCurrentTime:function(g,k){return b.poke(k,24405875e-1+new Date().getTime()/864e5,"double"),0},xCurrentTimeInt64:function(g,k){return b.poke(k,24405875e-1*864e5+new Date().getTime(),"i64"),0},xDelete:function(g,k,P){he("xDelete");let X=W("xDelete",b.cstrToJs(k),P,!1);return ge(),X},xFullPathname:function(g,k,P,X){return b.cstrncpy(X,k,P)<P?0:O.SQLITE_CANTOPEN},xGetLastError:function(g,k,P){return G("OPFS xGetLastError() has nothing sensible to return."),0},xOpen:function(k,P,X,V,ae){he("xOpen");let ce=0;P===0?P=_e():b.isPtr(P)&&(O.sqlite3_uri_boolean(P,"opfs-unlock-asap",0)&&(ce|=u.opfsFlags.OPFS_UNLOCK_ASAP),O.sqlite3_uri_boolean(P,"delete-before-open",0)&&(ce|=u.opfsFlags.OPFS_UNLINK_BEFORE_OPEN),P=b.cstrToJs(P));let ie=Object.create(null);ie.fid=X,ie.filename=P,ie.sab=new SharedArrayBuffer(u.fileBufferSize),ie.flags=V;let Oe=W("xOpen",X,P,V,ce);return Oe||(ie.readOnly&&b.poke(ae,O.SQLITE_OPEN_READONLY,"i32"),oe[X]=ie,ie.sabView=u.sabFileBufView,ie.sq3File=new j(X),ie.sq3File.$pMethods=_.pointer,ie.lockType=O.SQLITE_LOCK_NONE),ge(),Oe}};c&&(f.$xRandomness=c.$xRandomness,f.$xSleep=c.$xSleep),f.$xRandomness||(E.xRandomness=function(g,k,P){let X=b.heap8u(),V=0;for(;V<k;++V)X[P+V]=Math.random()*255e3&255;return V}),f.$xSleep||(E.xSleep=function(g,k){return Atomics.wait(u.sabOPView,u.opIds.xSleep,0,k),0}),w.getResolvedPath=function(g,k){let P=new URL(g,"file://irrelevant").pathname;return k?P.split("/").filter(X=>!!X):P},w.getDirForFilename=async function(k,P=!1){let X=w.getResolvedPath(k,!0),V=X.pop(),ae=w.rootDirectory;for(let ce of X)ce&&(ae=await ae.getDirectoryHandle(ce,{create:!!P}));return[ae,V]},w.mkdir=async function(g){try{return await w.getDirForFilename(g+"/filepart",!0),!0}catch{return!1}},w.entryExists=async function(g){try{let[k,P]=await w.getDirForFilename(g);return await k.getFileHandle(P),!0}catch{return!1}},w.randomFilename=_e,w.treeList=async function(){let g=async function P(X,V){V.name=X.name,V.dirs=[],V.files=[];for await(let ae of X.values())if(ae.kind==="directory"){let ce=Object.create(null);V.dirs.push(ce),await P(ae,ce)}else V.files.push(ae.name)},k=Object.create(null);return await g(w.rootDirectory,k),k},w.rmfr=async function(){let g=w.rootDirectory,k={recurse:!0};for await(let P of g.values())g.removeEntry(P.name,k)},w.unlink=async function(g,k=!1,P=!1){try{let[X,V]=await w.getDirForFilename(g,!1);return await X.removeEntry(V,{recursive:k}),!0}catch(X){if(P)throw new Error("unlink(",arguments[0],") failed: "+X.message,{cause:X});return!1}},w.traverse=async function(g){let k={recursive:!0,directory:w.rootDirectory};typeof g=="function"&&(g={callback:g}),g=Object.assign(k,g||{}),async function X(V,ae){for await(let ce of V.values()){if(g.callback(ce,V,ae)===!1)return!1;if(g.recursive&&ce.kind==="directory"&&await X(ce,ae+1)===!1)break}}(g.directory,0)};let N=async function(g,k){let[P,X]=await w.getDirForFilename(g,!0),ae=await(await P.getFileHandle(X,{create:!0})).createSyncAccessHandle(),ce=0,ie,Oe=!1,Fe=!1;try{for(ae.truncate(0);(ie=await k())!==void 0;)ie instanceof ArrayBuffer&&(ie=new Uint8Array(ie)),ce===0&&ie.byteLength>=15&&(x.affirmDbHeader(ie),Oe=!0),ae.write(ie,{at:ce}),ce+=ie.byteLength;if((ce<512||ce%512!==0)&&I("Input size",ce,"is not correct for an SQLite database."),!Oe){let T=new Uint8Array(20);ae.read(T,{at:0}),x.affirmDbHeader(T)}return ae.write(new Uint8Array([1,1]),{at:18}),ce}catch(T){throw await ae.close(),ae=void 0,await P.removeEntry(X).catch(()=>{}),T}finally{ae&&await ae.close()}};if(w.importDb=async function(g,k){if(k instanceof Function)return N(g,k);k instanceof ArrayBuffer&&(k=new Uint8Array(k)),x.affirmIsDb(k);let P=k.byteLength,[X,V]=await w.getDirForFilename(g,!0),ae,ce,ie=0;try{return ae=await(await X.getFileHandle(V,{create:!0})).createSyncAccessHandle(),ae.truncate(0),ie=ae.write(k,{at:0}),ie!=P&&I("Expected to write "+P+" bytes but wrote "+ie+"."),ae.write(new Uint8Array([1,1]),{at:18}),ie}catch(Oe){throw ae&&(await ae.close(),ae=void 0),await X.removeEntry(V).catch(()=>{}),Oe}finally{ae&&await ae.close()}},t.oo1){let g=function(...k){let P=t.oo1.DB.dbCtorHelper.normalizeArgs(...k);P.vfs=f.$zName,t.oo1.DB.dbCtorHelper.call(this,P)};g.prototype=Object.create(t.oo1.DB.prototype),t.oo1.OpfsDb=g,g.importDb=w.importDb,t.oo1.DB.dbCtorHelper.setVfsPostOpenSql(f.pointer,function(k,P){P.capi.sqlite3_busy_timeout(k,1e4),P.capi.sqlite3_exec(k,["pragma journal_mode=DELETE;","pragma cache_size=-16384;"],0,0,0)})}let $=function(){let g=b.scopedAllocPush(),k=new j;try{let P=k.pointer,X=O.SQLITE_OPEN_CREATE|O.SQLITE_OPEN_READWRITE|O.SQLITE_OPEN_MAIN_DB,V=b.scopedAlloc(8),ae="/sanity/check/file"+_e(8),ce=b.scopedAllocCString(ae),ie;if(u.s11n.serialize("This is \xE4 string."),ie=u.s11n.deserialize(),U("deserialize() says:",ie),ie[0]!=="This is \xE4 string."&&I("String d13n error."),E.xAccess(f.pointer,ce,0,V),ie=b.peek(V,"i32"),U("xAccess(",ae,") exists ?=",ie),ie=E.xOpen(f.pointer,ce,P,X,V),U("open rc =",ie,"state.sabOPView[xOpen] =",u.sabOPView[u.opIds.xOpen]),ie!==0){A("open failed with code",ie);return}E.xAccess(f.pointer,ce,0,V),ie=b.peek(V,"i32"),ie||I("xAccess() failed to detect file."),ie=J.xSync(k.pointer,0),ie&&I("sync failed w/ rc",ie),ie=J.xTruncate(k.pointer,1024),ie&&I("truncate failed w/ rc",ie),b.poke(V,0,"i64"),ie=J.xFileSize(k.pointer,V),ie&&I("xFileSize failed w/ rc",ie),U("xFileSize says:",b.peek(V,"i64")),ie=J.xWrite(k.pointer,ce,10,1),ie&&I("xWrite() failed!");let Oe=b.scopedAlloc(16);ie=J.xRead(k.pointer,Oe,6,2),b.poke(Oe+6,0);let Fe=b.cstrToJs(Oe);U("xRead() got:",Fe),Fe!=="sanity"&&I("Unexpected xRead() value."),E.xSleep&&(U("xSleep()ing before close()ing..."),E.xSleep(f.pointer,2e3),U("waking up from xSleep()")),ie=J.xClose(P),U("xClose rc =",ie,"sabOPView =",u.sabOPView),U("Deleting file:",ae),E.xDelete(f.pointer,ce,4660),E.xAccess(f.pointer,ce,0,V),ie=b.peek(V,"i32"),ie&&I("Expecting 0 from xAccess(",ae,") after xDelete()."),G("End of OPFS sanity checks.")}finally{k.dispose(),b.scopedAllocPop(g)}};d.onmessage=function({data:g}){switch(g.type){case"opfs-unavailable":L(new Error(g.payload.join(" ")));break;case"opfs-async-loaded":d.postMessage({type:"opfs-async-init",args:u});break;case"opfs-async-inited":{if(S===!0)break;try{t.vfs.installVfs({io:{struct:_,methods:J},vfs:{struct:f,methods:E}}),u.sabOPView=new Int32Array(u.sabOP),u.sabFileBufView=new Uint8Array(u.sabIO,0,u.fileBufferSize),u.sabS11nView=new Uint8Array(u.sabIO,u.sabS11nOffset,u.sabS11nSize),Z(),r.sanityChecks&&(G("Running sanity checks because of opfs-sanity-check URL arg..."),$()),H()?navigator.storage.getDirectory().then(k=>{d.onerror=d._originalOnError,delete d._originalOnError,t.opfs=w,w.rootDirectory=k,U("End of OPFS sqlite3_vfs setup.",f),D()}).catch(L):D()}catch(k){A(k),L(k)}break}default:{let k="Unexpected message from the OPFS async worker: "+JSON.stringify(g);A(k),L(new Error(k));break}}}}))};i.defaultProxyUri="sqlite3-opfs-async-proxy.js",globalThis.sqlite3ApiBootstrap.initializersAsync.push(async o=>{try{let r=i.defaultProxyUri;return o.scriptInfo.sqlite3Dir&&(i.defaultProxyUri=o.scriptInfo.sqlite3Dir+r),i().catch(s=>{o.config.warn("Ignoring inability to install OPFS sqlite3_vfs:",s.message)})}catch(r){return o.config.error("installOpfsVfs() exception:",r),Promise.reject(r)}})}),globalThis.sqlite3ApiBootstrap.initializers.push(function(t){"use strict";let i=t.util.toss,o=t.util.toss3,r=Object.create(null),s=t.capi,p=t.util,h=t.wasm,R=4096,C=512,Q=4,U=8,G=C+Q,A=C,I=G,O=R,x=s.SQLITE_OPEN_MAIN_DB|s.SQLITE_OPEN_MAIN_JOURNAL|s.SQLITE_OPEN_SUPER_JOURNAL|s.SQLITE_OPEN_WAL,b=".opaque",F=()=>Math.random().toString(36).slice(2),j=new TextDecoder,z=new TextEncoder,w=Object.assign(Object.create(null),{name:"opfs-sahpool",directory:void 0,initialCapacity:6,clearOnInit:!1,verbosity:2}),H=[t.config.error,t.config.warn,t.config.log],_=t.config.log,f=t.config.warn,S=t.config.error,L=new Map,D=J=>L.get(J),d=(J,E)=>{E?L.set(J,E):L.delete(J)},l=new Map,c=J=>l.get(J),u=(J,E)=>{E?l.set(J,E):l.delete(J)},y={xCheckReservedLock:function(J,E){let N=c(J);return N.log("xCheckReservedLock"),N.storeErr(),h.poke32(E,1),0},xClose:function(J){let E=c(J);E.storeErr();let N=E.getOFileForS3File(J);if(N)try{E.log(`xClose ${N.path}`),E.mapS3FileToOFile(J,!1),N.sah.flush(),N.flags&s.SQLITE_OPEN_DELETEONCLOSE&&E.deletePath(N.path)}catch($){return E.storeErr($,s.SQLITE_IOERR)}return 0},xDeviceCharacteristics:function(J){return s.SQLITE_IOCAP_UNDELETABLE_WHEN_OPEN},xFileControl:function(J,E,N){return s.SQLITE_NOTFOUND},xFileSize:function(J,E){let N=c(J);N.log("xFileSize");let g=N.getOFileForS3File(J).sah.getSize()-O;return h.poke64(E,BigInt(g)),0},xLock:function(J,E){let N=c(J);N.log(`xLock ${E}`),N.storeErr();let $=N.getOFileForS3File(J);return $.lockType=E,0},xRead:function(J,E,N,$){let g=c(J);g.storeErr();let k=g.getOFileForS3File(J);g.log(`xRead ${k.path} ${N} @ ${$}`);try{let P=k.sah.read(h.heap8u().subarray(E,E+N),{at:O+Number($)});return P<N?(h.heap8u().fill(0,E+P,E+N),s.SQLITE_IOERR_SHORT_READ):0}catch(P){return g.storeErr(P,s.SQLITE_IOERR)}},xSectorSize:function(J){return R},xSync:function(J,E){let N=c(J);N.log(`xSync ${E}`),N.storeErr();let $=N.getOFileForS3File(J);try{return $.sah.flush(),0}catch(g){return N.storeErr(g,s.SQLITE_IOERR)}},xTruncate:function(J,E){let N=c(J);N.log(`xTruncate ${E}`),N.storeErr();let $=N.getOFileForS3File(J);try{return $.sah.truncate(O+Number(E)),0}catch(g){return N.storeErr(g,s.SQLITE_IOERR)}},xUnlock:function(J,E){let N=c(J);N.log("xUnlock");let $=N.getOFileForS3File(J);return $.lockType=E,0},xWrite:function(J,E,N,$){let g=c(J);g.storeErr();let k=g.getOFileForS3File(J);g.log(`xWrite ${k.path} ${N} ${$}`);try{let P=k.sah.write(h.heap8u().subarray(E,E+N),{at:O+Number($)});return N===P?0:i("Unknown write() failure.")}catch(P){return g.storeErr(P,s.SQLITE_IOERR)}}},W=new s.sqlite3_io_methods;W.$iVersion=1,t.vfs.installVfs({io:{struct:W,methods:y}});let Z={xAccess:function(J,E,N,$){let g=D(J);g.storeErr();try{let k=g.getPath(E);h.poke32($,g.hasFilename(k)?1:0)}catch{h.poke32($,0)}return 0},xCurrentTime:function(J,E){return h.poke(E,24405875e-1+new Date().getTime()/864e5,"double"),0},xCurrentTimeInt64:function(J,E){return h.poke(E,24405875e-1*864e5+new Date().getTime(),"i64"),0},xDelete:function(J,E,N){let $=D(J);$.log(`xDelete ${h.cstrToJs(E)}`),$.storeErr();try{return $.deletePath($.getPath(E)),0}catch(g){return $.storeErr(g),s.SQLITE_IOERR_DELETE}},xFullPathname:function(J,E,N,$){return h.cstrncpy($,E,N)<N?0:s.SQLITE_CANTOPEN},xGetLastError:function(J,E,N){let $=D(J),g=$.popErr();if($.log(`xGetLastError ${E} e =`,g),g){let k=h.scopedAllocPush();try{let[P,X]=h.scopedAllocCString(g.message,!0);h.cstrncpy(N,P,E),X>E&&h.poke8(N+E-1,0)}catch{return s.SQLITE_NOMEM}finally{h.scopedAllocPop(k)}}return g?g.sqlite3Rc||s.SQLITE_IOERR:0},xOpen:function(E,N,$,g,k){let P=D(E);try{P.log(`xOpen ${h.cstrToJs(N)} ${g}`);let X=N&&h.peek8(N)?P.getPath(N):F(),V=P.getSAHForPath(X);!V&&g&s.SQLITE_OPEN_CREATE&&(P.getFileCount()<P.getCapacity()?(V=P.nextAvailableSAH(),P.setAssociatedPath(V,X,g)):i("SAH pool is full. Cannot create file",X)),V||i("file not found:",X);let ae={path:X,flags:g,sah:V};P.mapS3FileToOFile($,ae),ae.lockType=s.SQLITE_LOCK_NONE;let ce=new s.sqlite3_file($);return ce.$pMethods=W.pointer,ce.dispose(),h.poke32(k,g),0}catch(X){return P.storeErr(X),s.SQLITE_CANTOPEN}}},_e=function(J){t.capi.sqlite3_vfs_find(J)&&o("VFS name is already registered:",J);let E=new s.sqlite3_vfs,N=s.sqlite3_vfs_find(null),$=N?new s.sqlite3_vfs(N):null;return E.$iVersion=2,E.$szOsFile=s.sqlite3_file.structInfo.sizeof,E.$mxPathname=C,E.addOnDispose(E.$zName=h.allocCString(J),()=>d(E.pointer,0)),$&&(E.$xRandomness=$.$xRandomness,E.$xSleep=$.$xSleep,$.dispose()),!E.$xRandomness&&!Z.xRandomness&&(Z.xRandomness=function(g,k,P){let X=h.heap8u(),V=0;for(;V<k;++V)X[P+V]=Math.random()*255e3&255;return V}),!E.$xSleep&&!Z.xSleep&&(Z.xSleep=(g,k)=>0),t.vfs.installVfs({vfs:{struct:E,methods:Z}}),E};class oe{vfsDir;#e;#t;#a;#o=new Map;#n=new Map;#s=new Set;#l=new Map;#r=new Uint8Array(G);#c;#i;#_;constructor(E=Object.create(null)){this.#_=E.verbosity??w.verbosity,this.vfsName=E.name||w.name,this.#i=_e(this.vfsName),d(this.#i.pointer,this),this.vfsDir=E.directory||"."+this.vfsName,this.#c=new DataView(this.#r.buffer,this.#r.byteOffset),this.isReady=this.reset(!!(E.clearOnInit??w.clearOnInit)).then(()=>{if(this.$error)throw this.$error;return this.getCapacity()?Promise.resolve(void 0):this.addCapacity(E.initialCapacity||w.initialCapacity)})}#u(E,...N){this.#_>E&&H[E](this.vfsName+":",...N)}log(...E){this.#u(2,...E)}warn(...E){this.#u(1,...E)}error(...E){this.#u(0,...E)}getVfs(){return this.#i}getCapacity(){return this.#o.size}getFileCount(){return this.#n.size}getFileNames(){let E=[],N=this.#n.keys();for(let $ of N)E.push($);return E}async addCapacity(E){for(let N=0;N<E;++N){let $=F(),k=await(await this.#t.getFileHandle($,{create:!0})).createSyncAccessHandle();this.#o.set(k,$),this.setAssociatedPath(k,"",0)}return this.getCapacity()}async reduceCapacity(E){let N=0;for(let $ of Array.from(this.#s)){if(N===E||this.getFileCount()===this.getCapacity())break;let g=this.#o.get($);$.close(),await this.#t.removeEntry(g),this.#o.delete($),this.#s.delete($),++N}return N}releaseAccessHandles(){for(let E of this.#o.keys())E.close();this.#o.clear(),this.#n.clear(),this.#s.clear()}async acquireAccessHandles(E){let N=[];for await(let[$,g]of this.#t)g.kind==="file"&&N.push([$,g]);return Promise.all(N.map(async([$,g])=>{try{let k=await g.createSyncAccessHandle();if(this.#o.set(k,$),E)k.truncate(O),this.setAssociatedPath(k,"",0);else{let P=this.getAssociatedPath(k);P?this.#n.set(P,k):this.#s.add(k)}}catch(k){throw this.storeErr(k),this.releaseAccessHandles(),k}}))}getAssociatedPath(E){E.read(this.#r,{at:0});let N=this.#c.getUint32(A);if(this.#r[0]&&(N&s.SQLITE_OPEN_DELETEONCLOSE||!(N&x)))return f(`Removing file with unexpected flags ${N.toString(16)}`,this.#r),this.setAssociatedPath(E,"",0),"";let $=new Uint32Array(U/4);E.read($,{at:I});let g=this.computeDigest(this.#r);if($.every((k,P)=>k===g[P])){let k=this.#r.findIndex(P=>P===0);return k===0&&E.truncate(O),k?j.decode(this.#r.subarray(0,k)):""}else return f("Disassociating file with bad digest."),this.setAssociatedPath(E,"",0),""}setAssociatedPath(E,N,$){let g=z.encodeInto(N,this.#r);C<=g.written+1&&i("Path too long:",N),this.#r.fill(0,g.written,C),this.#c.setUint32(A,$);let k=this.computeDigest(this.#r);E.write(this.#r,{at:0}),E.write(k,{at:I}),E.flush(),N?(this.#n.set(N,E),this.#s.delete(E)):(E.truncate(O),this.#s.add(E))}computeDigest(E){let N=3735928559,$=1103547991;for(let g of E)N=31*N+g*307,$=31*$+g*307;return new Uint32Array([N>>>0,$>>>0])}async reset(E){await this.isReady;let N=await navigator.storage.getDirectory(),$,g;for(let k of this.vfsDir.split("/"))k&&($=N,N=await N.getDirectoryHandle(k,{create:!0}));return this.#e=N,this.#a=$,this.#t=await this.#e.getDirectoryHandle(b,{create:!0}),this.releaseAccessHandles(),this.acquireAccessHandles(E)}getPath(E){return h.isPtr(E)&&(E=h.cstrToJs(E)),(E instanceof URL?E:new URL(E,"file://localhost/")).pathname}deletePath(E){let N=this.#n.get(E);return N&&(this.#n.delete(E),this.setAssociatedPath(N,"",0)),!!N}storeErr(E,N){return E&&(E.sqlite3Rc=N||s.SQLITE_IOERR,this.error(E)),this.$error=E,N}popErr(){let E=this.$error;return this.$error=void 0,E}nextAvailableSAH(){let[E]=this.#s.keys();return E}getOFileForS3File(E){return this.#l.get(E)}mapS3FileToOFile(E,N){N?(this.#l.set(E,N),u(E,this)):(this.#l.delete(E),u(E,!1))}hasFilename(E){return this.#n.has(E)}getSAHForPath(E){return this.#n.get(E)}async removeVfs(){if(!this.#i.pointer||!this.#t)return!1;s.sqlite3_vfs_unregister(this.#i.pointer),this.#i.dispose();try{this.releaseAccessHandles(),await this.#e.removeEntry(b,{recursive:!0}),this.#t=void 0,await this.#a.removeEntry(this.#e.name,{recursive:!0}),this.#e=this.#a=void 0}catch(E){t.config.error(this.vfsName,"removeVfs() failed:",E)}return!0}exportFile(E){let N=this.#n.get(E)||i("File not found:",E),$=N.getSize()-O,g=new Uint8Array($>0?$:0);if($>0){let k=N.read(g,{at:O});k!=$&&i("Expected to read "+$+" bytes but read "+k+".")}return g}async importDbChunked(E,N){let $=this.#n.get(E)||this.nextAvailableSAH()||i("No available handles to import to.");$.truncate(0);let g=0,k,P=!1,X=!1;try{for(;(k=await N())!==void 0;)k instanceof ArrayBuffer&&(k=new Uint8Array(k)),g===0&&k.byteLength>=15&&(p.affirmDbHeader(k),P=!0),$.write(k,{at:O+g}),g+=k.byteLength;if((g<512||g%512!==0)&&i("Input size",g,"is not correct for an SQLite database."),!P){let V=new Uint8Array(20);$.read(V,{at:0}),p.affirmDbHeader(V)}$.write(new Uint8Array([1,1]),{at:O+18})}catch(V){throw this.setAssociatedPath($,"",0),V}return this.setAssociatedPath($,E,s.SQLITE_OPEN_MAIN_DB),g}importDb(E,N){if(N instanceof ArrayBuffer)N=new Uint8Array(N);else if(N instanceof Function)return this.importDbChunked(E,N);let $=this.#n.get(E)||this.nextAvailableSAH()||i("No available handles to import to."),g=N.byteLength;(g<512||g%512!=0)&&i("Byte array size is invalid for an SQLite db.");let k="SQLite format 3";for(let X=0;X<k.length;++X)k.charCodeAt(X)!==N[X]&&i("Input does not contain an SQLite database header.");let P=$.write(N,{at:O});return P!=g?(this.setAssociatedPath($,"",0),i("Expected to write "+g+" bytes but wrote "+P+".")):($.write(new Uint8Array([1,1]),{at:O+18}),this.setAssociatedPath($,E,s.SQLITE_OPEN_MAIN_DB)),P}}class de{#e;constructor(E){this.#e=E,this.vfsName=E.vfsName}async addCapacity(E){return this.#e.addCapacity(E)}async reduceCapacity(E){return this.#e.reduceCapacity(E)}getCapacity(){return this.#e.getCapacity(this.#e)}getFileCount(){return this.#e.getFileCount()}getFileNames(){return this.#e.getFileNames()}async reserveMinimumCapacity(E){let N=this.#e.getCapacity();return N<E?this.#e.addCapacity(E-N):N}exportFile(E){return this.#e.exportFile(E)}importDb(E,N){return this.#e.importDb(E,N)}async wipeFiles(){return this.#e.reset(!0)}unlink(E){return this.#e.deletePath(E)}async removeVfs(){return this.#e.removeVfs()}}let he=async()=>{let J=await navigator.storage.getDirectory(),E=".opfs-sahpool-sync-check-"+F(),g=(await(await J.getFileHandle(E,{create:!0})).createSyncAccessHandle()).close();return await g,await J.removeEntry(E),g?.then&&i("The local OPFS API is too old for opfs-sahpool:","it has an async FileSystemSyncAccessHandle.close() method."),!0},ge=0;t.installOpfsSAHPoolVfs=async function(J=Object.create(null)){let E=J.name||w.name;return r[E]?r[E]:!globalThis.FileSystemHandle||!globalThis.FileSystemDirectoryHandle||!globalThis.FileSystemFileHandle||!globalThis.FileSystemFileHandle.prototype.createSyncAccessHandle||!navigator?.storage?.getDirectory?r[E]=Promise.reject(new Error("Missing required OPFS APIs.")):r[E]=he().then(async function(){if(J.$testThrowInInit)throw J.$testThrowInInit;let N=new oe(J);return N.isReady.then(async()=>{let $=new de(N);if(t.oo1){let g=t.oo1,k=N.getVfs(),P=function(...X){let V=g.DB.dbCtorHelper.normalizeArgs(...X);V.vfs=k.$zName,g.DB.dbCtorHelper.call(this,V)};P.prototype=Object.create(g.DB.prototype),$.OpfsSAHPoolDb=P,g.DB.dbCtorHelper.setVfsPostOpenSql(k.pointer,function(X,V){V.capi.sqlite3_exec(X,["pragma journal_mode=DELETE;","pragma cache_size=-16384;"],0,0,0)})}return N.log("VFS initialized."),$}).catch(async $=>{throw await N.removeVfs().catch(()=>{}),$})}).catch(N=>r[E]=Promise.reject(N))}}),typeof n<"u"){let t=Object.assign(Object.create(null),{exports:typeof wasmExports>"u"?n.asm:wasmExports,memory:n.wasmMemory},globalThis.sqlite3ApiConfig||{});globalThis.sqlite3ApiConfig=t;let i;try{i=globalThis.sqlite3ApiBootstrap()}catch(o){throw console.error("sqlite3ApiBootstrap() error:",o),o}finally{delete globalThis.sqlite3ApiBootstrap,delete globalThis.sqlite3ApiConfig}n.sqlite3=i}else console.warn("This is not running in an Emscripten module context, so","globalThis.sqlite3ApiBootstrap() is _not_ being called due to lack","of config info for the WASM environment.","It must be called manually.")}),q.ready}})(),gl=function(){let M=Lt;if(!M)throw new Error("Expecting globalThis.sqlite3InitModule to be defined by the Emscripten build.");let m=globalThis.sqlite3InitModuleState=Object.assign(Object.create(null),{moduleScript:globalThis?.document?.currentScript,isWorker:typeof WorkerGlobalScope<"u",location:globalThis.location,urlParams:globalThis?.location?.href?new URL(globalThis.location.href).searchParams:new URLSearchParams});if(m.debugModule=m.urlParams.has("sqlite3.debugModule")?(...q)=>console.warn("sqlite3.debugModule:",...q):()=>{},m.urlParams.has("sqlite3.dir"))m.sqlite3Dir=m.urlParams.get("sqlite3.dir")+"/";else if(m.moduleScript){let q=m.moduleScript.src.split("/");q.pop(),m.sqlite3Dir=q.join("/")+"/"}if(globalThis.sqlite3InitModule=function q(...e){return M(...e).then(B=>{let K=B.sqlite3;K.scriptInfo=m,q.__isUnderTest&&(K.__isUnderTest=!0);let ne=K.asyncPostInit;return delete K.asyncPostInit,ne()}).catch(B=>{throw console.error("Exception loading sqlite3 module:",B),B})},globalThis.sqlite3InitModule.ready=M.ready,globalThis.sqlite3InitModuleState.moduleScript){let q=globalThis.sqlite3InitModuleState,e=q.moduleScript.src.split("/");e.pop(),q.scriptDir=e.join("/")+"/"}return m.debugModule("sqlite3InitModuleState =",m),globalThis.sqlite3InitModule}();Lt=gl;var ln=Lt;globalThis.sqlite3Worker1Promiser=function M(m=M.defaultConfig){if(arguments.length===1&&typeof arguments[0]=="function"){let te=m;m=Object.assign(Object.create(null),M.defaultConfig),m.onready=te}else m=Object.assign(Object.create(null),M.defaultConfig,m);let q=Object.create(null),e=function(){},B=m.onerror||e,K=m.debug||e,ne=m.generateMessageId?void 0:Object.create(null),le=m.generateMessageId||function(te){return te.type+"#"+(ne[te.type]=(ne[te.type]||0)+1)},se=(...te)=>{throw new Error(te.join(" "))};m.worker||(m.worker=M.defaultConfig.worker),typeof m.worker=="function"&&(m.worker=m.worker());let ye,be;return m.worker.onmessage=function(te){te=te.data,K("worker1.onmessage",te);let xe=q[te.messageId];if(!xe){if(te&&te.type==="sqlite3-api"&&te.result==="worker1-ready"){m.onready&&m.onready(be);return}if(xe=q[te.type],xe&&xe.onrow){xe.onrow(te);return}m.onunhandled?m.onunhandled(arguments[0]):B("sqlite3Worker1Promiser() unhandled worker message:",te);return}switch(delete q[te.messageId],te.type){case"error":xe.reject(te);return;case"open":ye||(ye=te.dbId);break;case"close":te.dbId===ye&&(ye=void 0);break;default:break}try{xe.resolve(te)}catch(we){xe.reject(we)}},be=function(){let te;arguments.length===1?te=arguments[0]:arguments.length===2?(te=Object.create(null),te.type=arguments[0],te.args=arguments[1],te.dbId=te.args.dbId):se("Invalid arguments for sqlite3Worker1Promiser()-created factory."),!te.dbId&&te.type!=="open"&&(te.dbId=ye),te.messageId=le(te),te.departureTime=performance.now();let xe=Object.create(null);xe.message=te;let we;te.type==="exec"&&te.args&&(typeof te.args.callback=="function"?(we=te.messageId+":row",xe.onrow=te.args.callback,te.args.callback=we,q[we]=xe):typeof te.args.callback=="string"&&se("exec callback may not be a string when using the Promise interface."));let He=new Promise(function(rt,qe){xe.resolve=rt,xe.reject=qe,q[te.messageId]=xe,K("Posting",te.type,"message to Worker dbId="+(ye||"default")+":",te),m.worker.postMessage(te)});return we&&(He=He.finally(()=>delete q[we])),He}};globalThis.sqlite3Worker1Promiser.defaultConfig={worker:function(){return new Worker(new URL("sqlite3-worker1-bundler-friendly.mjs",import.meta.url),{type:"module"})},onerror:(...M)=>console.error("worker1 promiser error",...M)};sqlite3Worker1Promiser.v2=function(M){let m;typeof M=="function"?(m=M,M={}):typeof M?.onready=="function"&&(m=M.onready,delete M.onready);let q=Object.create(null);M=Object.assign(M||Object.create(null),{onready:async function(B){try{m&&await m(B),q.resolve(B)}catch(K){q.reject(K)}}});let e=new Promise(function(B,K){q.resolve=B,q.reject=K});try{this.original(M)}catch(B){q.reject(B)}return e}.bind({original:sqlite3Worker1Promiser});var Yl=sqlite3Worker1Promiser.v2;var nc=self.sqlite3Worker1Promiser,cn=ln;var ut=hl(_n(),1);function je(){return new Date().getTime()}function Dt(M,m){if(m.since&&M.created_at<m.since||m.until&&M.created_at>m.until||!(m.ids?.includes(M.id)??!0)||!(m.authors?.includes(M.pubkey)??!0)||!(m.kinds?.includes(M.kind)??!0))return!1;let q=Object.entries(m).filter(([e])=>e.startsWith("#"));for(let[e,B]of q){let K=B;for(let ne of K)if(!M.tags.find(le=>le[0]===e.slice(1)&&le[1]===ne))return!1}return!0}var fn=!1;function Ke(M,m,...q){fn&&console.log(M,m,...q)}function dn(M){fn=M}var bl=(M,...m)=>Ke("SqliteRelay:migrations",M,...m),vl=[{version:1,script:El},{version:2,script:xl},{version:3,script:Sl},{version:4,script:Al},{version:5,script:kl},{version:6,script:Il}];async function wl(M){if(!M.db)throw new Error("DB must be open");M.db.exec("CREATE TABLE IF NOT EXISTS __migration (    version INTEGER PRIMARY KEY,     migrated_at INTEGER   )");let q=M.db.exec("SELECT MAX(version) FROM __migration",{returnValue:"resultRows"})[0][0]??0;for(let{version:e,script:B}of vl)q<e&&(bl(`Migrating to v${e}`),await B(M),q=e)}function El(M){return M.db?.transaction(m=>{m.exec("CREATE TABLE events (      id TEXT(64) PRIMARY KEY,       pubkey TEXT(64),       created INTEGER,       kind INTEGER,       json TEXT     )"),m.exec("CREATE TABLE tags (      event_id TEXT(64),       key TEXT,       value TEXT,       CONSTRAINT tags_FK FOREIGN KEY (event_id) REFERENCES events(id) ON DELETE CASCADE       )"),m.exec("CREATE INDEX tags_key_IDX ON tags (key,value)"),m.exec("insert into __migration values(1, ?)",{bind:[new Date().getTime()/1e3]})})}function xl(M){M.db?.transaction(m=>{m.exec("CREATE INDEX pubkey_kind_IDX ON events (pubkey,kind)"),m.exec("CREATE INDEX pubkey_created_IDX ON events (pubkey,created)"),m.exec("insert into __migration values(2, ?)",{bind:[new Date().getTime()/1e3]})})}function Sl(M){M.db?.transaction(m=>{m.exec("CREATE VIRTUAL TABLE search_content using fts5(id UNINDEXED, content)");let q=m.selectArrays("select json from events where kind in (?,?)",[0,1]);for(let e of q){let B=JSON.parse(e[0]);B&&M.insertIntoSearchIndex(m,B)}m.exec("insert into __migration values(3, ?)",{bind:[new Date().getTime()/1e3]})})}async function Al(M){M.db?.transaction(m=>{m.exec("ALTER TABLE events ADD COLUMN seen_at INTEGER"),m.exec("insert into __migration values(4, ?)",{bind:[new Date().getTime()/1e3]})})}async function kl(M){M.db?.transaction(m=>{m.exec("CREATE INDEX seen_at_IDX ON events (seen_at)"),m.exec("insert into __migration values(5, ?)",{bind:[new Date().getTime()/1e3]})})}async function Il(M){M.db?.transaction(m=>{m.exec("ALTER TABLE events ADD COLUMN relays TEXT"),m.exec("insert into __migration values(6, ?)",{bind:[new Date().getTime()/1e3]})})}var Nt=wl;import Tl from"./sqlite3-PTMSDN4U.wasm?url";async function pn(M){}var bt=class extends ut.default{#e;#t=(m,...q)=>Ke("SqliteRelay",m,...q);db;#a;#o=new Set;async init(m){this.#e||(this.#e=await cn({locateFile:(q,e)=>q==="sqlite3.wasm"?Tl:e+q,print:q=>this.#t(q),printErr:q=>this.#t(q)}),this.#t(`Got SQLite version: ${this.#e.version.libVersion}`),await this.#n(m),this.db&&(await Nt(this),pn(this)))}async#n(m){if(!this.#e)throw new Error("Must call init first");this.db||(this.#a=await this.#e.installOpfsSAHPoolVfs({}),this.db=new this.#a.OpfsSAHPoolDb(m),this.#t(`Opened ${this.db.filename}`))}async wipe(){if(this.#a&&this.db){let m=this.db.filename;this.close(),await this.#a.wipeFiles(),await this.#n(m),await Nt(this)}}close(){this.db?.close(),this.db=void 0}event(m){return this.#l(this.db,m)?(this.#t(`Inserted: kind=${m.kind},authors=${m.pubkey},id=${m.id}`),this.emit("event",[m]),!0):!1}sql(m,q){return this.db?.selectArrays(m,q)}eventBatch(m){let q=je(),e=[];return this.db?.transaction(B=>{for(let K of m)this.#l(B,K)&&e.push(K)}),e.length>0&&(this.#t(`Inserted Batch: ${e.length}/${m.length}, ${(je()-q).toLocaleString()}ms`),this.emit("event",e)),e.length>0}setEventMetadata(m,q){q.seen_at&&this.db?.exec("update events set seen_at = ? where id = ?",{bind:[q.seen_at,m]})}#s(m,q){if(q.length===0)return;m.exec(`delete from events where id in (${this.#i(q.length)})`,{bind:q});let e=m.changes();m.exec(`delete from search_content where id in (${this.#i(q.length)})`,{bind:q}),this.#t("Deleted",q,e)}#l(m,q){if(this.#o.has(q.id))return!1;if([0,3,41].includes(q.kind)||q.kind>=1e4&&q.kind<2e4){let ne=m.selectValues("select id from events where kind = ? and pubkey = ? and created <= ?",[q.kind,q.pubkey,q.created_at]);if(ne.includes(q.id)){if(this.#o.add(q.id),ne.length>1){let le=ne.filter(se=>se!==q.id);this.#s(m,le)}return!1}else this.#s(m,ne)}if(q.kind>=3e4&&q.kind<4e4){let ne=q.tags.find(se=>se[0]==="d")[1],le=m.selectValues("select id from events where id in (select id from events, tags where events.id = tags.event_id and tags.key = ? and tags.value = ?)",["d",ne]);if(le.includes(q.id)){if(this.#o.add(q.id),le.length>1){let se=le.filter(ye=>ye!==q.id);this.#s(m,se)}return!1}else this.#s(m,le)}let B={...q};delete B.relays,m.exec("insert or ignore into events(id, pubkey, created, kind, json, relays) values(?,?,?,?,?,?)",{bind:[q.id,q.pubkey,q.created_at,q.kind,JSON.stringify(B),(q.relays??[]).join(",")]});let K=m.changes();if(K>0){for(let ne of q.tags.filter(le=>le[0].length===1))m.exec("insert into tags(event_id, key, value) values(?, ?, ?)",{bind:[q.id,ne[0],ne[1]]});this.insertIntoSearchIndex(m,q)}else return this.#r(m,q),0;return this.#o.add(q.id),K}#r(m,q){let e=m.selectArrays("select relays from events where id = ?",[q.id]),B=new Set(e?.at(0)?.at(0)?.split(",")??[]),K=!1;for(let ne of q.relays??[])B.has(ne)||(B.add(ne),K=!0);K&&m.exec("update events set relays = ? where id = ?",{bind:[[...B].join(","),q.id]})}req(m,q){let e=je(),[B,K]=this.#c(q),le=this.db?.selectArrays(B,K)?.map(ye=>q.ids_only===!0?ye[0]:{...JSON.parse(ye[0]),relays:ye[1]?.split(",")})??[],se=je()-e;return this.#t(`Query ${m} results took ${se.toLocaleString()}ms`),le}count(m){let q=je(),[e,B]=this.#c(m,!0),ne=this.db?.exec(e,{bind:B,returnValue:"resultRows"})?.at(0)?.at(0)??0,le=je()-q;return this.#t(`Query count results took ${le.toLocaleString()}ms`),ne}delete(m){this.#t(`Starting delete of ${JSON.stringify(m)}`);let q=je(),e=this.req("ids-for-delete",{...m,ids_only:!0}),B=e.reduce((ne,le,se)=>{let ye=(se/1e3).toFixed(0);return ne[ye]??=[],ne[ye].push(le),ne},{});this.#t(`Starting delete of ${Object.keys(B).length} batches`),Object.entries(B).forEach(([ne,le])=>{this.#s(this.db,le)});let K=je()-q;return this.#t(`Delete ${e.length} events took ${K.toLocaleString()}ms`),e}summary(){let m=this.db?.exec("select kind, count(*) from events group by kind",{returnValue:"resultRows"});return Object.fromEntries(m?.map(q=>[String(q[0]),q[1]])??[])}async dump(){let m=String(this.db?.filename??"");if(this.db&&this.#a)try{return await this.#a.exportFile(`/${m}`)}catch(q){console.error(q)}finally{await this.#n(m)}return new Uint8Array}#c(m,q=!1,e=!1){let B=[],K=[],ne="json,relays";q?ne="count(json)":m.ids_only===!0&&(ne="id");let le=`select ${ne}`;e&&(le="delete");let se=`${le} from events`,ye=Object.entries(m).filter(([te])=>te.startsWith("#")),be=0;for(let[te,xe]of ye){let we=xe;se+=` inner join tags t_${be} on events.id = t_${be}.event_id and t_${be}.key = ? and t_${be}.value in (${this.#i(we.length)})`,K.push(te.slice(1)),K.push(...we),be++}return m.search&&(se+=" inner join search_content on search_content.id = events.id",B.push("search_content match ?"),K.push(m.search.replaceAll(".","+").replaceAll("@","+"))),m.ids&&(B.push(`id in (${this.#i(m.ids.length)})`),K.push(...m.ids)),m.authors&&(B.push(`pubkey in (${this.#i(m.authors.length)})`),K.push(...m.authors)),m.kinds&&(B.push(`kind in (${this.#i(m.kinds.length)})`),K.push(...m.kinds)),m.since&&(B.push("created >= ?"),K.push(m.since)),m.until&&(B.push("created < ?"),K.push(m.until)),B.length>0&&(se+=` where ${B.join(" and ")}`),m.limit&&(se+=` order by created desc limit ${m.limit}`),[se,K]}#i(m){let q=[];for(let e=0;e<m;e++)q.push("?");return q.join(", ")}#_(m,q){let e="",B=0;for(let K of m)if(K==="?"){let ne=q[B++];typeof ne=="number"?e+=ne.toString():typeof ne=="string"&&(e+=`'${ne}'`)}else e+=K;return e}insertIntoSearchIndex(m,q){if(q.kind===0){let e=JSON.parse(q.content);if(e){let B=[e.name,e.display_name,e.about,e.website,e.lud16,e.nip05].join(" ");m.exec("insert into search_content values(?,?)",{bind:[q.id,B]})}}else q.kind===1&&m.exec("insert into search_content values(?,?)",{bind:[q.id,q.content]})}#u(m){}};var _t=class extends ut.default{#e=new Map;#t=(m,...q)=>Ke("InMemoryRelay",m,...q);init(){return this.#t("Using in-memory relay"),Promise.resolve()}count(m){let q=0;for(let[,e]of this.#e)Dt(e,m)&&q++;return q}summary(){let m={};for(let[q,e]of this.#e)m[e.kind.toString()]??=0,m[e.kind.toString()]++;return m}dump(){let m=new TextEncoder;return Promise.resolve(m.encode(JSON.stringify(this.#e.values())))}close(){}wipe(){return this.#e=new Map,Promise.resolve()}event(m){return this.#e.has(m.id)?!1:(this.#e.set(m.id,m),this.emit("event",[m]),!0)}eventBatch(m){let q=[];for(let e of m)this.#e.has(e.id)||(this.#e.set(e.id,e),q.push(e));return q.length>0?(this.emit("event",q),!0):!1}sql(m,q){return[]}req(m,q){let e=[];for(let[,B]of this.#e)Dt(B,q)&&(q.ids_only===!0?e.push(B.id):e.push(B));return e}delete(m){let q=this.req("ids-for-delete",{...m,ids_only:!0});return q.forEach(e=>this.#e.delete(e)),q}setEventMetadata(m,q){}};var Fl=M=>({event:null}),Xe=(M,...m)=>Ke("getForYouFeed",M,...m);async function mn(M,m){console.time("For You feed generation time"),Xe("pubkey",m);let q=await Pl(M,m);Xe("my reacted events",q);let e=await Ol(M,q,m);Xe("my reacted authors",e);let B=await Ll(M,q,m);Xe("others who reacted",B);let K=await Rl(M,B,q,m);Xe("reacted by others",K);let ne=await Dl(M,K,e);return Xe("feed.length",ne.length),console.timeEnd("For You feed generation time"),ne}async function Ol(M,m,q){let e=new Map;return M.req("getMyReactedAuthors",{"#e":Array.from(m)}).forEach(K=>{K.pubkey!==q&&e.set(K.pubkey,(e.get(K.pubkey)||0)+1)}),e}async function Pl(M,m){let q=new Set;return M.req("getMyReactedEventIds",{authors:[m],kinds:[1,6,7,9735]}).forEach(B=>{let K=B.kind===9735?Fl(B).event?.id:B.tags.find(ne=>ne[0]==="e")?.[1];K&&q.add(K)}),q}async function Ll(M,m,q){let e=new Map;return M.req("getOthersWhoReacted",{"#e":Array.from(m)}).forEach(K=>{K.pubkey!==q&&e.set(K.pubkey,(e.get(K.pubkey)||0)+1)}),e}async function Rl(M,m,q,e){let B=new Map;return M.req("getEventIdsReactedByOthers",{authors:[...m.keys()],kinds:[1,6,7,9735]}).forEach(ne=>{ne.pubkey===e||q.has(ne.id)||ne.tags.forEach(le=>{if(le[0]==="e"){let se=Math.ceil(Math.sqrt(m.get(ne.pubkey)||0));B.set(le[1],(B.get(le[1])||0)+se)}})}),B}async function Dl(M,m,q){let e=M.sql(`select json from events where id in (${Array.from(m.keys()).map(()=>"?").join(", ")}) and kind = 1 order by seen_at ASC, created DESC limit 1000`,Array.from(m.keys())).map(qe=>JSON.parse(qe[0])),B=new Set(e.map(qe=>qe.id));Xe("reactedToAuthors",q);let K=Array.from(q.keys()).sort((qe,De)=>q.get(De)-q.get(qe)).slice(20);M.sql(`select json from events where pubkey in (${K.map(()=>"?").join(", ")}) and kind = 1 order by seen_at ASC, created DESC limit 100`,K).map(qe=>JSON.parse(qe[0])).forEach(qe=>{B.has(qe.id)||e.push(qe)});let le=e.filter(qe=>!qe.tags.some(De=>De[0]==="e")),se=new Date().getTime(),ye=1/0,be=-1/0,te=1/0,xe=-1/0;le.forEach(qe=>{let De=m.get(qe.id)||0;ye=Math.min(ye,De),be=Math.max(be,De);let Be=se-new Date(qe.created_at).getTime();te=Math.min(te,Be),xe=Math.max(xe,Be)});let we=(qe,De,Be)=>(qe-De)/(Be-De),He=Math.max(...Array.from(q.values())),rt=.5;return le.sort((qe,De)=>{let Be=we(m.get(qe.id)||0,ye,be),ft=we(m.get(De.id)||0,ye,be),st=we(se-new Date(qe.created_at).getTime(),te,xe),vt=we(se-new Date(De.created_at).getTime(),te,xe),Ye=we(q.get(qe.pubkey)||0,0,He),ze=we(q.get(De.pubkey)||0,0,He),wt=Math.random()>.75?-.1:-10,Et=Be+wt*st+Ye*rt;return ft+wt*vt+ze*rt-Et}),le}var Re,hn=10,nt=[];async function gn(){if(nt.length>0){let M=je(),m=1e3;if(Re)for(;nt.length>0&&!(je()-M>=m);){let q=nt.splice(0,hn);nt=nt.slice(q.length),Re.eventBatch(q)}}setTimeout(()=>gn(),100)}try{setTimeout(()=>gn(),100)}catch(M){console.error(M)}var yn=async(M,m)=>{async function q(B,K){M.postMessage({id:B,cmd:"reply",args:K})}let e=m.data;try{switch(e.cmd){case"debug":{dn(!0),q(e.id,!0);break}case"init":{let B=e.args;hn=B.insertBatchSize??10;try{"WebAssembly"in self?Re=new bt:Re=new _t,await Re.init(B.databasePath)}catch(K){console.error("Fallback to InMemoryRelay",K),Re=new _t,await Re.init(B.databasePath)}q(e.id,!0);break}case"event":{let B=e.args;nt.push(B),q(e.id,{ok:!0,id:B.id,relay:""});break}case"close":{let B=Re.close();q(e.id,B);break}case"req":{let B=e.args,K=B.slice(2),ne=[],le=new Set;for(let se of K){let ye=Re.req(B[1],se);for(let be of ye)typeof be=="string"&&le.has(be)||le.has(be.id)||(le.add(typeof be=="string"?be:be.id),ne.push(be))}q(e.id,ne);break}case"count":{let B=e.args,K=0,ne=B.slice(2);for(let le of ne){let se=Re.count(le);K+=se}q(e.id,K);break}case"delete":{let B=e.args,K=[],ne=B.slice(2);for(let le of ne){let se=Re.delete(le);K.push(...se)}q(e.id,K);break}case"summary":{let B=Re.summary();q(e.id,B);break}case"dumpDb":{let B=await Re.dump();q(e.id,B);break}case"wipe":{await Re.wipe(),q(e.id,!0);break}case"forYouFeed":{let B=await mn(Re,e.args);q(e.id,B);break}case"setEventMetadata":{let[B,K]=e.args;Re.setEventMetadata(B,K);break}default:{q(e.id,{error:"Unknown command"});break}}}catch(B){B instanceof Error?q(e.id,{error:B.message}):typeof B=="string"?q(e.id,{error:B}):q(e.id,"Unknown error")}};"SharedWorkerGlobalScope"in globalThis&&(onconnect=M=>{let m=M.ports[0];m.onmessage=q=>yn(m,q),m.start()});"DedicatedWorkerGlobalScope"in globalThis&&(onmessage=M=>{yn(self,M)});
//# sourceMappingURL=worker.mjs.map
