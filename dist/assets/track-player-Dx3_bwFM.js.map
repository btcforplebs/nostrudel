{"version":3,"file":"track-player-Dx3_bwFM.js","sources":["../../src/views/tracks/components/track-stemstr-button.tsx","../../src/views/tracks/components/track-download-button.tsx","../../src/components/live-audio-player.tsx","../../src/views/tracks/components/track-player.tsx"],"sourcesContent":["import { Button, Image, Link } from \"@chakra-ui/react\";\nimport { NostrEvent } from \"../../../types/nostr-event\";\n\nexport default function TrackStemstrButton({ track }: { track: NostrEvent }) {\n  return (\n    <Button\n      as={Link}\n      leftIcon={<Image src=\"https://stemstr.app/favicon.svg\" />}\n      href={`https://stemstr.app/thread/${track.id}`}\n      colorScheme=\"purple\"\n      isExternal\n    >\n      View on Stemstr\n    </Button>\n  );\n}\n","import { IconButton, IconButtonProps, Link } from \"@chakra-ui/react\";\nimport { NostrEvent } from \"../../../types/nostr-event\";\nimport { getDownloadURL } from \"../../../helpers/nostr/stemstr\";\nimport { DownloadIcon } from \"../../../components/icons\";\n\nexport default function TrackDownloadButton({\n  track,\n  ...props\n}: { track: NostrEvent } & Omit<IconButtonProps, \"aria-label\" | \"icon\">) {\n  const download = getDownloadURL(track);\n\n  return download ? (\n    <IconButton\n      as={Link}\n      icon={<DownloadIcon />}\n      aria-label=\"Download\"\n      title=\"Download\"\n      href={download.url}\n      download\n      isExternal\n      {...props}\n    />\n  ) : null;\n}\n","import { HTMLProps, useEffect, useRef } from \"react\";\nimport { Box, BoxProps } from \"@chakra-ui/react\";\nimport Hls from \"hls.js\";\n\nexport function LiveAudioPlayer({\n  stream,\n  autoPlay,\n  poster,\n  muted,\n  ...props\n}: Omit<BoxProps, \"children\"> & {\n  stream?: string;\n  autoPlay?: boolean;\n  poster?: string;\n  muted?: HTMLProps<HTMLVideoElement>[\"muted\"];\n}) {\n  const audio = useRef<HTMLVideoElement>(null);\n\n  useEffect(() => {\n    if (stream && audio.current && !audio.current.src && Hls.isSupported()) {\n      try {\n        const hls = new Hls({ capLevelToPlayerSize: true });\n        hls.loadSource(stream);\n        hls.attachMedia(audio.current);\n        hls.on(Hls.Events.ERROR, (event, data) => {\n          const errorType = data.type;\n          if (errorType === Hls.ErrorTypes.NETWORK_ERROR && data.fatal) {\n            hls.stopLoad();\n            hls.detachMedia();\n          }\n        });\n        hls.on(Hls.Events.MANIFEST_PARSED, () => {});\n        return () => hls.destroy();\n      } catch (e) {\n        console.error(e);\n      }\n    }\n  }, [audio, stream]);\n\n  return (\n    <Box\n      as=\"audio\"\n      ref={audio}\n      playsInline={true}\n      autoPlay={autoPlay}\n      poster={poster}\n      muted={muted}\n      controls\n      {...props}\n    />\n  );\n}\n","import { Box, Flex, IconButton, useDisclosure } from \"@chakra-ui/react\";\n\nimport { NostrEvent } from \"../../../types/nostr-event\";\nimport { LiveAudioPlayer } from \"../../../components/live-audio-player\";\nimport { getDownloadURL, getStreamURL, getWaveform } from \"../../../helpers/nostr/stemstr\";\nimport Play from \"../../../components/icons/play\";\n\nexport default function TrackPlayer({ track }: { track: NostrEvent }) {\n  const streamUrl = getStreamURL(track);\n  const downloadUrl = getDownloadURL(track);\n  const waveform = getWaveform(track);\n\n  const showPlayer = useDisclosure();\n\n  if (!showPlayer.isOpen)\n    return (\n      <Flex\n        gap=\"2px\"\n        h=\"20\"\n        alignItems=\"center\"\n        px=\"4\"\n        py=\"2\"\n        overflow=\"hidden\"\n        borderColor=\"primary.500\"\n        borderWidth=\"1px\"\n        borderRadius=\"lg\"\n        position=\"relative\"\n      >\n        <IconButton aria-label=\"Play\" mr=\"4\" icon={<Play />} onClick={showPlayer.onOpen} size=\"md\" variant=\"outline\" />\n        {waveform?.map((v) => <Box h={v + \"%\"} w=\"3px\" bg=\"primary.800\" />)}\n      </Flex>\n    );\n\n  if (streamUrl) {\n    return <LiveAudioPlayer stream={streamUrl.url} w=\"full\" autoPlay h=\"20\" />;\n  } else if (downloadUrl) {\n    return (\n      <Box as=\"audio\" controls w=\"full\" autoPlay h=\"20\">\n        <source src={downloadUrl.url} type={downloadUrl.format} />\n      </Box>\n    );\n  } else return null;\n}\n"],"names":["TrackStemstrButton","track","jsx","Button","Link","Image","TrackDownloadButton","props","download","getDownloadURL","IconButton","DownloadIcon","LiveAudioPlayer","stream","autoPlay","poster","muted","audio","useRef","useEffect","Hls","hls","event","data","e","Box","TrackPlayer","streamUrl","getStreamURL","downloadUrl","waveform","getWaveform","showPlayer","useDisclosure","jsxs","Flex","Play","v"],"mappings":"yMAGwB,SAAAA,EAAmB,CAAE,MAAAC,GAAgC,CAEzE,OAAAC,EAAA,IAACC,EAAA,CACC,GAAIC,EACJ,SAAUF,EAAAA,IAACG,EAAM,CAAA,IAAI,iCAAkC,CAAA,EACvD,KAAM,8BAA8BJ,EAAM,EAAE,GAC5C,YAAY,SACZ,WAAU,GACX,SAAA,iBAAA,CAAA,CAIL,CCVA,SAAwBK,EAAoB,CAC1C,MAAAL,EACA,GAAGM,CACL,EAAyE,CACjE,MAAAC,EAAWC,EAAeR,CAAK,EAErC,OAAOO,EACLN,EAAA,IAACQ,EAAA,CACC,GAAIN,EACJ,WAAOO,EAAa,EAAA,EACpB,aAAW,WACX,MAAM,WACN,KAAMH,EAAS,IACf,SAAQ,GACR,WAAU,GACT,GAAGD,CAAA,CAEJ,EAAA,IACN,CCnBO,SAASK,EAAgB,CAC9B,OAAAC,EACA,SAAAC,EACA,OAAAC,EACA,MAAAC,EACA,GAAGT,CACL,EAKG,CACK,MAAAU,EAAQC,SAAyB,IAAI,EAE3CC,OAAAA,EAAAA,UAAU,IAAM,CACV,GAAAN,GAAUI,EAAM,SAAW,CAACA,EAAM,QAAQ,KAAOG,EAAI,cACnD,GAAA,CACF,MAAMC,EAAM,IAAID,EAAI,CAAE,qBAAsB,EAAM,CAAA,EAClD,OAAAC,EAAI,WAAWR,CAAM,EACjBQ,EAAA,YAAYJ,EAAM,OAAO,EAC7BI,EAAI,GAAGD,EAAI,OAAO,MAAO,CAACE,EAAOC,IAAS,CACtBA,EAAK,OACLH,EAAI,WAAW,eAAiBG,EAAK,QACrDF,EAAI,SAAS,EACbA,EAAI,YAAY,EAClB,CACD,EACDA,EAAI,GAAGD,EAAI,OAAO,gBAAiB,IAAM,CAAA,CAAE,EACpC,IAAMC,EAAI,gBACVG,EAAG,CACV,QAAQ,MAAMA,CAAC,CACjB,CACF,EACC,CAACP,EAAOJ,CAAM,CAAC,EAGhBX,EAAA,IAACuB,EAAA,CACC,GAAG,QACH,IAAKR,EACL,YAAa,GACb,SAAAH,EACA,OAAAC,EACA,MAAAC,EACA,SAAQ,GACP,GAAGT,CAAA,CAAA,CAGV,CC5CwB,SAAAmB,EAAY,CAAE,MAAAzB,GAAgC,CAC9D,MAAA0B,EAAYC,EAAa3B,CAAK,EAC9B4B,EAAcpB,EAAeR,CAAK,EAClC6B,EAAWC,EAAY9B,CAAK,EAE5B+B,EAAaC,IAEnB,OAAKD,EAAW,OAmBZL,EACKzB,EAAA,IAACU,EAAgB,CAAA,OAAQe,EAAU,IAAK,EAAE,OAAO,SAAQ,GAAC,EAAE,IAAK,CAAA,EAC/DE,EAEP3B,MAACuB,GAAI,GAAG,QAAQ,SAAQ,GAAC,EAAE,OAAO,SAAQ,GAAC,EAAE,KAC3C,SAAAvB,EAAA,IAAC,UAAO,IAAK2B,EAAY,IAAK,KAAMA,EAAY,MAAQ,CAAA,CAC1D,CAAA,EAEU,KAzBVK,EAAA,KAACC,EAAA,CACC,IAAI,MACJ,EAAE,KACF,WAAW,SACX,GAAG,IACH,GAAG,IACH,SAAS,SACT,YAAY,cACZ,YAAY,MACZ,aAAa,KACb,SAAS,WAET,SAAA,CAAAjC,MAACQ,EAAW,CAAA,aAAW,OAAO,GAAG,IAAI,KAAMR,MAACkC,EAAK,CAAA,CAAA,EAAI,QAASJ,EAAW,OAAQ,KAAK,KAAK,QAAQ,UAAU,EAC5GF,GAAA,YAAAA,EAAU,IAAKO,GAAOnC,EAAA,IAAAuB,EAAA,CAAI,EAAGY,EAAI,IAAK,EAAE,MAAM,GAAG,aAAc,CAAA,EAAE,CAAA,CAAA,CAa1E"}