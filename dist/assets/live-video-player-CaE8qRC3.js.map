{"version":3,"file":"live-video-player-CaE8qRC3.js","sources":["../../src/components/live-video-player.tsx"],"sourcesContent":["import { HTMLProps, useEffect, useRef, useState } from \"react\";\nimport { Box, BoxProps } from \"@chakra-ui/react\";\nimport Hls from \"hls.js\";\n\nexport enum VideoStatus {\n  Online = \"online\",\n  Offline = \"offline\",\n}\n\n// copied from zap.stream\nexport default function LiveVideoPlayer({\n  stream,\n  autoPlay,\n  poster,\n  muted,\n  ...props\n}: Omit<BoxProps, \"children\"> & {\n  stream?: string;\n  autoPlay?: boolean;\n  poster?: string;\n  muted?: HTMLProps<HTMLVideoElement>[\"muted\"];\n}) {\n  const video = useRef<HTMLVideoElement>(null);\n  const [status, setStatus] = useState<VideoStatus>();\n\n  useEffect(() => {\n    if (stream && video.current && !video.current.src && Hls.isSupported()) {\n      try {\n        const hls = new Hls({ capLevelToPlayerSize: true });\n        hls.loadSource(stream);\n        hls.attachMedia(video.current);\n        hls.on(Hls.Events.ERROR, (event, data) => {\n          const errorType = data.type;\n          if (errorType === Hls.ErrorTypes.NETWORK_ERROR && data.fatal) {\n            hls.stopLoad();\n            hls.detachMedia();\n            setStatus(VideoStatus.Offline);\n          }\n        });\n        hls.on(Hls.Events.MANIFEST_PARSED, () => {\n          setStatus(VideoStatus.Online);\n        });\n        return () => hls.destroy();\n      } catch (e) {\n        console.error(e);\n        setStatus(VideoStatus.Offline);\n      }\n    }\n  }, [video, stream]);\n\n  return (\n    <Box\n      as=\"video\"\n      ref={video}\n      playsInline={true}\n      controls={status === VideoStatus.Online}\n      autoPlay={autoPlay}\n      poster={poster}\n      muted={muted}\n      {...props}\n    />\n  );\n}\n"],"names":["VideoStatus","LiveVideoPlayer","stream","autoPlay","poster","muted","props","video","useRef","status","setStatus","useState","useEffect","Hls","hls","event","data","jsx","Box"],"mappings":"4FAIY,IAAAA,GAAAA,IACVA,EAAA,OAAS,SACTA,EAAA,QAAU,UAFAA,IAAAA,GAAA,CAAA,CAAA,EAMZ,SAAwBC,EAAgB,CACtC,OAAAC,EACA,SAAAC,EACA,OAAAC,EACA,MAAAC,EACA,GAAGC,CACL,EAKG,CACK,MAAAC,EAAQC,SAAyB,IAAI,EACrC,CAACC,EAAQC,CAAS,EAAIC,EAAsB,SAAA,EAElDC,OAAAA,EAAAA,UAAU,IAAM,CACV,GAAAV,GAAUK,EAAM,SAAW,CAACA,EAAM,QAAQ,KAAOM,EAAI,cACnD,GAAA,CACF,MAAMC,EAAM,IAAID,EAAI,CAAE,qBAAsB,EAAM,CAAA,EAClD,OAAAC,EAAI,WAAWZ,CAAM,EACjBY,EAAA,YAAYP,EAAM,OAAO,EAC7BO,EAAI,GAAGD,EAAI,OAAO,MAAO,CAACE,EAAOC,IAAS,CACtBA,EAAK,OACLH,EAAI,WAAW,eAAiBG,EAAK,QACrDF,EAAI,SAAS,EACbA,EAAI,YAAY,EAChBJ,EAAU,SAAmB,EAC/B,CACD,EACDI,EAAI,GAAGD,EAAI,OAAO,gBAAiB,IAAM,CACvCH,EAAU,QAAkB,CAAA,CAC7B,EACM,IAAMI,EAAI,gBACV,EAAG,CACV,QAAQ,MAAM,CAAC,EACfJ,EAAU,SAAmB,CAC/B,CACF,EACC,CAACH,EAAOL,CAAM,CAAC,EAGhBe,EAAA,IAACC,EAAA,CACC,GAAG,QACH,IAAKX,EACL,YAAa,GACb,SAAUE,IAAW,SACrB,SAAAN,EACA,OAAAC,EACA,MAAAC,EACC,GAAGC,CAAA,CAAA,CAGV"}