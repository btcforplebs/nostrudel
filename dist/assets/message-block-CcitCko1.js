import{r as d,by as C,ep as h,j as e,ae as m,bo as g,E as I,aB as B,eq as R,z as E,bX as T,eb as z,u as M,C as F,a9 as W,Z as A,bD as U,y as p,$ as L,aX as j,aZ as N,er as b,es as O,cd as P,af as Z,aN as w,F as f}from"./index-C6wlVu-O.js";const v=d.createContext({threads:{},getRoot:t=>{}});function D(){return d.useContext(v)}function G({timeline:t,children:s}){const a=C(t.timeline)??[],i=d.useMemo(()=>{var c;const n={};for(const l of a){const r=(c=l.tags.find(u=>u[0]==="e"&&u[3]==="root"))==null?void 0:c[1];r&&(n[r]||(n[r]={messages:[],rootId:r,root:h.getEvent(r)}),n[r].messages.push(l))}return n},[a.length]),o=d.useCallback(n=>h.getEvent(n),[]),x=d.useMemo(()=>({threads:i,getRoot:o}),[i,o]);return e.jsx(v.Provider,{value:x,children:s})}function S({thread:t}){const s=m(),a=g(),i=()=>{s(".",{state:{...a.state,thread:t.rootId}})};return e.jsxs(I,{variant:"outline",size:"sm",leftIcon:e.jsx(B,{pubkey:t.messages[t.messages.length-1].pubkey,size:"xs"}),rightIcon:e.jsx(R,{}),onClick:i,children:[t.messages.length," replies"]})}function X({event:t,...s}){const a=m(),i=g(),o=()=>{a(".",{state:{...i.state,thread:t.id}})};return e.jsx(E,{icon:e.jsx(T,{}),onClick:o,"aria-label":"Reply in thread",title:"Reply in thread",...s})}function y({message:t,showHeader:s=!0,showThreadButton:a=!0,renderContent:i,...o}){const n=(z(t)??[]).length>0;let c=s?"header":"inline";n&&c==="inline"&&(c="footer");const l=M(t),r=e.jsxs(e.Fragment,{children:[e.jsx(P,{event:t}),e.jsx(b,{event:t,portal:!0}),a&&e.jsx(X,{event:t,"aria-label":"Open Thread"})]});return e.jsxs(F,{...o,borderRadius:"lg",ref:l,children:[s&&e.jsxs(W,{px:"2",pt:"2",pb:"0",gap:"2",display:"flex",alignItems:"center",children:[e.jsx(A,{pubkey:t.pubkey,fontWeight:"bold"}),e.jsx(U,{pubkey:t.pubkey,onlyIcon:!0}),c==="header"&&e.jsx(p,{size:"xs",variant:"ghost",ml:"auto",children:r})]}),e.jsx(L,{px:"2",py:"2",children:i(t,n?null:e.jsxs(p,{size:"xs",variant:"ghost",float:"right",ml:"2",children:[c==="inline"&&r,e.jsx(j,{timestamp:t.created_at,ml:"2",userSelect:"none"})]}))}),n&&e.jsxs(N,{alignItems:"center",display:"flex",gap:"2",px:"2",pt:"0",pb:"2",children:[e.jsxs(p,{size:"xs",variant:"ghost",children:[c==="footer"?r:e.jsx(b,{event:t,portal:!0}),e.jsx(O,{event:t})]}),e.jsx(j,{ml:"auto",timestamp:t.created_at})]})]})}function _({message:t,showThreadButton:s=!0,...a}){const{threads:i}=D(),o=i[t.id];return e.jsxs(e.Fragment,{children:[s&&!!o&&e.jsx(S,{thread:o}),e.jsx(y,{message:t,showThreadButton:s&&!o,...a})]})}function H({messages:t,showThreadButton:s=!0,reverse:a=!1,renderContent:i}){const o=t[t.length-1],n=Z().pubkey===o.pubkey,c=e.jsx(w,{pubkey:o.pubkey,size:"sm",my:"1"}),l=s?_:y;return e.jsxs(f,{direction:"row",gap:"2",alignItems:"flex-end",children:[!n&&c,e.jsx(f,{direction:a?"column-reverse":"column",gap:"1",ml:n?"auto":0,mr:n?0:"auto",maxW:"2xl",alignItems:n?"flex-end":"flex-start",children:t.map((r,u,k)=>e.jsx(l,{message:r,showHeader:a?u===k.length-1:u===0,minW:{base:0,sm:"sm",md:"md"},maxW:"full",overflow:"hidden",showThreadButton:s,renderContent:i},r.id))}),n&&c]})}export{H as M,S as T,G as a,D as u};
//# sourceMappingURL=message-block-CcitCko1.js.map
