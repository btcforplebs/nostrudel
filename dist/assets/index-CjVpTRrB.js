import{eW as g,k as h,j as s,gJ as C,gK as T,by as x,ct as F,ae as M,r as o,fc as y,e as L,f as N,F as l,E as m,bB as R}from"./index-C6wlVu-O.js";import{n as f,u as B,L as P}from"./use-event-markers-NVI1qG80.js";function A(e,t){let r;return u=>new Promise(c=>{r&&window.clearTimeout(r),r=window.setTimeout(()=>{c(e(u))},t)})}const V=g.memo(({event:e,focused:t})=>{switch(e.kind){case h.ShortTextNote:return s.jsx(T,{event:e,variant:t?"elevated":void 0});case h.LiveEvent:return s.jsx(C,{event:e});default:return null}}),W=g.memo(({timeline:e,focused:t})=>{const r=x(e.timeline);return s.jsx(s.Fragment,{children:r==null?void 0:r.map(i=>s.jsx(F,{event:i,children:s.jsx(V,{event:i,focused:t===i.id})},i.id))})});function q(e){return e<=4?1:e<=8?2:e<=10?3:e<=12?4:e<=14?5:e<=16?6:(e<=18,7)}function O(){const e=M(),[t,r]=o.useState(),[i,u]=y();o.useEffect(()=>{if(!t)return;const n=A(()=>{const a=t.getCenter(),E=f.encode(a.lat,a.lng,5);u({hash:E},{replace:!0})},1e3);return t.addEventListener("move",n),()=>{t.removeEventListener("move",n)}});const[c,p]=o.useState([]),v=L(),{loader:d,timeline:I}=N("geo-events",v,c.length>0?{"#g":c,kinds:[h.ShortTextNote]}:void 0),b=o.useCallback(()=>{if(!t)return;const n=t.getBounds(),a=f.bboxes(n.getSouth(),n.getWest(),n.getNorth(),n.getEast(),q(t.getZoom()));p(a)},[t]),[j,S]=o.useState(),k=o.useCallback(n=>{var a;(a=document.querySelector(`[data-event-id="${n.id}"]`))==null||a.scrollIntoView(),S(n.id)},[]),w=x(d.timeline)??[];return B(w,t,k),s.jsxs(l,{overflow:{lg:"hidden"},h:{lg:"full"},direction:{base:"column-reverse",lg:"row"},children:[s.jsxs(l,{w:{base:"full",lg:"xl"},direction:"column",p:"2",gap:"2",children:[s.jsxs(l,{gap:"2",children:[s.jsx(m,{flexShrink:0,onClick:()=>e(-1),children:"Back"}),s.jsx(m,{colorScheme:"primary",onClick:b,flex:1,children:"Search this area"})]}),s.jsxs(l,{overflowY:"auto",overflowX:"hidden",gap:"2",direction:"column",h:"full",children:[s.jsx(W,{timeline:d,focused:j}),c.length>0&&s.jsx(R,{timeline:d})]})]}),s.jsx(P,{onCreate:r,h:{base:"50vh",lg:"100vh"}})]})}export{O as default};
//# sourceMappingURL=index-CjVpTRrB.js.map
