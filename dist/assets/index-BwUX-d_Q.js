import{af as O,j as s,aE as S,a6 as B,ae as P,s as p,e as F,cW as L,ck as _,cX as z,f as U,k as u,cY as b,cZ as $,c_ as H,r as V,c$ as Y,d0 as J,i as q,V as G,F as i,E as x,b as k,y as K,H as h,c8 as Q,I as W,bB as X,ct as w,d1 as v,m as M,T as Z,l as ee,bP as se,ao as ne,bQ as oe,ar as te,aq as ae,as as ie,d2 as re,t as ce,d3 as le,d4 as de}from"./index-C6wlVu-O.js";import{C as me}from"./community-create-modal-B8kIIGiT.js";import{A as pe}from"./community-approved-post-CnQFPEOV.js";import{C as ue}from"./chunk-FAWTVNS3-DRjGX2be.js";import"./event-vote-buttions-RbXWv7yI.js";import"./community-post-BPGddPsB.js";function xe(){const g=B(),I=P(),E=O(),r=p(),c=F(),{pointers:l}=L(E.pubkey,c,{alwaysRequest:!0}),t=_(l,c).sort(z),N=async e=>{const n={kind:re,created_at:ce().unix(),content:"",tags:[["d",e.name]]};if(e.description&&n.tags.push(["description",e.description]),e.banner)try{const o=await le(e.banner);n.tags.push(["image",e.banner,`${o.width}x${o.height}`])}catch{n.tags.push(["image",e.banner])}for(const o of e.mods)n.tags.push(["p",o,"","moderator"]);for(const o of e.relays)n.tags.push(["relay",o]);for(const[o,y]of e.links)n.tags.push(y?["r",o,y]:["r",o]);const a=await g("Create Community",n,e.relays,!1);a&&I(`/c/${de(a.event)}/${a.event.pubkey}`)},{loader:f,timeline:j}=U("all-communities-timeline",c,l.length>0?{kinds:[u.ShortTextNote,u.Repost,u.GenericRepost,b],"#a":l.map(e=>$(e.kind,e.pubkey,e.identifier))}:void 0),d=p(),D=H(),T=V.useMemo(()=>{const e=new Set;for(const n of t)for(const a of Y(n))e.add(a);return Array.from(e)},[t]),C=J(j,T),A=j.filter(e=>e.kind!==b&&(d.isOpen?!0:C.has(e.id))).map(e=>({event:e,approvals:C.get(e.id)})).filter(e=>!D(e.event)),R=q(f),m=p();return s.jsxs(s.Fragment,{children:[s.jsxs(G,{children:[s.jsxs(i,{gap:"2",alignItems:"center",wrap:"wrap",children:[s.jsx(x,{as:k,to:"/communities/explore",children:"Explore"}),s.jsxs(K,{ml:"auto",children:[s.jsx(x,{onClick:r.onOpen,children:"Create"}),s.jsx(x,{onClick:m.onOpen,hideFrom:"xl",children:"Joined"})]})]}),t.length>0?s.jsxs(i,{gap:"4",overflow:"hidden",children:[s.jsxs(i,{direction:"column",gap:"2",flex:1,overflow:"hidden",children:[s.jsxs(i,{alignItems:"center",gap:"4",children:[s.jsx(h,{size:"lg",children:"Latest Posts"}),s.jsx(Q,{isChecked:d.isOpen,onChange:d.onToggle,children:"Show Unapproved"})]}),s.jsx(W,{callback:R,children:A.map(({event:e,approvals:n})=>s.jsx(pe,{event:e,approvals:n??[],showCommunity:!0},e.id))}),s.jsx(X,{timeline:f})]}),s.jsxs(i,{gap:"2",direction:"column",w:"md",flexShrink:0,hideBelow:"xl",children:[s.jsx(h,{size:"md",children:"Joined Communities"}),t.map(e=>s.jsx(w,{event:e,children:s.jsx(v,{community:e})},M(e)))]})]}):s.jsxs(ue,{py:"20",flexDirection:"column",gap:"4",children:[s.jsx(h,{size:"md",children:"No communities :("}),s.jsxs(Z,{children:["go find a cool one to join."," ",s.jsx(ee,{as:k,to:"/communities/explore",color:"blue.500",children:"Explore"})]})]})]}),r.isOpen&&s.jsx(me,{isOpen:r.isOpen,onClose:r.onClose,onSubmit:N}),s.jsxs(se,{isOpen:m.isOpen,placement:"right",onClose:m.onClose,size:"lg",children:[s.jsx(ne,{}),s.jsxs(oe,{children:[s.jsx(te,{}),s.jsx(ae,{p:"4",children:"Joined Communities"}),s.jsx(ie,{display:"flex",flexDirection:"column",gap:"2",px:"4",pt:"0",pb:"8",overflowY:"auto",children:t.map(e=>s.jsx(w,{event:e,children:s.jsx(v,{community:e,flexShrink:0})},M(e)))})]})]})]})}function be(){return O()?s.jsx(xe,{}):s.jsx(S,{to:"/communities/explore"})}export{be as default};
//# sourceMappingURL=index-BwUX-d_Q.js.map
