import{dx as A,a6 as T,ae as V,fc as q,r as x,aw as L,e as _,at as B,bI as D,hE as K,hD as N,hC as H,bJ as M,hv as W,t as j,hz as d,m as J,hw as z,cm as G,j as e,V as U,H as Y,a2 as $,a3 as O,aC as Q,F as y,cn as m,co as h,v as b,hJ as X,dB as Z,aP as ee,E as k}from"./index-C6wlVu-O.js";import{F as te,M as ae}from"./format-toolbar-CPmampgE.js";function ie(){const S=A(),w=T(),p=V(),[i]=q(),n=i.get("topic"),C=i.get("title"),o=x.useMemo(()=>{const t=i.get("fork");if(t){const s=L.decode(t);if(s.type==="naddr")return s.data}},[i]),v=_(),a=B(o??void 0,v),{register:c,setValue:u,getValues:r,handleSubmit:E,watch:P,formState:g,reset:l}=D({defaultValues:{content:"",title:C||n||"",topic:n||"",summary:""},mode:"all"});x.useEffect(()=>{a&&l({topic:K(a),title:N(a)??"",summary:H(a,!1)??"",content:a.content})},[a,l]);const F=o?"wiki-"+o.identifier+":"+o.pubkey+"-fork":n?"wiki-"+n:"wiki-create-page",I=M(F,r,l,g);P("content"),c("content",{minLength:10,required:!0});const R=E(async t=>{try{const s={kind:W,content:t.content,tags:[["d",t.topic],["title",t.title],["summary",t.summary],["published_at",String(j().unix())]],created_at:j().unix()};a&&(s.tags.push(["e",a.id,d[0],"fork"]),s.tags.push(["a",J(a),d[0],"fork"]));const f=await w("Publish Page",s,d,!1);z.handleEvent(f.event),I(),p(`/wiki/page/${G.getSharableEventAddress(f.event)}`,{replace:!0})}catch(s){s instanceof Error&&S({description:s.message,status:"error"})}});return e.jsxs(U,{as:"form",h:"full",onSubmit:R,children:[e.jsx(Y,{children:"Create Page"}),a&&e.jsxs($,{status:"info",children:[e.jsx(O,{}),"Forking page from ",e.jsx(Q,{pubkey:a.pubkey,ml:"2"})]}),e.jsxs(y,{gap:"2",wrap:{base:"wrap",md:"nowrap"},children:[e.jsxs(m,{w:{base:"full",md:"sm"},isRequired:!0,flexShrink:0,children:[e.jsx(h,{children:"Topic"}),e.jsx(b,{placeholder:"banana",isRequired:!0,...c("topic",{onBlur:()=>{const t=X(r().topic);u("topic",t.replaceAll(" ","_").toLocaleLowerCase()),r().title||u("title",t,{shouldDirty:!0})}})})]}),e.jsxs(m,{isRequired:!0,children:[e.jsx(h,{children:"Title"}),e.jsx(b,{...c("title",{required:!0}),autoComplete:"off"})]})]}),e.jsxs(m,{children:[e.jsx(h,{children:"Summary"}),e.jsx(Z,{...c("summary",{required:!0}),isRequired:!0})]}),e.jsxs(y,{gap:"2",children:[e.jsx(te,{getValue:()=>r().content,setValue:t=>u("content",t,{shouldDirty:!0})}),e.jsx(ee,{}),e.jsx(k,{onClick:()=>p(-1),children:"Cancel"}),e.jsx(k,{colorScheme:"primary",type:"submit",isLoading:g.isSubmitting,children:"Publish"})]}),e.jsx(ae,{value:r().content,onChange:t=>u("content",t)})]})}export{ie as default};
//# sourceMappingURL=create-DvaTMuP5.js.map
