import{dx as ae,af as ne,bH as re,bI as te,r as d,dy as oe,j as e,an as ie,ao as le,ap as de,aq as ce,ar as ue,as as me,cn as i,co as l,v as c,dz as u,dA as b,dB as N,B as pe,F as t,z as G,dC as xe,aB as he,Z as je,dD as ge,E as m,aV as ye,T as fe,dE as be,l as ve,cp as Ce,cU as ke,dF as Ie,b0 as Re,dG as Se}from"./index-C6wlVu-O.js";function k({...v}){return e.jsx(G,{icon:e.jsx(ke,{}),size:"sm",colorScheme:"red",variant:"ghost",ml:"auto",...v})}function Fe({isOpen:v,onClose:I,onSubmit:O,defaultValues:P,isUpdate:p,...W}){var T,z,D,E,w,V,H,q;const R=ae(),S=ne(),{requestSignature:M}=re(),{register:x,formState:{errors:a,isSubmitting:Z},handleSubmit:$,watch:h,getValues:r,setValue:o}=te({mode:"all",defaultValues:P||{name:"",banner:"",description:"",rules:"",mods:S?[S.pubkey]:[],relays:[],links:[]}});h("mods"),h("banner"),h("links"),h("relays");const[J,F]=d.useState(!1),K=d.useCallback(async s=>{try{if(!(s.type.includes("image")||s.type.includes("video")||s.type.includes("audio")))throw new Error("Unsupported file type");F(!0);const f=(await oe(s,M)).url;o("banner",f,{shouldDirty:!0,shouldValidate:!0})}catch(n){n instanceof Error&&R({description:n.message,status:"error"})}F(!1)},[o,r,M,R]),[j,L]=d.useState(""),Q=()=>{if(!j)return;const s=Ie(j);s&&o("mods",r("mods").concat(s)),L("")},X=s=>{o("mods",r("mods").filter(n=>n!==s))},[g,U]=d.useState(""),Y=()=>{if(!g)return;const s=Re(g);s&&o("relays",r("relays").concat(s)),U("")},_=s=>{o("relays",r("relays").filter(n=>n!==s))},[y,B]=d.useState(""),[C,A]=d.useState(""),ee=()=>{if(!y)return;const s=Se(y);s&&o("links",[...r("links"),C?[s,C]:[s]]),B(""),A("")},se=s=>{o("links",r("links").filter(([n])=>n!==s))};return e.jsxs(ie,{isOpen:v,onClose:I,size:"2xl",...W,children:[e.jsx(le,{}),e.jsxs(de,{as:"form",onSubmit:$(O),children:[e.jsx(ce,{p:"4",children:p?"Update Community":"Create Community"}),e.jsx(ue,{}),e.jsxs(me,{px:"4",py:"0",gap:"4",display:"flex",flexDirection:"column",children:[!p&&e.jsxs(i,{isInvalid:!!a.name,children:[e.jsx(l,{children:"Community Name"}),e.jsx(c,{type:"text",...x("name",{required:!0,validate:s=>new RegExp("\\p{Z}","iu").test(s)?"Must not have spaces":!0}),isReadOnly:p,autoComplete:"off",placeholder:"more-cat-pictures"}),e.jsx(u,{children:"The name of your community (no-spaces)"}),((T=a.name)==null?void 0:T.message)&&e.jsx(b,{children:(z=a.name)==null?void 0:z.message})]}),e.jsxs(i,{isInvalid:!!a.description,children:[e.jsx(l,{children:"Description"}),e.jsx(N,{...x("description"),autoComplete:"off"}),e.jsx(u,{children:"Short description about your community"}),((D=a.description)==null?void 0:D.message)&&e.jsx(b,{children:(E=a.description)==null?void 0:E.message})]}),e.jsxs(i,{isInvalid:!!a.banner,children:[e.jsx(l,{children:"Banner"}),r().banner&&e.jsx(pe,{backgroundImage:r().banner,backgroundRepeat:"no-repeat",backgroundPosition:"center",backgroundSize:"cover",aspectRatio:3/1,mb:"2",borderRadius:"lg"}),e.jsxs(t,{gap:"2",children:[e.jsx(c,{type:"url",...x("banner"),autoComplete:"off",placeholder:"https://example.com/banner.png"}),e.jsx(c,{id:"banner-upload",type:"file",accept:"image/*",display:"none",onChange:s=>{var f;const n=(f=s.target.files)==null?void 0:f[0];n&&K(n)}}),e.jsx(G,{as:"label",htmlFor:"banner-upload",icon:e.jsx(xe,{}),"aria-label":"Upload Image",cursor:"pointer",tabIndex:0,isLoading:J})]}),((w=a.banner)==null?void 0:w.message)&&e.jsx(b,{children:(V=a.banner)==null?void 0:V.message})]}),e.jsxs(i,{isInvalid:!!a.rules,children:[e.jsx(l,{children:"Rules and Guidelines"}),e.jsx(N,{...x("rules"),autoComplete:"off",placeholder:"don't be a jerk"}),e.jsx(u,{children:"Rules and posting guidelines"}),((H=a.rules)==null?void 0:H.message)&&e.jsx(b,{children:(q=a.rules)==null?void 0:q.message})]}),e.jsxs(i,{isInvalid:!!a.mods,children:[e.jsx(l,{children:"Moderators"}),e.jsx(t,{direction:"column",gap:"2",pb:"2",children:r().mods.map(s=>e.jsxs(t,{gap:"2",alignItems:"center",children:[e.jsx(he,{pubkey:s,size:"sm"}),e.jsx(je,{pubkey:s,fontWeight:"bold"}),e.jsx(k,{"aria-label":"Remove moderator",title:"Remove moderator",onClick:()=>X(s)})]},s))}),e.jsxs(t,{gap:"2",children:[e.jsx(ge,{value:j,onChange:s=>L(s.target.value)}),e.jsx(m,{isDisabled:!j,onClick:Q,children:"Add"})]})]}),e.jsxs(i,{isInvalid:!!a.mods,children:[e.jsx(l,{children:"Relays"}),e.jsx(u,{children:"A Short list of recommended relays for the community"}),e.jsx(t,{direction:"column",gap:"2",py:"2",children:r().relays.map(s=>e.jsxs(t,{alignItems:"center",gap:"2",children:[e.jsx(ye,{relay:s,size:"sm"}),e.jsx(fe,{fontWeight:"bold",isTruncated:!0,children:s}),e.jsx(k,{"aria-label":`Remove ${s}`,title:`Remove ${s}`,onClick:()=>_(s)})]},s))}),e.jsxs(t,{gap:"2",children:[e.jsx(be,{value:g,onChange:s=>U(s.target.value)}),e.jsx(m,{isDisabled:!g,onClick:Y,children:"Add"})]})]}),e.jsxs(i,{isInvalid:!!a.mods,children:[e.jsx(l,{children:"Links"}),e.jsx(u,{children:"A few helpful resources for the community"}),e.jsx(t,{direction:"column",mt:"2",children:r().links.map(([s,n])=>e.jsxs(t,{children:[e.jsx(ve,{href:s,children:n||s}),e.jsx(k,{"aria-label":"Remove Link",title:"Remove Link",onClick:()=>se(s)})]},s))}),e.jsxs(t,{gap:"2",children:[e.jsx(c,{type:"url",placeholder:"https://example.com/useful-resources.html",value:y,onChange:s=>B(s.target.value)}),e.jsx(c,{placeholder:"title",value:C,onChange:s=>A(s.target.value)}),e.jsx(m,{isDisabled:!y,onClick:ee,flexShrink:0,children:"Add"})]})]})]}),e.jsxs(Ce,{p:"4",display:"flex",gap:"2",children:[e.jsx(m,{onClick:I,children:"Cancel"}),e.jsx(m,{colorScheme:"primary",type:"submit",isLoading:Z,children:p?"Update Community":"Create Community"})]})]})]})}export{Fe as C};
//# sourceMappingURL=community-create-modal-B8kIIGiT.js.map
