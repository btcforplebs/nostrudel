import{n as ne,o as m,p as se,q as te,s as _,r as w,j as e,t as h,F as d,B as y,Q as ae,v as ie,w as b,x as oe,T as u,y as ce,z as V,A as le,E as g,G as ue,J as de,K as xe,M as he,N as je,O as pe,P as J,H as x,U as ge,C as M,W as P,X as fe,Y as I,Z as ve,_ as R,$ as z,a0 as me,a1 as ye,a2 as N,a3 as A,a4 as L,a5 as B,a6 as U,a7 as W,e as H,a8 as be,a9 as Ee,h as D,aa as we,ab as _e,ac as Ce,ad as Ie,R as Pe,ae as Se,af as Oe,f as Me,ag as Re,ah as De,ai as qe,aj as ke,ak as Te,al as Fe,V as ze,am as Ne,an as Ae,ao as Le,ap as Be,aq as Ve,ar as Je,as as Ue}from"./index-C6wlVu-O.js";import{D as We,b as He,u as Ge}from"./dvm-name--L8vhJB8.js";var Ke=ne({d:"M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z",displayName:"ChevronLeftIcon"}),G={},S={},l={},f=m&&m.__extends||function(){var r=function(n,s){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,t){a.__proto__=t}||function(a,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(a[i]=t[i])},r(n,s)};return function(n,s){if(typeof s!="function"&&s!==null)throw new TypeError("Class extends value "+String(s)+" is not a constructor or null");r(n,s);function a(){this.constructor=n}n.prototype=s===null?Object.create(s):(a.prototype=s.prototype,new a)}}();Object.defineProperty(l,"__esModule",{value:!0});l.InternalError=l.InvalidDataError=l.RoutingError=l.UnsupportedMethodError=l.ConnectionError=l.RejectionError=l.MissingProviderError=void 0;function v(r,n,s){if(Object.setPrototypeOf(r,s.prototype),n===s)if(r.name=n.name,Error.captureStackTrace)Error.captureStackTrace(r,s);else{var a=new Error(r.message).stack;a&&(r.stack=Qe(a,"new ".concat(n.name)))}}function Qe(r,n){if(!r||!n)return r;var s=new RegExp("\\s+at\\s".concat(n,"\\s")),a=r.split(`
`),t=a.filter(function(i){return!i.match(s)});return t.join(`
`)}var Ye=function(r){f(n,r);function n(s){var a=this.constructor,t=r.call(this,s)||this;return v(t,a,n),t}return n}(Error);l.MissingProviderError=Ye;var $e=function(r){f(n,r);function n(s){var a=this.constructor,t=r.call(this,s)||this;return v(t,a,n),t}return n}(Error);l.RejectionError=$e;var Xe=function(r){f(n,r);function n(s){var a=this.constructor,t=r.call(this,s)||this;return v(t,a,n),t}return n}(Error);l.ConnectionError=Xe;var Ze=function(r){f(n,r);function n(s){var a=this.constructor,t=r.call(this,s)||this;return v(t,a,n),t}return n}(Error);l.UnsupportedMethodError=Ze;var er=function(r){f(n,r);function n(s){var a=this.constructor,t=r.call(this,s)||this;return v(t,a,n),t}return n}(Error);l.RoutingError=er;var rr=function(r){f(n,r);function n(s){var a=this.constructor,t=r.call(this,s)||this;return v(t,a,n),t}return n}(Error);l.InvalidDataError=rr;var nr=function(r){f(n,r);function n(s){var a=this.constructor,t=r.call(this,s)||this;return v(t,a,n),t}return n}(Error);l.InternalError=nr;Object.defineProperty(S,"__esModule",{value:!0});S.requestProvider=void 0;var sr=l;function tr(r){return new Promise(function(n,s){if(typeof window>"u")return s(new Error("Must be called in a browser context"));var a=window.webln;if(!a)return s(new sr.MissingProviderError("Your browser has no WebLN provider"));a.enable().then(function(){return n(a)}).catch(function(t){return s(t)})})}S.requestProvider=tr;var K={};Object.defineProperty(K,"__esModule",{value:!0});(function(r){var n=m&&m.__createBinding||(Object.create?function(a,t,i,o){o===void 0&&(o=i);var c=Object.getOwnPropertyDescriptor(t,i);(!c||("get"in c?!t.__esModule:c.writable||c.configurable))&&(c={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(a,o,c)}:function(a,t,i,o){o===void 0&&(o=i),a[o]=t[i]}),s=m&&m.__exportStar||function(a,t){for(var i in a)i!=="default"&&!Object.prototype.hasOwnProperty.call(t,i)&&n(t,a,i)};Object.defineProperty(r,"__esModule",{value:!0}),s(S,r),s(K,r),s(l,r)})(G);const ar=({paymentRequest:r,...n})=>{const{value:s,error:a}=se(async()=>te(r)),t=_(),[i,o]=w.useState(!1),c=async E=>{if(window.webln){E.preventDefault(),o(!0);try{(await(await G.requestProvider()).sendPayment(r)).preimage&&console.log("Paid")}catch(p){console.log("Failed to pay invoice"),console.log(p)}o(!1)}};if(!s)return e.jsx(e.Fragment,{children:"Loading Invoice..."});const j=h(s.expiry).isBefore(h());return e.jsx(d,{padding:"3",borderColor:"yellow.300",borderWidth:"1px",rounded:"md",direction:"column",position:"relative",...n,children:t.isOpen?e.jsxs(e.Fragment,{children:[e.jsx(y,{maxW:"3in",mx:"auto",w:"full",children:e.jsx(ae,{content:s.paymentRequest})}),e.jsxs(d,{gap:"2",mt:"2",children:[e.jsx(ie,{value:s.paymentRequest,userSelect:"all"}),e.jsx(b,{value:s.paymentRequest,"aria-label":"Copy Invoice"})]}),e.jsx(oe,{onClick:t.onClose,position:"absolute",right:"2",top:"2"})]}):e.jsxs(d,{flexWrap:"wrap",gap:"4",alignItems:"center",children:[e.jsxs(y,{flexGrow:1,children:[e.jsx(u,{fontWeight:"bold",children:"Lightning Invoice"}),e.jsx(u,{children:s.description})]}),e.jsx(y,{children:e.jsxs(u,{color:j?"red.400":void 0,children:[j?"Expired":"Expires",": ",h(s.expiry).fromNow()]})}),e.jsxs(ce,{variant:"outline",children:[e.jsx(b,{value:s.paymentRequest,"aria-label":"Copy Invoice"}),e.jsx(V,{icon:e.jsx(le,{boxSize:6}),onClick:t.onToggle,"aria-label":"Show QrCode"}),e.jsxs(g,{as:"a",onClick:c,isLoading:i,href:`lightning:${r}`,children:["âš¡ Pay ",s.amount?ue(s.amount/1e3)+" sats":""]})]})]})})};function ir({result:r}){return e.jsxs(e.Fragment,{children:[e.jsxs(u,{isTruncated:!0,children:["ID: ",P(r.id)," ",e.jsx(b,{size:"xs","aria-label":"copy id",value:r.id})]}),e.jsxs(d,{gap:"2",alignItems:"center",overflow:"hidden",children:[e.jsxs(u,{isTruncated:!0,children:["Content: ",r.content]})," ",e.jsx(b,{size:"xs","aria-label":"copy content",value:r.content})]})]})}function or({status:r}){var n;return e.jsxs(e.Fragment,{children:[e.jsxs(u,{isTruncated:!0,children:["ID: ",P(r.id)," ",e.jsx(b,{size:"xs","aria-label":"copy id",value:r.id})]}),e.jsxs(u,{isTruncated:!0,children:["Status: ",(n=r.tags.find(s=>s[0]==="status"))==null?void 0:n[1]]}),e.jsxs(u,{isTruncated:!0,children:["Content: ",r.content]})]})}function q({job:r}){const n=ge(r.request),s=_(),a=_();return e.jsxs(M,{p:"2",variant:"outline",children:[e.jsxs(u,{children:["ID: ",r.request.id," ",e.jsx(b,{size:"xs","aria-label":"copy id",value:r.request.id})]}),n&&e.jsxs(u,{children:["Input: ",P(n.value)," (",n.type,")"]}),e.jsx(x,{size:"sm",children:"Relays:"}),e.jsx(u,{children:fe(r.request).join(", ")}),e.jsx(I,{my:"2"}),r.responses.map(t=>e.jsxs(e.Fragment,{children:[e.jsx(x,{children:e.jsx(ve,{pubkey:t.pubkey})}),e.jsx(x,{size:"sm",children:"Status:"}),t.status?e.jsx(or,{status:t.status}):e.jsx(R,{}),e.jsx(I,{my:"2"}),e.jsx(x,{size:"sm",children:"Result:"}),t.result?e.jsx(ir,{result:t.result}):e.jsx(R,{})]})),e.jsx(I,{my:"2"}),r.prev&&e.jsxs(e.Fragment,{children:[e.jsxs(d,{gap:"2",alignItems:"center",children:[e.jsxs(x,{size:"sm",children:["Previous (",P(r.prev.request.id),"):"]}),e.jsx(g,{onClick:a.onToggle,size:"xs",children:a.isOpen?"Hide":"Show"})]}),a.isOpen&&e.jsx(q,{job:r.prev}),e.jsx(I,{my:"2"})]}),r.next.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs(d,{gap:"2",alignItems:"center",children:[e.jsxs(x,{size:"sm",children:["Next (",r.next.length,"):"]}),e.jsx(g,{onClick:s.onToggle,size:"xs",children:s.isOpen?"Hide":"Show"})]}),s.isOpen&&e.jsx(d,{gap:"2",direction:"column",children:r.next.map(t=>e.jsx(q,{job:t},t.request.id))})]})]})}function cr({chain:r}){const n=_();return e.jsxs(e.Fragment,{children:[e.jsxs(u,{children:["Events: ",J(r).length]}),e.jsxs(d,{gap:"2",alignItems:"center",children:[e.jsxs(x,{size:"sm",children:["Pages (",r.length,"):"]}),e.jsx(g,{size:"xs",onClick:n.onToggle,children:n.isOpen?"Hide":"Show"})]}),n.isOpen&&e.jsx(d,{gap:"2",direction:"column",children:r.map(s=>e.jsx(q,{job:s},s.request.id))})]})}function lr({chains:r}){return e.jsx(de,{children:r.map(n=>e.jsxs(xe,{children:[e.jsx("h2",{children:e.jsxs(he,{children:[e.jsx(y,{as:"span",flex:"1",textAlign:"left",children:h.unix(n[0].request.created_at).fromNow()}),e.jsx(je,{})]})}),e.jsx(pe,{pb:4,children:e.jsx(cr,{chain:n})})]},n[0].request.id))})}function ur({chain:r,pointer:n}){const s=U(),a=W(n.pubkey),t=H(),i=r[r.length-1],o=async()=>{const j={kind:D,created_at:h().unix(),content:"",tags:[["i",i.request.id,"event"],["p",n.pubkey],["relays",...t],["expiration",String(h().add(1,"day").unix())]]};await s("Next Page",j,a==null?void 0:a.inboxes)},c=be(i,n.pubkey);return e.jsx(g,{colorScheme:"primary",onClick:o,isLoading:i&&!(c!=null&&c.result)&&!(c!=null&&c.status),mx:"auto",my:"4",px:"20",children:"Next page"})}function dr({chain:r,pointer:n}){const s=r[r.length-1],a=s.responses.find(j=>j.pubkey===n.pubkey);if(a!=null&&a.result)return e.jsx(ur,{pointer:n,chain:r});const t={w:"full",maxW:"2xl",mx:"auto",overflow:"hidden"},i=e.jsxs(Ee,{p:"4",alignItems:"center",display:"flex",gap:"2",children:[e.jsx(We,{pointer:n,w:"12"}),e.jsx(He,{pointer:n,fontWeight:"bold",fontSize:"lg"})]}),o=a==null?void 0:a.status;if(!o)return e.jsxs(M,{...t,children:[i,e.jsxs(z,{px:"4",pb:"4",pt:"0",flexDirection:"row",display:"flex",alignItems:"center",gap:"4",children:[e.jsx(R,{}),e.jsx(x,{size:"sm",children:"Waiting for response..."})]})]});const c=me(s,n.pubkey);switch(c){case"payment-required":const[j,E,p]=o.tags.find(C=>C[0]==="amount")??[];return e.jsxs(M,{...t,children:[i,e.jsxs(z,{px:"4",pb:"4",pt:"0",gap:"2",display:"flex",flexDirection:"column",children:[e.jsx(x,{size:"sm",children:o.content}),p&&e.jsx(ar,{paymentRequest:p})]})]});case"processing":return e.jsxs(N,{status:"info",...t,children:[e.jsx(A,{boxSize:8}),e.jsxs(y,{children:[e.jsx(L,{children:"Processing"}),e.jsx(B,{children:o.content})]})]});case"error":return e.jsxs(N,{status:"error",...t,children:[e.jsx(A,{boxSize:8}),e.jsxs(y,{children:[e.jsx(L,{children:"Error!"}),e.jsx(B,{children:o.content})]})]});default:return e.jsxs(e.Fragment,{children:[e.jsxs(u,{children:["Unknown status ",e.jsx(ye,{children:c})]}),e.jsx(u,{children:o.content})]})}}function xr({chain:r}){const n=J(r),s=we(n);return e.jsx(e.Fragment,{children:s.map(a=>e.jsx(_e,{event:a,visible:!0}))})}function hr({chain:r,pointer:n}){return e.jsxs(e.Fragment,{children:[r.length>0&&e.jsx(xr,{chain:r}),e.jsx(dr,{chain:r,pointer:n})]})}function jr({pointer:r,params:n,onChange:s}){const a=Ge(r),t=Object.entries((a==null?void 0:a.nip90Params)||{}).filter(([i,o])=>o.values&&o.values.length>0);return e.jsx(e.Fragment,{children:t.map(([i,o])=>e.jsx(Ce,{isRequired:!!o.required,w:"10rem",onChange:c=>s({...n,[i]:c.target.value}),children:o.values.map(c=>e.jsx("option",{value:c,children:c},c))},i))})}function pr({pointer:r}){var F;const[n]=w.useState(()=>h().subtract(1,"hour").unix()),s=U(),a=Se(),t=Oe(),i=_(),o=(F=W(r.pubkey))==null?void 0:F.outboxes,c=H(o),{loader:j,timeline:E}=Me(`${qe(r.kind,r.pubkey,r.identifier)}-jobs`,c,[{authors:[t.pubkey,r.pubkey],"#p":[t.pubkey,r.pubkey],kinds:[D,Re,De],since:n}]),p=ke(E),C=Te(Array.from(Object.values(p))),O=Fe(C),[k,Q]=w.useState({}),[Y,T]=w.useState(!1),$=async()=>{T(!0);const X=Object.entries(k).map(([ee,re])=>["param",ee,re]),Z={kind:D,created_at:h().unix(),content:"",tags:[["p",r.pubkey],["relays",...c],["expiration",String(h().add(1,"day").unix())],...X]};await s("Request Feed",Z,o)};return w.useEffect(()=>{T(!1)},[E.length]),e.jsxs(ze,{children:[e.jsxs(d,{gap:"2",children:[e.jsx(g,{leftIcon:e.jsx(Ke,{boxSize:6}),onClick:()=>a(-1),children:"Back"}),e.jsx(jr,{pointer:r,params:k,onChange:Q}),e.jsx(g,{onClick:$,isLoading:Y,colorScheme:"primary",children:"New Feed"}),e.jsx(V,{icon:e.jsx(Ne,{}),ml:"auto","aria-label":"View Raw",title:"View Raw",onClick:i.onOpen})]}),O[0]&&e.jsx(hr,{chain:O[0],pointer:r}),i.isOpen&&e.jsxs(Ae,{isOpen:!0,onClose:i.onClose,size:"4xl",children:[e.jsx(Le,{}),e.jsxs(Be,{children:[e.jsx(Ve,{p:"4",children:"Jobs"}),e.jsx(Je,{}),e.jsx(Ue,{p:"0",children:e.jsx(lr,{chains:O})})]})]})]})}function vr(){const r=Ie("addr");return e.jsx(Pe,{children:e.jsx(pr,{pointer:r})})}export{vr as default};
//# sourceMappingURL=feed-CD4XFirR.js.map
