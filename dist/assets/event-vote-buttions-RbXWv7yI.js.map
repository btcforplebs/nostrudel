{"version":3,"file":"event-vote-buttions-RbXWv7yI.js","sources":["../../src/components/reactions/event-vote-buttions.tsx"],"sourcesContent":["import { useCallback, useMemo, useState } from \"react\";\nimport { Flex, FlexProps, IconButton, IconButtonProps, Text } from \"@chakra-ui/react\";\n\nimport { ChevronDownIcon, ChevronUpIcon, DislikeIcon, LikeIcon } from \"../icons\";\nimport useCurrentAccount from \"../../hooks/use-current-account\";\nimport useEventReactions from \"../../hooks/use-event-reactions\";\nimport { draftEventReaction, getEventReactionScore, groupReactions } from \"../../helpers/nostr/reactions\";\nimport { NostrEvent } from \"../../types/nostr-event\";\nimport { useAdditionalRelayContext } from \"../../providers/local/additional-relay-context\";\nimport { usePublishEvent } from \"../../providers/global/publish-provider\";\n\nexport default function EventVoteButtons({\n  event,\n  chevrons = true,\n  inline = false,\n  variant = \"ghost\",\n  ...props\n}: Omit<FlexProps, \"children\"> & {\n  event: NostrEvent;\n  chevrons?: boolean;\n  inline?: boolean;\n  variant?: IconButtonProps[\"variant\"];\n}) {\n  const account = useCurrentAccount();\n  const publish = usePublishEvent();\n  const reactions = useEventReactions(event);\n  const additionalRelays = useAdditionalRelayContext();\n\n  const grouped = useMemo(() => groupReactions(reactions ?? []), [reactions]);\n  const { vote, up, down } = getEventReactionScore(grouped);\n\n  const hasUpVote = !!account && !!up?.pubkeys.includes(account.pubkey);\n  const hasDownVote = !!account && !!down?.pubkeys.includes(account.pubkey);\n\n  const [loading, setLoading] = useState(false);\n  const addVote = useCallback(\n    async (vote: string) => {\n      setLoading(true);\n      const draft = draftEventReaction(event, vote);\n      await publish(\"Reaction\", draft, additionalRelays);\n      setLoading(false);\n    },\n    [event, publish, additionalRelays],\n  );\n\n  const upIcon = chevrons ? <ChevronUpIcon boxSize={6} /> : <LikeIcon />;\n  const downIcon = chevrons ? <ChevronDownIcon boxSize={6} /> : <DislikeIcon />;\n\n  return (\n    <Flex flexDirection={inline ? \"row\" : \"column\"} alignItems=\"center\" {...props}>\n      <IconButton\n        aria-label=\"up vote\"\n        title=\"up vote\"\n        icon={upIcon}\n        size=\"sm\"\n        variant={hasUpVote ? \"solid\" : variant}\n        isLoading={loading}\n        onClick={() => addVote(\"+\")}\n        isDisabled={!account || !!hasUpVote || !!hasDownVote}\n        colorScheme={hasUpVote ? \"primary\" : \"gray\"}\n      />\n      {(up || down) && vote > 0 && (\n        <Text p=\"2\" lineHeight=\"1em\">\n          {vote}\n        </Text>\n      )}\n      <IconButton\n        aria-label=\"down vote\"\n        title=\"down vote\"\n        icon={downIcon}\n        size=\"sm\"\n        variant={hasDownVote ? \"solid\" : variant}\n        isLoading={loading}\n        onClick={() => addVote(\"-\")}\n        isDisabled={!account || !!hasUpVote || !!hasDownVote}\n        colorScheme={hasDownVote ? \"primary\" : \"gray\"}\n      />\n    </Flex>\n  );\n}\n"],"names":["EventVoteButtons","event","chevrons","inline","variant","props","account","useCurrentAccount","publish","usePublishEvent","reactions","useEventReactions","additionalRelays","useAdditionalRelayContext","grouped","useMemo","groupReactions","vote","up","down","getEventReactionScore","hasUpVote","hasDownVote","loading","setLoading","useState","addVote","useCallback","draft","draftEventReaction","upIcon","jsx","ChevronUpIcon","LikeIcon","downIcon","ChevronDownIcon","DislikeIcon","jsxs","Flex","IconButton","Text"],"mappings":"4JAWA,SAAwBA,EAAiB,CACvC,MAAAC,EACA,SAAAC,EAAW,GACX,OAAAC,EAAS,GACT,QAAAC,EAAU,QACV,GAAGC,CACL,EAKG,CACD,MAAMC,EAAUC,IACVC,EAAUC,IACVC,EAAYC,EAAkBV,CAAK,EACnCW,EAAmBC,IAEnBC,EAAUC,EAAQ,QAAA,IAAMC,EAAeN,GAAa,EAAE,EAAG,CAACA,CAAS,CAAC,EACpE,CAAE,KAAAO,EAAM,GAAAC,EAAI,KAAAC,CAAK,EAAIC,EAAsBN,CAAO,EAElDO,EAAY,CAAC,CAACf,GAAW,CAAC,EAACY,GAAA,MAAAA,EAAI,QAAQ,SAASZ,EAAQ,SACxDgB,EAAc,CAAC,CAAChB,GAAW,CAAC,EAACa,GAAA,MAAAA,EAAM,QAAQ,SAASb,EAAQ,SAE5D,CAACiB,EAASC,CAAU,EAAIC,WAAS,EAAK,EACtCC,EAAUC,EAAA,YACd,MAAOV,GAAiB,CACtBO,EAAW,EAAI,EACT,MAAAI,EAAQC,EAAmB5B,EAAOgB,CAAI,EACtC,MAAAT,EAAQ,WAAYoB,EAAOhB,CAAgB,EACjDY,EAAW,EAAK,CAClB,EACA,CAACvB,EAAOO,EAASI,CAAgB,CAAA,EAG7BkB,EAAS5B,EAAY6B,EAAA,IAAAC,EAAA,CAAc,QAAS,CAAG,CAAA,QAAMC,EAAS,CAAA,CAAA,EAC9DC,EAAWhC,EAAY6B,EAAA,IAAAI,EAAA,CAAgB,QAAS,CAAG,CAAA,QAAMC,EAAY,CAAA,CAAA,EAGzE,OAAAC,OAACC,GAAK,cAAenC,EAAS,MAAQ,SAAU,WAAW,SAAU,GAAGE,EACtE,SAAA,CAAA0B,EAAA,IAACQ,EAAA,CACC,aAAW,UACX,MAAM,UACN,KAAMT,EACN,KAAK,KACL,QAAST,EAAY,QAAUjB,EAC/B,UAAWmB,EACX,QAAS,IAAMG,EAAQ,GAAG,EAC1B,WAAY,CAACpB,GAAW,CAAC,CAACe,GAAa,CAAC,CAACC,EACzC,YAAaD,EAAY,UAAY,MAAA,CACvC,GACEH,GAAMC,IAASF,EAAO,GACtBc,EAAA,IAACS,GAAK,EAAE,IAAI,WAAW,MACpB,SACHvB,CAAA,CAAA,EAEFc,EAAA,IAACQ,EAAA,CACC,aAAW,YACX,MAAM,YACN,KAAML,EACN,KAAK,KACL,QAASZ,EAAc,QAAUlB,EACjC,UAAWmB,EACX,QAAS,IAAMG,EAAQ,GAAG,EAC1B,WAAY,CAACpB,GAAW,CAAC,CAACe,GAAa,CAAC,CAACC,EACzC,YAAaA,EAAc,UAAY,MAAA,CACzC,CACF,CAAA,CAAA,CAEJ"}