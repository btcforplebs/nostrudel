import{hX as h,r as n,dX as S,dU as o,j as e,T as j,y as D,E as W,cn as I,co as R,fX as N,dW as i,fY as P,fZ as B,f_ as L,f$ as T,F as X,C as y,H as z}from"./index-C6wlVu-O.js";import{E as K,a as q}from"./event-kinds-table-ZNhBMzdA.js";import{I as A,E as H}from"./export-events-button-LHehTa1G.js";function O(){const c=o;if(!(c instanceof h))return null;const s=c.worker;if(!s)return null;const[r,u]=n.useState(),b=S(i.wasmPersistForDays),v=r?Object.values(r).reduce((a,t)=>a+t,0):void 0,l=n.useCallback(async()=>{await s.summary().then(a=>u(a))},[u,s]),w=n.useCallback(async a=>{const d=Array.from(a),C=()=>{const x=[];for(let p=0;p<100;p++){const f=d.pop();if(!f)break;x.push(s.event(f))}return Promise.all(x)};for(;d.length>0;)await C(),await l()},[s]),E=n.useCallback(async()=>s.query(["REQ","export",{}]),[s]),g=n.useCallback(async a=>{const t=parseInt(a);confirm(`Are you sure you want to delete all kind ${t} events?`)&&(await s.delete(["REQ","delete-"+t,{kinds:[t]}]),l())},[s,l]),[k,m]=n.useState(!1),F=n.useCallback(async()=>{try{m(!0),o instanceof h&&(await o.wipe(),location.reload())}catch{}m(!1)},[]);return n.useEffect(()=>{l()},[]),e.jsxs(e.Fragment,{children:[e.jsx(j,{children:"Wasm Relay Database"}),e.jsxs(j,{children:["Total events: ",v??"Loading..."]}),e.jsxs(D,{flexWrap:"wrap",children:[e.jsx(A,{onLoad:w}),e.jsx(H,{getEvents:E}),e.jsx(W,{colorScheme:"red",onClick:F,isLoading:k,children:"Delete database"})]}),e.jsxs(I,{children:[e.jsx(R,{children:"Remove events older than X days"}),e.jsxs(N,{maxW:"xs",value:b??void 0,onChange:(a,t)=>{Number.isFinite(t)?i.wasmPersistForDays.next(t):i.wasmPersistForDays.clear()},step:1e3,children:[e.jsx(P,{}),e.jsxs(B,{children:[e.jsx(L,{}),e.jsx(T,{})]})]})]}),e.jsx(X,{gap:"2",wrap:"wrap",alignItems:"flex-start",w:"full",children:r&&e.jsxs(e.Fragment,{children:[e.jsxs(y,{p:"2",minW:"sm",maxW:"lg",flex:1,children:[e.jsx(z,{size:"sm",children:"Events by kind"}),e.jsx(K,{kinds:r})]}),e.jsx(y,{p:"2",minW:"sm",maxW:"md",flex:1,children:e.jsx(q,{kinds:r,deleteKind:g})})]})})]})}export{O as default};
//# sourceMappingURL=wasm-BnE4OHes.js.map
