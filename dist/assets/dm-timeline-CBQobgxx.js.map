{"version":3,"file":"dm-timeline-CBQobgxx.js","sources":["../../src/views/tools/dm-timeline.tsx"],"sourcesContent":["import { Button, Flex } from \"@chakra-ui/react\";\nimport { memo, useCallback } from \"react\";\nimport { kinds } from \"nostr-tools\";\nimport { useNavigate } from \"react-router-dom\";\n\nimport VerticalPageLayout from \"../../components/vertical-page-layout\";\nimport PeopleListProvider, { usePeopleListContext } from \"../../providers/local/people-list-provider\";\nimport PeopleListSelection from \"../../components/people-list-selection/people-list-selection\";\nimport useTimelineLoader from \"../../hooks/use-timeline-loader\";\nimport { useReadRelays } from \"../../hooks/use-client-relays\";\nimport { useTimelineCurserIntersectionCallback } from \"../../hooks/use-timeline-cursor-intersection-callback\";\nimport IntersectionObserverProvider from \"../../providers/local/intersection-observer\";\nimport EmbeddedDM from \"../../components/embed-event/event-types/embedded-dm\";\nimport { NostrEvent } from \"../../types/nostr-event\";\nimport { ChevronLeftIcon } from \"../../components/icons\";\nimport useClientSideMuteFilter from \"../../hooks/use-client-side-mute-filter\";\nimport { ErrorBoundary } from \"../../components/error-boundary\";\nimport useEventIntersectionRef from \"../../hooks/use-event-intersection-ref\";\n\nconst DirectMessage = memo(({ dm }: { dm: NostrEvent }) => {\n  const ref = useEventIntersectionRef(dm);\n\n  return (\n    <div ref={ref}>\n      <EmbeddedDM dm={dm} />\n    </div>\n  );\n});\n\nexport function DMTimelinePage() {\n  const navigate = useNavigate();\n  const { listId, filter } = usePeopleListContext();\n\n  const clientMuteFilter = useClientSideMuteFilter();\n  const eventFilter = useCallback(\n    (e: NostrEvent) => {\n      if (clientMuteFilter(e)) return false;\n      return true;\n    },\n    [clientMuteFilter],\n  );\n  const readRelays = useReadRelays();\n  const { loader, timeline: dms } = useTimelineLoader(\n    `${listId ?? \"global\"}-dm-feed`,\n    readRelays,\n    filter\n      ? [\n          {\n            ...filter,\n            kinds: [kinds.EncryptedDirectMessage],\n          },\n          { \"#p\": filter.authors, kinds: [kinds.EncryptedDirectMessage] },\n        ]\n      : { kinds: [kinds.EncryptedDirectMessage] },\n    { eventFilter },\n  );\n  const callback = useTimelineCurserIntersectionCallback(loader);\n\n  return (\n    <VerticalPageLayout>\n      <Flex gap=\"2\">\n        <Button leftIcon={<ChevronLeftIcon />} onClick={() => navigate(-1)}>\n          Back\n        </Button>\n        <PeopleListSelection />\n      </Flex>\n      <IntersectionObserverProvider callback={callback}>\n        {dms?.map((dm) => (\n          <ErrorBoundary key={dm.id} event={dm}>\n            <DirectMessage dm={dm} />\n          </ErrorBoundary>\n        ))}\n      </IntersectionObserverProvider>\n    </VerticalPageLayout>\n  );\n}\n\nexport default function DMTimelineView() {\n  return (\n    <PeopleListProvider>\n      <DMTimelinePage />\n    </PeopleListProvider>\n  );\n}\n"],"names":["DirectMessage","memo","dm","ref","useEventIntersectionRef","jsx","EmbeddedDM","DMTimelinePage","navigate","useNavigate","listId","filter","usePeopleListContext","clientMuteFilter","useClientSideMuteFilter","eventFilter","useCallback","e","readRelays","useReadRelays","loader","dms","useTimelineLoader","kinds","callback","useTimelineCurserIntersectionCallback","VerticalPageLayout","jsxs","Flex","Button","ChevronLeftIcon","PeopleListSelection","IntersectionObserverProvider","ErrorBoundary","DMTimelineView","PeopleListProvider"],"mappings":"8KAmBA,MAAMA,EAAgBC,EAAA,KAAK,CAAC,CAAE,GAAAC,KAA6B,CACnD,MAAAC,EAAMC,EAAwBF,CAAE,EAEtC,aACG,MAAI,CAAA,IAAAC,EACH,SAACE,MAAAC,EAAA,CAAW,GAAAJ,EAAQ,CACtB,CAAA,CAEJ,CAAC,EAEM,SAASK,GAAiB,CAC/B,MAAMC,EAAWC,IACX,CAAE,OAAAC,EAAQ,OAAAC,CAAO,EAAIC,EAAqB,EAE1CC,EAAmBC,IACnBC,EAAcC,EAAA,YACjBC,GACK,CAAAJ,EAAiBI,CAAC,EAGxB,CAACJ,CAAgB,CAAA,EAEbK,EAAaC,IACb,CAAE,OAAAC,EAAQ,SAAUC,CAAQ,EAAAC,EAChC,GAAGZ,GAAU,QAAQ,WACrBQ,EACAP,EACI,CACE,CACE,GAAGA,EACH,MAAO,CAACY,EAAM,sBAAsB,CACtC,EACA,CAAE,KAAMZ,EAAO,QAAS,MAAO,CAACY,EAAM,sBAAsB,CAAE,GAEhE,CAAE,MAAO,CAACA,EAAM,sBAAsB,CAAE,EAC5C,CAAE,YAAAR,CAAY,CAAA,EAEVS,EAAWC,EAAsCL,CAAM,EAE7D,cACGM,EACC,CAAA,SAAA,CAACC,EAAAA,KAAAC,EAAA,CAAK,IAAI,IACR,SAAA,CAACvB,EAAAA,IAAAwB,EAAA,CAAO,SAAUxB,EAAA,IAACyB,EAAgB,CAAA,CAAA,EAAI,QAAS,IAAMtB,EAAS,EAAE,EAAG,SAEpE,MAAA,CAAA,QACCuB,EAAoB,EAAA,CAAA,EACvB,QACCC,EAA6B,CAAA,SAAAR,EAC3B,0BAAK,IAAKtB,GACRG,EAAA,IAAA4B,EAAA,CAA0B,MAAO/B,EAChC,eAACF,EAAc,CAAA,GAAAE,EAAQ,GADLA,EAAG,EAEvB,GAEJ,CACF,CAAA,CAAA,CAEJ,CAEA,SAAwBgC,GAAiB,CACvC,OACG7B,EAAA,IAAA8B,EAAA,CACC,SAAC9B,EAAA,IAAAE,EAAA,CAAA,CAAe,CAClB,CAAA,CAEJ"}