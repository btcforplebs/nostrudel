import{n as ee,j as e,r as a,bP as se,ao as N,bQ as te,ar as A,aq as q,as as W,v as ne,F as c,E,w as S,cp as re,s as y,T as d,aC as ie,f7 as ae,f8 as F,c8 as J,a1 as h,aX as oe,B as M,an as le,ap as ce,H as R,k as de,f9 as pe,fa as ue,fb as he,fc as xe,fd as me,fe as je,dU as B,ff as fe,b6 as U,fg as ge,V as ye,aM as be,dE as Ce,y as we,z as k,fh as ke,fi as Se,a2 as Re,a3 as ve,a4 as Oe,a5 as ze,x as Ie,eP as Ee}from"./index-C6wlVu-O.js";import{P as Fe}from"./play-BortdZAr.js";import{k as Me,j as Le,a as De,c as Pe,R as He,g as Te,b as Be,u as Ue,p as Ne}from"./user-autocomplete-BPrFEqa4.js";import"./index-0cR9FdqN.js";const V=ee({displayName:"ClockRewind",viewBox:"0 0 24 24",path:[e.jsx("path",{d:"M22.7 13.5L20.7005 11.5L18.7 13.5M21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3C15.3019 3 18.1885 4.77814 19.7545 7.42909M12 7V12L15 14",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",fill:"none"})],defaultProps:{boxSize:4}});function Ae({onClose:s,isOpen:i,history:t,onClear:n,onSelect:m}){const p=a.useRef(null),[l,j]=a.useState(""),v=l.length>1?t.filter(o=>o.includes(l)):t;return e.jsxs(se,{isOpen:i,placement:"right",onClose:s,initialFocusRef:p,size:"md",children:[e.jsx(N,{}),e.jsxs(te,{children:[e.jsx(A,{}),e.jsxs(q,{px:"2",pt:"2",pb:"0",children:[e.jsx(V,{boxSize:"6"})," History"]}),e.jsxs(W,{p:"2",overflowX:"hidden",overflowY:"auto",children:[e.jsx(ne,{placeholder:"Search",type:"search",ref:p,value:l,onChange:o=>j(o.target.value)}),e.jsx(c,{direction:"column",gap:"2",mt:"2",children:v.map(o=>e.jsxs(c,{gap:"2",alignItems:"center",children:[e.jsx(E,{variant:"ghost",fontFamily:"monospace",fontWeight:"normal",fontSize:"xs",size:"sm",w:"full",justifyContent:"flex-start",onClick:()=>m(o),children:o}),e.jsx(S,{value:o,"aria-label":"Copy Filter",title:"Copy Filter",size:"xs",ml:"auto",tabIndex:-1})]},o))})]}),e.jsx(re,{p:"2",children:e.jsx(E,{variant:"outline",onClick:n,children:"Clear"})})]})]})}function qe({event:s}){const i=y(),t=y();return e.jsxs(e.Fragment,{children:[e.jsxs(c,{gap:"2",alignItems:"center",borderTopWidth:1,p:"2",onClick:i.onToggle,overflow:"hidden",cursor:"pointer",children:[e.jsxs(d,{fontFamily:"monospace",whiteSpace:"pre",children:[s.id.slice(0,8)," (",s.kind,") [",s.tags.length,"]"]}),e.jsx(ie,{pubkey:s.pubkey,fontSize:"sm"}),!i.isOpen&&e.jsx(d,{isTruncated:!0,fontSize:"sm",children:s.content}),e.jsx(ae,{isOpen:i.isOpen,onToggle:i.onToggle,size:"xs",variant:"ghost",ml:"auto"})]}),i.isOpen&&e.jsxs(c,{gap:"2",direction:"column",px:"2",pb:"2",alignItems:"flex-start",position:"relative",children:[e.jsxs(c,{top:"2",right:"4",position:"absolute",gap:"2",alignItems:"center",p:"2",bg:"var(--chakra-colors-chakra-body-bg)",borderRadius:"md",children:[t.isOpen&&e.jsx(S,{value:F(s,{space:"  "}),"aria-label":"Copy json",size:"sm"}),e.jsx(J,{size:"sm",isChecked:!t.isOpen,onChange:t.onToggle,children:"Raw"})]}),t.isOpen?e.jsx(h,{whiteSpace:"pre",w:"full",overflow:"auto",children:F(s,{space:"  "})}):e.jsxs(e.Fragment,{children:[e.jsxs(c,{gap:"2",children:[e.jsx(d,{children:"ID: "}),e.jsx(h,{children:s.id}),e.jsx(S,{value:s.id,"aria-label":"Copy ID",title:"Copy ID",size:"xs"})]}),e.jsxs(c,{gap:"2",children:[e.jsx(d,{children:"Pubkey: "}),e.jsx(h,{children:s.pubkey}),e.jsx(S,{value:s.pubkey,"aria-label":"Copy Pubkey",title:"Copy Pubkey",size:"xs"})]}),e.jsxs(c,{gap:"2",children:[e.jsx(d,{children:"Created: "}),e.jsx(h,{children:s.created_at}),e.jsx(oe,{timestamp:s.created_at})]}),e.jsx(h,{whiteSpace:"pre-wrap",w:"full",children:s.content}),e.jsxs(M,{children:[e.jsx(d,{children:"Tags:"}),e.jsx(c,{gap:"2",direction:"column",children:s.tags.map((n,m)=>e.jsx(c,{gap:"1",wrap:"wrap",children:n.map((p,l)=>e.jsx(h,{minW:"1rem",fontFamily:"monospace",fontWeight:l===0?"bold":"normal",children:p},p))},n.join(",")+m))})]})]})]})]})}function We({isOpen:s,onClose:i,...t}){return e.jsxs(le,{isOpen:s,onClose:i,size:"lg",...t,children:[e.jsx(N,{}),e.jsxs(ce,{children:[e.jsx(q,{p:"4",children:"Help"}),e.jsx(A,{}),e.jsxs(W,{px:"4",pt:"0",pb:"4",children:[e.jsx(R,{size:"sm",children:"Keyboard shortcuts"}),e.jsxs(d,{children:[e.jsx(h,{children:"Ctrl+Shift+Enter"}),": Run Filter"]}),e.jsx(R,{size:"sm",mt:"4",children:"Pubkeys"}),e.jsxs(d,{children:["Typing ",e.jsx(h,{children:"@"})," inside any string will autocomplete with a list of users the app has seen"]}),e.jsx(R,{size:"sm",mt:"4",children:"Dates"}),e.jsxs(d,{children:[e.jsx(h,{children:"since"})," and ",e.jsx(h,{children:"until"})," fields can both take relative times in the form of strings"]}),e.jsx(d,{children:"Examples:"}),e.jsx(c,{gap:"1",children:["now","n-3h","n-5","n+4m","n-7d","n-30s","n-4w"].map(n=>e.jsx(h,{children:n},n))})]})]})]})}const Je=Object.values(de).filter(s=>typeof s=="number"),Ve="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ".split(""),_={type:"object",properties:{ids:{type:"array",minItems:1,uniqueItems:!0,items:{type:"string"}},kinds:{type:"array",description:"Filter by event kind",minItems:1,uniqueItems:!0,items:{type:"integer",minimum:0,examples:Je}},authors:{type:"array",description:"Filter by pubkey",minItems:1,uniqueItems:!0,items:{type:"string"}},limit:{type:"integer",description:"max number of events to return",default:20,minimum:0},until:{description:"Return events before or on this date",oneOf:[{type:"integer",minimum:0},{type:"string"}]},since:{description:"Return events after or on this date",oneOf:[{type:"integer",minimum:0},{type:"string"}]}}};for(const s of Ve)_.properties["#"+s]={type:"array",description:`Filter on ${s} tag`,items:{type:"string"}};const _e=a.memo(({value:s,onChange:i,onRun:t})=>{const n=pe(),{colorMode:m}=ue();he(()=>{Ue(n())},1e3);const p=a.useMemo(()=>[Me.of([{win:"Ctrl-Enter",linux:"Ctrl-Enter",mac:"Cmd-Enter",preventDefault:!0,run:()=>(t(),!0),shift:()=>(t(),!0)}]),Le(_),De.data.of({autocomplete:Pe})],[t]);return e.jsx(He,{value:s,onChange:i,height:"200px",lang:"json",extensions:p,theme:m==="light"?Te:Be})}),Qe=a.memo(({events:s})=>e.jsx(e.Fragment,{children:s.map(i=>e.jsx(qe,{event:i},i.id))}));function Ze(){const[s,i]=xe(),t=y(),[n,m]=me("console-history",[]),p=y(),l=y({defaultIsOpen:s.has("relay")}),[j,v]=a.useState(s.get("relay")||""),[o,L]=a.useState(null),[b,Q]=a.useState(null),[f,D]=a.useState(()=>{if(s.has("filter")){const r=s.get("filter");if(r){const x=je(r,null);if(x)return JSON.stringify(x,null,2)}}return n!=null&&n[0]?n==null?void 0:n[0]:JSON.stringify({kinds:[1],limit:20},null,2)}),[P,C]=a.useState(""),[X,H]=a.useState(!1),[w,O]=a.useState([]),z=a.useCallback(async()=>{try{if(l.isOpen&&!j)throw new Error("Must set relay");const r=await Ne(JSON.parse(f));if(H(!0),m(u=>u?u.includes(f)?u:[f,...u]:[f]),O([]),b&&b.close(),!B)throw new Error("Local relay disabled");let x=B;if(l.isOpen){const u=fe(j);!o||o.url!==u.toString()?(x=await U.requestRelay(u),await U.requestConnect(x),L(x)):x=o}else o&&L(null);await new Promise(u=>{let g=[];const Z=ge(()=>O([...g]),100,{trailing:!0});C("");const $=x.subscribe([r],{onevent:I=>{g.push(I),Z()},oneose:()=>{O([...g]),u()},onclose:I=>{g.length||C(I)}});Q($)})}catch(r){r instanceof Error&&C(r.message)}H(!1)},[l.isOpen,f,j,o,b]),T=a.useRef(z);T.current=z;const G=a.useCallback(()=>T.current(),[]),K=()=>{const r=w.map(g=>F(g)).join(`
`),x=new File([r],"events.json",{type:"application/jsonl"}),u=URL.createObjectURL(x);window.open(u,"_blank")},Y=()=>{const r=new URLSearchParams(s);r.set("filter",f),r.set("relay",j),i(r,{replace:!0})};return e.jsxs(ye,{children:[e.jsxs(c,{gap:"2",alignItems:"center",wrap:"wrap",children:[e.jsx(be,{size:"sm"}),e.jsx(R,{size:"md",children:"Event Console"}),e.jsx(J,{size:"sm",isChecked:l.isOpen,onChange:l.onToggle,children:"Query Relay"}),l.isOpen&&e.jsx(Ce,{size:"sm",borderRadius:"md",w:"xs",value:j,onChange:r=>v(r.target.value)}),e.jsxs(we,{ml:"auto",children:[e.jsx(k,{icon:e.jsx(ke,{}),"aria-label":"Help",title:"Help",size:"sm",onClick:p.onOpen}),l.isOpen&&e.jsx(k,{icon:e.jsx(Se,{}),"aria-label":"Share",size:"sm",onClick:Y}),e.jsx(k,{icon:e.jsx(V,{}),"aria-label":"History",title:"History",size:"sm",onClick:t.onOpen}),e.jsx(E,{colorScheme:"primary",onClick:z,isLoading:X,leftIcon:e.jsx(Fe,{}),size:"sm",children:"Run"})]})]}),e.jsx(_e,{value:f,onChange:D,onRun:G}),P&&e.jsxs(Re,{status:"error",children:[e.jsx(ve,{}),e.jsxs(M,{children:[e.jsx(Oe,{children:"Error"}),e.jsx(ze,{whiteSpace:"pre",children:P})]}),e.jsx(Ie,{alignSelf:"flex-start",position:"relative",right:-1,top:-1,onClick:()=>C(""),ml:"auto"})]}),e.jsxs(c,{gap:"2",children:[e.jsxs(d,{children:[w.length," events"]}),b&&e.jsx(d,{color:"green.500",ml:"auto",children:"Subscribed"}),w.length>0&&e.jsx(k,{"aria-label":"Download Events",title:"Download Events",icon:e.jsx(Ee,{}),onClick:K,size:"xs"})]}),e.jsx(M,{children:e.jsx(Qe,{events:w})}),e.jsx(Ae,{isOpen:t.isOpen,onClose:t.onClose,history:n||[],onClear:()=>m([]),onSelect:r=>{D(r),t.onClose()}}),e.jsx(We,{isOpen:p.isOpen,onClose:p.onClose})]})}export{Ze as default};
//# sourceMappingURL=index-CqTu3-q9.js.map
