{"version":3,"file":"feed-B1DPVD9x.js","sources":["../../src/views/discovery/blindspot/feed.tsx"],"sourcesContent":["import { useCallback, useMemo } from \"react\";\nimport { Flex, Heading, Spacer, Spinner, useDisclosure } from \"@chakra-ui/react\";\nimport { Navigate } from \"react-router-dom\";\nimport { kinds, NostrEvent } from \"nostr-tools\";\n\nimport VerticalPageLayout from \"../../../components/vertical-page-layout\";\nimport useParamsProfilePointer from \"../../../hooks/use-params-pubkey-pointer\";\nimport useTimelineLoader from \"../../../hooks/use-timeline-loader\";\nimport useCurrentAccount from \"../../../hooks/use-current-account\";\nimport useUserContactList from \"../../../hooks/use-user-contact-list\";\nimport { getPubkeysFromList } from \"../../../helpers/nostr/lists\";\nimport { useReadRelays } from \"../../../hooks/use-client-relays\";\nimport TimelinePage, { useTimelinePageEventFilter } from \"../../../components/timeline-page\";\nimport KindSelectionProvider, { useKindSelectionContext } from \"../../../providers/local/kind-selection-provider\";\nimport NoteFilterTypeButtons from \"../../../components/note-filter-type-buttons\";\nimport TimelineViewTypeButtons from \"../../../components/timeline-page/timeline-view-type\";\nimport Telescope from \"../../../components/icons/telescope\";\nimport UserAvatarLink from \"../../../components/user/user-avatar-link\";\nimport BackButton from \"../../../components/router/back-button\";\nimport UserLink from \"../../../components/user/user-link\";\nimport useClientSideMuteFilter from \"../../../hooks/use-client-side-mute-filter\";\nimport { isReply, isRepost } from \"../../../helpers/nostr/event\";\n\nfunction BlindspotFeedPage({ pubkey }: { pubkey: string }) {\n  const account = useCurrentAccount()!;\n  const contacts = useUserContactList(account.pubkey);\n  const otherContacts = useUserContactList(pubkey);\n  const readRelays = useReadRelays();\n\n  const blindspot = useMemo(() => {\n    if (!contacts || !otherContacts) return [];\n\n    const mine = new Set(getPubkeysFromList(contacts).map((p) => p.pubkey));\n    const other = new Set(getPubkeysFromList(otherContacts).map((p) => p.pubkey));\n\n    return Array.from(other).filter((p) => !mine.has(p) && p !== account.pubkey);\n  }, [contacts, otherContacts, account.pubkey]);\n\n  const showReplies = useDisclosure({ defaultIsOpen: localStorage.getItem(\"show-replies\") === \"true\" });\n  const showReposts = useDisclosure({ defaultIsOpen: localStorage.getItem(\"show-reposts\") !== \"false\" });\n\n  const timelinePageEventFilter = useTimelinePageEventFilter();\n  const muteFilter = useClientSideMuteFilter();\n  const eventFilter = useCallback(\n    (event: NostrEvent) => {\n      if (muteFilter(event)) return false;\n      if (!showReplies.isOpen && isReply(event)) return false;\n      if (!showReposts.isOpen && isRepost(event)) return false;\n      return timelinePageEventFilter(event);\n    },\n    [timelinePageEventFilter, showReplies.isOpen, showReposts.isOpen, muteFilter],\n  );\n\n  const { kinds } = useKindSelectionContext();\n  const { loader, timeline } = useTimelineLoader(\n    `blnidspot-${account.pubkey}-${pubkey}-${kinds.join(\",\")}`,\n    readRelays,\n    blindspot.length > 0 ? [{ authors: blindspot, kinds }] : undefined,\n    { eventFilter },\n  );\n\n  if (!contacts)\n    return (\n      <Flex gap=\"4\" alignItems=\"center\" justifyContent=\"center\" flex={1}>\n        <Spinner />\n        <Heading size=\"lg\">Loading your contacts...</Heading>\n      </Flex>\n    );\n  if (!otherContacts)\n    return (\n      <Flex gap=\"4\" alignItems=\"center\" justifyContent=\"center\" flex={1}>\n        <Spinner />\n        <Heading size=\"lg\">Loading other users contacts...</Heading>\n      </Flex>\n    );\n\n  return (\n    <VerticalPageLayout>\n      <Flex gap=\"2\" alignItems=\"center\">\n        <BackButton />\n        <Telescope boxSize={6} />\n        <UserAvatarLink size=\"sm\" pubkey={pubkey} />\n        <UserLink pubkey={pubkey} isTruncated fontWeight=\"bold\" />\n        <NoteFilterTypeButtons showReplies={showReplies} showReposts={showReposts} />\n        <Spacer />\n        <TimelineViewTypeButtons />\n      </Flex>\n\n      <TimelinePage loader={loader} timeline={timeline} />\n    </VerticalPageLayout>\n  );\n}\n\nconst defaultKinds = [kinds.ShortTextNote, kinds.Repost, kinds.GenericRepost];\n\nexport default function BlindspotFeedView() {\n  const pointer = useParamsProfilePointer(\"pubkey\");\n\n  if (!pointer) return <Navigate to=\"/discovery/blindspot\" />;\n\n  return (\n    <KindSelectionProvider initKinds={defaultKinds}>\n      <BlindspotFeedPage pubkey={pointer.pubkey} />\n    </KindSelectionProvider>\n  );\n}\n"],"names":["BlindspotFeedPage","pubkey","account","useCurrentAccount","contacts","useUserContactList","otherContacts","readRelays","useReadRelays","blindspot","useMemo","mine","getPubkeysFromList","p","other","showReplies","useDisclosure","showReposts","timelinePageEventFilter","useTimelinePageEventFilter","muteFilter","useClientSideMuteFilter","eventFilter","useCallback","event","isReply","isRepost","kinds","useKindSelectionContext","loader","timeline","useTimelineLoader","VerticalPageLayout","jsxs","Flex","jsx","BackButton","Telescope","UserAvatarLink","UserLink","NoteFilterTypeButtons","Spacer","TimelineViewTypeButtons","TimelinePage","Spinner","Heading","defaultKinds","BlindspotFeedView","pointer","useParamsProfilePointer","KindSelectionProvider","Navigate"],"mappings":"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"}