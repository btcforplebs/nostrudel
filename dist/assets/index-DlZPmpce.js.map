{"version":3,"file":"index-DlZPmpce.js","sources":["../../src/views/wiki/index.tsx"],"sourcesContent":["import {\n  AvatarGroup,\n  Link,\n  Button,\n  Flex,\n  Heading,\n  LinkBox,\n  SimpleGrid,\n  useForceUpdate,\n  useInterval,\n} from \"@chakra-ui/react\";\nimport { Link as RouterLink } from \"react-router-dom\";\nimport { NostrEvent } from \"nostr-tools\";\n\nimport VerticalPageLayout from \"../../components/vertical-page-layout\";\nimport WikiSearchForm from \"./components/wiki-search-form\";\nimport { WIKI_PAGE_KIND, validatePage } from \"../../helpers/nostr/wiki\";\nimport useTimelineLoader from \"../../hooks/use-timeline-loader\";\nimport { useReadRelays } from \"../../hooks/use-client-relays\";\nimport TimelineActionAndStatus from \"../../components/timeline/timeline-action-and-status\";\nimport { WIKI_RELAYS } from \"../../const\";\nimport { ExternalLinkIcon } from \"../../components/icons\";\nimport WikiLink from \"./components/wiki-link\";\nimport { useEffect } from \"react\";\nimport dictionaryService from \"../../services/dictionary\";\nimport UserAvatar from \"../../components/user/user-avatar\";\nimport HoverLinkOverlay from \"../../components/hover-link-overlay\";\n\nfunction eventFilter(event: NostrEvent) {\n  if (!validatePage(event)) return false;\n  return event.content.length > 0;\n}\n\nexport default function WikiHomeView() {\n  const relays = useReadRelays(WIKI_RELAYS);\n  const { loader, timeline: pages } = useTimelineLoader(`wiki-recent-pages`, relays, [{ kinds: [WIKI_PAGE_KIND] }], {\n    eventFilter,\n  });\n\n  useEffect(() => {\n    if (pages) {\n      for (const page of pages) {\n        dictionaryService.handleEvent(page);\n      }\n    }\n  }, [pages]);\n\n  const update = useForceUpdate();\n  useInterval(update, 1000);\n\n  return (\n    <VerticalPageLayout>\n      <Flex mx=\"auto\" mt=\"10vh\" mb=\"10vh\" direction=\"column\" alignItems=\"center\" maxW=\"full\">\n        <Heading>\n          <WikiLink topic=\"wikifreedia\" color=\"inherit\">\n            Wikifreedia\n          </WikiLink>\n        </Heading>\n        <Link isExternal color=\"blue.500\" href=\"https://wikifreedia.xyz/\">\n          wikifreedia.xyz <ExternalLinkIcon />\n        </Link>\n        <WikiSearchForm maxW=\"full\" mt=\"4\" />\n        <Button variant=\"link\" p=\"2\" mt=\"2\" as={RouterLink} to=\"/wiki/create\">\n          Create Page\n        </Button>\n      </Flex>\n\n      <Heading size=\"md\" mt=\"4\">\n        Recent Updates:\n      </Heading>\n      <SimpleGrid spacing=\"2\" columns={{ base: 1, lg: 2, xl: 3 }}>\n        {Array.from(dictionaryService.topics)\n          .filter(([_, sub]) => !!sub.value && sub.value.size > 0)\n          .sort((a, b) => b[1].value!.size - a[1].value!.size)\n          .map(([topic, sub]) => (\n            <LinkBox key={topic} p=\"2\">\n              <Heading size=\"md\">\n                <HoverLinkOverlay as={RouterLink} to={`/wiki/topic/${topic}`}>\n                  {topic}\n                </HoverLinkOverlay>\n              </Heading>\n              <AvatarGroup size=\"sm\">\n                {Array.from(sub.value!.values()).map((page) => (\n                  <UserAvatar pubkey={page.pubkey} />\n                ))}\n              </AvatarGroup>\n            </LinkBox>\n          ))}\n      </SimpleGrid>\n      <TimelineActionAndStatus timeline={loader} />\n    </VerticalPageLayout>\n  );\n}\n"],"names":["eventFilter","event","validatePage","WikiHomeView","relays","useReadRelays","WIKI_RELAYS","loader","pages","useTimelineLoader","WIKI_PAGE_KIND","useEffect","page","dictionaryService","update","useForceUpdate","useInterval","VerticalPageLayout","jsxs","Flex","jsx","Heading","WikiLink","Link","ExternalLinkIcon","WikiSearchForm","Button","RouterLink","SimpleGrid","_","sub","b","topic","LinkBox","HoverLinkOverlay","AvatarGroup","UserAvatar","TimelineActionAndStatus"],"mappings":"uQA4BA,SAASA,EAAYC,EAAmB,CACtC,OAAKC,EAAaD,CAAK,EAChBA,EAAM,QAAQ,OAAS,EADG,EAEnC,CAEA,SAAwBE,GAAe,CAC/B,MAAAC,EAASC,EAAcC,CAAW,EAClC,CAAE,OAAAC,EAAQ,SAAUC,GAAUC,EAAkB,oBAAqBL,EAAQ,CAAC,CAAE,MAAO,CAACM,CAAc,CAAG,CAAA,EAAG,CAChH,YAAAV,CAAA,CACD,EAEDW,EAAAA,UAAU,IAAM,CACd,GAAIH,EACF,UAAWI,KAAQJ,EACjBK,EAAkB,YAAYD,CAAI,CAEtC,EACC,CAACJ,CAAK,CAAC,EAEV,MAAMM,EAASC,IACf,OAAAC,EAAYF,EAAQ,GAAI,SAGrBG,EACC,CAAA,SAAA,CAAAC,EAAA,KAACC,EAAK,CAAA,GAAG,OAAO,GAAG,OAAO,GAAG,OAAO,UAAU,SAAS,WAAW,SAAS,KAAK,OAC9E,SAAA,CAACC,EAAAA,IAAAC,EAAA,CACC,eAACC,EAAS,CAAA,MAAM,cAAc,MAAM,UAAU,uBAE9C,CACF,CAAA,SACCC,EAAK,CAAA,WAAU,GAAC,MAAM,WAAW,KAAK,2BAA2B,SAAA,CAAA,yBAC/CC,EAAiB,EAAA,CAAA,EACpC,EACCJ,EAAA,IAAAK,EAAA,CAAe,KAAK,OAAO,GAAG,IAAI,EAClCL,EAAA,IAAAM,EAAA,CAAO,QAAQ,OAAO,EAAE,IAAI,GAAG,IAAI,GAAIC,EAAY,GAAG,eAAe,SAEtE,cAAA,CAAA,EACF,QAECN,EAAQ,CAAA,KAAK,KAAK,GAAG,IAAI,SAE1B,kBAAA,EACAD,EAAAA,IAACQ,EAAW,CAAA,QAAQ,IAAI,QAAS,CAAE,KAAM,EAAG,GAAI,EAAG,GAAI,CAAE,EACtD,eAAM,KAAKf,EAAkB,MAAM,EACjC,OAAO,CAAC,CAACgB,EAAGC,CAAG,IAAM,CAAC,CAACA,EAAI,OAASA,EAAI,MAAM,KAAO,CAAC,EACtD,KAAK,CAAC,EAAGC,IAAMA,EAAE,CAAC,EAAE,MAAO,KAAO,EAAE,CAAC,EAAE,MAAO,IAAI,EAClD,IAAI,CAAC,CAACC,EAAOF,CAAG,IACfZ,EAAAA,KAACe,EAAoB,CAAA,EAAE,IACrB,SAAA,CAAAb,EAAA,IAACC,EAAQ,CAAA,KAAK,KACZ,SAAAD,EAAAA,IAACc,EAAiB,CAAA,GAAIP,EAAY,GAAI,eAAeK,CAAK,GACvD,SAAAA,CACH,CAAA,EACF,EACAZ,MAACe,GAAY,KAAK,KACf,eAAM,KAAKL,EAAI,MAAO,OAAO,CAAC,EAAE,IAAKlB,GACnCQ,EAAAA,IAAAgB,EAAA,CAAW,OAAQxB,EAAK,OAAQ,CAClC,EACH,CAAA,GAVYoB,CAWd,CACD,EACL,EACAZ,EAAAA,IAACiB,EAAwB,CAAA,SAAU9B,CAAQ,CAAA,CAC7C,CAAA,CAAA,CAEJ"}